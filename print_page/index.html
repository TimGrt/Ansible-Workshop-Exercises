
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../assets/images/ansible-logo-black.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.13">
    
    
      
        <title>Ansible Workshop</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e359304.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      
  
  
    
    
  
  
  <style>:root{--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.25 12a.75.75 0 0 1-.22.53l-2.75 2.75a.75.75 0 0 1-1.06-1.06L7.44 12 5.22 9.78a.75.75 0 1 1 1.06-1.06l2.75 2.75c.141.14.22.331.22.53Zm2 2a.75.75 0 0 0 0 1.5h5a.75.75 0 0 0 0-1.5h-5Z"/><path d="M0 4.75C0 3.784.784 3 1.75 3h20.5c.966 0 1.75.784 1.75 1.75v14.5A1.75 1.75 0 0 1 22.25 21H1.75A1.75 1.75 0 0 1 0 19.25Zm1.75-.25a.25.25 0 0 0-.25.25v14.5c0 .138.112.25.25.25h20.5a.25.25 0 0 0 .25-.25V4.75a.25.25 0 0 0-.25-.25Z"/></svg>');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/print-site-enum-headings1.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings2.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings3.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings4.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings5.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings6.css">
    
      <link rel="stylesheet" href="../css/print-site.css">
    
      <link rel="stylesheet" href="../css/print-site-material.css">
    
      <link rel="stylesheet" href="../assets/stylesheets/tables.css">
    
    <script>__md_scope=new URL("/",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  
        <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function () {
            remove_material_navigation();remove_mkdocs_theme_navigation();generate_toc();
        })
        </script>
        </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#section-workshop-overview" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
            
  <!-- Add announcement here, including arbitrary HTML -->
  <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M1.75 1h12.5c.966 0 1.75.784 1.75 1.75v9.5A1.75 1.75 0 0 1 14.25 14H8.061l-2.574 2.573A1.458 1.458 0 0 1 3 15.543V14H1.75A1.75 1.75 0 0 1 0 12.25v-9.5C0 1.784.784 1 1.75 1ZM1.5 2.75v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25H1.75a.25.25 0 0 0-.25.25Z"/><path d="M22.5 8.75a.25.25 0 0 0-.25-.25h-3.5a.75.75 0 0 1 0-1.5h3.5c.966 0 1.75.784 1.75 1.75v9.5A1.75 1.75 0 0 1 22.25 20H21v1.543a1.457 1.457 0 0 1-2.487 1.03L15.939 20H10.75A1.75 1.75 0 0 1 9 18.25v-1.465a.75.75 0 0 1 1.5 0v1.465c0 .138.112.25.25.25h5.5a.75.75 0 0 1 .53.22l2.72 2.72v-2.19a.75.75 0 0 1 .75-.75h2a.25.25 0 0 0 .25-.25v-9.5Z"/></svg></span> &nbsp;The current Workshop URL: <b><a href="https://demo.redhat.com/workshop/pm6xgd" target="_blank">https://demo.redhat.com/workshop/pm6xgd</a></b>

          </div>
          
        </aside>
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Ansible Workshop" class="md-header__button md-logo" aria-label="Ansible Workshop" data-md-component="logo">
      
  <img src="../assets/images/ansible-logo-black.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Ansible Workshop
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="grey" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/TimGrt/Ansible-Workshop-Exercises" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    timgrt/ansible-workshop-exercises
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href=".." class="md-tabs__link">
          
  
    
  
  Workshop Overview

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../ansible-basics-overview/" class="md-tabs__link">
          
  
    
  
  Ansible Basics

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../automation-platform-overview/" class="md-tabs__link">
          
  
    
  
  Automation Platform

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../projects/projects-overview/" class="md-tabs__link">
          
  
    
  
  Projects

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../ansible-future-overview/" class="md-tabs__link">
          
  
    
  
  Ansible Future

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Ansible Workshop" class="md-nav__button md-logo" aria-label="Ansible Workshop" data-md-component="logo">
      
  <img src="../assets/images/ansible-logo-black.png" alt="logo">

    </a>
    Ansible Workshop
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/TimGrt/Ansible-Workshop-Exercises" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    timgrt/ansible-workshop-exercises
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href=".." class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Workshop Overview
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Workshop Overview
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../demo-environment/demo-environment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RedHat Demo Environment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../demo-environment/editor-alternatives/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Editor Alternatives
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Ansible Basics
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Ansible Basics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ansible-basics-overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ansible-core/ansible-core-intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1 - Check the Prerequisites
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ansible-core/ansible-core-basics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2 - The Ansible Basics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ansible-core/ansible-core-playbook/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3 - Writing your first Playbook
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ansible-core/ansible-core-variables/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4 - Using Variables
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ansible-core/ansible-core-conditionals/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5 - Work with conditionals
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ansible-core/ansible-core-loops/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6 - Run tasks multiple times
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ansible-core/ansible-core-handlers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7 - Trigger changes with Handlers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ansible-core/ansible-core-templates/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8 - Templating with Jinja2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ansible-core/ansible-core-roles/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9 - Reusability with Roles
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ansible-core/ansible-core-supplemental/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bonus exercises
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Automation Platform
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Automation Platform
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../automation-platform-overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../automation-platform/automation-platform-intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1 - AAP Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../automation-platform/automation-platform-inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2 - Inventory & Ad-hoc commands
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../automation-platform/automation-platform-projects/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3 - Projects & Job Templates
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../automation-platform/automation-platform-surveys/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4 - Surveys
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../automation-platform/automation-platform-rbac/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5 - Role-based access control
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../automation-platform/automation-platform-workflows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6 - Workflows
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../automation-platform/automation-platform-wrapup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7 - AAP Wrap up
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Projects
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Projects
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../projects/projects-overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../projects/linux-automation/grafana-project/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Project - Linux automation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../projects/network-automation/apic-project/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Project - Network automation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../projects/cloud-automation/aws-project/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Project - AWS Automation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../projects/dcim-ipam-automation/netbox-project/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Project - DCIM Automation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Ansible Future
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Ansible Future
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ansible-future-overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ansible-navigator/ansible-navigator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ansible Navigator
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#section-workshop-overview" class="md-nav__link">
    <span class="md-ellipsis">
      I. Workshop Overview
    </span>
  </a>
  
    <nav class="md-nav" aria-label="I. Workshop Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#index" class="md-nav__link">
    <span class="md-ellipsis">
      1. Ansible Workshop
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#demo-environment-demo-environment" class="md-nav__link">
    <span class="md-ellipsis">
      2. RedHat Demo Environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#demo-environment-editor-alternatives" class="md-nav__link">
    <span class="md-ellipsis">
      3. Editor Alternatives
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-ansible-basics" class="md-nav__link">
    <span class="md-ellipsis">
      II. Ansible Basics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="II. Ansible Basics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ansible-basics-overview" class="md-nav__link">
    <span class="md-ellipsis">
      4. Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ansible-core-ansible-core-intro" class="md-nav__link">
    <span class="md-ellipsis">
      5. 1 - Check the Prerequisites
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ansible-core-ansible-core-basics" class="md-nav__link">
    <span class="md-ellipsis">
      6. 2 - The Ansible Basics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ansible-core-ansible-core-playbook" class="md-nav__link">
    <span class="md-ellipsis">
      7. 3 - Writing your first Playbook
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ansible-core-ansible-core-variables" class="md-nav__link">
    <span class="md-ellipsis">
      8. 4 - Using Variables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ansible-core-ansible-core-conditionals" class="md-nav__link">
    <span class="md-ellipsis">
      9. 5 - Work with conditionals
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ansible-core-ansible-core-loops" class="md-nav__link">
    <span class="md-ellipsis">
      10. 6 - Run tasks multiple times
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ansible-core-ansible-core-handlers" class="md-nav__link">
    <span class="md-ellipsis">
      11. 7 - Trigger changes with Handlers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ansible-core-ansible-core-templates" class="md-nav__link">
    <span class="md-ellipsis">
      12. 8 - Templating with Jinja2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ansible-core-ansible-core-roles" class="md-nav__link">
    <span class="md-ellipsis">
      13. 9 - Reusability with Roles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ansible-core-ansible-core-supplemental" class="md-nav__link">
    <span class="md-ellipsis">
      14. Bonus exercises
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-automation-platform" class="md-nav__link">
    <span class="md-ellipsis">
      III. Automation Platform
    </span>
  </a>
  
    <nav class="md-nav" aria-label="III. Automation Platform">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#automation-platform-overview" class="md-nav__link">
    <span class="md-ellipsis">
      15. Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automation-platform-automation-platform-intro" class="md-nav__link">
    <span class="md-ellipsis">
      16. 1 - AAP Introduction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automation-platform-automation-platform-inventory" class="md-nav__link">
    <span class="md-ellipsis">
      17. 2 - Inventory & Ad-hoc commands
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automation-platform-automation-platform-projects" class="md-nav__link">
    <span class="md-ellipsis">
      18. 3 - Projects & Job Templates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automation-platform-automation-platform-surveys" class="md-nav__link">
    <span class="md-ellipsis">
      19. 4 - Surveys
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automation-platform-automation-platform-rbac" class="md-nav__link">
    <span class="md-ellipsis">
      20. 5 - Role-based access control
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automation-platform-automation-platform-workflows" class="md-nav__link">
    <span class="md-ellipsis">
      21. 6 - Workflows
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automation-platform-automation-platform-wrapup" class="md-nav__link">
    <span class="md-ellipsis">
      22. 7 - AAP Wrap up
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-projects" class="md-nav__link">
    <span class="md-ellipsis">
      IV. Projects
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IV. Projects">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#projects-projects-overview" class="md-nav__link">
    <span class="md-ellipsis">
      23. Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#projects-linux-automation-grafana-project" class="md-nav__link">
    <span class="md-ellipsis">
      24. Project - Linux automation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#projects-network-automation-apic-project" class="md-nav__link">
    <span class="md-ellipsis">
      25. Project - Network automation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#projects-cloud-automation-aws-project" class="md-nav__link">
    <span class="md-ellipsis">
      26. Project - AWS Automation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#projects-dcim-ipam-automation-netbox-project" class="md-nav__link">
    <span class="md-ellipsis">
      27. Project - DCIM Automation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-ansible-future" class="md-nav__link">
    <span class="md-ellipsis">
      V. Ansible Future
    </span>
  </a>
  
    <nav class="md-nav" aria-label="V. Ansible Future">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ansible-future-overview" class="md-nav__link">
    <span class="md-ellipsis">
      28. Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ansible-navigator-ansible-navigator" class="md-nav__link">
    <span class="md-ellipsis">
      29. Ansible Navigator
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                




                  


<div id="print-site-page" class="print-site-enumerate-headings print-site-enumerate-figures">
        <section id="print-site-cover-page">
            <div>

    
        <h1>Ansible Workshop</h1>
    

</div>

<p>
    <img src="../assets/images/computacenter.png" width=500/>
</p>




<p>
    <em>Copyright &copy; Computacenter 2023</em>
</p>

        </section>
        
        <div id="print-site-banner">
            <p>
    <b><em>This box will disappear when printing!</em></b>
</p>
<p>This page has combined all site pages into one. This cover page and a table of contents will be added.</p>
<p>You can export to PDF using <b>File > Print > Save as PDF</b> (or use <b>Ctrl-P</b> and set to <b>Save as PDF</b>).</p>
<p>See also <a href="https://timvink.github.io/mkdocs-print-site-plugin/how-to/export-PDF.html">Export to PDF</a>.</p>
        </div>
        
        <section class="print-page">
            <div id="print-page-toc" data-toc-depth="3">
                <nav role='navigation' class='print-page-toc-nav'>
                <h1 class='print-page-toc-title'>Table of Contents</h1>
                </nav>
            </div>
        </section>
        
                        <h1 class='nav-section-title' id='section-workshop-overview'>
                            Workshop Overview <a class='headerlink' href='#section-workshop-overview' title='Permanent link'>↵</a>
                        </h1>
                        <section class="print-page" id="index"><h1 id="index-ansible-workshop">Ansible Workshop</h1>
<p><strong>Welcome to the Computacenter Ansible Workshop!</strong></p>
<figure>
<p><img alt="CC Logo" src="../assets/images/computacenter.png#only-light" width="500" />
  <img alt="CC Logo" src="../assets/images/computacenter-white.png#only-dark" width="500" />
  </p>
<figcaption></figcaption>
</figure>
<p>Ansible is a radically simple IT automation system. It handles configuration management, application deployment, cloud provisioning, ad-hoc task execution, network automation, and multi-node orchestration.</p>
<p>You will learn all about Ansible:</p>
<ol>
<li>starting with the basics of understanding foundational command line activities</li>
<li>applying what you’ve learned to implement Ansible automation controller to your enterprise use cases.</li>
<li>learn about the Ansible future and network automation</li>
</ol>
<p>You’ll start off by writing your first Ansible playbook, work on Jinja templates, and implement higher-level Ansible roles. Next you’ll get started on automation controller, understand inventory and credential management, projects, job templates, surveys, workflows and more.</p>
<p>After finishing this lab you are ready to start using Ansible for your automation requirements.</p>
<h2 id="index-time-planning">Time planning</h2>
<p>The time required to do the workshops strongly depends on multiple factors: the length of the workshop. the number of participants, how familiar you are with Linux in general and how much discussions are done in between.</p>
<p>Having said that, the exercises themselves should take roughly 4-5 hours, not counting the projects.  </p>
<h2 id="index-lab-overview">Lab Overview</h2>
<figure>
<p><img alt="ansible rhel lab diagram"  src="../assets/images/rhel_lab_diagram.png" />
  </p>
<figcaption></figcaption>
</figure>
<!-- markdownlint-disable --></section><section class="print-page" id="demo-environment-demo-environment"><h1 id="demo-environment-demo-environment-redhat-demo-environment">RedHat Demo Environment</h1>
<p>Every Workshop attendant has his own demo environment.</p>
<h2 id="demo-environment-demo-environment-lab-diagram">Lab Diagram</h2>
<p>The Lab environment consist of an <em>Ansible control node</em> (called <code>ansible-1</code>) and three <em>Managed nodes</em> (called <code>node1</code>, <code>node2</code> and <code>node3</code>). All managed nodes are <abbr title="Red Hat Enterprise Linux">RHEL</abbr> 8 hosts and are reachable password-less with <abbr title="Secure Shell">SSH</abbr>.</p>
<p><img alt="ansible rhel lab diagram" src="../assets/images/rhel_lab_diagram.png" /></p>
<p>You will be logged in to the <em>Ansible Control node</em> with the Code editor <em>Visual Studio Code</em>. From here you will be writing all your playbooks and issuing all Ansible <abbr title="Command-Line Interface">CLI</abbr> commands.</p>
<h2 id="demo-environment-demo-environment-visual-studio-code">Visual Studio Code</h2>
<p>At its heart, Visual Studio Code is a code editor. Like many other code editors, VS Code adopts a common user interface and layout of an explorer on the left, showing all of the files and folders you have access to, and an editor on the right, showing the content of the files you have opened.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>It is highly recommended to use the <em>VS Code Editor</em> to write your playbooks, it has <strong>automatic saving</strong> and syntax highlighting enabled!</p>
</div>
<p>If you want the real <abbr title="YAML Ain't Markup Language">YAML</abbr> challenge, try to write all your playbooks in the terminal/on the command-line. Expect to struggle at first with indentation, which leads to errors trying to run your playbooks.<br />
Nevertheless, mastering to write Ansible playbooks without the help of a Code editor is the best possible way to really understand the <abbr title="YAML Ain't Markup Language">YAML</abbr> syntax. It doesn't take long and is highly rewarding.</p>
<h3 id="demo-environment-demo-environment-useful-vscode-configuration">Useful VScode configuration</h3>
<h4 id="demo-environment-demo-environment-color-theme-for-syntax-highlighting">Color theme for syntax highlighting</h4>
<p>The <em>Ansible</em> extension supports <em>syntax-highlighting</em> for Ansible content. Depending on the used <em>theme</em> of VScode, this might not be shown correctly. Use the <strong>Default Dark+</strong> theme.<br />
Click on <em>File</em> in the top menu bar, click on <em>Preferences</em> and open <em>Settings</em>. Search for <code>theme</code> and choose the <em>Dark+ (default dark)</em> from the drop-down menu.</p>
<p><img alt="Workbench Color Theme" src="../demo-environment/images/WorkbenchColorTheme.png" /></p>
<h4 id="demo-environment-demo-environment-terminal-scrollback">Terminal Scrollback</h4>
<p>By default, scrollback of only 1000 lines is possible. If you need to scroll back further, you need to adjust this limit.<br />
Click on <em>File</em> in the top menu bar, click on <em>Preferences</em> and open <em>Settings</em>. Search for <code>scrollback</code> and adjust the number to 10000 in the second configuration parameter (<em>Terminal &gt; Integrated: Scrollback</em>).</p>
<p><img alt="Terminal Scrollback configuration" src="../demo-environment/images/TerminalScrollback.png" /></p>
<!-- markdownlint-disable --></section><section class="print-page" id="demo-environment-editor-alternatives"><h1 id="demo-environment-editor-alternatives-editor-alternatives">Editor Alternatives</h1>
<p>It is recommended to use the <strong>VS Code Editor</strong> for your exercises, if you don't like it, you may use <strong>vi</strong> or <strong>vim</strong> in the terminal directly.<br />
If you don’t like these as an editor as well, feel free to use <strong>Nano</strong> or <strong>Midnight Commander</strong> (<strong>mc</strong>) in the <abbr title="Secure Shell">SSH</abbr> terminal. Here is a quick introduction to both. And no, I’ll refuse to talk about Emacs…​ ;-)</p>
<h2 id="demo-environment-editor-alternatives-midnight-commander-mc">Midnight Commander (mc)</h2>
<p>Mc is more then an editor, it’s a file manager. And it has this nice nineties feel about it…​ anyway we’ll focus on editing files here.</p>
<p>To open <strong>mc</strong> at the command-line prompt type:</p>
<div class="language-text highlight"><pre><span></span><code># mc
</code></pre></div>
<h3 id="demo-environment-editor-alternatives-basic-editing">Basic Editing</h3>
<p>Mc is controlled mainly through the function keys. This can pose all kinds of issues when run in a terminal session, e.g. <span class="keys"><kbd class="key-f10">F10</kbd></span> is most times caught as a shortcut by the terminal window.</p>
<p>To work around this:</p>
<ul>
<li>
<p>Try the combination <span class="keys"><kbd class="key-escape">Esc</kbd></span> <span class="keys"><kbd class="key-0">0</kbd></span> to get <span class="keys"><kbd class="key-f10">F10</kbd></span>. Don’t hold <span class="keys"><kbd class="key-escape">Esc</kbd></span>!</p>
</li>
<li>
<p>Use the mouse, all <strong>mc</strong> keys should be clickable, even if they don’t look it.</p>
</li>
</ul>
<p>To create a new file:</p>
<ul>
<li>
<p>Type <code>touch filename</code> in the command field to create an empty file</p>
</li>
<li>
<p>Navigate with the <strong>arrow keys</strong> in one of the panes to the new file</p>
</li>
<li>
<p>Hit (or click) <span class="keys"><kbd class="key-f4">F4</kbd></span> to start editing the file</p>
</li>
</ul>
<p>To save a file:</p>
<ul>
<li>Hit (or click) <span class="keys"><kbd class="key-f2">F2</kbd></span> and confirm with <span class="keys"><kbd class="key-enter">Enter</kbd></span></li>
</ul>
<p>To exit edit mode with or without saving:</p>
<ul>
<li>
<p>Hit <span class="keys"><kbd class="key-escape">Esc</kbd></span> <span class="keys"><kbd class="key-0">0</kbd></span> or click <span class="keys"><kbd class="key-f10">F10</kbd></span></p>
</li>
<li>
<p>If you did any changes you will be asked "Save before Close?".</p>
</li>
<li>
<p>Choose one of the options "Yes, No, Cancel" by moving with the <strong>arrow</strong> or <span class="keys"><kbd class="key-tab">Tab</kbd></span> keys (or click)</p>
</li>
</ul>
<p>Copy text internally:</p>
<ul>
<li>
<p>Position the cursor where you want to start to copy</p>
</li>
<li>
<p>Hit (or click) <span class="keys"><kbd class="key-f3">F3</kbd></span> to start selecting</p>
</li>
<li>
<p>Move the cursor to highlight/select the text you want to copy</p>
</li>
<li>
<p>Hit (or click) <span class="keys"><kbd class="key-f3">F3</kbd></span> again to stop selecting</p>
</li>
</ul>
<p>Paste text internally:</p>
<ul>
<li>
<p>Position the cursor where you want to paste the text</p>
</li>
<li>
<p>Hit (or click) <span class="keys"><kbd class="key-f5">F5</kbd></span> to paste a copy of the text</p>
</li>
<li>
<p>Hit (or select) <span class="keys"><kbd class="key-f6">F6</kbd></span> to cut the text and paste it here</p>
</li>
</ul>
<p>Copy text from external source:</p>
<ul>
<li>
<p>mark the text with the mouse, e.g. from the lab guide</p>
</li>
<li>
<p><strong>right-click → Copy</strong></p>
</li>
</ul>
<p>Paste text from external source:</p>
<ul>
<li>Click <strong>Edit → Paste</strong> in the terminal menu at the top</li>
</ul>
<h2 id="demo-environment-editor-alternatives-short-intro-to-the-nano-editor">Short Intro to the Nano Editor</h2>
<p>If you don’t like <strong>Vim</strong> and you feel too young for <strong>Midnight Commander</strong> use <strong>Nano</strong>, a simple to use command line editor.</p>
<h3 id="demo-environment-editor-alternatives-basic-commands">Basic Commands</h3>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><span class="keys"><kbd class="key-control">Ctrl</kbd></span> or <span class="keys"><kbd class="key-alt">Alt</kbd></span> means press and hold the Control or Alt key and then press the character after the dash.</p>
</div>
<p>To create a new file or open an existing file:</p>
<div class="language-text highlight"><pre><span></span><code># nano playbook.yml
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>When Nano asks for confirmation, it expects a <strong>y</strong> for yes or <strong>n</strong> for no.</p>
</div>
<p>To save the current file in Nano:</p>
<ul>
<li>Type <span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-o">O</kbd></span></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Depending if the file was changed or not Nano will ask for confirmation and the file name.</p>
</div>
<p>To leave Nano without saving the file (if something went wrong while editing and you just want out without changing anything):</p>
<ul>
<li>Type <span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-x">X</kbd></span> <strong>n</strong> <span class="keys"><kbd class="key-enter">Enter</kbd></span></li>
</ul>
<p>Copy and paste external text:</p>
<ul>
<li>
<p>mark the text with the mouse, e.g. from the lab guide</p>
</li>
<li>
<p><strong>right-click → Copy</strong></p>
</li>
<li>
<p><strong>right-click</strong> into the Nano terminal window, then click <strong>Paste</strong></p>
</li>
</ul>
<!-- markdownlint-disable --></section><h1 class='nav-section-title-end'>Ended: Workshop Overview</h1>
                        <h1 class='nav-section-title' id='section-ansible-basics'>
                            Ansible Basics <a class='headerlink' href='#section-ansible-basics' title='Permanent link'>↵</a>
                        </h1>
                        <section class="print-page" id="ansible-basics-overview"><h1 id="ansible-basics-overview-overview">Overview</h1>
<p>The first workshop day is all about getting to know Ansible and learning to write your first Ansible Playbooks.  </p>
<figure>
<p><a href="http://github.com/ansible/logos"><img _="," alt="Ansible Logo"  src="../assets/images/ansible-logo-black.png" width="200" /></a>
  </p>
<figcaption></figcaption>
</figure>
<p>You will complete the following exercises today:</p>
<ul>
<li><a href="#ansible-core-ansible-core-intro">Exercise 1 - Check the Prerequisites</a></li>
<li><a href="#ansible-core-ansible-core-basics">Exercise 2 - The Ansible Basics</a></li>
<li><a href="#ansible-core-ansible-core-playbook">Exercise 3 - Writing your first Playbook</a></li>
<li><a href="#ansible-core-ansible-core-variables">Exercise 4 - Using Variables</a></li>
<li><a href="#ansible-core-ansible-core-conditionals">Exercise 5 - Work with conditionals</a></li>
<li><a href="#ansible-core-ansible-core-loops">Exercise 6 - Run tasks multiple times</a></li>
<li><a href="#ansible-core-ansible-core-handlers">Exercise 7 - Trigger changes with Handlers</a></li>
<li><a href="#ansible-core-ansible-core-templates">Exercise 8 - Templating with Jinja2</a></li>
<li><a href="#ansible-core-ansible-core-roles">Exercise 9 - Reusability with Roles</a></li>
</ul>
<!-- markdownlint-disable --></section><section class="print-page" id="ansible-core-ansible-core-intro"><h1 id="ansible-core-ansible-core-intro-1-check-the-prerequisites">1 - Check the Prerequisites</h1>
<h2 id="ansible-core-ansible-core-intro-objective">Objective</h2>
<ul>
<li>Understand the lab topology and how to access the environment.</li>
<li>Understand how to work the workshop exercises</li>
<li>Understand challenge labs</li>
</ul>
<p>These first few lab exercises will be exploring the command-line utilities of the Ansible Automation Platform.  This includes</p>
<ul>
<li><a href="https://docs.ansible.com/core.html" target="_blank">ansible-core</a> - the base executable that provides the framework, language and functions that underpin the Ansible Automation Platform.  It also includes various cli tools like <code>ansible</code>, <code>ansible-playbook</code> and <code>ansible-doc</code>.  Ansible Core acts as the bridge between the upstream community with the free and open source Ansible and connects it to the downstream enterprise automation offering from Red Hat, the Ansible Automation Platform.</li>
<li><a href="https://github.com/ansible/ansible-navigator" target="_blank">ansible-navigator</a> - a command line utility and text-based user interface (TUI) for running and developing Ansible automation content.</li>
<li><a href="https://docs.ansible.com/automation-controller/latest/html/userguide/execution_environments.html" target="_blank">Execution Environments</a> - not specifically covered in this workshop (day 1) because the built-in Ansible Execution Environments already included all the Red Hat supported collections which includes all the collections we use for this workshop.  Execution Environments are container images that can be utilized as Ansible execution.</li>
<li><a href="https://github.com/ansible/ansible-builder" target="_blank">ansible-builder</a> - not specifically covered in this workshop, <code>ansible-builder</code> is a command line utility to automate the process of building Execution Environments.</li>
</ul>
<p>If you need more information on new Ansible Automation Platform components bookmark this landing page <a href="https://red.ht/AAP-20" target="_blank">https://red.ht/<abbr title="Ansible Automation Platform">AAP</abbr>-20</a></p>
<p>We will be using especially the <em>ansible-core</em> executable and the <abbr title="Command-Line Interface">CLI</abbr> tools it provides, as currently (Q1/2023) it is still the main interface to interact with Ansible.</p>
<p>In the (near) future this will be replaced/supplemented by the <em>Ansible Navigator</em>, which on the one hand brings more useful additional features and in the end serves a much greater purpose than just be a drop in replacement or alias to the currently used Ansible utilities. It requires a broader introduction and explanation regarding the use of containers and collections, which we will discuss on workshop day 3.<br />
Still, although we will be using the <em>ansible-core</em> executable in all exercises, it is shown how to also achieve everything using the <code>ansible-navigator</code> utility in a separate tab.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="ansible-core-ansible-core-intro-__tabbed_1_1" name="ansible-core-ansible-core-intro-__tabbed_1" type="radio" /><input id="ansible-core-ansible-core-intro-__tabbed_1_2" name="ansible-core-ansible-core-intro-__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="ansible-core-ansible-core-intro-__tabbed_1_1">Ansible</label><label for="ansible-core-ansible-core-intro-__tabbed_1_2">Navigator</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ansible-core-ansible-core-intro-__codelineno-0-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible-playbook<span class="w"> </span>--help
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#ansible-core-ansible-core-intro-__codelineno-0-2"></a><span class="go">usage: ansible-playbook [-h] [--version] [-v] [--private-key PRIVATE_KEY_FILE] [-u REMOTE_USER] [-c CONNECTION] [-T TIMEOUT] [--ssh-common-args SSH_COMMON_ARGS]</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#ansible-core-ansible-core-intro-__codelineno-0-3"></a><span class="go">                        [--sftp-extra-args SFTP_EXTRA_ARGS] [--scp-extra-args SCP_EXTRA_ARGS] [--ssh-extra-args SSH_EXTRA_ARGS]</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#ansible-core-ansible-core-intro-__codelineno-0-4"></a><span class="go">                        [-k | --connection-password-file CONNECTION_PASSWORD_FILE] [--force-handlers] [--flush-cache] [-b] [--become-method BECOME_METHOD] [--become-user BECOME_USER]</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#ansible-core-ansible-core-intro-__codelineno-0-5"></a><span class="go">                        [-K | --become-password-file BECOME_PASSWORD_FILE] [-t TAGS] [--skip-tags SKIP_TAGS] [-C] [--syntax-check] [-D] [-i INVENTORY] [--list-hosts] [-l SUBSET]</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#ansible-core-ansible-core-intro-__codelineno-0-6"></a><span class="go">                        [-e EXTRA_VARS] [--vault-id VAULT_IDS] [--ask-vault-password | --vault-password-file VAULT_PASSWORD_FILES] [-f FORKS] [-M MODULE_PATH] [--list-tasks]</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#ansible-core-ansible-core-intro-__codelineno-0-7"></a><span class="go">                        [--list-tags] [--step] [--start-at-task START_AT_TASK]</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#ansible-core-ansible-core-intro-__codelineno-0-8"></a><span class="go">                        playbook [playbook ...]</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#ansible-core-ansible-core-intro-__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#ansible-core-ansible-core-intro-__codelineno-0-10"></a><span class="go">Runs Ansible playbooks, executing the defined tasks on the targeted hosts.</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#ansible-core-ansible-core-intro-__codelineno-0-11"></a>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#ansible-core-ansible-core-intro-__codelineno-0-12"></a><span class="go">positional arguments:</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#ansible-core-ansible-core-intro-__codelineno-0-13"></a><span class="go">  playbook              Playbook(s)</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#ansible-core-ansible-core-intro-__codelineno-0-14"></a>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#ansible-core-ansible-core-intro-__codelineno-0-15"></a><span class="go">optional arguments:</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#ansible-core-ansible-core-intro-__codelineno-0-16"></a>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#ansible-core-ansible-core-intro-__codelineno-0-17"></a><span class="go">[...]</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default, the <em>ansible-navigator</em> will start in the <em>interactive</em> mode. This will launch the navigator in the <em>Text-based User Interface</em> (TUI) mode.<br />
If you want to use the tool the same way as with the normal <em>ansible-playbook</em> command, provide the parameter <code>-m stdout</code> which forces the output to the command-line (though, this prevents you from experiencing the cool features of the navigator).</p>
</div>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ansible-core-ansible-core-intro-__codelineno-1-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible-navigator<span class="w"> </span>--help
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#ansible-core-ansible-core-intro-__codelineno-1-2"></a><span class="go">usage: ansible-navigator [-h] [--version] [--rad ANSIBLE_RUNNER_ARTIFACT_DIR] [--rac ANSIBLE_RUNNER_ROTATE_ARTIFACTS_COUNT] [--rt ANSIBLE_RUNNER_TIMEOUT]</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#ansible-core-ansible-core-intro-__codelineno-1-3"></a><span class="go">                        [--cdcp COLLECTION_DOC_CACHE_PATH] [--ce CONTAINER_ENGINE] [--co CONTAINER_OPTIONS [CONTAINER_OPTIONS ...]] [--dc DISPLAY_COLOR] [--ecmd EDITOR_COMMAND]</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#ansible-core-ansible-core-intro-__codelineno-1-4"></a><span class="go">                        [--econ EDITOR_CONSOLE] [--ee EXECUTION_ENVIRONMENT] [--eei EXECUTION_ENVIRONMENT_IMAGE]</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#ansible-core-ansible-core-intro-__codelineno-1-5"></a><span class="go">                        [--eev EXECUTION_ENVIRONMENT_VOLUME_MOUNTS [EXECUTION_ENVIRONMENT_VOLUME_MOUNTS ...]] [--la LOG_APPEND] [--lf LOG_FILE] [--ll LOG_LEVEL] [-m MODE] [--osc4 OSC4]</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#ansible-core-ansible-core-intro-__codelineno-1-6"></a><span class="go">                        [--penv PASS_ENVIRONMENT_VARIABLE [PASS_ENVIRONMENT_VARIABLE ...]] [--pp PULL_POLICY] [--senv SET_ENVIRONMENT_VARIABLE [SET_ENVIRONMENT_VARIABLE ...]]</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#ansible-core-ansible-core-intro-__codelineno-1-7"></a><span class="go">                        {subcommand} --help ...</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#ansible-core-ansible-core-intro-__codelineno-1-8"></a>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#ansible-core-ansible-core-intro-__codelineno-1-9"></a><span class="go">optional arguments:</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#ansible-core-ansible-core-intro-__codelineno-1-10"></a>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#ansible-core-ansible-core-intro-__codelineno-1-11"></a><span class="go">[...]</span>
</span></code></pre></div>
</div>
</div>
</div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Although the tab is titled <strong>Ansible</strong>, this can be any of the <em>classic</em> utilities provided by the <em>ansible-core</em> executable. The <strong>Navigator</strong> tab uses the same utils but acts as an abstraction layer.</p>
</div>
<h2 id="ansible-core-ansible-core-intro-guide">Guide</h2>
<h3 id="ansible-core-ansible-core-intro-your-lab-environment">Your Lab Environment</h3>
<p>In this lab you work in a pre-configured lab environment. You will have access to the following hosts:</p>
<table>
<thead>
<tr>
<th>Role</th>
<th>Inventory name</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ansible Control Host</td>
<td>ansible-1</td>
</tr>
<tr>
<td>Managed Host 1</td>
<td>node1</td>
</tr>
<tr>
<td>Managed Host 2</td>
<td>node2</td>
</tr>
<tr>
<td>Managed Host 3</td>
<td>node3</td>
</tr>
</tbody>
</table>
<p>Every host is reachable via <abbr title="Secure Shell">SSH</abbr>.</p>
<h3 id="ansible-core-ansible-core-intro-step-1-access-the-environment">Step 1 - Access the Environment</h3>
<p>Connect to Visual Studio Code from the Workshop launch page (provided by your instructor).  The password is provided below the WebUI link.</p>
<p><img alt="launch page" src="../ansible-core/images/launch_page.png" /></p>
<p>Type in the provided password to connect.</p>
<p><img alt="login vs code" src="../ansible-core/images/vscode_login.png" /></p>
<p>Clicking on <code>File</code> &#8594; <code>Open Folder...</code> in the menu bar and open your <em>home directory</em> in Visual Studio Code (this folder should already be shown in the <em>Open Folder</em> pop-up and called <code>/home/student</code>. This will reload your browser window.</p>
<h3 id="ansible-core-ansible-core-intro-step-2-using-the-terminal">Step 2 - Using the Terminal</h3>
<p>Open a terminal in Visual Studio Code:</p>
<p><img alt="picture of new terminal" src="../ansible-core/images/vscode-new-terminal.png" /></p>
<p>Navigate to the <code>lab_inventory</code> directory on the Ansible control node terminal.</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ansible-core-ansible-core-intro-__codelineno-2-1"></a><span class="gp">[student@ansible-1 ~]$ </span><span class="nb">cd</span><span class="w"> </span>lab_inventory
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#ansible-core-ansible-core-intro-__codelineno-2-2"></a><span class="gp">[student@ansible-1 lab_inventory]$ </span><span class="nb">pwd</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#ansible-core-ansible-core-intro-__codelineno-2-3"></a><span class="go">/home/student/lab_inventory</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#ansible-core-ansible-core-intro-__codelineno-2-4"></a><span class="gp">[student@ansible-1 lab_inventory]$ </span>ls
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#ansible-core-ansible-core-intro-__codelineno-2-5"></a><span class="gp">[student@ansible-1 lab_inventory]$</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#ansible-core-ansible-core-intro-__codelineno-2-6"></a><span class="go">hosts</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#ansible-core-ansible-core-intro-__codelineno-2-7"></a><span class="gp">[student@ansible-1 lab_inventory]$ </span><span class="nb">cd</span><span class="w"> </span>..
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#ansible-core-ansible-core-intro-__codelineno-2-8"></a><span class="gp">[student@ansible-1 ~]$</span>
</span></code></pre></div>
<ul>
<li><code>~</code> - the tilde in this context is a shortcut for the home directory, i.e. <code>/home/student</code></li>
<li><code>cd</code> - Linux command to change directory</li>
<li><code>pwd</code> - Linux command for print working directory.  This will show the full path to the current working directory.</li>
</ul>
<h3 id="ansible-core-ansible-core-intro-step-3-challenge-labs">Step 3 - Challenge Labs</h3>
<p>You will soon discover that many chapters in this lab guide come with a "Challenge Lab" section. These labs are meant to give you a small task to solve using what you have learned so far. The solution of the task is shown underneath a warning sign.</p>
<!-- markdownlint-disable --></section><section class="print-page" id="ansible-core-ansible-core-basics"><h1 id="ansible-core-ansible-core-basics-2-the-ansible-basics">2 - The Ansible Basics</h1>
<h2 id="ansible-core-ansible-core-basics-objective">Objective</h2>
<p>In this exercise, we are going to explore the Ansible command line utility <code>ansible-inventory</code> to learn how to work with inventory files, using the utility <code>ansible</code> to run commands on hosts in the inventory file and getting help by the <code>ansible-doc</code> utility.<br />
The goal is to familiarize yourself with some of the different cli tools Ansible provides and how it can be used to enrich your Ansible experience.</p>
<p>This exercise will cover</p>
<ul>
<li>Working with inventory files</li>
<li>Locating and understanding an <code>ini</code> formatted inventory file</li>
<li>Running commands on inventory groups with Ansible Ad-Hoc commands</li>
<li>Listing modules and getting help when trying to use them</li>
</ul>
<h2 id="ansible-core-ansible-core-basics-guide">Guide</h2>
<h3 id="ansible-core-ansible-core-basics-step-1-check-the-infrastructure">Step 1 - Check the infrastructure</h3>
<p>The Ansible <em>master nodes</em> by default communicates via <abbr title="Secure Shell">SSH</abbr> with all <em>managed hosts</em>. As we are automating Linux hosts, this is fine and we need to make sure that we can reach every node with <abbr title="Secure Shell">SSH</abbr>.<br />
If you intend to automate hosts that can't be reached with the default method, e.g. Windows hosts, network infrastructure nodes, firewall hosts and so on, you need to instruct Ansible to use another communication method. In most cases, this is very easy and only requires setting a certain variable. But, let's focus on automating Linux nodes first.</p>
<p>You can reach all your <em>managed nodes</em> (the hosts that you want to automate) with <em>password-less <abbr title="Secure Shell">SSH</abbr></em>, you won't need to enter a password (or a user) when connecting to the nodes.</p>
<p>Try it out, <abbr title="Secure Shell">SSH</abbr> to <code>node1</code>:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ansible-core-ansible-core-basics-__codelineno-0-1"></a><span class="gp">[student1@ansible-1 ~]$ </span>ssh<span class="w"> </span>node1
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#ansible-core-ansible-core-basics-__codelineno-0-2"></a><span class="gp">[ec2-user@node1 ~]$</span>
</span></code></pre></div>
<p>As you can see, you are now the user <code>ec2-user</code> on <code>node1</code>. Leave <code>node1</code> again:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ansible-core-ansible-core-basics-__codelineno-1-1"></a><span class="gp">[ec-user@node1 ~]$ </span><span class="nb">exit</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#ansible-core-ansible-core-basics-__codelineno-1-2"></a><span class="gp">[student1@ansible-1 ~]$</span>
</span></code></pre></div>
<p>You can also connect to <code>node2</code> and <code>node3</code> with the same method. When you are finished, make sure you are back on your Ansible Control node (<code>ansible-1</code>), only here you can execute Ansible commands (as the Ansible binary is only installed on the Controller, Ansible works <em>agent-less</em>).</p>
<h3 id="ansible-core-ansible-core-basics-step-2-work-with-your-inventory">Step 2 - Work with your Inventory</h3>
<p>An inventory file is a text file that specifies the nodes that will be managed by the control machine. The nodes to be managed may include a list of hostnames and/or IP addresses of those nodes. The inventory file allows for nodes to be organized into groups by declaring a host group name within square brackets ([ ]).</p>
<p>To use the <code>ansible-inventory</code> command for host management, you need to provide an inventory file which defines a list of hosts to be managed from the control node.<br />
In this lab, the inventory is provided by your instructor. The inventory file is an <code>ini</code> formatted file listing your hosts, sorted in groups, additionally providing some variables. It looks like:</p>
<div class="language-ini no-copy highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ansible-core-ansible-core-basics-__codelineno-2-1"></a><span class="k">[web]</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#ansible-core-ansible-core-basics-__codelineno-2-2"></a><span class="na">node1 ansible_host</span><span class="o">=</span><span class="s">&lt;X.X.X.X&gt;</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#ansible-core-ansible-core-basics-__codelineno-2-3"></a><span class="na">node2 ansible_host</span><span class="o">=</span><span class="s">&lt;Y.Y.Y.Y&gt;</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#ansible-core-ansible-core-basics-__codelineno-2-4"></a><span class="na">node3 ansible_host</span><span class="o">=</span><span class="s">&lt;Z.Z.Z.Z&gt;</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#ansible-core-ansible-core-basics-__codelineno-2-5"></a>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#ansible-core-ansible-core-basics-__codelineno-2-6"></a><span class="k">[control]</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#ansible-core-ansible-core-basics-__codelineno-2-7"></a><span class="na">ansible-1 ansible_host</span><span class="o">=</span><span class="s">44.55.66.77</span>
</span></code></pre></div>
<p>Ansible is already configured to use the inventory specific to your environment. We will show you in the next step how that is done. For now, we will execute some simple commands to work with the inventory.</p>
<p>To reference all the inventory hosts, you supply a pattern to the <code>ansible-inventory</code> command. The <code>--list</code> option can be useful for displaying all the hosts that are part of an inventory file including what groups they are associated with.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="ansible-core-ansible-core-basics-__tabbed_1_1" name="ansible-core-ansible-core-basics-__tabbed_1" type="radio" /><input id="ansible-core-ansible-core-basics-__tabbed_1_2" name="ansible-core-ansible-core-basics-__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="ansible-core-ansible-core-basics-__tabbed_1_1">Ansible</label><label for="ansible-core-ansible-core-basics-__tabbed_1_2">Navigator</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ansible-core-ansible-core-basics-__codelineno-3-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible-inventory<span class="w"> </span>--list
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#ansible-core-ansible-core-basics-__codelineno-3-2"></a><span class="go">{</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#ansible-core-ansible-core-basics-__codelineno-3-3"></a><span class="go">    &quot;_meta&quot;: {</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#ansible-core-ansible-core-basics-__codelineno-3-4"></a><span class="go">        &quot;hostvars&quot;: {</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#ansible-core-ansible-core-basics-__codelineno-3-5"></a><span class="go">            &quot;ansible-1&quot;: {</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#ansible-core-ansible-core-basics-__codelineno-3-6"></a><span class="go">                &quot;ansible_host&quot;: &quot;3.236.186.92&quot;</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#ansible-core-ansible-core-basics-__codelineno-3-7"></a><span class="go">            },</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#ansible-core-ansible-core-basics-__codelineno-3-8"></a><span class="go">            &quot;node1&quot;: {</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#ansible-core-ansible-core-basics-__codelineno-3-9"></a><span class="go">                &quot;ansible_host&quot;: &quot;3.239.234.187&quot;</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#ansible-core-ansible-core-basics-__codelineno-3-10"></a><span class="go">            },</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#ansible-core-ansible-core-basics-__codelineno-3-11"></a><span class="go">            &quot;node2&quot;: {</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#ansible-core-ansible-core-basics-__codelineno-3-12"></a><span class="go">                &quot;ansible_host&quot;: &quot;75.101.228.151&quot;</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#ansible-core-ansible-core-basics-__codelineno-3-13"></a><span class="go">            },</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#ansible-core-ansible-core-basics-__codelineno-3-14"></a><span class="go">            &quot;node3&quot;: {</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#ansible-core-ansible-core-basics-__codelineno-3-15"></a><span class="go">                &quot;ansible_host&quot;: &quot;100.27.38.142&quot;</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#ansible-core-ansible-core-basics-__codelineno-3-16"></a><span class="go">            }</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#ansible-core-ansible-core-basics-__codelineno-3-17"></a><span class="go">        }</span>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#ansible-core-ansible-core-basics-__codelineno-3-18"></a><span class="go">    },</span>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19" href="#ansible-core-ansible-core-basics-__codelineno-3-19"></a><span class="go">    &quot;all&quot;: {</span>
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20" href="#ansible-core-ansible-core-basics-__codelineno-3-20"></a><span class="go">        &quot;children&quot;: [</span>
</span><span id="__span-3-21"><a id="__codelineno-3-21" name="__codelineno-3-21" href="#ansible-core-ansible-core-basics-__codelineno-3-21"></a><span class="go">            &quot;control&quot;,</span>
</span><span id="__span-3-22"><a id="__codelineno-3-22" name="__codelineno-3-22" href="#ansible-core-ansible-core-basics-__codelineno-3-22"></a><span class="go">            &quot;ungrouped&quot;,</span>
</span><span id="__span-3-23"><a id="__codelineno-3-23" name="__codelineno-3-23" href="#ansible-core-ansible-core-basics-__codelineno-3-23"></a><span class="go">            &quot;web&quot;</span>
</span><span id="__span-3-24"><a id="__codelineno-3-24" name="__codelineno-3-24" href="#ansible-core-ansible-core-basics-__codelineno-3-24"></a><span class="go">        ]</span>
</span><span id="__span-3-25"><a id="__codelineno-3-25" name="__codelineno-3-25" href="#ansible-core-ansible-core-basics-__codelineno-3-25"></a><span class="go">    },</span>
</span><span id="__span-3-26"><a id="__codelineno-3-26" name="__codelineno-3-26" href="#ansible-core-ansible-core-basics-__codelineno-3-26"></a><span class="go">    &quot;control&quot;: {</span>
</span><span id="__span-3-27"><a id="__codelineno-3-27" name="__codelineno-3-27" href="#ansible-core-ansible-core-basics-__codelineno-3-27"></a><span class="go">        &quot;hosts&quot;: [</span>
</span><span id="__span-3-28"><a id="__codelineno-3-28" name="__codelineno-3-28" href="#ansible-core-ansible-core-basics-__codelineno-3-28"></a><span class="go">            &quot;ansible-1&quot;</span>
</span><span id="__span-3-29"><a id="__codelineno-3-29" name="__codelineno-3-29" href="#ansible-core-ansible-core-basics-__codelineno-3-29"></a><span class="go">        ]</span>
</span><span id="__span-3-30"><a id="__codelineno-3-30" name="__codelineno-3-30" href="#ansible-core-ansible-core-basics-__codelineno-3-30"></a><span class="go">    },</span>
</span><span id="__span-3-31"><a id="__codelineno-3-31" name="__codelineno-3-31" href="#ansible-core-ansible-core-basics-__codelineno-3-31"></a><span class="go">    &quot;web&quot;: {</span>
</span><span id="__span-3-32"><a id="__codelineno-3-32" name="__codelineno-3-32" href="#ansible-core-ansible-core-basics-__codelineno-3-32"></a><span class="go">        &quot;hosts&quot;: [</span>
</span><span id="__span-3-33"><a id="__codelineno-3-33" name="__codelineno-3-33" href="#ansible-core-ansible-core-basics-__codelineno-3-33"></a><span class="go">            &quot;node1&quot;,</span>
</span><span id="__span-3-34"><a id="__codelineno-3-34" name="__codelineno-3-34" href="#ansible-core-ansible-core-basics-__codelineno-3-34"></a><span class="go">            &quot;node2&quot;,</span>
</span><span id="__span-3-35"><a id="__codelineno-3-35" name="__codelineno-3-35" href="#ansible-core-ansible-core-basics-__codelineno-3-35"></a><span class="go">            &quot;node3&quot;</span>
</span><span id="__span-3-36"><a id="__codelineno-3-36" name="__codelineno-3-36" href="#ansible-core-ansible-core-basics-__codelineno-3-36"></a><span class="go">        ]</span>
</span><span id="__span-3-37"><a id="__codelineno-3-37" name="__codelineno-3-37" href="#ansible-core-ansible-core-basics-__codelineno-3-37"></a><span class="go">    }</span>
</span><span id="__span-3-38"><a id="__codelineno-3-38" name="__codelineno-3-38" href="#ansible-core-ansible-core-basics-__codelineno-3-38"></a><span class="go">}</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ansible-core-ansible-core-basics-__codelineno-4-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible-navigator<span class="w"> </span>inventory<span class="w"> </span>--list<span class="w"> </span>-m<span class="w"> </span>stdout
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#ansible-core-ansible-core-basics-__codelineno-4-2"></a><span class="go">{</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#ansible-core-ansible-core-basics-__codelineno-4-3"></a><span class="go">    &quot;_meta&quot;: {</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#ansible-core-ansible-core-basics-__codelineno-4-4"></a><span class="go">        &quot;hostvars&quot;: {</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#ansible-core-ansible-core-basics-__codelineno-4-5"></a><span class="go">            &quot;ansible-1&quot;: {</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#ansible-core-ansible-core-basics-__codelineno-4-6"></a><span class="go">                &quot;ansible_host&quot;: &quot;3.236.186.92&quot;</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#ansible-core-ansible-core-basics-__codelineno-4-7"></a><span class="go">            },</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#ansible-core-ansible-core-basics-__codelineno-4-8"></a><span class="go">            &quot;node1&quot;: {</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#ansible-core-ansible-core-basics-__codelineno-4-9"></a><span class="go">                &quot;ansible_host&quot;: &quot;3.239.234.187&quot;</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#ansible-core-ansible-core-basics-__codelineno-4-10"></a><span class="go">            },</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#ansible-core-ansible-core-basics-__codelineno-4-11"></a><span class="go">            &quot;node2&quot;: {</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#ansible-core-ansible-core-basics-__codelineno-4-12"></a><span class="go">                &quot;ansible_host&quot;: &quot;75.101.228.151&quot;</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#ansible-core-ansible-core-basics-__codelineno-4-13"></a><span class="go">            },</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#ansible-core-ansible-core-basics-__codelineno-4-14"></a><span class="go">            &quot;node3&quot;: {</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#ansible-core-ansible-core-basics-__codelineno-4-15"></a><span class="go">                &quot;ansible_host&quot;: &quot;100.27.38.142&quot;</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#ansible-core-ansible-core-basics-__codelineno-4-16"></a><span class="go">            }</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#ansible-core-ansible-core-basics-__codelineno-4-17"></a><span class="go">        }</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#ansible-core-ansible-core-basics-__codelineno-4-18"></a><span class="go">    },</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#ansible-core-ansible-core-basics-__codelineno-4-19"></a><span class="go">    &quot;all&quot;: {</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#ansible-core-ansible-core-basics-__codelineno-4-20"></a><span class="go">        &quot;children&quot;: [</span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#ansible-core-ansible-core-basics-__codelineno-4-21"></a><span class="go">            &quot;control&quot;,</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#ansible-core-ansible-core-basics-__codelineno-4-22"></a><span class="go">            &quot;ungrouped&quot;,</span>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#ansible-core-ansible-core-basics-__codelineno-4-23"></a><span class="go">            &quot;web&quot;</span>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#ansible-core-ansible-core-basics-__codelineno-4-24"></a><span class="go">        ]</span>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#ansible-core-ansible-core-basics-__codelineno-4-25"></a><span class="go">    },</span>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#ansible-core-ansible-core-basics-__codelineno-4-26"></a><span class="go">    &quot;control&quot;: {</span>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#ansible-core-ansible-core-basics-__codelineno-4-27"></a><span class="go">        &quot;hosts&quot;: [</span>
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28" href="#ansible-core-ansible-core-basics-__codelineno-4-28"></a><span class="go">            &quot;ansible-1&quot;</span>
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29" href="#ansible-core-ansible-core-basics-__codelineno-4-29"></a><span class="go">        ]</span>
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30" href="#ansible-core-ansible-core-basics-__codelineno-4-30"></a><span class="go">    },</span>
</span><span id="__span-4-31"><a id="__codelineno-4-31" name="__codelineno-4-31" href="#ansible-core-ansible-core-basics-__codelineno-4-31"></a><span class="go">    &quot;web&quot;: {</span>
</span><span id="__span-4-32"><a id="__codelineno-4-32" name="__codelineno-4-32" href="#ansible-core-ansible-core-basics-__codelineno-4-32"></a><span class="go">        &quot;hosts&quot;: [</span>
</span><span id="__span-4-33"><a id="__codelineno-4-33" name="__codelineno-4-33" href="#ansible-core-ansible-core-basics-__codelineno-4-33"></a><span class="go">            &quot;node1&quot;,</span>
</span><span id="__span-4-34"><a id="__codelineno-4-34" name="__codelineno-4-34" href="#ansible-core-ansible-core-basics-__codelineno-4-34"></a><span class="go">            &quot;node2&quot;,</span>
</span><span id="__span-4-35"><a id="__codelineno-4-35" name="__codelineno-4-35" href="#ansible-core-ansible-core-basics-__codelineno-4-35"></a><span class="go">            &quot;node3&quot;</span>
</span><span id="__span-4-36"><a id="__codelineno-4-36" name="__codelineno-4-36" href="#ansible-core-ansible-core-basics-__codelineno-4-36"></a><span class="go">        ]</span>
</span><span id="__span-4-37"><a id="__codelineno-4-37" name="__codelineno-4-37" href="#ansible-core-ansible-core-basics-__codelineno-4-37"></a><span class="go">    }</span>
</span><span id="__span-4-38"><a id="__codelineno-4-38" name="__codelineno-4-38" href="#ansible-core-ansible-core-basics-__codelineno-4-38"></a><span class="go">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<p>If <code>--list</code> is too verbose, the option of <code>--graph</code> can be used to provide a more condensed version of <code>--list</code>.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="ansible-core-ansible-core-basics-__tabbed_2_1" name="ansible-core-ansible-core-basics-__tabbed_2" type="radio" /><input id="ansible-core-ansible-core-basics-__tabbed_2_2" name="ansible-core-ansible-core-basics-__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="ansible-core-ansible-core-basics-__tabbed_2_1">Ansible</label><label for="ansible-core-ansible-core-basics-__tabbed_2_2">Navigator</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ansible-core-ansible-core-basics-__codelineno-5-1"></a><span class="gp">[student1@ansible-1 ~]$ </span>ansible-inventory<span class="w"> </span>--graph
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#ansible-core-ansible-core-basics-__codelineno-5-2"></a><span class="go">@all:</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#ansible-core-ansible-core-basics-__codelineno-5-3"></a><span class="go">|--@control:</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#ansible-core-ansible-core-basics-__codelineno-5-4"></a><span class="go">|  |--ansible-1</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#ansible-core-ansible-core-basics-__codelineno-5-5"></a><span class="go">|--@ungrouped:</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#ansible-core-ansible-core-basics-__codelineno-5-6"></a><span class="go">|--@web:</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#ansible-core-ansible-core-basics-__codelineno-5-7"></a><span class="go">|  |--node1</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#ansible-core-ansible-core-basics-__codelineno-5-8"></a><span class="go">|  |--node2</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#ansible-core-ansible-core-basics-__codelineno-5-9"></a><span class="go">|  |--node3</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ansible-core-ansible-core-basics-__codelineno-6-1"></a><span class="gp">[student1@ansible-1 ~]$ </span>ansible-navigator<span class="w"> </span>inventory<span class="w"> </span>--graph<span class="w"> </span>-m<span class="w"> </span>stdout
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#ansible-core-ansible-core-basics-__codelineno-6-2"></a><span class="go">@all:</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#ansible-core-ansible-core-basics-__codelineno-6-3"></a><span class="go">|--@control:</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#ansible-core-ansible-core-basics-__codelineno-6-4"></a><span class="go">|  |--ansible-1</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#ansible-core-ansible-core-basics-__codelineno-6-5"></a><span class="go">|--@ungrouped:</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#ansible-core-ansible-core-basics-__codelineno-6-6"></a><span class="go">|--@web:</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#ansible-core-ansible-core-basics-__codelineno-6-7"></a><span class="go">|  |--node1</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#ansible-core-ansible-core-basics-__codelineno-6-8"></a><span class="go">|  |--node2</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#ansible-core-ansible-core-basics-__codelineno-6-9"></a><span class="go">|  |--node3</span>
</span></code></pre></div>
</div>
</div>
</div>
<p>We can clearly see that nodes: <code>node1</code>, <code>node2</code>, <code>node3</code> are part of the <code>web</code> group, while <code>ansible-1</code> is part of the <code>control</code> group.</p>
<p>An inventory file can contain a lot more information, it can organize your hosts in groups or define variables. In our example, the current inventory has the groups <code>web</code> and <code>control</code>.</p>
<p>Using the <code>ansible-inventory</code> command, we can also run commands that provide information only for one host or group. For example, give the following commands a try to see their output.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="ansible-core-ansible-core-basics-__tabbed_3_1" name="ansible-core-ansible-core-basics-__tabbed_3" type="radio" /><input id="ansible-core-ansible-core-basics-__tabbed_3_2" name="ansible-core-ansible-core-basics-__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="ansible-core-ansible-core-basics-__tabbed_3_1">Ansible</label><label for="ansible-core-ansible-core-basics-__tabbed_3_2">Navigator</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#ansible-core-ansible-core-basics-__codelineno-7-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible-inventory<span class="w"> </span>--graph<span class="w"> </span>web
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#ansible-core-ansible-core-basics-__codelineno-7-2"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible-inventory<span class="w"> </span>--graph<span class="w"> </span>control
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#ansible-core-ansible-core-basics-__codelineno-7-3"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible-inventory<span class="w"> </span>--host<span class="w"> </span>node1
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#ansible-core-ansible-core-basics-__codelineno-8-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible-navigator<span class="w"> </span>inventory<span class="w"> </span>--graph<span class="w"> </span>web<span class="w"> </span>-m<span class="w"> </span>stdout
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#ansible-core-ansible-core-basics-__codelineno-8-2"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible-navigator<span class="w"> </span>inventory<span class="w"> </span>--graph<span class="w"> </span>control<span class="w"> </span>-m<span class="w"> </span>stdout
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#ansible-core-ansible-core-basics-__codelineno-8-3"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible-navigator<span class="w"> </span>inventory<span class="w"> </span>--host<span class="w"> </span>node1<span class="w"> </span>-m<span class="w"> </span>stdout
</span></code></pre></div>
</div>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The inventory can contain more data.</p>
</div>
<h3 id="ansible-core-ansible-core-basics-step-3-use-the-inventory-with-ad-hoc-commands">Step 3 - Use the inventory with ad-hoc commands</h3>
<p>An Ansible ad hoc command uses the <code>ansible</code> command-line tool to automate a single task on one or more managed nodes. Ad hoc commands are quick and easy, but they are not reusable. So why learn about ad hoc commands first? Ad hoc commands demonstrate the simplicity and power of Ansible. The concepts you learn here will port over directly to the playbook language.</p>
<p>Ad hoc commands are great for tasks you repeat rarely. For example, if you want to power off all the machines in your lab for Christmas vacation, you could execute a quick one-liner in Ansible without writing a playbook. An ad hoc command looks like this:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#ansible-core-ansible-core-basics-__codelineno-9-1"></a><span class="go">ansible [pattern] -m [module] -a &quot;[module options]&quot;</span>
</span></code></pre></div>
<p>Ad hoc commands can be used perfectly to check if all hosts in your inventory are reachable. Ansible offers the <em>ping</em> module for that (this is not a real ICMP ping, though). Let's try to reach all hosts of the <em>web</em> group:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#ansible-core-ansible-core-basics-__codelineno-10-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible<span class="w"> </span>web<span class="w"> </span>-m<span class="w"> </span>ping
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#ansible-core-ansible-core-basics-__codelineno-10-2"></a><span class="go">node2 | SUCCESS =&gt; {</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#ansible-core-ansible-core-basics-__codelineno-10-3"></a><span class="go">    &quot;ansible_facts&quot;: {</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#ansible-core-ansible-core-basics-__codelineno-10-4"></a><span class="go">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#ansible-core-ansible-core-basics-__codelineno-10-5"></a><span class="go">    },</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#ansible-core-ansible-core-basics-__codelineno-10-6"></a><span class="go">    &quot;changed&quot;: false,</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#ansible-core-ansible-core-basics-__codelineno-10-7"></a><span class="go">    &quot;ping&quot;: &quot;pong&quot;</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#ansible-core-ansible-core-basics-__codelineno-10-8"></a><span class="go">}</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#ansible-core-ansible-core-basics-__codelineno-10-9"></a><span class="go">node3 | SUCCESS =&gt; {</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#ansible-core-ansible-core-basics-__codelineno-10-10"></a><span class="go">    &quot;ansible_facts&quot;: {</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#ansible-core-ansible-core-basics-__codelineno-10-11"></a><span class="go">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#ansible-core-ansible-core-basics-__codelineno-10-12"></a><span class="go">    },</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#ansible-core-ansible-core-basics-__codelineno-10-13"></a><span class="go">    &quot;changed&quot;: false,</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#ansible-core-ansible-core-basics-__codelineno-10-14"></a><span class="go">    &quot;ping&quot;: &quot;pong&quot;</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#ansible-core-ansible-core-basics-__codelineno-10-15"></a><span class="go">}</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#ansible-core-ansible-core-basics-__codelineno-10-16"></a><span class="go">node1 | SUCCESS =&gt; {</span>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#ansible-core-ansible-core-basics-__codelineno-10-17"></a><span class="go">    &quot;ansible_facts&quot;: {</span>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#ansible-core-ansible-core-basics-__codelineno-10-18"></a><span class="go">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19" href="#ansible-core-ansible-core-basics-__codelineno-10-19"></a><span class="go">    },</span>
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20" href="#ansible-core-ansible-core-basics-__codelineno-10-20"></a><span class="go">    &quot;changed&quot;: false,</span>
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21" href="#ansible-core-ansible-core-basics-__codelineno-10-21"></a><span class="go">    &quot;ping&quot;: &quot;pong&quot;</span>
</span><span id="__span-10-22"><a id="__codelineno-10-22" name="__codelineno-10-22" href="#ansible-core-ansible-core-basics-__codelineno-10-22"></a><span class="go">}</span>
</span></code></pre></div>
<p>Success! All three nodes are reachable, we get a <em>pong</em> back, we proved that we can establish a <abbr title="Secure Shell">SSH</abbr> connection and that the node(s) have a usable Python interpreter.</p>
<p>Try to run the same ad hoc command against the <em>control</em> group.  </p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#ansible-core-ansible-core-basics-__codelineno-11-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible<span class="w"> </span>control<span class="w"> </span>-m<span class="w"> </span>ping
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#ansible-core-ansible-core-basics-__codelineno-11-2"></a><span class="go">ansible-1 | SUCCESS =&gt; {</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#ansible-core-ansible-core-basics-__codelineno-11-3"></a><span class="go">    &quot;ansible_facts&quot;: {</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#ansible-core-ansible-core-basics-__codelineno-11-4"></a><span class="go">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#ansible-core-ansible-core-basics-__codelineno-11-5"></a><span class="go">    },</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#ansible-core-ansible-core-basics-__codelineno-11-6"></a><span class="go">    &quot;changed&quot;: false,</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#ansible-core-ansible-core-basics-__codelineno-11-7"></a><span class="go">    &quot;ping&quot;: &quot;pong&quot;</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#ansible-core-ansible-core-basics-__codelineno-11-8"></a><span class="go">}</span>
</span></code></pre></div>
<p>Let's play around with ad hoc commands a bit more. You can use every <em>module</em> that Ansible provides with ad hoc commands, we will learn more about <em>modules</em> later today. By default, Ansible will use the <em>command</em> module, you can send every linux command you want to all managed nodes, the arguments are provided with the <code>-a</code> parameter:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#ansible-core-ansible-core-basics-__codelineno-12-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible<span class="w"> </span>web<span class="w"> </span>-m<span class="w"> </span><span class="nb">command</span><span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;cat /etc/os-release&quot;</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#ansible-core-ansible-core-basics-__codelineno-12-2"></a><span class="go">node2 | CHANGED | rc=0 &gt;&gt;</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#ansible-core-ansible-core-basics-__codelineno-12-3"></a><span class="go">NAME=&quot;Red Hat Enterprise Linux&quot;</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#ansible-core-ansible-core-basics-__codelineno-12-4"></a><span class="go">VERSION=&quot;8.5 (Ootpa)&quot;</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#ansible-core-ansible-core-basics-__codelineno-12-5"></a><span class="go">ID=&quot;rhel&quot;</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#ansible-core-ansible-core-basics-__codelineno-12-6"></a><span class="go">ID_LIKE=&quot;fedora&quot;</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#ansible-core-ansible-core-basics-__codelineno-12-7"></a><span class="go">VERSION_ID=&quot;8.5&quot;</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#ansible-core-ansible-core-basics-__codelineno-12-8"></a><span class="go">PLATFORM_ID=&quot;platform:el8&quot;</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#ansible-core-ansible-core-basics-__codelineno-12-9"></a><span class="go">PRETTY_NAME=&quot;Red Hat Enterprise Linux 8.5 (Ootpa)&quot;</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#ansible-core-ansible-core-basics-__codelineno-12-10"></a><span class="go">ANSI_COLOR=&quot;0;31&quot;</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#ansible-core-ansible-core-basics-__codelineno-12-11"></a><span class="go">CPE_NAME=&quot;cpe:/o:redhat:enterprise_linux:8::baseos&quot;</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#ansible-core-ansible-core-basics-__codelineno-12-12"></a><span class="go">HOME_URL=&quot;https://www.redhat.com/&quot;</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#ansible-core-ansible-core-basics-__codelineno-12-13"></a><span class="go">DOCUMENTATION_URL=&quot;https://access.redhat.com/documentation/red_hat_enterprise_linux/8/&quot;</span>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#ansible-core-ansible-core-basics-__codelineno-12-14"></a><span class="go">BUG_REPORT_URL=&quot;https://bugzilla.redhat.com/&quot;</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#ansible-core-ansible-core-basics-__codelineno-12-15"></a>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#ansible-core-ansible-core-basics-__codelineno-12-16"></a><span class="go">REDHAT_BUGZILLA_PRODUCT=&quot;Red Hat Enterprise Linux 8&quot;</span>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#ansible-core-ansible-core-basics-__codelineno-12-17"></a><span class="go">REDHAT_BUGZILLA_PRODUCT_VERSION=8.5</span>
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#ansible-core-ansible-core-basics-__codelineno-12-18"></a><span class="go">REDHAT_SUPPORT_PRODUCT=&quot;Red Hat Enterprise Linux&quot;</span>
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#ansible-core-ansible-core-basics-__codelineno-12-19"></a><span class="go">REDHAT_SUPPORT_PRODUCT_VERSION=&quot;8.5&quot;</span>
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20" href="#ansible-core-ansible-core-basics-__codelineno-12-20"></a><span class="go">node3 | CHANGED | rc=0 &gt;&gt;</span>
</span><span id="__span-12-21"><a id="__codelineno-12-21" name="__codelineno-12-21" href="#ansible-core-ansible-core-basics-__codelineno-12-21"></a><span class="go">NAME=&quot;Red Hat Enterprise Linux&quot;</span>
</span><span id="__span-12-22"><a id="__codelineno-12-22" name="__codelineno-12-22" href="#ansible-core-ansible-core-basics-__codelineno-12-22"></a><span class="go">VERSION=&quot;8.5 (Ootpa)&quot;</span>
</span><span id="__span-12-23"><a id="__codelineno-12-23" name="__codelineno-12-23" href="#ansible-core-ansible-core-basics-__codelineno-12-23"></a><span class="go">ID=&quot;rhel&quot;</span>
</span><span id="__span-12-24"><a id="__codelineno-12-24" name="__codelineno-12-24" href="#ansible-core-ansible-core-basics-__codelineno-12-24"></a><span class="go">ID_LIKE=&quot;fedora&quot;</span>
</span><span id="__span-12-25"><a id="__codelineno-12-25" name="__codelineno-12-25" href="#ansible-core-ansible-core-basics-__codelineno-12-25"></a><span class="go">VERSION_ID=&quot;8.5&quot;</span>
</span><span id="__span-12-26"><a id="__codelineno-12-26" name="__codelineno-12-26" href="#ansible-core-ansible-core-basics-__codelineno-12-26"></a><span class="go">PLATFORM_ID=&quot;platform:el8&quot;</span>
</span><span id="__span-12-27"><a id="__codelineno-12-27" name="__codelineno-12-27" href="#ansible-core-ansible-core-basics-__codelineno-12-27"></a><span class="go">PRETTY_NAME=&quot;Red Hat Enterprise Linux 8.5 (Ootpa)&quot;</span>
</span><span id="__span-12-28"><a id="__codelineno-12-28" name="__codelineno-12-28" href="#ansible-core-ansible-core-basics-__codelineno-12-28"></a><span class="go">ANSI_COLOR=&quot;0;31&quot;</span>
</span><span id="__span-12-29"><a id="__codelineno-12-29" name="__codelineno-12-29" href="#ansible-core-ansible-core-basics-__codelineno-12-29"></a><span class="go">CPE_NAME=&quot;cpe:/o:redhat:enterprise_linux:8::baseos&quot;</span>
</span><span id="__span-12-30"><a id="__codelineno-12-30" name="__codelineno-12-30" href="#ansible-core-ansible-core-basics-__codelineno-12-30"></a><span class="go">HOME_URL=&quot;https://www.redhat.com/&quot;</span>
</span><span id="__span-12-31"><a id="__codelineno-12-31" name="__codelineno-12-31" href="#ansible-core-ansible-core-basics-__codelineno-12-31"></a><span class="go">DOCUMENTATION_URL=&quot;https://access.redhat.com/documentation/red_hat_enterprise_linux/8/&quot;</span>
</span><span id="__span-12-32"><a id="__codelineno-12-32" name="__codelineno-12-32" href="#ansible-core-ansible-core-basics-__codelineno-12-32"></a><span class="go">BUG_REPORT_URL=&quot;https://bugzilla.redhat.com/&quot;</span>
</span><span id="__span-12-33"><a id="__codelineno-12-33" name="__codelineno-12-33" href="#ansible-core-ansible-core-basics-__codelineno-12-33"></a>
</span><span id="__span-12-34"><a id="__codelineno-12-34" name="__codelineno-12-34" href="#ansible-core-ansible-core-basics-__codelineno-12-34"></a><span class="go">REDHAT_BUGZILLA_PRODUCT=&quot;Red Hat Enterprise Linux 8&quot;</span>
</span><span id="__span-12-35"><a id="__codelineno-12-35" name="__codelineno-12-35" href="#ansible-core-ansible-core-basics-__codelineno-12-35"></a><span class="go">REDHAT_BUGZILLA_PRODUCT_VERSION=8.5</span>
</span><span id="__span-12-36"><a id="__codelineno-12-36" name="__codelineno-12-36" href="#ansible-core-ansible-core-basics-__codelineno-12-36"></a><span class="go">REDHAT_SUPPORT_PRODUCT=&quot;Red Hat Enterprise Linux&quot;</span>
</span><span id="__span-12-37"><a id="__codelineno-12-37" name="__codelineno-12-37" href="#ansible-core-ansible-core-basics-__codelineno-12-37"></a><span class="go">REDHAT_SUPPORT_PRODUCT_VERSION=&quot;8.5&quot;</span>
</span><span id="__span-12-38"><a id="__codelineno-12-38" name="__codelineno-12-38" href="#ansible-core-ansible-core-basics-__codelineno-12-38"></a><span class="go">node1 | CHANGED | rc=0 &gt;&gt;</span>
</span><span id="__span-12-39"><a id="__codelineno-12-39" name="__codelineno-12-39" href="#ansible-core-ansible-core-basics-__codelineno-12-39"></a><span class="go">NAME=&quot;Red Hat Enterprise Linux&quot;</span>
</span><span id="__span-12-40"><a id="__codelineno-12-40" name="__codelineno-12-40" href="#ansible-core-ansible-core-basics-__codelineno-12-40"></a><span class="go">VERSION=&quot;8.5 (Ootpa)&quot;</span>
</span><span id="__span-12-41"><a id="__codelineno-12-41" name="__codelineno-12-41" href="#ansible-core-ansible-core-basics-__codelineno-12-41"></a><span class="go">ID=&quot;rhel&quot;</span>
</span><span id="__span-12-42"><a id="__codelineno-12-42" name="__codelineno-12-42" href="#ansible-core-ansible-core-basics-__codelineno-12-42"></a><span class="go">ID_LIKE=&quot;fedora&quot;</span>
</span><span id="__span-12-43"><a id="__codelineno-12-43" name="__codelineno-12-43" href="#ansible-core-ansible-core-basics-__codelineno-12-43"></a><span class="go">VERSION_ID=&quot;8.5&quot;</span>
</span><span id="__span-12-44"><a id="__codelineno-12-44" name="__codelineno-12-44" href="#ansible-core-ansible-core-basics-__codelineno-12-44"></a><span class="go">PLATFORM_ID=&quot;platform:el8&quot;</span>
</span><span id="__span-12-45"><a id="__codelineno-12-45" name="__codelineno-12-45" href="#ansible-core-ansible-core-basics-__codelineno-12-45"></a><span class="go">PRETTY_NAME=&quot;Red Hat Enterprise Linux 8.5 (Ootpa)&quot;</span>
</span><span id="__span-12-46"><a id="__codelineno-12-46" name="__codelineno-12-46" href="#ansible-core-ansible-core-basics-__codelineno-12-46"></a><span class="go">ANSI_COLOR=&quot;0;31&quot;</span>
</span><span id="__span-12-47"><a id="__codelineno-12-47" name="__codelineno-12-47" href="#ansible-core-ansible-core-basics-__codelineno-12-47"></a><span class="go">CPE_NAME=&quot;cpe:/o:redhat:enterprise_linux:8::baseos&quot;</span>
</span><span id="__span-12-48"><a id="__codelineno-12-48" name="__codelineno-12-48" href="#ansible-core-ansible-core-basics-__codelineno-12-48"></a><span class="go">HOME_URL=&quot;https://www.redhat.com/&quot;</span>
</span><span id="__span-12-49"><a id="__codelineno-12-49" name="__codelineno-12-49" href="#ansible-core-ansible-core-basics-__codelineno-12-49"></a><span class="go">DOCUMENTATION_URL=&quot;https://access.redhat.com/documentation/red_hat_enterprise_linux/8/&quot;</span>
</span><span id="__span-12-50"><a id="__codelineno-12-50" name="__codelineno-12-50" href="#ansible-core-ansible-core-basics-__codelineno-12-50"></a><span class="go">BUG_REPORT_URL=&quot;https://bugzilla.redhat.com/&quot;</span>
</span><span id="__span-12-51"><a id="__codelineno-12-51" name="__codelineno-12-51" href="#ansible-core-ansible-core-basics-__codelineno-12-51"></a>
</span><span id="__span-12-52"><a id="__codelineno-12-52" name="__codelineno-12-52" href="#ansible-core-ansible-core-basics-__codelineno-12-52"></a><span class="go">REDHAT_BUGZILLA_PRODUCT=&quot;Red Hat Enterprise Linux 8&quot;</span>
</span><span id="__span-12-53"><a id="__codelineno-12-53" name="__codelineno-12-53" href="#ansible-core-ansible-core-basics-__codelineno-12-53"></a><span class="go">REDHAT_BUGZILLA_PRODUCT_VERSION=8.5</span>
</span><span id="__span-12-54"><a id="__codelineno-12-54" name="__codelineno-12-54" href="#ansible-core-ansible-core-basics-__codelineno-12-54"></a><span class="go">REDHAT_SUPPORT_PRODUCT=&quot;Red Hat Enterprise Linux&quot;</span>
</span><span id="__span-12-55"><a id="__codelineno-12-55" name="__codelineno-12-55" href="#ansible-core-ansible-core-basics-__codelineno-12-55"></a><span class="go">REDHAT_SUPPORT_PRODUCT_VERSION=&quot;8.5&quot;</span>
</span></code></pre></div>
<p>You can shorten the command and leave out <code>-m command</code> as this module is used by default:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#ansible-core-ansible-core-basics-__codelineno-13-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible<span class="w"> </span>control<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;uname -a&quot;</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#ansible-core-ansible-core-basics-__codelineno-13-2"></a><span class="go">ansible-1 | CHANGED | rc=0 &gt;&gt;</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#ansible-core-ansible-core-basics-__codelineno-13-3"></a><span class="go">Linux ansible-1.example.com 4.18.0-348.12.2.el8_5.x86_64 #1 SMP Mon Jan 17 07:06:06 EST 2022 x86_64 x86_64 x86_64 GNU/Linux</span>
</span></code></pre></div>
<p>Ad hoc command are very useful to gather information about your managed nodes, the <em>setup</em> module is used. Try that against one host alone (so you won't get overwhelmed with output):</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#ansible-core-ansible-core-basics-__codelineno-14-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible<span class="w"> </span>node1<span class="w"> </span>-m<span class="w"> </span>setup
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#ansible-core-ansible-core-basics-__codelineno-14-2"></a><span class="go">node1 | SUCCESS =&gt; {</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#ansible-core-ansible-core-basics-__codelineno-14-3"></a><span class="go">    &quot;ansible_facts&quot;: {</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#ansible-core-ansible-core-basics-__codelineno-14-4"></a><span class="go">        &quot;ansible_all_ipv4_addresses&quot;: [</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#ansible-core-ansible-core-basics-__codelineno-14-5"></a><span class="go">            &quot;172.16.9.82&quot;</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#ansible-core-ansible-core-basics-__codelineno-14-6"></a><span class="go">        ],</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#ansible-core-ansible-core-basics-__codelineno-14-7"></a><span class="go">        &quot;ansible_all_ipv6_addresses&quot;: [</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#ansible-core-ansible-core-basics-__codelineno-14-8"></a><span class="go">            &quot;fe80::a4:bff:fea5:6d70&quot;</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#ansible-core-ansible-core-basics-__codelineno-14-9"></a><span class="go">        ],</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#ansible-core-ansible-core-basics-__codelineno-14-10"></a><span class="go">        &quot;ansible_apparmor&quot;: {</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#ansible-core-ansible-core-basics-__codelineno-14-11"></a><span class="go">            &quot;status&quot;: &quot;disabled&quot;</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#ansible-core-ansible-core-basics-__codelineno-14-12"></a><span class="go">        },</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#ansible-core-ansible-core-basics-__codelineno-14-13"></a><span class="go">        &quot;ansible_architecture&quot;: &quot;x86_64&quot;,</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#ansible-core-ansible-core-basics-__codelineno-14-14"></a><span class="go">        &quot;ansible_bios_date&quot;: &quot;10/16/2017&quot;,</span>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#ansible-core-ansible-core-basics-__codelineno-14-15"></a><span class="go">        &quot;ansible_bios_vendor&quot;: &quot;Amazon EC2&quot;,</span>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#ansible-core-ansible-core-basics-__codelineno-14-16"></a><span class="go">        &quot;ansible_bios_version&quot;: &quot;1.0&quot;,</span>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#ansible-core-ansible-core-basics-__codelineno-14-17"></a><span class="go">...</span>
</span></code></pre></div>
<p>You will get loads of useful information and you can use every bit as variables in your playbooks later on! We will use facts in a later exercise again.</p>
<!-- markdownlint-disable --></section><section class="print-page" id="ansible-core-ansible-core-playbook"><h1 id="ansible-core-ansible-core-playbook-3-writing-your-first-playbook">3 - Writing your first Playbook</h1>
<h2 id="ansible-core-ansible-core-playbook-objective">Objective</h2>
<p>This exercise covers using Ansible to build two Apache web servers on Red Hat Enterprise Linux. This exercise covers the following Ansible fundamentals:</p>
<ul>
<li>Understanding Ansible module parameters</li>
<li>Understanding and using the following modules<ul>
<li><a href="https://docs.ansible.com/ansible/latest/modules/yum_module.html" target="_blank">yum module</a></li>
<li><a href="https://docs.ansible.com/ansible/latest/modules/service_module.html" target="_blank">service module</a></li>
<li><a href="https://docs.ansible.com/ansible/latest/modules/copy_module.html" target="_blank">copy module</a></li>
</ul>
</li>
<li>Understanding <a href="https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_intro.html#desired-state-and-idempotency" target="_blank">Idempotence</a> and how Ansible modules can be idempotent</li>
</ul>
<h2 id="ansible-core-ansible-core-playbook-guide">Guide</h2>
<p>Playbooks are files which describe the desired configurations or steps to implement on managed hosts. Playbooks can change lengthy, complex administrative tasks into easily repeatable routines with predictable and successful outcomes.</p>
<p>A playbook can have multiple plays and a play can have one or multiple tasks. In a task a <em>module</em> is called, like the modules in the previous chapter. The goal of a <em>play</em> is to map a group of hosts.  The goal of a <em>task</em> is to implement modules against those hosts.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Here is a nice analogy: When Ansible modules are the tools in your workshop, the inventory is the materials and the Playbooks are the instructions.</p>
</div>
<h3 id="ansible-core-ansible-core-playbook-step-1-playbook-basics">Step 1 - Playbook Basics</h3>
<p>Playbooks are text files written in <abbr title="YAML Ain't Markup Language">YAML</abbr> format and therefore need:</p>
<ul>
<li>
<p>to start with three dashes (<code>---</code>)</p>
</li>
<li>
<p>proper indentation using spaces and <strong>not</strong> tabs!</p>
</li>
</ul>
<p>There are some important concepts:</p>
<ul>
<li>
<p><strong>hosts</strong>: the managed hosts to perform the tasks on</p>
</li>
<li>
<p><strong>tasks</strong>: the operations to be performed by invoking Ansible modules and passing them the necessary options</p>
</li>
<li>
<p><strong>become</strong>: privilege escalation in playbooks</p>
</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The ordering of the contents within a Playbook is important, because Ansible executes plays and tasks in the order they are presented.</p>
</div>
<p>A Playbook should be <strong>idempotent</strong>, so if a Playbook is run once to put the hosts in the correct state, it should be safe to run it a second time and it should make no further changes to the hosts.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Most Ansible modules are idempotent, so it is relatively easy to ensure this is true.</p>
</div>
<h3 id="ansible-core-ansible-core-playbook-step-2-directory-structure-and-files-for-your-playbook">Step 2 - Directory Structure and files for your Playbook</h3>
<p>Enough theory, it’s time to create your first Ansible playbook. In this lab you create a playbook to set up an Apache web server in three steps:</p>
<ol>
<li>Install httpd package</li>
<li>Enable/start httpd service</li>
<li>Copy over an web.html file to each web host</li>
</ol>
<p>This Playbook makes sure the package containing the Apache web server is installed on <code>node1</code>.</p>
<p>There is a <a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_best_practices.html" target="_blank">best practice Guide</a> on the preferred directory structures for playbooks.  We strongly encourage you to read and understand these practices as you develop your Ansible skills.<br />
That said, our playbook today is very basic and creating a complex structure will just confuse things.</p>
<p>Instead, we are going to create a very simple directory structure for our playbook, and add just a couple of files to it.</p>
<p>On your control host <strong>ansible-1</strong>, create a directory called <code>ansible-files</code> in your home directory and change directories into it:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ansible-core-ansible-core-playbook-__codelineno-0-1"></a><span class="gp">[student@ansible-1 ~]$ </span>mkdir<span class="w"> </span>ansible-files
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#ansible-core-ansible-core-playbook-__codelineno-0-2"></a><span class="gp">[student@ansible-1 ~]$ </span><span class="nb">cd</span><span class="w"> </span>ansible-files/
</span></code></pre></div>
<p>Add a file called <code>apache.yml</code> with the following content. As discussed in the previous exercises, use <code>vi</code>/<code>vim</code> or, if you are new to editors on the command line, check out the <a href="#demo-environment-editor-alternatives">editor alternatives</a> again.</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ansible-core-ansible-core-playbook-__codelineno-1-1"></a><span class="nn">---</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#ansible-core-ansible-core-playbook-__codelineno-1-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Apache server installed</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#ansible-core-ansible-core-playbook-__codelineno-1-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node1</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#ansible-core-ansible-core-playbook-__codelineno-1-4"></a><span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span></code></pre></div>
<p>This shows one of Ansible’s strengths: The Playbook syntax is easy to read and understand. In this Playbook:</p>
<ul>
<li>A name is given for the play via <code>name:</code>.</li>
<li>The host to run the playbook against is defined via <code>hosts:</code>.</li>
<li>We enable user privilege escalation with <code>become:</code>.</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You obviously need to use privilege escalation to install a package or run any other task that requires root permissions. This is done in the Playbook by <code>become: true</code>.</p>
</div>
<p>Now that we've defined the play, let's add a task to get something done. We will add a task in which yum will ensure that the Apache package is installed in the latest version. Modify the file so that it looks like the following listing:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ansible-core-ansible-core-playbook-__codelineno-2-1"></a><span class="nn">---</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#ansible-core-ansible-core-playbook-__codelineno-2-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Apache server installed</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#ansible-core-ansible-core-playbook-__codelineno-2-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node1</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#ansible-core-ansible-core-playbook-__codelineno-2-4"></a><span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#ansible-core-ansible-core-playbook-__codelineno-2-5"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#ansible-core-ansible-core-playbook-__codelineno-2-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install Apache package</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#ansible-core-ansible-core-playbook-__codelineno-2-7"></a><span class="w">      </span><span class="nt">ansible.builtin.yum</span><span class="p">:</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#ansible-core-ansible-core-playbook-__codelineno-2-8"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#ansible-core-ansible-core-playbook-__codelineno-2-9"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span></code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Since playbooks are written in <abbr title="YAML Ain't Markup Language">YAML</abbr>, alignment of the lines and keywords is crucial. Make sure to vertically align the <em>t</em> in <code>task</code> with the <em>b</em> in <code>become</code>. Once you are more familiar with Ansible, make sure to take some time and study a bit the <a href="https://docs.ansible.com/ansible/latest/reference_appendices/YAMLSyntax.html" target="_blank"><abbr title="YAML Ain't Markup Language">YAML</abbr> Syntax</a>.</p>
</div>
<p>In the added lines:</p>
<ul>
<li>We started the tasks part with the keyword <code>tasks:</code>.</li>
<li>A task is named and the module for the task is referenced. Here it uses the <code>yum</code> module.</li>
<li>Parameters for the module are added:<ul>
<li><code>name:</code> to identify the package name</li>
<li><code>state:</code> to define the wanted state of the package</li>
</ul>
</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The module parameters are individual to each module. If in doubt, look them up again with <code>ansible-doc</code>.</p>
</div>
<p>Save your playbook and exit your editor.</p>
<h3 id="ansible-core-ansible-core-playbook-step-3-running-the-playbook">Step 3 - Running the Playbook</h3>
<p>To run your playbook, use the <code>ansible-playbook &lt;playbook&gt;</code> command as follows:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="ansible-core-ansible-core-playbook-__tabbed_1_1" name="ansible-core-ansible-core-playbook-__tabbed_1" type="radio" /><input id="ansible-core-ansible-core-playbook-__tabbed_1_2" name="ansible-core-ansible-core-playbook-__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="ansible-core-ansible-core-playbook-__tabbed_1_1">Ansible</label><label for="ansible-core-ansible-core-playbook-__tabbed_1_2">Navigator</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ansible-core-ansible-core-playbook-__codelineno-3-1"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>ansible-playbook<span class="w"> </span>apache.yml
</span></code></pre></div>
<details class="failure">
<summary>What does <code>Invalid callback for stdout specified</code> mean?</summary>
<p>If you see this error, this is not your fault, but a missing <em>plugin</em>.<br />
In the demo environment, only the <code>ansible-core</code> package is installed. The missing plugin (a <em>callback</em> plugin formats the output Ansible is producing) is not part of the <code>ansible.builtin</code> collection, you need to install it.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ansible-core-ansible-core-playbook-__codelineno-4-1"></a>ansible-galaxy<span class="w"> </span>collection<span class="w"> </span>install<span class="w"> </span>community.general
</span></code></pre></div>
<p>If you want to know where this configuration is stored, take a look at the following tip.</p>
</details>
</div>
<div class="tabbed-block">
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ansible-core-ansible-core-playbook-__codelineno-5-1"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>ansible-navigator<span class="w"> </span>run<span class="w"> </span>apache.yml<span class="w"> </span>-m<span class="w"> </span>stdout
</span></code></pre></div>
</div>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The existing <code>/etc/ansible/ansible.cfg</code> file provides the location of your inventory file. If this was not set within your <code>ansible.cfg</code> file, the command to run the playbook would be:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ansible-core-ansible-core-playbook-__codelineno-6-1"></a>ansible-playbook<span class="w"> </span>-i<span class="w"> </span>/home/student/lab_inventory/hosts<span class="w"> </span>apache.yml
</span></code></pre></div>
<p>The configuration file does set some more parameters, take a look. If you want to know which config file is used and where it is stored, run <code>ansible --version</code>. The output shows the currently used config file.</p>
</div>
<p>Once the playbook has completed, connect to <code>node1</code> via <abbr title="Secure Shell">SSH</abbr> to make sure Apache has been installed:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#ansible-core-ansible-core-playbook-__codelineno-7-1"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>ssh<span class="w"> </span>node1
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#ansible-core-ansible-core-playbook-__codelineno-7-2"></a><span class="go">Last login: Wed May 15 14:03:45 2019 from 44.55.66.77</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#ansible-core-ansible-core-playbook-__codelineno-7-3"></a><span class="go">Managed by Ansible</span>
</span></code></pre></div>
<p>Use the command <code>rpm -qi httpd</code> to verify httpd is installed:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#ansible-core-ansible-core-playbook-__codelineno-8-1"></a><span class="gp">[ec2-user@node1 ~]$ </span>rpm<span class="w"> </span>-qi<span class="w"> </span>httpd
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#ansible-core-ansible-core-playbook-__codelineno-8-2"></a><span class="go">Name        : httpd</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#ansible-core-ansible-core-playbook-__codelineno-8-3"></a><span class="go">Version     : 2.4.37</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#ansible-core-ansible-core-playbook-__codelineno-8-4"></a><span class="go">[...]</span>
</span></code></pre></div>
<p>Log out of <code>node1</code> with the command <code>exit</code> so that you are back on the control host and verify the installed package with an Ansible playbook named <code>package.yml</code>. Create the file and paste in the following content:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#ansible-core-ansible-core-playbook-__codelineno-9-1"></a><span class="nn">---</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#ansible-core-ansible-core-playbook-__codelineno-9-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Check packages</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#ansible-core-ansible-core-playbook-__codelineno-9-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node1</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#ansible-core-ansible-core-playbook-__codelineno-9-4"></a><span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#ansible-core-ansible-core-playbook-__codelineno-9-5"></a><span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#ansible-core-ansible-core-playbook-__codelineno-9-6"></a><span class="w">    </span><span class="nt">package</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;httpd&quot;</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#ansible-core-ansible-core-playbook-__codelineno-9-7"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#ansible-core-ansible-core-playbook-__codelineno-9-8"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Gather the package facts</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#ansible-core-ansible-core-playbook-__codelineno-9-9"></a><span class="w">      </span><span class="nt">ansible.builtin.package_facts</span><span class="p">:</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#ansible-core-ansible-core-playbook-__codelineno-9-10"></a><span class="w">        </span><span class="nt">manager</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">auto</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#ansible-core-ansible-core-playbook-__codelineno-9-11"></a>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#ansible-core-ansible-core-playbook-__codelineno-9-12"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Output message if package is installed</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#ansible-core-ansible-core-playbook-__codelineno-9-13"></a><span class="w">      </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#ansible-core-ansible-core-playbook-__codelineno-9-14"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">package</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">Version</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">ansible_facts.packages[package][0].version</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">installed!&quot;</span>
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The playbook (and some of the following playbooks) make use of <em>variables</em>, you will learn about them in the next chapter.</p>
</div>
<p>The playbook has two tasks, the first one uses the <code>package_facts</code> module, it does what it says, it gathers information about packages. These facts are not gathered by default with the "Gather facts" tasks (which uses the <code>setup</code> module) and must be collected separately.<br />
The second task uses the <code>debug</code> module. The variable <em>ansible_facts</em> is extended with the <em>packages</em> key, which contains a dictionary with <strong>all</strong> packages installed on the managed node. The <em>httpd</em> package could be installed in multiple versions, therefore every <em>package</em> key, in our case <em>httpd</em>, is a list. We have installed only one version of <em>httpd</em> (thus, we have a list with only one element), we get the version of <em>httpd</em> with <code>[0].version</code>.  </p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="ansible-core-ansible-core-playbook-__tabbed_2_1" name="ansible-core-ansible-core-playbook-__tabbed_2" type="radio" /><input id="ansible-core-ansible-core-playbook-__tabbed_2_2" name="ansible-core-ansible-core-playbook-__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="ansible-core-ansible-core-playbook-__tabbed_2_1">Ansible</label><label for="ansible-core-ansible-core-playbook-__tabbed_2_2">Navigator</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#ansible-core-ansible-core-playbook-__codelineno-10-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible-playbook<span class="w"> </span>package.yml
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#ansible-core-ansible-core-playbook-__codelineno-11-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible-navigator<span class="w"> </span>run<span class="w"> </span>package.yml<span class="w"> </span>-m<span class="w"> </span>stdout
</span></code></pre></div>
</div>
</div>
</div>
<p>The output should look like this:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#ansible-core-ansible-core-playbook-__codelineno-12-1"></a><span class="go">PLAY [Check packages] **********************************************************</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#ansible-core-ansible-core-playbook-__codelineno-12-2"></a>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#ansible-core-ansible-core-playbook-__codelineno-12-3"></a><span class="go">TASK [Gathering Facts] *********************************************************</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#ansible-core-ansible-core-playbook-__codelineno-12-4"></a><span class="go">ok: [ansible]</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#ansible-core-ansible-core-playbook-__codelineno-12-5"></a>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#ansible-core-ansible-core-playbook-__codelineno-12-6"></a><span class="go">TASK [Gather the package facts] ************************************************</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#ansible-core-ansible-core-playbook-__codelineno-12-7"></a><span class="go">ok: [ansible]</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#ansible-core-ansible-core-playbook-__codelineno-12-8"></a>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#ansible-core-ansible-core-playbook-__codelineno-12-9"></a><span class="go">TASK [Check whether a httpd  is installed] *************************************</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#ansible-core-ansible-core-playbook-__codelineno-12-10"></a><span class="go">ok: [ansible] =&gt; {</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#ansible-core-ansible-core-playbook-__codelineno-12-11"></a><span class="go">    &quot;msg&quot;: &quot;httpd 2.4.37 is installed!&quot;</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#ansible-core-ansible-core-playbook-__codelineno-12-12"></a><span class="go">}</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#ansible-core-ansible-core-playbook-__codelineno-12-13"></a>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#ansible-core-ansible-core-playbook-__codelineno-12-14"></a><span class="go">PLAY RECAP *********************************************************************</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#ansible-core-ansible-core-playbook-__codelineno-12-15"></a><span class="go">ansible                    : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0  </span>
</span></code></pre></div>
<p>Execute the command <code>ansible-playbook apache.yml</code> for a second time, and compare the output.</p>
<h3 id="ansible-core-ansible-core-playbook-step-4-add-one-more-task">Step 4 - Add one more task</h3>
<p>The next part of the Ansible playbook makes sure the Apache application is enabled and started on <code>node1</code>.</p>
<p>On the control host, as your student user, edit the file <code>~/ansible-files/apache.yml</code> to add a second task using the <code>service</code> module. The Playbook should now look like this:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#ansible-core-ansible-core-playbook-__codelineno-13-1"></a><span class="nn">---</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#ansible-core-ansible-core-playbook-__codelineno-13-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Apache server installation</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#ansible-core-ansible-core-playbook-__codelineno-13-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node1</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#ansible-core-ansible-core-playbook-__codelineno-13-4"></a><span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#ansible-core-ansible-core-playbook-__codelineno-13-5"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#ansible-core-ansible-core-playbook-__codelineno-13-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install Apache package</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#ansible-core-ansible-core-playbook-__codelineno-13-7"></a><span class="w">      </span><span class="nt">ansible.builtin.yum</span><span class="p">:</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#ansible-core-ansible-core-playbook-__codelineno-13-8"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#ansible-core-ansible-core-playbook-__codelineno-13-9"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#ansible-core-ansible-core-playbook-__codelineno-13-10"></a>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#ansible-core-ansible-core-playbook-__codelineno-13-11"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ensure Apache is enabled and running</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#ansible-core-ansible-core-playbook-__codelineno-13-12"></a><span class="w">      </span><span class="nt">ansible.builtin.service</span><span class="p">:</span>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#ansible-core-ansible-core-playbook-__codelineno-13-13"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd.service</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#ansible-core-ansible-core-playbook-__codelineno-13-14"></a><span class="w">        </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#ansible-core-ansible-core-playbook-__codelineno-13-15"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
</span></code></pre></div>
<p>What exactly did we do?</p>
<ul>
<li>a second task named "Apache enabled and running" is created</li>
<li>a module is specified (<code>service</code>)</li>
<li>The module <code>service</code> takes the name of the service (<code>httpd</code>), if it should be permanently set (<code>enabled</code>), and its current state (<code>started</code>)</li>
</ul>
<p>Thus with the second task we make sure the Apache server is indeed running on the target machine. Run your extended Playbook:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="ansible-core-ansible-core-playbook-__tabbed_3_1" name="ansible-core-ansible-core-playbook-__tabbed_3" type="radio" /><input id="ansible-core-ansible-core-playbook-__tabbed_3_2" name="ansible-core-ansible-core-playbook-__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="ansible-core-ansible-core-playbook-__tabbed_3_1">Ansible</label><label for="ansible-core-ansible-core-playbook-__tabbed_3_2">Navigator</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#ansible-core-ansible-core-playbook-__codelineno-14-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible-playbook<span class="w"> </span>apache.yml
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#ansible-core-ansible-core-playbook-__codelineno-15-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible-navigator<span class="w"> </span>run<span class="w"> </span>apache.yml<span class="w"> </span>-m<span class="w"> </span>stdout
</span></code></pre></div>
<p>You may also run the playbook in <em>interactive</em> mode:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#ansible-core-ansible-core-playbook-__codelineno-16-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible-navigator<span class="w"> </span>run<span class="w"> </span>apache.yml<span class="w"> </span>-m<span class="w"> </span>interactive
</span></code></pre></div>
<p>Notice in the output, we see the play had <code>1</code> "CHANGED" shown in yellow. Press <code>0</code> to enter the play output, you can see that task 2, "Ensure Apache is enabled and running", was the task that incorporated the latest change by the "CHANGED" value being set to True and highlighted in yellow.</p>
</div>
</div>
</div>
<ul>
<li>
<p>Run the playbook a second time  to get used to the change in the output.</p>
</li>
<li>
<p>Use an Ansible playbook labeled <code>service_state.yml</code> to make sure the Apache (httpd) service is running on <code>node1</code>.</p>
</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#ansible-core-ansible-core-playbook-__codelineno-17-1"></a><span class="nn">---</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#ansible-core-ansible-core-playbook-__codelineno-17-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Check Service status</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#ansible-core-ansible-core-playbook-__codelineno-17-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node1</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#ansible-core-ansible-core-playbook-__codelineno-17-4"></a><span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#ansible-core-ansible-core-playbook-__codelineno-17-5"></a><span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#ansible-core-ansible-core-playbook-__codelineno-17-6"></a><span class="w">    </span><span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;httpd.service&quot;</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#ansible-core-ansible-core-playbook-__codelineno-17-7"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#ansible-core-ansible-core-playbook-__codelineno-17-8"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Get state of all service</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#ansible-core-ansible-core-playbook-__codelineno-17-9"></a><span class="w">      </span><span class="nt">ansible.builtin.service_facts</span><span class="p">:</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#ansible-core-ansible-core-playbook-__codelineno-17-10"></a>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#ansible-core-ansible-core-playbook-__codelineno-17-11"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Output service state of {{ service }}</span>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#ansible-core-ansible-core-playbook-__codelineno-17-12"></a><span class="w">      </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#ansible-core-ansible-core-playbook-__codelineno-17-13"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">ansible_facts[&#39;services&#39;][service][&#39;state&#39;]</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></div>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="ansible-core-ansible-core-playbook-__tabbed_4_1" name="ansible-core-ansible-core-playbook-__tabbed_4" type="radio" /><input id="ansible-core-ansible-core-playbook-__tabbed_4_2" name="ansible-core-ansible-core-playbook-__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="ansible-core-ansible-core-playbook-__tabbed_4_1">Ansible</label><label for="ansible-core-ansible-core-playbook-__tabbed_4_2">Navigator</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#ansible-core-ansible-core-playbook-__codelineno-18-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible-playbook<span class="w"> </span>service_state.yml
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#ansible-core-ansible-core-playbook-__codelineno-19-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible-navigator<span class="w"> </span>run<span class="w"> </span>service_state.yml<span class="w"> </span>-m<span class="w"> </span>stdout
</span></code></pre></div>
</div>
</div>
</div>
<p>This would be the same as checking the service state manually on <code>node1</code> with: <code>systemctl status httpd</code>.</p>
<h3 id="ansible-core-ansible-core-playbook-step-5-extend-your-playbook">Step 5 - Extend your Playbook</h3>
<p>Check that the tasks were executed correctly and Apache is accepting connections: Make an <abbr title="Hyper Text Transfer Protocol">HTTP</abbr> request using Ansible’s <code>uri</code> module in a playbook named <code>check_httpd.yml</code> from the control node to <code>node1</code>.</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#ansible-core-ansible-core-playbook-__codelineno-20-1"></a><span class="nn">---</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#ansible-core-ansible-core-playbook-__codelineno-20-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Check URL</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#ansible-core-ansible-core-playbook-__codelineno-20-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">control</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#ansible-core-ansible-core-playbook-__codelineno-20-4"></a><span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#ansible-core-ansible-core-playbook-__codelineno-20-5"></a><span class="w">    </span><span class="nt">node</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;node1&quot;</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#ansible-core-ansible-core-playbook-__codelineno-20-6"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#ansible-core-ansible-core-playbook-__codelineno-20-7"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Check that you can connect (GET) to a page and it returns a status 200</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#ansible-core-ansible-core-playbook-__codelineno-20-8"></a><span class="w">      </span><span class="nt">ansible.builtin.uri</span><span class="p">:</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#ansible-core-ansible-core-playbook-__codelineno-20-9"></a><span class="w">        </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://{{</span><span class="nv"> </span><span class="s">node</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><strong>Expect a lot of red lines and a 403 status!</strong></p>
</div>
<div class="tabbed-set tabbed-alternate" data-tabs="5:2"><input checked="checked" id="ansible-core-ansible-core-playbook-__tabbed_5_1" name="ansible-core-ansible-core-playbook-__tabbed_5" type="radio" /><input id="ansible-core-ansible-core-playbook-__tabbed_5_2" name="ansible-core-ansible-core-playbook-__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="ansible-core-ansible-core-playbook-__tabbed_5_1">Ansible</label><label for="ansible-core-ansible-core-playbook-__tabbed_5_2">Navigator</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#ansible-core-ansible-core-playbook-__codelineno-21-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible-playbook<span class="w"> </span>check_httpd.yml
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#ansible-core-ansible-core-playbook-__codelineno-22-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible-navigator<span class="w"> </span>run<span class="w"> </span>check_httpd.yml<span class="w"> </span>-m<span class="w"> </span>stdout
</span></code></pre></div>
</div>
</div>
</div>
<p>There are a lot of red lines and an error: As long as there is not at least an <code>index.html</code> file to be served by Apache, it will throw an ugly "<abbr title="Hyper Text Transfer Protocol">HTTP</abbr> Error 403: Forbidden" status and Ansible will report an error.</p>
<p>So why not use Ansible to deploy a simple <code>index.html</code> file? On the ansible control host, as the <code>student</code> user, create the directory <code>files</code> to hold file resources in <code>~/ansible-files/</code>:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#ansible-core-ansible-core-playbook-__codelineno-23-1"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>mkdir<span class="w"> </span>files
</span></code></pre></div>
<p>Then create the file <code>~/ansible-files/files/web.html</code> on the control node:</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#ansible-core-ansible-core-playbook-__codelineno-24-1"></a><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#ansible-core-ansible-core-playbook-__codelineno-24-2"></a><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Apache is running fine<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#ansible-core-ansible-core-playbook-__codelineno-24-3"></a><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></code></pre></div>
<p>In a previous example, you used Ansible’s <code>copy</code> module to write text supplied on the command line into a file. Now you’ll use the module in your playbook to copy a file.</p>
<p>On the control node as your student user edit the file <code>~/ansible-files/apache.yml</code> and add a new task utilizing the <code>copy</code> module. It should now look like this:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#ansible-core-ansible-core-playbook-__codelineno-25-1"></a><span class="nn">---</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#ansible-core-ansible-core-playbook-__codelineno-25-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Apache server installation</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#ansible-core-ansible-core-playbook-__codelineno-25-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node1</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#ansible-core-ansible-core-playbook-__codelineno-25-4"></a><span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#ansible-core-ansible-core-playbook-__codelineno-25-5"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#ansible-core-ansible-core-playbook-__codelineno-25-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install Apache package</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#ansible-core-ansible-core-playbook-__codelineno-25-7"></a><span class="w">      </span><span class="nt">ansible.builtin.yum</span><span class="p">:</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#ansible-core-ansible-core-playbook-__codelineno-25-8"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd</span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#ansible-core-ansible-core-playbook-__codelineno-25-9"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#ansible-core-ansible-core-playbook-__codelineno-25-10"></a>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#ansible-core-ansible-core-playbook-__codelineno-25-11"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ensure Apache is enabled and running</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#ansible-core-ansible-core-playbook-__codelineno-25-12"></a><span class="w">      </span><span class="nt">ansible.builtin.service</span><span class="p">:</span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#ansible-core-ansible-core-playbook-__codelineno-25-13"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd.service</span>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#ansible-core-ansible-core-playbook-__codelineno-25-14"></a><span class="w">        </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15" href="#ansible-core-ansible-core-playbook-__codelineno-25-15"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16" href="#ansible-core-ansible-core-playbook-__codelineno-25-16"></a>
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17" href="#ansible-core-ansible-core-playbook-__codelineno-25-17"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Copy file for webserver index</span>
</span><span id="__span-25-18"><a id="__codelineno-25-18" name="__codelineno-25-18" href="#ansible-core-ansible-core-playbook-__codelineno-25-18"></a><span class="w">      </span><span class="nt">ansible.builtin.copy</span><span class="p">:</span>
</span><span id="__span-25-19"><a id="__codelineno-25-19" name="__codelineno-25-19" href="#ansible-core-ansible-core-playbook-__codelineno-25-19"></a><span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web.html</span>
</span><span id="__span-25-20"><a id="__codelineno-25-20" name="__codelineno-25-20" href="#ansible-core-ansible-core-playbook-__codelineno-25-20"></a><span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/www/html/index.html</span>
</span><span id="__span-25-21"><a id="__codelineno-25-21" name="__codelineno-25-21" href="#ansible-core-ansible-core-playbook-__codelineno-25-21"></a><span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0644&quot;</span>
</span></code></pre></div>
<p>What does this new copy task do? The new task uses the <code>copy</code> module and defines the source and destination options for the copy operation as parameters.</p>
<p>Run your extended Playbook:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="6:2"><input checked="checked" id="ansible-core-ansible-core-playbook-__tabbed_6_1" name="ansible-core-ansible-core-playbook-__tabbed_6" type="radio" /><input id="ansible-core-ansible-core-playbook-__tabbed_6_2" name="ansible-core-ansible-core-playbook-__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="ansible-core-ansible-core-playbook-__tabbed_6_1">Ansible</label><label for="ansible-core-ansible-core-playbook-__tabbed_6_2">Navigator</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#ansible-core-ansible-core-playbook-__codelineno-26-1"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>ansible-playbook<span class="w"> </span>apache.yml
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#ansible-core-ansible-core-playbook-__codelineno-27-1"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>ansible-navigator<span class="w"> </span>run<span class="w"> </span>apache.yml<span class="w"> </span>-m<span class="w"> </span>stdout
</span></code></pre></div>
</div>
</div>
</div>
<ul>
<li>
<p>Have a good look at the output, notice the changes of "CHANGED" and the tasks associated with that change.</p>
</li>
<li>
<p>Run the Ansible playbook <code>check_httpd.yml</code> using the "uri" module from above again to test Apache. The command should now return a friendly green "status: 200" line, amongst other information.</p>
</li>
</ul>
<h3 id="ansible-core-ansible-core-playbook-step-6-practice-apply-to-multiple-host">Step 6 - Practice: Apply to Multiple Host</h3>
<p>While the above, shows the simplicity of applying changes to a particular host. What about if you want to set changes to many hosts? This is where you'll notice the real power of Ansible as it applies the same set of tasks reliably to many hosts.</p>
<ul>
<li>So what about changing the apache.yml Playbook to run on <code>node1</code> <strong>and</strong> <code>node2</code> <strong>and</strong> <code>node3</code>?</li>
</ul>
<p>As you might remember, the inventory lists all nodes as members of the group <code>web</code>:</p>
<div class="language-ini no-copy highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#ansible-core-ansible-core-playbook-__codelineno-28-1"></a><span class="k">[web]</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#ansible-core-ansible-core-playbook-__codelineno-28-2"></a><span class="na">node1 ansible_host</span><span class="o">=</span><span class="s">node1.example.com</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#ansible-core-ansible-core-playbook-__codelineno-28-3"></a><span class="na">node2 ansible_host</span><span class="o">=</span><span class="s">node2.example.com</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#ansible-core-ansible-core-playbook-__codelineno-28-4"></a><span class="na">node3 ansible_host</span><span class="o">=</span><span class="s">node3.example.com</span>
</span></code></pre></div>
<p>Change the playbook <code>hosts</code> parameter to point to <code>web</code> instead of <code>node1</code>:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#ansible-core-ansible-core-playbook-__codelineno-29-1"></a><span class="nn">---</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#ansible-core-ansible-core-playbook-__codelineno-29-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Apache server installation</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#ansible-core-ansible-core-playbook-__codelineno-29-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#ansible-core-ansible-core-playbook-__codelineno-29-4"></a><span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#ansible-core-ansible-core-playbook-__codelineno-29-5"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#ansible-core-ansible-core-playbook-__codelineno-29-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install Apache package</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#ansible-core-ansible-core-playbook-__codelineno-29-7"></a><span class="w">      </span><span class="nt">ansible.builtin.yum</span><span class="p">:</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#ansible-core-ansible-core-playbook-__codelineno-29-8"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#ansible-core-ansible-core-playbook-__codelineno-29-9"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#ansible-core-ansible-core-playbook-__codelineno-29-10"></a>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#ansible-core-ansible-core-playbook-__codelineno-29-11"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ensure Apache is enabled and running</span>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#ansible-core-ansible-core-playbook-__codelineno-29-12"></a><span class="w">      </span><span class="nt">ansible.builtin.service</span><span class="p">:</span>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13" href="#ansible-core-ansible-core-playbook-__codelineno-29-13"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd.service</span>
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14" href="#ansible-core-ansible-core-playbook-__codelineno-29-14"></a><span class="w">        </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-29-15"><a id="__codelineno-29-15" name="__codelineno-29-15" href="#ansible-core-ansible-core-playbook-__codelineno-29-15"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
</span><span id="__span-29-16"><a id="__codelineno-29-16" name="__codelineno-29-16" href="#ansible-core-ansible-core-playbook-__codelineno-29-16"></a>
</span><span id="__span-29-17"><a id="__codelineno-29-17" name="__codelineno-29-17" href="#ansible-core-ansible-core-playbook-__codelineno-29-17"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Copy file for webserver index</span>
</span><span id="__span-29-18"><a id="__codelineno-29-18" name="__codelineno-29-18" href="#ansible-core-ansible-core-playbook-__codelineno-29-18"></a><span class="w">      </span><span class="nt">ansible.builtin.copy</span><span class="p">:</span>
</span><span id="__span-29-19"><a id="__codelineno-29-19" name="__codelineno-29-19" href="#ansible-core-ansible-core-playbook-__codelineno-29-19"></a><span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web.html</span>
</span><span id="__span-29-20"><a id="__codelineno-29-20" name="__codelineno-29-20" href="#ansible-core-ansible-core-playbook-__codelineno-29-20"></a><span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/www/html/index.html</span>
</span><span id="__span-29-21"><a id="__codelineno-29-21" name="__codelineno-29-21" href="#ansible-core-ansible-core-playbook-__codelineno-29-21"></a><span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0644&quot;</span>
</span></code></pre></div>
<p>Now run the playbook:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="7:2"><input checked="checked" id="ansible-core-ansible-core-playbook-__tabbed_7_1" name="ansible-core-ansible-core-playbook-__tabbed_7" type="radio" /><input id="ansible-core-ansible-core-playbook-__tabbed_7_2" name="ansible-core-ansible-core-playbook-__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="ansible-core-ansible-core-playbook-__tabbed_7_1">Ansible</label><label for="ansible-core-ansible-core-playbook-__tabbed_7_2">Navigator</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#ansible-core-ansible-core-playbook-__codelineno-30-1"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>ansible-playbook<span class="w"> </span>apache.yml
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#ansible-core-ansible-core-playbook-__codelineno-31-1"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>ansible-navigator<span class="w"> </span>run<span class="w"> </span>apache.yml<span class="w"> </span>-m<span class="w"> </span>stdout
</span></code></pre></div>
</div>
</div>
</div>
<p>Verify if Apache is now running on all web servers (node1, node2, node3). All output should be green.</p>
<!-- markdownlint-disable --></section><section class="print-page" id="ansible-core-ansible-core-variables"><h1 id="ansible-core-ansible-core-variables-4-using-variables">4 - Using Variables</h1>
<h2 id="ansible-core-ansible-core-variables-objective">Objective</h2>
<p>Ansible supports variables to store values that can be used in Ansible playbooks. Variables can be defined in a variety of places and have a clear precedence. Ansible substitutes the variable with its value when a task is executed.</p>
<p>This exercise covers variables, specifically</p>
<ul>
<li>How to use variable delimiters <code>{{</code> and <code>}}</code></li>
<li>What <code>host_vars</code> and <code>group_vars</code> are and when to use them</li>
<li>How to use <code>ansible_facts</code></li>
<li>How to use the <code>debug</code> module to print variables to the console window</li>
</ul>
<h2 id="ansible-core-ansible-core-variables-guide">Guide</h2>
<p>Variables are referenced in Ansible Playbooks by placing the variable name in double curly braces:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ansible-core-ansible-core-variables-__codelineno-0-1"></a><span class="l l-Scalar l-Scalar-Plain">This string contains a {{ variable }}</span>
</span></code></pre></div>
<p>Variables and their values can be defined in various places: the inventory, additional files, on the command line, etc.</p>
<p>The recommended practice to provide variables in the inventory, is to define them in files located in two directories: <code>host_vars</code> and <code>group_vars</code>.</p>
<ul>
<li>To define variables for a group "servers", a <abbr title="YAML Ain't Markup Language">YAML</abbr> file named <code>group_vars/servers.yml</code> with the variable definitions is created.</li>
<li>To define variables specifically for a host <code>node1</code>, the file <code>host_vars/node1.yml</code> with the variable definitions is created.</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Host variables take precedence over group variables (more about precedence can be found in the <a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_variables.html#variable-precedence-where-should-i-put-a-variable" target="_blank">docs</a>).</p>
</div>
<h3 id="ansible-core-ansible-core-variables-step-1-create-variable-files">Step 1 - Create Variable Files</h3>
<p>For understanding and practice let’s do a lab. Following up on the theme "Let’s build a web server. Or two. Or even more…​", you will change the <code>index.html</code> to show the development environment (dev/prod) a server is deployed in.</p>
<p>On the ansible control host, as the <code>student</code> user, create the directories to hold the variable definitions in <code>~/ansible-files/</code>:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ansible-core-ansible-core-variables-__codelineno-1-1"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>mkdir<span class="w"> </span>host_vars<span class="w"> </span>group_vars
</span></code></pre></div>
<p>Now create two files containing variable definitions. We’ll define a variable named <code>stage</code> which will point to different environments, <code>dev</code> or <code>prod</code>:</p>
<ul>
<li>Create the file <code>~/ansible-files/group_vars/web.yml</code> with this content:</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ansible-core-ansible-core-variables-__codelineno-2-1"></a><span class="nn">---</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#ansible-core-ansible-core-variables-__codelineno-2-2"></a><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dev</span>
</span></code></pre></div>
<ul>
<li>Create the file <code>~/ansible-files/host_vars/node2.yml</code> with this content:</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ansible-core-ansible-core-variables-__codelineno-3-1"></a><span class="nn">---</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#ansible-core-ansible-core-variables-__codelineno-3-2"></a><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prod</span>
</span></code></pre></div>
<p>What is this about?</p>
<ul>
<li>For all servers in the <code>web</code> group the variable <code>stage</code> with value <code>dev</code> is defined. So as default we flag them as members of the dev environment.</li>
<li>For server <code>node2</code> this is overridden and the host is flagged as a production server.</li>
</ul>
<h3 id="ansible-core-ansible-core-variables-step-2-create-webhtml-files">Step 2 - Create web.html Files</h3>
<p>Now create two files in <code>~/ansible-files/files/</code>:</p>
<p>One called <code>prod_web.html</code> with the following content:</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ansible-core-ansible-core-variables-__codelineno-4-1"></a><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#ansible-core-ansible-core-variables-__codelineno-4-2"></a><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>This is a production webserver, take care!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#ansible-core-ansible-core-variables-__codelineno-4-3"></a><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></code></pre></div>
<p>And the other called <code>dev_web.html</code> with the following content:</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ansible-core-ansible-core-variables-__codelineno-5-1"></a><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#ansible-core-ansible-core-variables-__codelineno-5-2"></a><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>This is a development webserver, have fun!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#ansible-core-ansible-core-variables-__codelineno-5-3"></a><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></code></pre></div>
<h3 id="ansible-core-ansible-core-variables-step-3-create-the-playbook">Step 3 - Create the Playbook</h3>
<p>Now you need a Playbook that copies the prod or dev <code>web.html</code> file - according to the "stage" variable.</p>
<p>Create a new Playbook called <code>deploy_index_html.yml</code> in the <code>~/ansible-files/</code> directory.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Note how the variable "stage" is used in the name of the file to copy.</p>
</div>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ansible-core-ansible-core-variables-__codelineno-6-1"></a><span class="nn">---</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#ansible-core-ansible-core-variables-__codelineno-6-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Webserver configuration</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#ansible-core-ansible-core-variables-__codelineno-6-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#ansible-core-ansible-core-variables-__codelineno-6-4"></a><span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#ansible-core-ansible-core-variables-__codelineno-6-5"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#ansible-core-ansible-core-variables-__codelineno-6-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Copy web.html</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#ansible-core-ansible-core-variables-__codelineno-6-7"></a><span class="w">      </span><span class="nt">ansible.builtin.copy</span><span class="p">:</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#ansible-core-ansible-core-variables-__codelineno-6-8"></a><span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">stage</span><span class="nv"> </span><span class="s">}}_web.html&quot;</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#ansible-core-ansible-core-variables-__codelineno-6-9"></a><span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/www/html/index.html</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#ansible-core-ansible-core-variables-__codelineno-6-10"></a><span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0644&quot;</span>
</span></code></pre></div>
<ul>
<li>Run the Playbook:</li>
</ul>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="ansible-core-ansible-core-variables-__tabbed_1_1" name="ansible-core-ansible-core-variables-__tabbed_1" type="radio" /><input id="ansible-core-ansible-core-variables-__tabbed_1_2" name="ansible-core-ansible-core-variables-__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="ansible-core-ansible-core-variables-__tabbed_1_1">Ansible</label><label for="ansible-core-ansible-core-variables-__tabbed_1_2">Navigator</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#ansible-core-ansible-core-variables-__codelineno-7-1"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>ansible-playbook<span class="w"> </span>deploy_index_html.yml
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#ansible-core-ansible-core-variables-__codelineno-8-1"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>ansible-navigator<span class="w"> </span>run<span class="w"> </span>deploy_index_html.yml
</span></code></pre></div>
</div>
</div>
</div>
<h3 id="ansible-core-ansible-core-variables-step-4-test-the-result">Step 4 - Test the Result</h3>
<p>The Ansible Playbook copies different files as index.html to the hosts, use <code>curl</code> to test it.</p>
<p>For node1:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#ansible-core-ansible-core-variables-__codelineno-9-1"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>curl<span class="w"> </span>http://node1
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#ansible-core-ansible-core-variables-__codelineno-9-2"></a><span class="go">&lt;body&gt;</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#ansible-core-ansible-core-variables-__codelineno-9-3"></a><span class="go">&lt;h1&gt;This is a development webserver, have fun!&lt;/h1&gt;</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#ansible-core-ansible-core-variables-__codelineno-9-4"></a><span class="go">&lt;/body&gt;</span>
</span></code></pre></div>
<p>For node2:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#ansible-core-ansible-core-variables-__codelineno-10-1"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>curl<span class="w"> </span>http://node2
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#ansible-core-ansible-core-variables-__codelineno-10-2"></a><span class="go">&lt;body&gt;</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#ansible-core-ansible-core-variables-__codelineno-10-3"></a><span class="go">&lt;h1&gt;This is a production webserver, take care!&lt;/h1&gt;</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#ansible-core-ansible-core-variables-__codelineno-10-4"></a><span class="go">&lt;/body&gt;</span>
</span></code></pre></div>
<p>For node3:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#ansible-core-ansible-core-variables-__codelineno-11-1"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>curl<span class="w"> </span>http://node3
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#ansible-core-ansible-core-variables-__codelineno-11-2"></a><span class="go">&lt;body&gt;</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#ansible-core-ansible-core-variables-__codelineno-11-3"></a><span class="go">&lt;h1&gt;This is a development webserver, have fun!&lt;/h1&gt;</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#ansible-core-ansible-core-variables-__codelineno-11-4"></a><span class="go">&lt;/body&gt;</span>
</span></code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If by now you think: There has to be a smarter way to change content in files…​ you are absolutely right. This lab was done to introduce variables, you are about to learn about templates in one of the next chapters.</p>
</div>
<h3 id="ansible-core-ansible-core-variables-step-5-ansible-facts">Step 5 - Ansible Facts</h3>
<p>Ansible facts are variables that are automatically discovered by Ansible from a managed host. Remember the "Gathering Facts" task with the <em>setup</em> module we used with the Ansible ad hoc command?<br />
The facts contain useful information stored into variables that administrators can reuse.</p>
<p>To get an idea what facts Ansible collects by default, on your control node as your student user create the playbook <code>setup.yml</code> and run it to get the setup details of <code>node1</code>:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#ansible-core-ansible-core-variables-__codelineno-12-1"></a><span class="nn">---</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#ansible-core-ansible-core-variables-__codelineno-12-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Capture and output facts</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#ansible-core-ansible-core-variables-__codelineno-12-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node1</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#ansible-core-ansible-core-variables-__codelineno-12-4"></a><span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#ansible-core-ansible-core-variables-__codelineno-12-5"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#ansible-core-ansible-core-variables-__codelineno-12-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Collect only facts returned by facter</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#ansible-core-ansible-core-variables-__codelineno-12-7"></a><span class="w">      </span><span class="nt">ansible.builtin.setup</span><span class="p">:</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#ansible-core-ansible-core-variables-__codelineno-12-8"></a><span class="w">        </span><span class="nt">gather_subset</span><span class="p">:</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#ansible-core-ansible-core-variables-__codelineno-12-9"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;all&#39;</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#ansible-core-ansible-core-variables-__codelineno-12-10"></a><span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">setup_output</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#ansible-core-ansible-core-variables-__codelineno-12-11"></a>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#ansible-core-ansible-core-variables-__codelineno-12-12"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Output variable content</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#ansible-core-ansible-core-variables-__codelineno-12-13"></a><span class="w">      </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#ansible-core-ansible-core-variables-__codelineno-12-14"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">setup_output</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></div>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="ansible-core-ansible-core-variables-__tabbed_2_1" name="ansible-core-ansible-core-variables-__tabbed_2" type="radio" /><input id="ansible-core-ansible-core-variables-__tabbed_2_2" name="ansible-core-ansible-core-variables-__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="ansible-core-ansible-core-variables-__tabbed_2_1">Ansible</label><label for="ansible-core-ansible-core-variables-__tabbed_2_2">Navigator</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#ansible-core-ansible-core-variables-__codelineno-13-1"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>ansible-playbook<span class="w"> </span>setup.yml
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#ansible-core-ansible-core-variables-__codelineno-14-1"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>ansible-navigator<span class="w"> </span>run<span class="w"> </span>setup.yml<span class="w"> </span>-m<span class="w"> </span>stdout
</span></code></pre></div>
</div>
</div>
</div>
<p>This might be a bit too much, you can use filters to limit the output to certain facts, the expression is shell-style wildcard within your playbook. Create a playbook labeled <code>setup_filter.yml</code> as shown below. In this example, we filter to get the <code>eth0</code> facts as well as memory details of <code>node1</code>.</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#ansible-core-ansible-core-variables-__codelineno-15-1"></a><span class="nn">---</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#ansible-core-ansible-core-variables-__codelineno-15-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Capture and output facts</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#ansible-core-ansible-core-variables-__codelineno-15-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node1</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#ansible-core-ansible-core-variables-__codelineno-15-4"></a><span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#ansible-core-ansible-core-variables-__codelineno-15-5"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#ansible-core-ansible-core-variables-__codelineno-15-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Collect only specific facts</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#ansible-core-ansible-core-variables-__codelineno-15-7"></a><span class="w">      </span><span class="nt">ansible.builtin.setup</span><span class="p">:</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#ansible-core-ansible-core-variables-__codelineno-15-8"></a><span class="w">        </span><span class="nt">filter</span><span class="p">:</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#ansible-core-ansible-core-variables-__codelineno-15-9"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;ansible_eth0&#39;</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#ansible-core-ansible-core-variables-__codelineno-15-10"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;ansible_*_mb&#39;</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#ansible-core-ansible-core-variables-__codelineno-15-11"></a><span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">setup_output</span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#ansible-core-ansible-core-variables-__codelineno-15-12"></a>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#ansible-core-ansible-core-variables-__codelineno-15-13"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Output variable content</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#ansible-core-ansible-core-variables-__codelineno-15-14"></a><span class="w">      </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#ansible-core-ansible-core-variables-__codelineno-15-15"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">setup_output</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></div>
<p>Run the playbook:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="ansible-core-ansible-core-variables-__tabbed_3_1" name="ansible-core-ansible-core-variables-__tabbed_3" type="radio" /><input id="ansible-core-ansible-core-variables-__tabbed_3_2" name="ansible-core-ansible-core-variables-__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="ansible-core-ansible-core-variables-__tabbed_3_1">Ansible</label><label for="ansible-core-ansible-core-variables-__tabbed_3_2">Navigator</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#ansible-core-ansible-core-variables-__codelineno-16-1"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>ansible-playbook<span class="w"> </span>setup_filter.yml
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#ansible-core-ansible-core-variables-__codelineno-17-1"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>ansible-navigator<span class="w"> </span>run<span class="w"> </span>setup_filter.yml<span class="w"> </span>-m<span class="w"> </span>stdout
</span></code></pre></div>
</div>
</div>
</div>
<h3 id="ansible-core-ansible-core-variables-step-6-challenge-lab-facts">Step 6 - Challenge Lab: Facts</h3>
<ul>
<li>Try to find and print the distribution (Red Hat) of your managed hosts using a playbook.</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Use the wildcard to find the fact within your filter, then apply a filter to only print this fact.</p>
</div>
<details class="success">
<summary>Solution</summary>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#ansible-core-ansible-core-variables-__codelineno-18-1"></a><span class="nn">---</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#ansible-core-ansible-core-variables-__codelineno-18-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Capture and output facts</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#ansible-core-ansible-core-variables-__codelineno-18-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node1</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#ansible-core-ansible-core-variables-__codelineno-18-4"></a><span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#ansible-core-ansible-core-variables-__codelineno-18-5"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#ansible-core-ansible-core-variables-__codelineno-18-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Collect only specific facts</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#ansible-core-ansible-core-variables-__codelineno-18-7"></a><span class="w">      </span><span class="nt">ansible.builtin.setup</span><span class="p">:</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#ansible-core-ansible-core-variables-__codelineno-18-8"></a><span class="w">        </span><span class="nt">filter</span><span class="p">:</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#ansible-core-ansible-core-variables-__codelineno-18-9"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;*distribution&#39;</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#ansible-core-ansible-core-variables-__codelineno-18-10"></a><span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">setup_output</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#ansible-core-ansible-core-variables-__codelineno-18-11"></a>
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#ansible-core-ansible-core-variables-__codelineno-18-12"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Output variable content</span>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#ansible-core-ansible-core-variables-__codelineno-18-13"></a><span class="w">      </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#ansible-core-ansible-core-variables-__codelineno-18-14"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">setup_output</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></div>
<p>With the wildcard in place, the output shows:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#ansible-core-ansible-core-variables-__codelineno-19-1"></a><span class="go">TASK [Output variable content] *******************************************************************</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#ansible-core-ansible-core-variables-__codelineno-19-2"></a><span class="go">ok: [ansible] =&gt; {</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#ansible-core-ansible-core-variables-__codelineno-19-3"></a><span class="go">    &quot;setup&quot;: {</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#ansible-core-ansible-core-variables-__codelineno-19-4"></a><span class="go">        &quot;ansible_facts&quot;: {</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#ansible-core-ansible-core-variables-__codelineno-19-5"></a><span class="go">            &quot;ansible_distribution&quot;: &quot;RedHat&quot;</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#ansible-core-ansible-core-variables-__codelineno-19-6"></a><span class="go">        },</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#ansible-core-ansible-core-variables-__codelineno-19-7"></a><span class="go">        &quot;changed&quot;: false,</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#ansible-core-ansible-core-variables-__codelineno-19-8"></a><span class="go">        &quot;failed&quot;: false</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#ansible-core-ansible-core-variables-__codelineno-19-9"></a><span class="go">    }</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#ansible-core-ansible-core-variables-__codelineno-19-10"></a><span class="go">}</span>
</span></code></pre></div>
<p>With this we can conclude the variable we are looking for is labeled <code>ansible_distribution</code>.</p>
<p>Then we can update the playbook to be explicit in its findings and change the following line:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#ansible-core-ansible-core-variables-__codelineno-20-1"></a><span class="nt">filter</span><span class="p">:</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#ansible-core-ansible-core-variables-__codelineno-20-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;*distribution&#39;</span>
</span></code></pre></div>
<p>to:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#ansible-core-ansible-core-variables-__codelineno-21-1"></a><span class="nt">filter</span><span class="p">:</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#ansible-core-ansible-core-variables-__codelineno-21-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;ansible_distribution&#39;</span>
</span></code></pre></div>
<p>Run the playbook:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#ansible-core-ansible-core-variables-__codelineno-22-1"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>ansible-playbook<span class="w"> </span>setup_filter.yml
</span></code></pre></div>
<p>Optionally, run the playbook with the <em>ansible-navigator</em>:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#ansible-core-ansible-core-variables-__codelineno-23-1"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>ansible-navigator<span class="w"> </span>run<span class="w"> </span>setup_filter.yml<span class="w"> </span>-m<span class="w"> </span>stdout
</span></code></pre></div>
</details>
<h3 id="ansible-core-ansible-core-variables-step-7-using-facts-in-playbooks">Step 7 - Using Facts in Playbooks</h3>
<p>Facts can be used in a Playbook like variables, using the proper naming, of course. Create this Playbook as <code>facts.yml</code> in the <code>~/ansible-files/</code> directory:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#ansible-core-ansible-core-variables-__codelineno-24-1"></a><span class="nn">---</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#ansible-core-ansible-core-variables-__codelineno-24-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Output facts within a playbook</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#ansible-core-ansible-core-variables-__codelineno-24-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#ansible-core-ansible-core-variables-__codelineno-24-4"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#ansible-core-ansible-core-variables-__codelineno-24-5"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prints Ansible facts</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#ansible-core-ansible-core-variables-__codelineno-24-6"></a><span class="w">      </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#ansible-core-ansible-core-variables-__codelineno-24-7"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">The default IPv4 address of {{ ansible_fqdn }} is {{ ansible_default_ipv4.address }}</span>
</span></code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The "debug" module is handy for e.g. debugging variables or expressions.</p>
</div>
<p>Execute it to see how the facts are printed:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="ansible-core-ansible-core-variables-__tabbed_4_1" name="ansible-core-ansible-core-variables-__tabbed_4" type="radio" /><input id="ansible-core-ansible-core-variables-__tabbed_4_2" name="ansible-core-ansible-core-variables-__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="ansible-core-ansible-core-variables-__tabbed_4_1">Ansible</label><label for="ansible-core-ansible-core-variables-__tabbed_4_2">Navigator</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#ansible-core-ansible-core-variables-__codelineno-25-1"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>ansible-playbook<span class="w"> </span>facts.yml
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#ansible-core-ansible-core-variables-__codelineno-26-1"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>ansible-navigator<span class="w"> </span>run<span class="w"> </span>facts.yml<span class="w"> </span>-m<span class="w"> </span>stdout
</span></code></pre></div>
</div>
</div>
</div>
<p>Examine the output:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#ansible-core-ansible-core-variables-__codelineno-27-1"></a><span class="go">PLAY [Output facts within a playbook] ******************************************</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#ansible-core-ansible-core-variables-__codelineno-27-2"></a>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#ansible-core-ansible-core-variables-__codelineno-27-3"></a><span class="go">TASK [Gathering Facts] *********************************************************</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#ansible-core-ansible-core-variables-__codelineno-27-4"></a><span class="go">ok: [node3]</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#ansible-core-ansible-core-variables-__codelineno-27-5"></a><span class="go">ok: [node2]</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#ansible-core-ansible-core-variables-__codelineno-27-6"></a><span class="go">ok: [node1]</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#ansible-core-ansible-core-variables-__codelineno-27-7"></a><span class="go">ok: [ansible-1]</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#ansible-core-ansible-core-variables-__codelineno-27-8"></a>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#ansible-core-ansible-core-variables-__codelineno-27-9"></a><span class="go">TASK [Prints Ansible facts] ****************************************************</span>
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#ansible-core-ansible-core-variables-__codelineno-27-10"></a><span class="go">ok: [node1] =&gt;</span>
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#ansible-core-ansible-core-variables-__codelineno-27-11"></a><span class="go">  msg: The default IPv4 address of node1 is 172.16.190.143</span>
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12" href="#ansible-core-ansible-core-variables-__codelineno-27-12"></a><span class="go">ok: [node2] =&gt;</span>
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13" href="#ansible-core-ansible-core-variables-__codelineno-27-13"></a><span class="go">  msg: The default IPv4 address of node2 is 172.16.30.170</span>
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14" href="#ansible-core-ansible-core-variables-__codelineno-27-14"></a><span class="go">ok: [node3] =&gt;</span>
</span><span id="__span-27-15"><a id="__codelineno-27-15" name="__codelineno-27-15" href="#ansible-core-ansible-core-variables-__codelineno-27-15"></a><span class="go">  msg: The default IPv4 address of node3 is 172.16.140.196</span>
</span><span id="__span-27-16"><a id="__codelineno-27-16" name="__codelineno-27-16" href="#ansible-core-ansible-core-variables-__codelineno-27-16"></a><span class="go">ok: [ansible-1] =&gt;</span>
</span><span id="__span-27-17"><a id="__codelineno-27-17" name="__codelineno-27-17" href="#ansible-core-ansible-core-variables-__codelineno-27-17"></a><span class="go">  msg: The default IPv4 address of ansible is 172.16.2.10</span>
</span><span id="__span-27-18"><a id="__codelineno-27-18" name="__codelineno-27-18" href="#ansible-core-ansible-core-variables-__codelineno-27-18"></a>
</span><span id="__span-27-19"><a id="__codelineno-27-19" name="__codelineno-27-19" href="#ansible-core-ansible-core-variables-__codelineno-27-19"></a><span class="go">PLAY RECAP *********************************************************************</span>
</span><span id="__span-27-20"><a id="__codelineno-27-20" name="__codelineno-27-20" href="#ansible-core-ansible-core-variables-__codelineno-27-20"></a><span class="go">ansible-1                  : ok=2    changed=0    unreachable=0    failed=0</span>
</span><span id="__span-27-21"><a id="__codelineno-27-21" name="__codelineno-27-21" href="#ansible-core-ansible-core-variables-__codelineno-27-21"></a><span class="go">node1                      : ok=2    changed=0    unreachable=0    failed=0</span>
</span><span id="__span-27-22"><a id="__codelineno-27-22" name="__codelineno-27-22" href="#ansible-core-ansible-core-variables-__codelineno-27-22"></a><span class="go">node2                      : ok=2    changed=0    unreachable=0    failed=0</span>
</span><span id="__span-27-23"><a id="__codelineno-27-23" name="__codelineno-27-23" href="#ansible-core-ansible-core-variables-__codelineno-27-23"></a><span class="go">node3                      : ok=2    changed=0    unreachable=0    failed=0</span>
</span></code></pre></div>
<!-- markdownlint-disable --></section><section class="print-page" id="ansible-core-ansible-core-conditionals"><h1 id="ansible-core-ansible-core-conditionals-5-work-with-conditionals">5 - Work with conditionals</h1>
<h2 id="ansible-core-ansible-core-conditionals-objective">Objective</h2>
<p>In a playbook, you may want to execute different tasks, or have different goals, depending on the value of a fact (data about the remote system), a variable, or the result of a previous task. You may want the value of some variables to depend on the value of other variables. Or you may want to create additional groups of hosts based on whether the hosts match other criteria. You can do all of these things with <a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_conditionals.html" target="_blank">conditionals</a>.</p>
<h2 id="ansible-core-ansible-core-conditionals-guide">Guide</h2>
<p>Ansible can use conditionals to execute tasks or plays when certain conditions are met.</p>
<p>To implement a conditional, the <code>when</code> statement must be used, followed by the condition to test. The condition is expressed using one of the available operators like e.g. for comparison:</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>\==</td>
<td>Compares two objects for equality.</td>
</tr>
<tr>
<td>!=</td>
<td>Compares two objects for inequality.</td>
</tr>
<tr>
<td>&gt;</td>
<td>true if the left hand side is greater than the right hand side.</td>
</tr>
<tr>
<td>&gt;=</td>
<td>true if the left hand side is greater or equal to the right hand side.</td>
</tr>
<tr>
<td>\&lt;</td>
<td>true if the left hand side is lower than the right hand side.</td>
</tr>
<tr>
<td>\&lt;=</td>
<td>true if the left hand side is lower or equal to the right hand side.</td>
</tr>
</tbody>
</table>
<p>Ansible uses Jinja2 <a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_tests.html#playbooks-tests" target="_blank">tests</a> and <a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_filters.html#playbooks-filters" target="_blank">filters</a> in conditionals. Ansible supports all the standard tests and filters, and adds some unique ones as well.</p>
<p>For more on this, please refer to the documentation: <a href="https://jinja.palletsprojects.com/en/latest/templates/" target="_blank">https://jinja.palletsprojects.com/en/latest/templates/</a></p>
<h3 id="ansible-core-ansible-core-conditionals-step-1-install-service-conditionally">Step 1 - Install service conditionally</h3>
<p>As an example we would like to install an <abbr title="File Transfer Protocol">FTP</abbr> server, but only on hosts that are in the <code>ftpserver</code> inventory group.</p>
<p>To do that, first edit the inventory to add another group, and place <code>node2</code> in it. Make sure that that IP address of <code>node2</code> is always the same when <code>node2</code> is listed. Edit the inventory <code>~/lab_inventory/hosts</code> to look like the following listing:</p>
<div class="language-ini no-copy highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ansible-core-ansible-core-conditionals-__codelineno-0-1"></a><span class="k">[control]</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#ansible-core-ansible-core-conditionals-__codelineno-0-2"></a><span class="na">ansible-1 ansible_host</span><span class="o">=</span><span class="s">ansible-1.example.com</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#ansible-core-ansible-core-conditionals-__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#ansible-core-ansible-core-conditionals-__codelineno-0-4"></a><span class="k">[web]</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#ansible-core-ansible-core-conditionals-__codelineno-0-5"></a><span class="na">node1 ansible_host</span><span class="o">=</span><span class="s">node1.example.com</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#ansible-core-ansible-core-conditionals-__codelineno-0-6"></a><span class="na">node2 ansible_host</span><span class="o">=</span><span class="s">node2.example.com</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#ansible-core-ansible-core-conditionals-__codelineno-0-7"></a><span class="na">node3 ansible_host</span><span class="o">=</span><span class="s">node3.example.com</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#ansible-core-ansible-core-conditionals-__codelineno-0-8"></a>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#ansible-core-ansible-core-conditionals-__codelineno-0-9"></a><span class="k">[ftpserver]</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#ansible-core-ansible-core-conditionals-__codelineno-0-10"></a><span class="na">node2 ansible_host</span><span class="o">=</span><span class="s">node2.example.com</span>
</span></code></pre></div>
<p>Next create the file <code>ftpserver.yml</code> on your control host in the <code>~/ansible-files/</code> directory:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ansible-core-ansible-core-conditionals-__codelineno-1-1"></a><span class="nn">---</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#ansible-core-ansible-core-conditionals-__codelineno-1-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install vsftpd if hosts are in inventory group</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#ansible-core-ansible-core-conditionals-__codelineno-1-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#ansible-core-ansible-core-conditionals-__codelineno-1-4"></a><span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#ansible-core-ansible-core-conditionals-__codelineno-1-5"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#ansible-core-ansible-core-conditionals-__codelineno-1-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install FTP server when host in ftpserver group</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#ansible-core-ansible-core-conditionals-__codelineno-1-7"></a><span class="w">      </span><span class="nt">ansible.builtin.yum</span><span class="p">:</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#ansible-core-ansible-core-conditionals-__codelineno-1-8"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vsftpd</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#ansible-core-ansible-core-conditionals-__codelineno-1-9"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#ansible-core-ansible-core-conditionals-__codelineno-1-10"></a><span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">inventory_hostname in groups[&quot;ftpserver&quot;]</span>
</span></code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>By now you should know how to run Ansible Playbooks, we’ll start to be less verbose in this guide. Go create and run it. :-)</p>
</div>
<p>Run it and examine the output. The expected outcome: The task is skipped on node1, node3 and the ansible host (your control host) because they are not in the ftpserver group in your inventory file.</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ansible-core-ansible-core-conditionals-__codelineno-2-1"></a><span class="go">TASK [Install FTP server when host in ftpserver group] *******************************************</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#ansible-core-ansible-core-conditionals-__codelineno-2-2"></a><span class="go">skipping: [ansible-1]</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#ansible-core-ansible-core-conditionals-__codelineno-2-3"></a><span class="go">skipping: [node1]</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#ansible-core-ansible-core-conditionals-__codelineno-2-4"></a><span class="go">skipping: [node3]</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#ansible-core-ansible-core-conditionals-__codelineno-2-5"></a><span class="go">changed: [node2]</span>
</span></code></pre></div>
<p>In your condition the <em>magic variable</em> <code>inventory_hostname</code> is used, a variable set by Ansible itself. It contains the inventory name for the <em>current</em> host being iterated over in the play.</p>
<h3 id="ansible-core-ansible-core-conditionals-step-2-find-out-exact-version-of-installed-service">Step 2 - Find out exact version of installed service</h3>
<p>We installed the <em>vsftpd</em> package, we would now be able to start the <em>vsftp</em>-Service (Very Secure <abbr title="File Transfer Protocol">FTP</abbr> Daemon). But what version of the package is installed?  </p>
<p>Lets add two more tasks to our playbook, one to gather information about all installed packages on the target host with the module <em>package_facts</em>. This module adds the gathered information to the <code>ansible_facts</code>, from there you can use the information as an Ansible variable. The last tasks outputs the exact version number to <em>stdout</em>, but only if the package is installed (the variable in the <em>packages</em> dictionary is defined).</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ansible-core-ansible-core-conditionals-__codelineno-3-1"></a><span class="nn">---</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#ansible-core-ansible-core-conditionals-__codelineno-3-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install vsftpd if hosts are in inventory group</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#ansible-core-ansible-core-conditionals-__codelineno-3-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#ansible-core-ansible-core-conditionals-__codelineno-3-4"></a><span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#ansible-core-ansible-core-conditionals-__codelineno-3-5"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#ansible-core-ansible-core-conditionals-__codelineno-3-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install FTP server when host in ftpserver group</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#ansible-core-ansible-core-conditionals-__codelineno-3-7"></a><span class="w">      </span><span class="nt">ansible.builtin.yum</span><span class="p">:</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#ansible-core-ansible-core-conditionals-__codelineno-3-8"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vsftpd</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#ansible-core-ansible-core-conditionals-__codelineno-3-9"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#ansible-core-ansible-core-conditionals-__codelineno-3-10"></a><span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">inventory_hostname in groups[&quot;ftpserver&quot;]</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#ansible-core-ansible-core-conditionals-__codelineno-3-11"></a>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#ansible-core-ansible-core-conditionals-__codelineno-3-12"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Get information about installed packages</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#ansible-core-ansible-core-conditionals-__codelineno-3-13"></a><span class="w">      </span><span class="nt">ansible.builtin.package_facts</span><span class="p">:</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#ansible-core-ansible-core-conditionals-__codelineno-3-14"></a><span class="w">        </span><span class="nt">manager</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">auto</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#ansible-core-ansible-core-conditionals-__codelineno-3-15"></a>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#ansible-core-ansible-core-conditionals-__codelineno-3-16"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Debug exact version of installed vsFTP package</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#ansible-core-ansible-core-conditionals-__codelineno-3-17"></a><span class="w">      </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#ansible-core-ansible-core-conditionals-__codelineno-3-18"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;vsFTP</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">installed</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">Version</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">ansible_facts.packages.vsftpd.0.version</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19" href="#ansible-core-ansible-core-conditionals-__codelineno-3-19"></a><span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_facts.packages.vsftpd is defined</span>
</span></code></pre></div>
<p>As you can see, the simplest conditional statement applies to a single task. Create the task, then add a <code>when</code> statement that applies a test. The <code>when</code> clause is a <em>raw</em> Jinja2 expression, you can use variables here, but you <strong>don't</strong> have to use double curly braces to enclose the variable.</p>
<p>Looking back at the playbook, why did we add the condition to the last task?<br />
We know that we installed the package, therefore the condition is always true (the variable is definitely defined) and we could live without the condition.</p>
<p>You should always strive towards making your playbooks as robust as possible, what would happen if we would change the first task to <em>de-install</em> the service and not use the condition?<br />
Let's change the title and the <em>state</em> to <code>absent</code>, remove (or comment) the condition and run the playbook again.</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ansible-core-ansible-core-conditionals-__codelineno-4-1"></a><span class="nn">---</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#ansible-core-ansible-core-conditionals-__codelineno-4-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install vsftpd if hosts are in inventory group</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#ansible-core-ansible-core-conditionals-__codelineno-4-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#ansible-core-ansible-core-conditionals-__codelineno-4-4"></a><span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#ansible-core-ansible-core-conditionals-__codelineno-4-5"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#ansible-core-ansible-core-conditionals-__codelineno-4-6"></a><span class="hll"><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">De-install FTP server when host in ftpserver group</span>
</span></span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#ansible-core-ansible-core-conditionals-__codelineno-4-7"></a><span class="w">      </span><span class="nt">ansible.builtin.yum</span><span class="p">:</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#ansible-core-ansible-core-conditionals-__codelineno-4-8"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vsftpd</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#ansible-core-ansible-core-conditionals-__codelineno-4-9"></a><span class="hll"><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">absent</span>
</span></span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#ansible-core-ansible-core-conditionals-__codelineno-4-10"></a><span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">inventory_hostname in groups[&quot;ftpserver&quot;]</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#ansible-core-ansible-core-conditionals-__codelineno-4-11"></a>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#ansible-core-ansible-core-conditionals-__codelineno-4-12"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Get information about installed packages</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#ansible-core-ansible-core-conditionals-__codelineno-4-13"></a><span class="w">      </span><span class="nt">ansible.builtin.package_facts</span><span class="p">:</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#ansible-core-ansible-core-conditionals-__codelineno-4-14"></a><span class="w">        </span><span class="nt">manager</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">auto</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#ansible-core-ansible-core-conditionals-__codelineno-4-15"></a>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#ansible-core-ansible-core-conditionals-__codelineno-4-16"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Debug exact version of installed vsFTP package</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#ansible-core-ansible-core-conditionals-__codelineno-4-17"></a><span class="w">      </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#ansible-core-ansible-core-conditionals-__codelineno-4-18"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;vsFTP</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">installed</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">Version</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">ansible_facts.packages.vsftpd.0.version</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#ansible-core-ansible-core-conditionals-__codelineno-4-19"></a><span class="hll"><span class="w">    </span><span class="c1">#  when: ansible_facts.packages.vsftpd is defined</span>
</span></span></code></pre></div>
<p>The service is removed by the playbook, therefore the result of the <em>package_facts</em> module does not include the <em>vsftpd</em> package anymore and your playbooks ends with an error message!</p>
<h3 id="ansible-core-ansible-core-conditionals-step-3-challenge-lab">Step 3 - Challenge lab</h3>
<p>Add a task to the playbook which outputs a message if important security patches are included in the installed <em>vsftpd</em> package.</p>
<ul>
<li>Make sure that the <em>vsftpd</em> package is installed (again).</li>
<li>Output the message <em>"The version of vsftpd includes important security patches!"</em> if the version of <em>vsftpd</em> is <strong>greater than 3.0</strong></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The Ansible documentation is helpful, a <em>test</em> to <a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_tests.html#comparing-versions" target="_blank">compare versions</a> is available.</p>
</div>
<p>Run the extended playbook.</p>
<details class="success">
<summary>Solution</summary>
<p>The updated playbook:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ansible-core-ansible-core-conditionals-__codelineno-5-1"></a><span class="nn">---</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#ansible-core-ansible-core-conditionals-__codelineno-5-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install vsftpd if hosts are in inventory group</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#ansible-core-ansible-core-conditionals-__codelineno-5-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#ansible-core-ansible-core-conditionals-__codelineno-5-4"></a><span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#ansible-core-ansible-core-conditionals-__codelineno-5-5"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#ansible-core-ansible-core-conditionals-__codelineno-5-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install FTP server when host in ftpserver group</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#ansible-core-ansible-core-conditionals-__codelineno-5-7"></a><span class="w">      </span><span class="nt">ansible.builtin.yum</span><span class="p">:</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#ansible-core-ansible-core-conditionals-__codelineno-5-8"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vsftpd</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#ansible-core-ansible-core-conditionals-__codelineno-5-9"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#ansible-core-ansible-core-conditionals-__codelineno-5-10"></a><span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">inventory_hostname in groups[&quot;ftpserver&quot;]</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#ansible-core-ansible-core-conditionals-__codelineno-5-11"></a>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#ansible-core-ansible-core-conditionals-__codelineno-5-12"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Get information about installed packages</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#ansible-core-ansible-core-conditionals-__codelineno-5-13"></a><span class="w">      </span><span class="nt">ansible.builtin.package_facts</span><span class="p">:</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#ansible-core-ansible-core-conditionals-__codelineno-5-14"></a><span class="w">        </span><span class="nt">manager</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">auto</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#ansible-core-ansible-core-conditionals-__codelineno-5-15"></a>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#ansible-core-ansible-core-conditionals-__codelineno-5-16"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Debug exact version of installed vsFTP package</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#ansible-core-ansible-core-conditionals-__codelineno-5-17"></a><span class="w">      </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#ansible-core-ansible-core-conditionals-__codelineno-5-18"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">ansible_facts.packages.vsftpd.0.version</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#ansible-core-ansible-core-conditionals-__codelineno-5-19"></a><span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_facts.packages.vsftpd is defined</span>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#ansible-core-ansible-core-conditionals-__codelineno-5-20"></a>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#ansible-core-ansible-core-conditionals-__codelineno-5-21"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Output message when vsftpd version is greater than 3.0</span>
</span><span id="__span-5-22"><a id="__codelineno-5-22" name="__codelineno-5-22" href="#ansible-core-ansible-core-conditionals-__codelineno-5-22"></a><span class="w">      </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
</span><span id="__span-5-23"><a id="__codelineno-5-23" name="__codelineno-5-23" href="#ansible-core-ansible-core-conditionals-__codelineno-5-23"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;The</span><span class="nv"> </span><span class="s">version</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">vsftp</span><span class="nv"> </span><span class="s">includes</span><span class="nv"> </span><span class="s">important</span><span class="nv"> </span><span class="s">security</span><span class="nv"> </span><span class="s">patches!&quot;</span>
</span><span id="__span-5-24"><a id="__codelineno-5-24" name="__codelineno-5-24" href="#ansible-core-ansible-core-conditionals-__codelineno-5-24"></a><span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_facts.packages.vsftpd.0.version is version(&#39;3.0&#39;, &#39;&gt;&#39;)</span>
</span></code></pre></div>
<p>Running the playbook outputs the following:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ansible-core-ansible-core-conditionals-__codelineno-6-1"></a><span class="go">...</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#ansible-core-ansible-core-conditionals-__codelineno-6-2"></a><span class="go">TASK [Output message when vsftp version is greater than 3.0] *******************************************************************</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#ansible-core-ansible-core-conditionals-__codelineno-6-3"></a><span class="go">ok: [node1] =&gt; {</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#ansible-core-ansible-core-conditionals-__codelineno-6-4"></a><span class="go">    &quot;msg&quot;: &quot;The version of vsftpd includes important security patches!&quot;</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#ansible-core-ansible-core-conditionals-__codelineno-6-5"></a><span class="go">}</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#ansible-core-ansible-core-conditionals-__codelineno-6-6"></a><span class="go">...</span>
</span></code></pre></div>
</details>
<p>The message is shown? Awesome!<br />
To see if the conditions works, change the version to compare to <code>4.0</code> and run the playbook again. You should now see the last task as <em>skipped</em>.</p>
<!-- markdownlint-disable --></section><section class="print-page" id="ansible-core-ansible-core-loops"><h1 id="ansible-core-ansible-core-loops-6-run-tasks-multiple-times">6 - Run tasks multiple times</h1>
<h2 id="ansible-core-ansible-core-loops-objective">Objective</h2>
<p>Get to know the <code>loop</code>, <code>with_&lt;lookup&gt;</code>, and <code>until</code> keywords to execute a task multiple times.  </p>
<p>The <code>loop</code> keyword is not yet a full replacement for <code>with_&lt;lookup&gt;</code>, but we recommend it for most use cases. Both keywords achieve the same thing (although a bit differently under the hood).<br />
You may find e.g. <code>with_items</code> in examples and the use is not (<em>yet</em>) deprecated - that syntax will still be valid for the foreseeable future - but try to use the <code>loop</code> keyword whenever possible.<br />
The <code>until</code> keyword is used to retry a task until a certain condition is met. For example, you could run a task up to <code>X</code> times (defined by a <em>retries</em> parameter) with a delay of <code>X</code> seconds between each attempt. This may be useful if your playbook has to wait for the startup of a process before continuing.</p>
<h2 id="ansible-core-ansible-core-loops-guide">Guide</h2>
<p>Loops enable us to repeat the same task over and over again. For example, lets say you want to create multiple users. By using an Ansible loop, you can do that in a single task. Loops can also iterate over more than just basic lists. For example, if you have a list of users with their corresponding group, loop can iterate over them as well.  </p>
<p>Find out more about loops in the <a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_loops.html" target="_blank">Ansible Loops</a> documentation.</p>
<h3 id="ansible-core-ansible-core-loops-step-1-simple-loops">Step 1 - Simple Loops</h3>
<p>To show the loops feature we will generate three new users on <code>node1</code>. For that, create the file <code>loop_users.yml</code> in <code>~/ansible-files</code> on your control node as your student user. We will use the <code>user</code> module to generate the user accounts.</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ansible-core-ansible-core-loops-__codelineno-0-1"></a><span class="nn">---</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#ansible-core-ansible-core-loops-__codelineno-0-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Demo playbook for loops</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#ansible-core-ansible-core-loops-__codelineno-0-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node1</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#ansible-core-ansible-core-loops-__codelineno-0-4"></a><span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#ansible-core-ansible-core-loops-__codelineno-0-5"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#ansible-core-ansible-core-loops-__codelineno-0-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ensure multiple users are present</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#ansible-core-ansible-core-loops-__codelineno-0-7"></a><span class="w">      </span><span class="nt">ansible.builtin.user</span><span class="p">:</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#ansible-core-ansible-core-loops-__codelineno-0-8"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#ansible-core-ansible-core-loops-__codelineno-0-9"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#ansible-core-ansible-core-loops-__codelineno-0-10"></a><span class="w">      </span><span class="nt">loop</span><span class="p">:</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#ansible-core-ansible-core-loops-__codelineno-0-11"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dev_user</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#ansible-core-ansible-core-loops-__codelineno-0-12"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">qa_user</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#ansible-core-ansible-core-loops-__codelineno-0-13"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prod_user</span>
</span></code></pre></div>
<p>Understand the playbook and the output:</p>
<ul>
<li>The names are not provided to the user module directly. Instead, there is only a variable called <code>{{ item }}</code> for the parameter <code>name</code>.</li>
<li>The <code>loop</code> keyword lists the actual user names. Those replace the <code>{{ item }}</code> during the actual execution of the playbook.</li>
<li>During execution the task is only listed once, but there are three changes listed underneath it.</li>
</ul>
<h3 id="ansible-core-ansible-core-loops-step-2-loops-over-hashes">Step 2 - Loops over hashes</h3>
<p>As mentioned loops can also be over lists of hashes. Imagine that the users should be assigned to different additional groups:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ansible-core-ansible-core-loops-__codelineno-1-1"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dev_user</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#ansible-core-ansible-core-loops-__codelineno-1-2"></a><span class="w">  </span><span class="nt">groups</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ftp</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#ansible-core-ansible-core-loops-__codelineno-1-3"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">qa_user</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#ansible-core-ansible-core-loops-__codelineno-1-4"></a><span class="w">  </span><span class="nt">groups</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ftp</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#ansible-core-ansible-core-loops-__codelineno-1-5"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prod_user</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#ansible-core-ansible-core-loops-__codelineno-1-6"></a><span class="w">  </span><span class="nt">groups</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apache</span>
</span></code></pre></div>
<p>The <code>user</code> module has the optional parameter <code>groups</code> which defines the group (or list of groups) the user should be added to. To reference items in a hash, the <code>{{ item }}</code> keyword needs to reference the sub-key: <code>{{ item.groups }}</code> for example.</p>
<details class="note">
<summary>Hint</summary>
<p>By default, the user is <strong>removed</strong> from all other groups. Use the module parameter <code>append: true</code> to modify this.</p>
</details>
<p>Let's rewrite the playbook to create the users with additional user rights:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ansible-core-ansible-core-loops-__codelineno-2-1"></a><span class="nn">---</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#ansible-core-ansible-core-loops-__codelineno-2-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Demo playbook for loops</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#ansible-core-ansible-core-loops-__codelineno-2-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node1</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#ansible-core-ansible-core-loops-__codelineno-2-4"></a><span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#ansible-core-ansible-core-loops-__codelineno-2-5"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#ansible-core-ansible-core-loops-__codelineno-2-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ensure multiple users are present</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#ansible-core-ansible-core-loops-__codelineno-2-7"></a><span class="w">      </span><span class="nt">ansible.builtin.user</span><span class="p">:</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#ansible-core-ansible-core-loops-__codelineno-2-8"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.username</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#ansible-core-ansible-core-loops-__codelineno-2-9"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#ansible-core-ansible-core-loops-__codelineno-2-10"></a><span class="w">        </span><span class="nt">groups</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.groups</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#ansible-core-ansible-core-loops-__codelineno-2-11"></a><span class="w">      </span><span class="nt">loop</span><span class="p">:</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#ansible-core-ansible-core-loops-__codelineno-2-12"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dev_user</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#ansible-core-ansible-core-loops-__codelineno-2-13"></a><span class="w">          </span><span class="nt">groups</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ftp</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#ansible-core-ansible-core-loops-__codelineno-2-14"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">qa_user</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#ansible-core-ansible-core-loops-__codelineno-2-15"></a><span class="w">          </span><span class="nt">groups</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ftp</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#ansible-core-ansible-core-loops-__codelineno-2-16"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prod_user</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#ansible-core-ansible-core-loops-__codelineno-2-17"></a><span class="w">          </span><span class="nt">groups</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apache</span>
</span></code></pre></div>
<p>Check the output:</p>
<ul>
<li>Again the task is listed once, but three changes are listed. Each loop with its content is shown.</li>
</ul>
<p>Verify that the user <code>dev_user</code> was indeed created on <code>node1</code> using the following playbook, name it <code>user_id.yml</code>:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ansible-core-ansible-core-loops-__codelineno-3-1"></a><span class="nn">---</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#ansible-core-ansible-core-loops-__codelineno-3-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Get user ID play</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#ansible-core-ansible-core-loops-__codelineno-3-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node1</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#ansible-core-ansible-core-loops-__codelineno-3-4"></a><span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#ansible-core-ansible-core-loops-__codelineno-3-5"></a><span class="w">    </span><span class="nt">myuser</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;dev_user&quot;</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#ansible-core-ansible-core-loops-__codelineno-3-6"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#ansible-core-ansible-core-loops-__codelineno-3-7"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Get info for {{ myuser }}</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#ansible-core-ansible-core-loops-__codelineno-3-8"></a><span class="w">      </span><span class="nt">ansible.builtin.getent</span><span class="p">:</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#ansible-core-ansible-core-loops-__codelineno-3-9"></a><span class="w">        </span><span class="nt">database</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">passwd</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#ansible-core-ansible-core-loops-__codelineno-3-10"></a><span class="w">        </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">myuser</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#ansible-core-ansible-core-loops-__codelineno-3-11"></a>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#ansible-core-ansible-core-loops-__codelineno-3-12"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Output info for {{ myuser }}</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#ansible-core-ansible-core-loops-__codelineno-3-13"></a><span class="w">      </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#ansible-core-ansible-core-loops-__codelineno-3-14"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">myuser</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">uid:</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">getent_passwd[myuser][1]</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></div>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="ansible-core-ansible-core-loops-__tabbed_1_1" name="ansible-core-ansible-core-loops-__tabbed_1" type="radio" /><input id="ansible-core-ansible-core-loops-__tabbed_1_2" name="ansible-core-ansible-core-loops-__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="ansible-core-ansible-core-loops-__tabbed_1_1">Ansible</label><label for="ansible-core-ansible-core-loops-__tabbed_1_2">Navigator</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-console highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ansible-core-ansible-core-loops-__codelineno-4-1"></a><span class="gp">$ </span>ansible-playbook<span class="w"> </span>user_id.yml
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#ansible-core-ansible-core-loops-__codelineno-4-2"></a>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#ansible-core-ansible-core-loops-__codelineno-4-3"></a><span class="go">PLAY [Get user ID play] ******************************************************************************************</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#ansible-core-ansible-core-loops-__codelineno-4-4"></a>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#ansible-core-ansible-core-loops-__codelineno-4-5"></a><span class="go">TASK [Gathering Facts] *******************************************************************************************</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#ansible-core-ansible-core-loops-__codelineno-4-6"></a><span class="go">ok: [node1]</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#ansible-core-ansible-core-loops-__codelineno-4-7"></a>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#ansible-core-ansible-core-loops-__codelineno-4-8"></a><span class="go">TASK [Get info for dev_user] *****************************************************************************************</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#ansible-core-ansible-core-loops-__codelineno-4-9"></a><span class="go">ok: [node1]</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#ansible-core-ansible-core-loops-__codelineno-4-10"></a>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#ansible-core-ansible-core-loops-__codelineno-4-11"></a><span class="go">TASK [Output info for dev_user] **************************************************************************************</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#ansible-core-ansible-core-loops-__codelineno-4-12"></a><span class="go">ok: [node1] =&gt; {</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#ansible-core-ansible-core-loops-__codelineno-4-13"></a><span class="go">    &quot;msg&quot;: [</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#ansible-core-ansible-core-loops-__codelineno-4-14"></a><span class="go">        &quot;dev_user uid: 1002&quot;</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#ansible-core-ansible-core-loops-__codelineno-4-15"></a><span class="go">    ]</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#ansible-core-ansible-core-loops-__codelineno-4-16"></a><span class="go">}</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#ansible-core-ansible-core-loops-__codelineno-4-17"></a>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#ansible-core-ansible-core-loops-__codelineno-4-18"></a><span class="go">PLAY RECAP *******************************************************************************************************</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#ansible-core-ansible-core-loops-__codelineno-4-19"></a><span class="go">node1                      : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0  </span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-console highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ansible-core-ansible-core-loops-__codelineno-5-1"></a><span class="gp">$ </span>ansible-navigator<span class="w"> </span>run<span class="w"> </span>user_id.yml<span class="w"> </span>-m<span class="w"> </span>stdout
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#ansible-core-ansible-core-loops-__codelineno-5-2"></a>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#ansible-core-ansible-core-loops-__codelineno-5-3"></a><span class="go">PLAY [Get user ID play] ******************************************************************************************</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#ansible-core-ansible-core-loops-__codelineno-5-4"></a>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#ansible-core-ansible-core-loops-__codelineno-5-5"></a><span class="go">TASK [Gathering Facts] *******************************************************************************************</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#ansible-core-ansible-core-loops-__codelineno-5-6"></a><span class="go">ok: [node1]</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#ansible-core-ansible-core-loops-__codelineno-5-7"></a>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#ansible-core-ansible-core-loops-__codelineno-5-8"></a><span class="go">TASK [Get info for dev_user] *****************************************************************************************</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#ansible-core-ansible-core-loops-__codelineno-5-9"></a><span class="go">ok: [node1]</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#ansible-core-ansible-core-loops-__codelineno-5-10"></a>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#ansible-core-ansible-core-loops-__codelineno-5-11"></a><span class="go">TASK [Output info for dev_user] **************************************************************************************</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#ansible-core-ansible-core-loops-__codelineno-5-12"></a><span class="go">ok: [node1] =&gt; {</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#ansible-core-ansible-core-loops-__codelineno-5-13"></a><span class="go">    &quot;msg&quot;: [</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#ansible-core-ansible-core-loops-__codelineno-5-14"></a><span class="go">        &quot;dev_user uid: 1002&quot;</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#ansible-core-ansible-core-loops-__codelineno-5-15"></a><span class="go">    ]</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#ansible-core-ansible-core-loops-__codelineno-5-16"></a><span class="go">}</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#ansible-core-ansible-core-loops-__codelineno-5-17"></a>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#ansible-core-ansible-core-loops-__codelineno-5-18"></a><span class="go">PLAY RECAP *******************************************************************************************************</span>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#ansible-core-ansible-core-loops-__codelineno-5-19"></a><span class="go">node1                      : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0  </span>
</span></code></pre></div>
</div>
</div>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>It is possible to insert a <em>string</em> directly into the dictionary structure like this (although it makes the task less flexible):
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ansible-core-ansible-core-loops-__codelineno-6-1"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Output info for user</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#ansible-core-ansible-core-loops-__codelineno-6-2"></a><span class="w">  </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#ansible-core-ansible-core-loops-__codelineno-6-3"></a><span class="w">    </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">myuser</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">uid:</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">getent_passwd[&#39;dev_user&#39;][1]</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></div>
As you can see the <em>value</em> of the variable <code>myuser</code> is used directly. It must be enclosed in single quotes. You can't use normal quotation marks, as these are used outside of the whole variable.</p>
</div>
<h3 id="ansible-core-ansible-core-loops-step-3-loops-with-list-variable">Step 3 - Loops with <em>list</em>-variable</h3>
<p>Up to now, we always provided the list to loop in the <em>loop</em> keyword directly, most of the times you will provide the list with a variable.</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#ansible-core-ansible-core-loops-__codelineno-7-1"></a><span class="nn">---</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#ansible-core-ansible-core-loops-__codelineno-7-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Use Ansible magic variables</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#ansible-core-ansible-core-loops-__codelineno-7-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">control</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#ansible-core-ansible-core-loops-__codelineno-7-4"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#ansible-core-ansible-core-loops-__codelineno-7-5"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Show all the hosts in the inventory</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#ansible-core-ansible-core-loops-__codelineno-7-6"></a><span class="w">      </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#ansible-core-ansible-core-loops-__codelineno-7-7"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#ansible-core-ansible-core-loops-__codelineno-7-8"></a><span class="w">      </span><span class="nt">loop</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">groups[&#39;all&#39;]</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#ansible-core-ansible-core-loops-__codelineno-7-9"></a>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#ansible-core-ansible-core-loops-__codelineno-7-10"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Show all the hosts in the current play</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#ansible-core-ansible-core-loops-__codelineno-7-11"></a><span class="w">      </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#ansible-core-ansible-core-loops-__codelineno-7-12"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#ansible-core-ansible-core-loops-__codelineno-7-13"></a><span class="w">      </span><span class="nt">loop</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">ansible_play_hosts</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></div>
<p>This playbook uses two <em><a href="https://docs.ansible.com/ansible/latest/reference_appendices/special_variables.html" target="_blank">magic variables</a></em>, these variables cannot be set directly by the user and are always defined.<br />
The second task for example, uses the special variable <code>ansible_play_hosts</code>, which contains a <strong>list</strong> of hosts in the current play run, failed or unreachable hosts are excluded from this list. The first task uses the special variable <code>groups</code>, this contains a <strong>dictionary</strong> with all the groups in the inventory and each group has the <strong>list</strong> of hosts that belong to it.<br />
Copy the contents to a file <code>special-variables.yml</code> and run the playbook.<br />
We can use the playbook to display that the <em>loop</em> keyword needs <em>list</em>-input, if you provide otherwise, Ansible will display an error message.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#ansible-core-ansible-core-loops-__codelineno-8-1"></a>fatal:<span class="w"> </span><span class="o">[</span>node1<span class="o">]</span>:<span class="w"> </span>FAILED!<span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span><span class="s2">&quot;msg&quot;</span>:<span class="w"> </span><span class="s2">&quot;Invalid data passed to &#39;loop&#39;, it requires a list, got this instead: {&#39;all&#39;: [&#39;node1&#39;, &#39;node2&#39;, &#39;node3&#39;], &#39;ungrouped&#39;: [], &#39;web&#39;: [&#39;node1&#39;, &#39;node2&#39;, &#39;node3&#39;]}. Hint: If you passed a list/dict of just one element, try adding wantlist=True to your lookup invocation or use q/query instead of lookup.&quot;</span><span class="o">}</span>
</span></code></pre></div>
<p>You can provoke this, if you change line 8 to <code>loop: "{{ groups }}"</code>. With that change you would try to loop a dictionary, this obviously fails.</p>
<!-- markdownlint-disable --></section><section class="print-page" id="ansible-core-ansible-core-handlers"><h1 id="ansible-core-ansible-core-handlers-7-trigger-changes-with-handlers">7 - Trigger changes with Handlers</h1>
<h2 id="ansible-core-ansible-core-handlers-objective">Objective</h2>
<p>Get to know <em>Handler</em>, a special task which is defined in its own <em>play</em> parameter. A handler is often used to restart services, but it can be used with every module Ansible offers.  </p>
<h2 id="ansible-core-ansible-core-handlers-guide">Guide</h2>
<p>Sometimes when a task does make a change to the system, an additional task or tasks may need to be run. For example, a change to a service’s configuration file may then require that the service be restarted so that the changed configuration takes effect.</p>
<p>Here Ansible’s handlers come into play. Handlers can be seen as inactive tasks that only get triggered when explicitly invoked using the "notify" statement. Read more about them in the <a href="https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_handlers.html" target="_blank">Ansible Handlers</a> documentation.</p>
<h3 id="ansible-core-ansible-core-handlers-step-1-handlers">Step 1 - Handlers</h3>
<p>As a an example, let’s write a playbook that:</p>
<ul>
<li>manages Apache’s configuration file <code>/etc/httpd/conf/httpd.conf</code> on all hosts in the <code>web</code> group</li>
<li>restarts Apache when the file has changed</li>
</ul>
<p>First we need the file Ansible will deploy, let’s just take the one from node1.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ansible-core-ansible-core-handlers-__codelineno-0-1"></a>scp<span class="w"> </span>node1:/etc/httpd/conf/httpd.conf<span class="w"> </span>~/ansible-files/files/.
</span></code></pre></div>
<p>We now have the configuration file for our webserver, we will adjust the file later and copy it back to all webserver hosts later.<br />
Next, create the Playbook <code>httpd_conf.yml</code>. Make sure that you are in the directory <code>~/ansible-files</code>.</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ansible-core-ansible-core-handlers-__codelineno-1-1"></a><span class="nn">---</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#ansible-core-ansible-core-handlers-__codelineno-1-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Manage httpd.conf</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#ansible-core-ansible-core-handlers-__codelineno-1-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#ansible-core-ansible-core-handlers-__codelineno-1-4"></a><span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#ansible-core-ansible-core-handlers-__codelineno-1-5"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#ansible-core-ansible-core-handlers-__codelineno-1-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Copy Apache configuration file</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#ansible-core-ansible-core-handlers-__codelineno-1-7"></a><span class="w">      </span><span class="nt">ansible.builtin.copy</span><span class="p">:</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#ansible-core-ansible-core-handlers-__codelineno-1-8"></a><span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd.conf</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#ansible-core-ansible-core-handlers-__codelineno-1-9"></a><span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/httpd/conf/httpd.conf</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#ansible-core-ansible-core-handlers-__codelineno-1-10"></a><span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0644&quot;</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#ansible-core-ansible-core-handlers-__codelineno-1-11"></a><span class="w">      </span><span class="nt">notify</span><span class="p">:</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#ansible-core-ansible-core-handlers-__codelineno-1-12"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restart_apache</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#ansible-core-ansible-core-handlers-__codelineno-1-13"></a><span class="w">  </span><span class="nt">handlers</span><span class="p">:</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#ansible-core-ansible-core-handlers-__codelineno-1-14"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restart_apache</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#ansible-core-ansible-core-handlers-__codelineno-1-15"></a><span class="w">      </span><span class="nt">ansible.builtin.service</span><span class="p">:</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#ansible-core-ansible-core-handlers-__codelineno-1-16"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#ansible-core-ansible-core-handlers-__codelineno-1-17"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restarted</span>
</span></code></pre></div>
<p>So what’s new here?</p>
<ul>
<li>The "notify" parameter calls the handler only when the copy task actually changes the file. That way the service is only restarted if needed - and not each time the playbook is run.</li>
<li>The "handlers" section defines a task that is only run on notification.</li>
</ul>
<p>Run the playbook. We didn’t change anything in the file yet so there should not be any <code>changed</code> lines in the output and of course the handler shouldn’t have fired.</p>
<ul>
<li>Now change the <code>Listen 80</code> line in <code>~/ansible-files/files/httpd.conf</code> to:</li>
</ul>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ansible-core-ansible-core-handlers-__codelineno-2-1"></a><span class="na">Listen 8080</span>
</span></code></pre></div>
<ul>
<li>
<p>Run the playbook again. Now the Ansible’s output should be a lot more interesting:</p>
<ul>
<li>httpd.conf should have been copied over</li>
<li>The handler should have restarted Apache</li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default, handlers run after all the tasks in a particular play have been completed.</p>
</div>
<p>Apache should now listen on port 8080. Easy enough to verify:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ansible-core-ansible-core-handlers-__codelineno-3-1"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>curl<span class="w"> </span>http://node1
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#ansible-core-ansible-core-handlers-__codelineno-3-2"></a><span class="go">curl: (7) Failed to connect to node1 port 80: Connection refused</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#ansible-core-ansible-core-handlers-__codelineno-3-3"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>curl<span class="w"> </span>http://node1:8080
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#ansible-core-ansible-core-handlers-__codelineno-3-4"></a><span class="go">&lt;body&gt;</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#ansible-core-ansible-core-handlers-__codelineno-3-5"></a><span class="go">&lt;h1&gt;This is a development webserver, have fun!&lt;/h1&gt;</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#ansible-core-ansible-core-handlers-__codelineno-3-6"></a><span class="go">&lt;/body&gt;</span>
</span></code></pre></div>
<p>Run the playbook one last time. As the configuration file is already copied over with the desired configuration state, the handler is not triggered, Apache will keep running.</p>
<!-- markdownlint-disable --></section><section class="print-page" id="ansible-core-ansible-core-templates"><h1 id="ansible-core-ansible-core-templates-8-templating-with-jinja2">8 - Templating with Jinja2</h1>
<h2 id="ansible-core-ansible-core-templates-objective">Objective</h2>
<p>This exercise will cover Jinja2 templating. Ansible uses Jinja2 templating to modify files before they are distributed to managed hosts. Jinja2 is one of the most used template engines for Python, take a look at the <a href="https://jinja.palletsprojects.com/" target="_blank">documentation</a> for additional information.</p>
<h2 id="ansible-core-ansible-core-templates-guide">Guide</h2>
<h3 id="ansible-core-ansible-core-templates-step-1-using-templates-in-playbooks">Step 1 - Using Templates in Playbooks</h3>
<p>When a template for a file has been created, it can be deployed to the managed hosts using the <code>template</code> module, which supports the transfer of a local file from the control node to the managed hosts.</p>
<p>As an example of using templates you will change the motd file to contain host-specific data.</p>
<p>First create the directory <code>templates</code> to hold template resources in <code>~/ansible-files/</code>:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ansible-core-ansible-core-templates-__codelineno-0-1"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>mkdir<span class="w"> </span>templates
</span></code></pre></div>
<p>Then in the <code>~/ansible-files/templates/</code> directory create the template file <code>motd-facts.j2</code>:</p>
<div class="language-html+jinja highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ansible-core-ansible-core-templates-__codelineno-1-1"></a>Welcome to <span class="cp">{{</span> <span class="nv">ansible_hostname</span> <span class="cp">}}</span>.
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#ansible-core-ansible-core-templates-__codelineno-1-2"></a><span class="cp">{{</span> <span class="nv">ansible_distribution</span> <span class="cp">}}</span> <span class="cp">{{</span> <span class="nv">ansible_distribution_version</span><span class="cp">}}</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#ansible-core-ansible-core-templates-__codelineno-1-3"></a>deployed on <span class="cp">{{</span> <span class="nv">ansible_architecture</span> <span class="cp">}}</span> architecture.
</span></code></pre></div>
<p>The template file contains the basic text that will later be copied over. It also contains variables which will be replaced on the target machines individually.</p>
<p>Next we need a playbook to use this template. In the <code>~/ansible-files/</code> directory create the Playbook <code>motd-facts.yml</code>:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ansible-core-ansible-core-templates-__codelineno-2-1"></a><span class="nn">---</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#ansible-core-ansible-core-templates-__codelineno-2-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Fill motd file with host data</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#ansible-core-ansible-core-templates-__codelineno-2-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node1</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#ansible-core-ansible-core-templates-__codelineno-2-4"></a><span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#ansible-core-ansible-core-templates-__codelineno-2-5"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#ansible-core-ansible-core-templates-__codelineno-2-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy message of the day file</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#ansible-core-ansible-core-templates-__codelineno-2-7"></a><span class="w">      </span><span class="nt">ansible.builtin.template</span><span class="p">:</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#ansible-core-ansible-core-templates-__codelineno-2-8"></a><span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">motd-facts.j2</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#ansible-core-ansible-core-templates-__codelineno-2-9"></a><span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/motd</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#ansible-core-ansible-core-templates-__codelineno-2-10"></a><span class="w">        </span><span class="nt">owner</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#ansible-core-ansible-core-templates-__codelineno-2-11"></a><span class="w">        </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#ansible-core-ansible-core-templates-__codelineno-2-12"></a><span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0644&quot;</span>
</span></code></pre></div>
<p>As we just learned what <em>handlers</em> do, let's add one to this playbook. Add the handlers block with a simple task, which just outputs a message:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ansible-core-ansible-core-templates-__codelineno-3-1"></a><span class="nn">---</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#ansible-core-ansible-core-templates-__codelineno-3-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Fill motd file with host data</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#ansible-core-ansible-core-templates-__codelineno-3-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node1</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#ansible-core-ansible-core-templates-__codelineno-3-4"></a><span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#ansible-core-ansible-core-templates-__codelineno-3-5"></a><span class="w">  </span><span class="nt">handlers</span><span class="p">:</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#ansible-core-ansible-core-templates-__codelineno-3-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Motd_changed</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#ansible-core-ansible-core-templates-__codelineno-3-7"></a><span class="w">      </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#ansible-core-ansible-core-templates-__codelineno-3-8"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;The</span><span class="nv"> </span><span class="s">Message</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Day</span><span class="nv"> </span><span class="s">was</span><span class="nv"> </span><span class="s">updated!</span><span class="nv"> </span><span class="s">SSH</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">node1</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">check</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">content.&quot;</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#ansible-core-ansible-core-templates-__codelineno-3-9"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#ansible-core-ansible-core-templates-__codelineno-3-10"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy message of the day file</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#ansible-core-ansible-core-templates-__codelineno-3-11"></a><span class="w">      </span><span class="nt">ansible.builtin.template</span><span class="p">:</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#ansible-core-ansible-core-templates-__codelineno-3-12"></a><span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">motd-facts.j2</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#ansible-core-ansible-core-templates-__codelineno-3-13"></a><span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/motd</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#ansible-core-ansible-core-templates-__codelineno-3-14"></a><span class="w">        </span><span class="nt">owner</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#ansible-core-ansible-core-templates-__codelineno-3-15"></a><span class="w">        </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#ansible-core-ansible-core-templates-__codelineno-3-16"></a><span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0644&quot;</span>
</span></code></pre></div>
<p>Before we do a bigger challenge lab, let's see if you remember how handlers are triggered. Currently, the handler is not triggered, add the missing keyword to the task, which deploys the template.</p>
<details class="success">
<summary>Solution</summary>
<p>Add the <em>notify</em> keyword and the name of the handler:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ansible-core-ansible-core-templates-__codelineno-4-1"></a><span class="nn">---</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#ansible-core-ansible-core-templates-__codelineno-4-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Fill motd file with host data</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#ansible-core-ansible-core-templates-__codelineno-4-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node1</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#ansible-core-ansible-core-templates-__codelineno-4-4"></a><span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#ansible-core-ansible-core-templates-__codelineno-4-5"></a><span class="w">  </span><span class="nt">handlers</span><span class="p">:</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#ansible-core-ansible-core-templates-__codelineno-4-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Motd_changed</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#ansible-core-ansible-core-templates-__codelineno-4-7"></a><span class="w">      </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#ansible-core-ansible-core-templates-__codelineno-4-8"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;The</span><span class="nv"> </span><span class="s">Message</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Day</span><span class="nv"> </span><span class="s">was</span><span class="nv"> </span><span class="s">updated!</span><span class="nv"> </span><span class="s">SSH</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">node1</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">check</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">content.&quot;</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#ansible-core-ansible-core-templates-__codelineno-4-9"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#ansible-core-ansible-core-templates-__codelineno-4-10"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy message of the day file</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#ansible-core-ansible-core-templates-__codelineno-4-11"></a><span class="w">      </span><span class="nt">ansible.builtin.template</span><span class="p">:</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#ansible-core-ansible-core-templates-__codelineno-4-12"></a><span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">motd-facts.j2</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#ansible-core-ansible-core-templates-__codelineno-4-13"></a><span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/motd</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#ansible-core-ansible-core-templates-__codelineno-4-14"></a><span class="w">        </span><span class="nt">owner</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#ansible-core-ansible-core-templates-__codelineno-4-15"></a><span class="w">        </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#ansible-core-ansible-core-templates-__codelineno-4-16"></a><span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0644&quot;</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#ansible-core-ansible-core-templates-__codelineno-4-17"></a><span class="hll"><span class="w">      </span><span class="nt">notify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Motd_changed</span>
</span></span></code></pre></div>
</details>
<p>You have done this a couple of times by now:</p>
<ul>
<li>Understand what the Playbook does.</li>
<li>Execute the Playbook <code>motd-facts.yml</code>.</li>
<li>Observe if the handler was triggered. Re-Run the playbook multiple times.</li>
<li>Login to node1 via <abbr title="Secure Shell">SSH</abbr> and check the message of the day content.</li>
<li>Log out of node1.</li>
</ul>
<p>You should see how Ansible replaces the variables with the facts it discovered from the system. The handler was only triggered when the task reported a <em>changed</em> state.</p>
<h3 id="ansible-core-ansible-core-templates-step-2-challenge-lab">Step 2 - Challenge Lab</h3>
<p>Add a line to the template to list the current kernel of the managed node.</p>
<ul>
<li>Find a fact that contains the kernel version using the commands you learned in the "Ansible Facts" chapter.</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Filter for <em>kernel</em>.</p>
</div>
<p>Run the newly created playbook to find the fact name.</p>
<ul>
<li>
<p>Change the template to use the fact you found.</p>
</li>
<li>
<p>Run the motd playbook again.</p>
</li>
<li>
<p>Check motd by logging in to node1</p>
</li>
</ul>
<details class="success">
<summary>Solution</summary>
<p>Find the fact:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ansible-core-ansible-core-templates-__codelineno-5-1"></a><span class="nn">---</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#ansible-core-ansible-core-templates-__codelineno-5-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Capture Kernel Version</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#ansible-core-ansible-core-templates-__codelineno-5-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node1</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#ansible-core-ansible-core-templates-__codelineno-5-4"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#ansible-core-ansible-core-templates-__codelineno-5-5"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Collect only kernel facts</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#ansible-core-ansible-core-templates-__codelineno-5-6"></a><span class="w">      </span><span class="nt">ansible.builtin.setup</span><span class="p">:</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#ansible-core-ansible-core-templates-__codelineno-5-7"></a><span class="w">        </span><span class="nt">filter</span><span class="p">:</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#ansible-core-ansible-core-templates-__codelineno-5-8"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;*kernel&#39;</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#ansible-core-ansible-core-templates-__codelineno-5-9"></a><span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">setup_output</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#ansible-core-ansible-core-templates-__codelineno-5-10"></a>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#ansible-core-ansible-core-templates-__codelineno-5-11"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Output variable content</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#ansible-core-ansible-core-templates-__codelineno-5-12"></a><span class="w">      </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#ansible-core-ansible-core-templates-__codelineno-5-13"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">setup_output</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></div>
<p>With the wildcard in place, the output shows:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ansible-core-ansible-core-templates-__codelineno-6-1"></a><span class="go">TASK [debug] *******************************************************************</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#ansible-core-ansible-core-templates-__codelineno-6-2"></a><span class="go">ok: [node1] =&gt; {</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#ansible-core-ansible-core-templates-__codelineno-6-3"></a><span class="go">    &quot;setup&quot;: {</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#ansible-core-ansible-core-templates-__codelineno-6-4"></a><span class="go">        &quot;ansible_facts&quot;: {</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#ansible-core-ansible-core-templates-__codelineno-6-5"></a><span class="go">            &quot;ansible_kernel&quot;: &quot;4.18.0-305.12.1.el8_4.x86_64&quot;</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#ansible-core-ansible-core-templates-__codelineno-6-6"></a><span class="go">        },</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#ansible-core-ansible-core-templates-__codelineno-6-7"></a><span class="go">        &quot;changed&quot;: false,</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#ansible-core-ansible-core-templates-__codelineno-6-8"></a><span class="go">        &quot;failed&quot;: false</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#ansible-core-ansible-core-templates-__codelineno-6-9"></a><span class="go">    }</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#ansible-core-ansible-core-templates-__codelineno-6-10"></a><span class="go">}</span>
</span></code></pre></div>
<p>With this we can conclude the variable we are looking for is labeled <code>ansible_kernel</code>.
Then we can update the motd-facts.j2 template to include <code>ansible_kernel</code> as part of its message.</p>
<p>Modify the template <code>motd-facts.j2</code>:</p>
<div class="language-html+jinja highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#ansible-core-ansible-core-templates-__codelineno-7-1"></a>Welcome to <span class="cp">{{</span> <span class="nv">ansible_hostname</span> <span class="cp">}}</span>!
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#ansible-core-ansible-core-templates-__codelineno-7-2"></a>Host runs <span class="cp">{{</span> <span class="nv">ansible_distribution</span> <span class="cp">}}</span> <span class="cp">{{</span> <span class="nv">ansible_distribution_version</span><span class="cp">}}</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#ansible-core-ansible-core-templates-__codelineno-7-3"></a>Deployed on <span class="cp">{{</span> <span class="nv">ansible_architecture</span> <span class="cp">}}</span> architecture
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#ansible-core-ansible-core-templates-__codelineno-7-4"></a>The kernel version is <span class="cp">{{</span> <span class="nv">ansible_kernel</span> <span class="cp">}}</span>
</span></code></pre></div>
<p>Run the playbook.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="ansible-core-ansible-core-templates-__tabbed_1_1" name="ansible-core-ansible-core-templates-__tabbed_1" type="radio" /><input id="ansible-core-ansible-core-templates-__tabbed_1_2" name="ansible-core-ansible-core-templates-__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="ansible-core-ansible-core-templates-__tabbed_1_1">Ansible</label><label for="ansible-core-ansible-core-templates-__tabbed_1_2">Navigator</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#ansible-core-ansible-core-templates-__codelineno-8-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible-playbook<span class="w"> </span>motd-facts.yml
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#ansible-core-ansible-core-templates-__codelineno-9-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible-navigator<span class="w"> </span>run<span class="w"> </span>motd-facts.yml<span class="w"> </span>-m<span class="w"> </span>stdout
</span></code></pre></div>
</div>
</div>
</div>
<p>Verify the new message via <abbr title="Secure Shell">SSH</abbr> login to <code>node1</code>.</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#ansible-core-ansible-core-templates-__codelineno-10-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ssh<span class="w"> </span>node1
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#ansible-core-ansible-core-templates-__codelineno-10-2"></a><span class="go">Welcome to node1.</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#ansible-core-ansible-core-templates-__codelineno-10-3"></a><span class="go">Host runs RedHat 8.1</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#ansible-core-ansible-core-templates-__codelineno-10-4"></a><span class="go">Deployed on x86_64 architecture</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#ansible-core-ansible-core-templates-__codelineno-10-5"></a><span class="go">The kernel version is 4.18.0-305.12.1.el8_4.x86_64.</span>
</span></code></pre></div>
</details>
<!-- markdownlint-disable --></section><section class="print-page" id="ansible-core-ansible-core-roles"><h1 id="ansible-core-ansible-core-roles-9-reusability-with-roles">9 - Reusability with Roles</h1>
<h2 id="ansible-core-ansible-core-roles-objective">Objective</h2>
<p>While it is possible to write a playbook in one file as we've done throughout this workshop, eventually you’ll want to reuse files and start to organize things.</p>
<p>Ansible Roles are the way we do this.  When you create a role, you deconstruct your playbook into parts and those parts sit in a directory structure.  This is explained in more details in Ansible documentation in <a href="https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_reuse_roles.html" target="_blank">Roles</a> or in <a href="https://docs.ansible.com/ansible/latest/user_guide/sample_setup.html" target="_blank">Sample Ansible setup</a>.</p>
<p>This exercise will cover:</p>
<ul>
<li>the folder structure of an Ansible Role</li>
<li>how to build an Ansible Role</li>
<li>creating an Ansible Play to use and execute a role</li>
<li>using Ansible to create a Apache VirtualHost on node2</li>
</ul>
<h2 id="ansible-core-ansible-core-roles-guide">Guide</h2>
<h3 id="ansible-core-ansible-core-roles-step-1-understanding-the-ansible-role-structure">Step 1 - Understanding the Ansible Role Structure</h3>
<p>Roles follow a defined directory structure; a role is named by the top level directory. Some of the subdirectories contain <abbr title="YAML Ain't Markup Language">YAML</abbr> files, named <code>main.yml</code>. The files and templates subdirectories can contain objects referenced by the <abbr title="YAML Ain't Markup Language">YAML</abbr> files.</p>
<p>An example project structure could look like this, the name of the role would be "apache":</p>
<div class="language-text no-copy highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ansible-core-ansible-core-roles-__codelineno-0-1"></a>apache/
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#ansible-core-ansible-core-roles-__codelineno-0-2"></a>├── defaults
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#ansible-core-ansible-core-roles-__codelineno-0-3"></a>│   └── main.yml
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#ansible-core-ansible-core-roles-__codelineno-0-4"></a>├── files
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#ansible-core-ansible-core-roles-__codelineno-0-5"></a>├── handlers
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#ansible-core-ansible-core-roles-__codelineno-0-6"></a>│   └── main.yml
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#ansible-core-ansible-core-roles-__codelineno-0-7"></a>├── meta
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#ansible-core-ansible-core-roles-__codelineno-0-8"></a>│   └── main.yml
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#ansible-core-ansible-core-roles-__codelineno-0-9"></a>├── README.md
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#ansible-core-ansible-core-roles-__codelineno-0-10"></a>├── tasks
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#ansible-core-ansible-core-roles-__codelineno-0-11"></a>│   └── main.yml
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#ansible-core-ansible-core-roles-__codelineno-0-12"></a>├── templates
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#ansible-core-ansible-core-roles-__codelineno-0-13"></a>├── tests
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#ansible-core-ansible-core-roles-__codelineno-0-14"></a>│   ├── inventory
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#ansible-core-ansible-core-roles-__codelineno-0-15"></a>│   └── test.yml
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#ansible-core-ansible-core-roles-__codelineno-0-16"></a>└── vars
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#ansible-core-ansible-core-roles-__codelineno-0-17"></a>    └── main.yml
</span></code></pre></div>
<p>The various <code>main.yml</code> files contain content depending on their location in the directory structure shown above. For instance, <code>vars/main.yml</code> references variables, <code>handlers/main.yaml</code> describes handlers, and so on. Note that in contrast to playbooks, the <code>main.yml</code> files only contain the specific content and not additional playbook information like hosts, <code>become</code> or other keywords.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>There are actually two directories for variables: <code>vars</code> and <code>default</code>. Default variables, <code>defaults/main.yml</code>, have the lowest precedence and usually contain default values set by the role authors and are often used when it is intended that their values will be overridden. Variables set in <code>vars/main.yml</code> are for variables not intended to be modified.</p>
</div>
<p>Using roles in a Playbook is straight forward:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ansible-core-ansible-core-roles-__codelineno-1-1"></a><span class="nn">---</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#ansible-core-ansible-core-roles-__codelineno-1-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Launch roles</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#ansible-core-ansible-core-roles-__codelineno-1-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#ansible-core-ansible-core-roles-__codelineno-1-4"></a><span class="w">  </span><span class="nt">roles</span><span class="p">:</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#ansible-core-ansible-core-roles-__codelineno-1-5"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">role1</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#ansible-core-ansible-core-roles-__codelineno-1-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">role2</span>
</span></code></pre></div>
<p>For each role, the tasks, handlers and variables of that role will be included in the Playbook, in that order. Any copy, script, template, or include tasks in the role can reference the relevant files, templates, or tasks <em>without absolute or relative path names</em>. Ansible will look for them in the role's files, templates, or tasks respectively, based on their
use.</p>
<h3 id="ansible-core-ansible-core-roles-step-2-create-a-basic-role-directory-structure">Step 2 - Create a Basic Role Directory Structure</h3>
<p>Ansible looks for roles in a subdirectory called <code>roles</code> in the project directory. This can be overridden in the Ansible configuration. Each role has its own directory. To ease creation of a new role the tool <code>ansible-galaxy</code> can be used.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Ansible Galaxy is your hub for finding, reusing and sharing the best Ansible content. <code>ansible-galaxy</code> helps to interact with Ansible Galaxy. For now we'll just using it as a helper to build the directory structure.</p>
</div>
<p>Okay, lets start to build a role. We'll build a role that installs and configures Apache to serve a virtual host. Run these commands in your <code>~/ansible-files</code> directory:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ansible-core-ansible-core-roles-__codelineno-2-1"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>mkdir<span class="w"> </span>roles
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#ansible-core-ansible-core-roles-__codelineno-2-2"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>ansible-galaxy<span class="w"> </span>init<span class="w"> </span>--offline<span class="w"> </span>roles/apache-webserver
</span></code></pre></div>
<p>Have a look at the role directories and their content:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ansible-core-ansible-core-roles-__codelineno-3-1"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>tree<span class="w"> </span>roles
</span></code></pre></div>
<div class="language-text no-copy highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ansible-core-ansible-core-roles-__codelineno-4-1"></a>roles/
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#ansible-core-ansible-core-roles-__codelineno-4-2"></a>└── apache-webserver
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#ansible-core-ansible-core-roles-__codelineno-4-3"></a>    ├── defaults
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#ansible-core-ansible-core-roles-__codelineno-4-4"></a>    │   └── main.yml
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#ansible-core-ansible-core-roles-__codelineno-4-5"></a>    ├── files
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#ansible-core-ansible-core-roles-__codelineno-4-6"></a>    ├── handlers
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#ansible-core-ansible-core-roles-__codelineno-4-7"></a>    │   └── main.yml
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#ansible-core-ansible-core-roles-__codelineno-4-8"></a>    ├── meta
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#ansible-core-ansible-core-roles-__codelineno-4-9"></a>    │   └── main.yml
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#ansible-core-ansible-core-roles-__codelineno-4-10"></a>    ├── README.md
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#ansible-core-ansible-core-roles-__codelineno-4-11"></a>    ├── tasks
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#ansible-core-ansible-core-roles-__codelineno-4-12"></a>    │   └── main.yml
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#ansible-core-ansible-core-roles-__codelineno-4-13"></a>    ├── templates
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#ansible-core-ansible-core-roles-__codelineno-4-14"></a>    ├── tests
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#ansible-core-ansible-core-roles-__codelineno-4-15"></a>    │   ├── inventory
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#ansible-core-ansible-core-roles-__codelineno-4-16"></a>    │   └── test.yml
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#ansible-core-ansible-core-roles-__codelineno-4-17"></a>    └── vars
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#ansible-core-ansible-core-roles-__codelineno-4-18"></a>        └── main.yml
</span></code></pre></div>
<h3 id="ansible-core-ansible-core-roles-step-3-create-the-tasks-file">Step 3 - Create the Tasks File</h3>
<p>The <code>main.yml</code> file in the tasks subdirectory of the role should do the following:</p>
<ul>
<li>Make sure httpd is installed</li>
<li>Make sure httpd is started and enabled</li>
<li>Put <abbr title="Hyper Text Markup Language">HTML</abbr> content into the Apache document root</li>
<li>Install the template provided to configure the vhost</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>main.yml</code> (and other files possibly included by main.yml) can <strong>only contain tasks</strong>, <strong>not</strong> complete playbooks!</p>
</div>
<p>Edit the <code>roles/apache-webserver/tasks/main.yml</code> file:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ansible-core-ansible-core-roles-__codelineno-5-1"></a><span class="nn">---</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#ansible-core-ansible-core-roles-__codelineno-5-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install httpd package</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#ansible-core-ansible-core-roles-__codelineno-5-3"></a><span class="w">  </span><span class="nt">ansible.builtin.yum</span><span class="p">:</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#ansible-core-ansible-core-roles-__codelineno-5-4"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#ansible-core-ansible-core-roles-__codelineno-5-5"></a><span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">latest</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#ansible-core-ansible-core-roles-__codelineno-5-6"></a>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#ansible-core-ansible-core-roles-__codelineno-5-7"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Start and enable httpd service</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#ansible-core-ansible-core-roles-__codelineno-5-8"></a><span class="w">  </span><span class="nt">ansible.builtin.service</span><span class="p">:</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#ansible-core-ansible-core-roles-__codelineno-5-9"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#ansible-core-ansible-core-roles-__codelineno-5-10"></a><span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#ansible-core-ansible-core-roles-__codelineno-5-11"></a><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span></code></pre></div>
<p>Note that here just tasks were added. The details of a playbook are not present.</p>
<p>The tasks added so far do:</p>
<ul>
<li>Install the httpd package using the yum module</li>
<li>Use the service module to enable and start httpd</li>
</ul>
<p>Next we add two more tasks to ensure a <em>vhost</em> directory structure on the managed nodes and copy <abbr title="Hyper Text Markup Language">HTML</abbr> content:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ansible-core-ansible-core-roles-__codelineno-6-1"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ensure vhost directory is present</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#ansible-core-ansible-core-roles-__codelineno-6-2"></a><span class="w">  </span><span class="nt">ansible.builtin.file</span><span class="p">:</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#ansible-core-ansible-core-roles-__codelineno-6-3"></a><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/var/www/vhosts/{{</span><span class="nv"> </span><span class="s">ansible_hostname</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#ansible-core-ansible-core-roles-__codelineno-6-4"></a><span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">directory</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#ansible-core-ansible-core-roles-__codelineno-6-5"></a>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#ansible-core-ansible-core-roles-__codelineno-6-6"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deliver html content</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#ansible-core-ansible-core-roles-__codelineno-6-7"></a><span class="w">  </span><span class="nt">ansible.builtin.copy</span><span class="p">:</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#ansible-core-ansible-core-roles-__codelineno-6-8"></a><span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web.html</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#ansible-core-ansible-core-roles-__codelineno-6-9"></a><span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/var/www/vhosts/{{</span><span class="nv"> </span><span class="s">ansible_hostname</span><span class="nv"> </span><span class="s">}}/index.html&quot;</span>
</span></code></pre></div>
<p>Note that the <em>vhost</em> directory is created/ensured using the <code>file</code> module.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>The term <em>Virtual Host</em> refers to the practice of running more than one web site (such as <em>company1.example.com</em> and <em>company2.example.com</em>) on a single machine. The fact that they are running on the same physical server is not apparent to the end user.</p>
</div>
<p>The last task we add uses the template module to create the vhost configuration file from a j2-template:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#ansible-core-ansible-core-roles-__codelineno-7-1"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy vhost template</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#ansible-core-ansible-core-roles-__codelineno-7-2"></a><span class="w">  </span><span class="nt">ansible.builtin.template</span><span class="p">:</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#ansible-core-ansible-core-roles-__codelineno-7-3"></a><span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vhost.conf.j2</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#ansible-core-ansible-core-roles-__codelineno-7-4"></a><span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/httpd/conf.d/vhost.conf</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#ansible-core-ansible-core-roles-__codelineno-7-5"></a><span class="w">    </span><span class="nt">owner</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#ansible-core-ansible-core-roles-__codelineno-7-6"></a><span class="w">    </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#ansible-core-ansible-core-roles-__codelineno-7-7"></a><span class="w">    </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0644&quot;</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#ansible-core-ansible-core-roles-__codelineno-7-8"></a><span class="w">  </span><span class="nt">notify</span><span class="p">:</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#ansible-core-ansible-core-roles-__codelineno-7-9"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restart_httpd</span>
</span></code></pre></div>
<p>Note it is using a handler to restart httpd after an configuration update.</p>
<p>The full <code>tasks/main.yml</code> file is:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#ansible-core-ansible-core-roles-__codelineno-8-1"></a><span class="nn">---</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#ansible-core-ansible-core-roles-__codelineno-8-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install httpd package</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#ansible-core-ansible-core-roles-__codelineno-8-3"></a><span class="w">  </span><span class="nt">ansible.builtin.yum</span><span class="p">:</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#ansible-core-ansible-core-roles-__codelineno-8-4"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#ansible-core-ansible-core-roles-__codelineno-8-5"></a><span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#ansible-core-ansible-core-roles-__codelineno-8-6"></a>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#ansible-core-ansible-core-roles-__codelineno-8-7"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Start and enable httpd service</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#ansible-core-ansible-core-roles-__codelineno-8-8"></a><span class="w">  </span><span class="nt">ansible.builtin.service</span><span class="p">:</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#ansible-core-ansible-core-roles-__codelineno-8-9"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#ansible-core-ansible-core-roles-__codelineno-8-10"></a><span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#ansible-core-ansible-core-roles-__codelineno-8-11"></a><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#ansible-core-ansible-core-roles-__codelineno-8-12"></a>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#ansible-core-ansible-core-roles-__codelineno-8-13"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ensure vhost directory is present</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#ansible-core-ansible-core-roles-__codelineno-8-14"></a><span class="w">  </span><span class="nt">ansible.builtin.file</span><span class="p">:</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#ansible-core-ansible-core-roles-__codelineno-8-15"></a><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/var/www/vhosts/{{</span><span class="nv"> </span><span class="s">ansible_hostname</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#ansible-core-ansible-core-roles-__codelineno-8-16"></a><span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">directory</span>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#ansible-core-ansible-core-roles-__codelineno-8-17"></a><span class="w">    </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0755&quot;</span>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#ansible-core-ansible-core-roles-__codelineno-8-18"></a>
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19" href="#ansible-core-ansible-core-roles-__codelineno-8-19"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deliver html content</span>
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20" href="#ansible-core-ansible-core-roles-__codelineno-8-20"></a><span class="w">  </span><span class="nt">ansible.builtin.copy</span><span class="p">:</span>
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21" href="#ansible-core-ansible-core-roles-__codelineno-8-21"></a><span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web.html</span>
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22" href="#ansible-core-ansible-core-roles-__codelineno-8-22"></a><span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/var/www/vhosts/{{</span><span class="nv"> </span><span class="s">ansible_hostname</span><span class="nv"> </span><span class="s">}}/index.html&quot;</span>
</span><span id="__span-8-23"><a id="__codelineno-8-23" name="__codelineno-8-23" href="#ansible-core-ansible-core-roles-__codelineno-8-23"></a><span class="w">    </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0644&quot;</span>
</span><span id="__span-8-24"><a id="__codelineno-8-24" name="__codelineno-8-24" href="#ansible-core-ansible-core-roles-__codelineno-8-24"></a>
</span><span id="__span-8-25"><a id="__codelineno-8-25" name="__codelineno-8-25" href="#ansible-core-ansible-core-roles-__codelineno-8-25"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy vhost template</span>
</span><span id="__span-8-26"><a id="__codelineno-8-26" name="__codelineno-8-26" href="#ansible-core-ansible-core-roles-__codelineno-8-26"></a><span class="w">  </span><span class="nt">ansible.builtin.template</span><span class="p">:</span>
</span><span id="__span-8-27"><a id="__codelineno-8-27" name="__codelineno-8-27" href="#ansible-core-ansible-core-roles-__codelineno-8-27"></a><span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vhost.conf.j2</span>
</span><span id="__span-8-28"><a id="__codelineno-8-28" name="__codelineno-8-28" href="#ansible-core-ansible-core-roles-__codelineno-8-28"></a><span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/httpd/conf.d/vhost.conf</span>
</span><span id="__span-8-29"><a id="__codelineno-8-29" name="__codelineno-8-29" href="#ansible-core-ansible-core-roles-__codelineno-8-29"></a><span class="w">    </span><span class="nt">owner</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
</span><span id="__span-8-30"><a id="__codelineno-8-30" name="__codelineno-8-30" href="#ansible-core-ansible-core-roles-__codelineno-8-30"></a><span class="w">    </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
</span><span id="__span-8-31"><a id="__codelineno-8-31" name="__codelineno-8-31" href="#ansible-core-ansible-core-roles-__codelineno-8-31"></a><span class="w">    </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0644&quot;</span>
</span><span id="__span-8-32"><a id="__codelineno-8-32" name="__codelineno-8-32" href="#ansible-core-ansible-core-roles-__codelineno-8-32"></a><span class="w">  </span><span class="nt">notify</span><span class="p">:</span>
</span><span id="__span-8-33"><a id="__codelineno-8-33" name="__codelineno-8-33" href="#ansible-core-ansible-core-roles-__codelineno-8-33"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restart_httpd</span>
</span></code></pre></div>
<h3 id="ansible-core-ansible-core-roles-step-4-create-the-handler">Step 4 - Create the handler</h3>
<p>Create the handler in the file <code>roles/apache-webserver/handlers/main.yml</code> to restart httpd when notified by the template task:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#ansible-core-ansible-core-roles-__codelineno-9-1"></a><span class="nn">---</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#ansible-core-ansible-core-roles-__codelineno-9-2"></a><span class="c1"># handlers file for roles/apache-webserver</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#ansible-core-ansible-core-roles-__codelineno-9-3"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restart_httpd</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#ansible-core-ansible-core-roles-__codelineno-9-4"></a><span class="w">  </span><span class="nt">ansible.builtin.service</span><span class="p">:</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#ansible-core-ansible-core-roles-__codelineno-9-5"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#ansible-core-ansible-core-roles-__codelineno-9-6"></a><span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restarted</span>
</span></code></pre></div>
<h3 id="ansible-core-ansible-core-roles-step-5-create-the-webhtml-and-vhost-configuration-file-template">Step 5 - Create the web.html and vhost configuration file template</h3>
<p>Create the <abbr title="Hyper Text Markup Language">HTML</abbr> content that will be served by the webserver.</p>
<ul>
<li>Create an <code>web.html</code> file in the "src" directory of the role, the <code>files</code> folder. Add a simple <abbr title="Hyper Text Markup Language">HTML</abbr> content to the file:</li>
</ul>
<div class="language-html highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#ansible-core-ansible-core-roles-__codelineno-10-1"></a><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#ansible-core-ansible-core-roles-__codelineno-10-2"></a>    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>The virtual host configuration works!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#ansible-core-ansible-core-roles-__codelineno-10-3"></a><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></code></pre></div>
<ul>
<li>Create the <code>vhost.conf.j2</code> template file in the role's <code>templates</code> subdirectory.</li>
</ul>
<p>The contents of the <code>vhost.conf.j2</code> template file are found below.</p>
<div class="language-apache highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#ansible-core-ansible-core-roles-__codelineno-11-1"></a><span class="c"># {{ ansible_managed }}</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#ansible-core-ansible-core-roles-__codelineno-11-2"></a>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#ansible-core-ansible-core-roles-__codelineno-11-3"></a><span class="nt">&lt;VirtualHost</span><span class="w"> </span><span class="s">*:8080</span><span class="nt">&gt;</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#ansible-core-ansible-core-roles-__codelineno-11-4"></a><span class="w">    </span><span class="nb">ServerAdmin</span><span class="w"> </span>webmaster@{{<span class="w"> </span>ansible_fqdn<span class="w"> </span>}}
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#ansible-core-ansible-core-roles-__codelineno-11-5"></a><span class="w">    </span><span class="nb">ServerName</span><span class="w"> </span>{{<span class="w"> </span>ansible_fqdn<span class="w"> </span>}}
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#ansible-core-ansible-core-roles-__codelineno-11-6"></a><span class="w">    </span><span class="nb">ErrorLog</span><span class="w"> </span>logs/{{<span class="w"> </span>ansible_hostname<span class="w"> </span>}}-error.log
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#ansible-core-ansible-core-roles-__codelineno-11-7"></a><span class="w">    </span><span class="nb">CustomLog</span><span class="w"> </span>logs/{{<span class="w"> </span>ansible_hostname<span class="w"> </span>}}-common.log<span class="w"> </span>common
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#ansible-core-ansible-core-roles-__codelineno-11-8"></a><span class="w">    </span><span class="nb">DocumentRoot</span><span class="w"> </span><span class="sx">/var/www/vhosts/</span>{{<span class="w"> </span>ansible_hostname<span class="w"> </span>}}/
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#ansible-core-ansible-core-roles-__codelineno-11-9"></a>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#ansible-core-ansible-core-roles-__codelineno-11-10"></a><span class="w">    </span><span class="nt">&lt;Directory</span><span class="w"> </span><span class="s">/var/www/vhosts/{{ ansible_hostname }}/</span><span class="nt">&gt;</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#ansible-core-ansible-core-roles-__codelineno-11-11"></a><span class="w">  </span><span class="nb">Options</span><span class="w"> </span>+Indexes<span class="w"> </span>+FollowSymlinks<span class="w"> </span>+Includes
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#ansible-core-ansible-core-roles-__codelineno-11-12"></a><span class="w">  </span><span class="nb">Order</span><span class="w"> </span>allow,deny
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#ansible-core-ansible-core-roles-__codelineno-11-13"></a><span class="w">  </span><span class="nb">Allow</span><span class="w"> </span>from<span class="w"> </span><span class="k">all</span>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#ansible-core-ansible-core-roles-__codelineno-11-14"></a><span class="w">    </span><span class="nt">&lt;/Directory&gt;</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#ansible-core-ansible-core-roles-__codelineno-11-15"></a><span class="nt">&lt;/VirtualHost&gt;</span>
</span></code></pre></div>
<h3 id="ansible-core-ansible-core-roles-step-6-test-the-role">Step 6 - Test the role</h3>
<p>You are ready to test the role against <code>node2</code>. But since a role cannot be assigned to a node directly, first create a playbook which connects the role and the host. Create the file <code>test_apache_role.yml</code> in the directory <code>~/ansible-files</code>:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#ansible-core-ansible-core-roles-__codelineno-12-1"></a><span class="nn">---</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#ansible-core-ansible-core-roles-__codelineno-12-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Use apache-webserver role</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#ansible-core-ansible-core-roles-__codelineno-12-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node2</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#ansible-core-ansible-core-roles-__codelineno-12-4"></a><span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#ansible-core-ansible-core-roles-__codelineno-12-5"></a><span class="w">  </span><span class="nt">pre_tasks</span><span class="p">:</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#ansible-core-ansible-core-roles-__codelineno-12-6"></a>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#ansible-core-ansible-core-roles-__codelineno-12-7"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Output info before any role execution</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#ansible-core-ansible-core-roles-__codelineno-12-8"></a><span class="w">      </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#ansible-core-ansible-core-roles-__codelineno-12-9"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Beginning</span><span class="nv"> </span><span class="s">web</span><span class="nv"> </span><span class="s">server</span><span class="nv"> </span><span class="s">configuration.&quot;</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#ansible-core-ansible-core-roles-__codelineno-12-10"></a>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#ansible-core-ansible-core-roles-__codelineno-12-11"></a><span class="w">  </span><span class="nt">roles</span><span class="p">:</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#ansible-core-ansible-core-roles-__codelineno-12-12"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apache-webserver</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#ansible-core-ansible-core-roles-__codelineno-12-13"></a>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#ansible-core-ansible-core-roles-__codelineno-12-14"></a><span class="w">  </span><span class="nt">post_tasks</span><span class="p">:</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#ansible-core-ansible-core-roles-__codelineno-12-15"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Output info before all roles are executed</span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#ansible-core-ansible-core-roles-__codelineno-12-16"></a><span class="w">      </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#ansible-core-ansible-core-roles-__codelineno-12-17"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Web</span><span class="nv"> </span><span class="s">server</span><span class="nv"> </span><span class="s">has</span><span class="nv"> </span><span class="s">been</span><span class="nv"> </span><span class="s">configured.&quot;</span>
</span></code></pre></div>
<p>Note the <code>pre_tasks</code> and <code>post_tasks</code> keywords. Normally, the tasks of <em>roles</em> execute before the <em>tasks</em> of a playbook. To control order of execution <code>pre_tasks</code> are performed before any roles are applied. The <code>post_tasks</code> are performed after all the roles have completed. Here we just use them to better highlight when the actual role is executed.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>In most use cases, you should not mix/use <em>roles</em> and <em>tasks</em> in your play together. If you need to have single tasks in your play, why not create another role and include the tasks there?!</p>
</div>
<p>Now you are ready to run your playbook:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="ansible-core-ansible-core-roles-__tabbed_1_1" name="ansible-core-ansible-core-roles-__tabbed_1" type="radio" /><input id="ansible-core-ansible-core-roles-__tabbed_1_2" name="ansible-core-ansible-core-roles-__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="ansible-core-ansible-core-roles-__tabbed_1_1">Ansible</label><label for="ansible-core-ansible-core-roles-__tabbed_1_2">Navigator</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#ansible-core-ansible-core-roles-__codelineno-13-1"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>ansible-playbook<span class="w"> </span>test_apache_role.yml
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#ansible-core-ansible-core-roles-__codelineno-14-1"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>ansible-navigator<span class="w"> </span>run<span class="w"> </span>test_apache_role.yml<span class="w"> </span>-m<span class="w"> </span>stdout
</span></code></pre></div>
</div>
</div>
</div>
<p>Run a curl command against <code>node2</code> to confirm that the role worked or use the <code>check_httpd.yml</code> playbook (you may need to adjust the variable in it to <code>node2:8080</code>):</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#ansible-core-ansible-core-roles-__codelineno-15-1"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>curl<span class="w"> </span>-s<span class="w"> </span>http://node2:8080
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#ansible-core-ansible-core-roles-__codelineno-15-2"></a><span class="go">&lt;body&gt;</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#ansible-core-ansible-core-roles-__codelineno-15-3"></a><span class="go">&lt;h1&gt;The virtual host configuration works!&lt;/h1&gt;</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#ansible-core-ansible-core-roles-__codelineno-15-4"></a><span class="go">&lt;/body&gt;</span>
</span></code></pre></div>
<p>You can also use the IP address of node2 (copy it from your inventory) and paste it into the browser (as well as adding <code>:8080</code>).</p>
<p>Congratulations! You have successfully completed this exercise!</p>
<h2 id="ansible-core-ansible-core-roles-troubleshooting-problems">Troubleshooting problems</h2>
<p>Did the final curl work?<br />
You can see what ports the web server is running on by using the netstat command, connect to the managed node via <abbr title="Secure Shell">SSH</abbr>:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#ansible-core-ansible-core-roles-__codelineno-16-1"></a><span class="gp">#</span>&gt;<span class="w"> </span>sudo<span class="w"> </span>netstat<span class="w"> </span>-tulpn
</span></code></pre></div>
<p>If <em>netstat</em> is not present, install it with this command:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#ansible-core-ansible-core-roles-__codelineno-17-1"></a><span class="gp">#</span>&gt;<span class="w"> </span>sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>net-tools
</span></code></pre></div>
<p>There should be a line like this:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#ansible-core-ansible-core-roles-__codelineno-18-1"></a><span class="go">tcp6       0      0 :::8080                 :::*                    LISTEN      25237/httpd</span>
</span></code></pre></div>
<p>If it is not working make sure that <code>/etc/httpd/conf/httpd.conf</code> has <code>Listen 8080</code> in it.  This should have been changed by <a href="#ansible-core-ansible-core-handlers">Exercise 7</a>.</p>
<!-- markdownlint-disable --></section><section class="print-page" id="ansible-core-ansible-core-supplemental"><h1 id="ansible-core-ansible-core-supplemental-bonus-exercises">Bonus exercises</h1>
<p>You have finished the lab already. But it doesn’t have to end here. We prepared some slightly more advanced bonus labs for you to follow through if you like. So if you are done with the labs and still have some time, here are some more labs for you:</p>
<h2 id="ansible-core-ansible-core-supplemental-bonus-lab-1-prepare-infrastructure">Bonus Lab 1: Prepare infrastructure</h2>
<p>Ansible uses <abbr title="Secure Shell">SSH</abbr> to communicate with Linux nodes, the recommended method is to use <em><abbr title="Secure Shell">SSH</abbr>-Keys</em> and not use a password to connect to the managed nodes.<br />
It is also advisable to use a dedicated user for automation on all managed nodes. In our exercises this user will be called <code>ansible</code>.  </p>
<p>Let's break the initially working (password-less) <abbr title="Secure Shell">SSH</abbr>-connection in the lab environment and establish a new one with the service user <code>ansible</code>.</p>
<p>Download a script using the next command. Copy the command by clicking the <em>copy</em> button on the right of the code block:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ansible-core-ansible-core-supplemental-__codelineno-0-1"></a><span class="go">wget -q https://raw.githubusercontent.com/TimGrt/prepare-redhat-demo-system/master/break-ssh.sh</span>
</span></code></pre></div>
<p>After downloading the script to your home directory, execute it:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ansible-core-ansible-core-supplemental-__codelineno-1-1"></a><span class="gp">[student@ansible-1 ~]$ </span>wget<span class="w"> </span>-q<span class="w"> </span>https://raw.githubusercontent.com/TimGrt/prepare-redhat-demo-system/master/break-ssh.sh
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#ansible-core-ansible-core-supplemental-__codelineno-1-2"></a><span class="gp">[student@ansible-1 ~]$ </span>sh<span class="w"> </span><span class="k">break</span>-ssh.sh
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#ansible-core-ansible-core-supplemental-__codelineno-1-3"></a><span class="gp">[student@ansible-1 ~]$</span>
</span></code></pre></div>
<p><em>No output is good output.</em> Now we can configure the <abbr title="Secure Shell">SSH</abbr> connection the way it want.</p>
<div class="admonition success">
<p class="admonition-title">Success</p>
<p>The goal is to be able to communicate from <em>ansible-1</em> as <code>student</code> to the <code>ansible</code> user on all 3 managed nodes.</p>
</div>
<p>We will need the (already present) <abbr title="Secure Shell">SSH</abbr> <strong>public key</strong> of user <code>student</code> on <em>ansible-1</em> (use your own, not this one!):</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ansible-core-ansible-core-supplemental-__codelineno-2-1"></a><span class="gp">[student@ansible-1 ~]$ </span>cat<span class="w"> </span>.ssh/id_rsa.pub
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#ansible-core-ansible-core-supplemental-__codelineno-2-2"></a><span class="go">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCFeZ0j9HODBeDzP5aV5mkrsIGY1mvHTLjbCZIeHNpldIGETKflG6W0/</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#ansible-core-ansible-core-supplemental-__codelineno-2-3"></a><span class="go">...</span>
</span></code></pre></div>
<details class="hint">
<summary>Hint</summary>
<p>If you want to create your own <abbr title="Secure Shell">SSH</abbr>-Key-Pair, use this command:
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ansible-core-ansible-core-supplemental-__codelineno-3-1"></a><span class="go">ssh-keygen</span>
</span></code></pre></div></p>
</details>
<p>Next, <abbr title="Secure Shell">SSH</abbr> to the <em>ec2-user</em> on <em>node1</em>.</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ansible-core-ansible-core-supplemental-__codelineno-4-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ssh<span class="w"> </span>ec2-user@node1
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#ansible-core-ansible-core-supplemental-__codelineno-4-2"></a><span class="gp">[ec2-user@node1 ~]$</span>
</span></code></pre></div>
<p>Your are now on <em>node1</em>. Switch to the <em>root</em> user and create a new user <code>ansible</code> (with a home directory). After creating the user, switch to the <code>ansible</code> user:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ansible-core-ansible-core-supplemental-__codelineno-5-1"></a><span class="gp">[ec2-user@node1 ~]$ </span>sudo<span class="w"> </span>su<span class="w"> </span>-<span class="w"> </span>root
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#ansible-core-ansible-core-supplemental-__codelineno-5-2"></a><span class="go">Last login: Sun Apr 17 08:36:53 UTC 2022 on pts/0</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#ansible-core-ansible-core-supplemental-__codelineno-5-3"></a><span class="gp">[root@node1 ~]# </span>useradd<span class="w"> </span>ansible
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#ansible-core-ansible-core-supplemental-__codelineno-5-4"></a><span class="gp">[root@node1 ~]# </span>su<span class="w"> </span>-<span class="w"> </span>ansible
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#ansible-core-ansible-core-supplemental-__codelineno-5-5"></a><span class="gp">[ansible@node1 ~]$</span>
</span></code></pre></div>
<p>Ensure that you are the <em>ansible</em> user, we need to create the (hidden) <code>.ssh</code> directory and the <code>authorized_keys</code> file in it. The <code>authorized_keys</code> file houses the <strong>public</strong> key of user <em>student</em> on the <em>ansible-1</em> host, copy the key to the file (press <em>i</em> in <em>vi</em> to enter the <em>insert mode</em>):</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ansible-core-ansible-core-supplemental-__codelineno-6-1"></a><span class="gp">[ansible@node1 ~]$ </span>mkdir<span class="w"> </span>.ssh
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#ansible-core-ansible-core-supplemental-__codelineno-6-2"></a><span class="gp">[ansible@node1 ~]$ </span>vi<span class="w"> </span>.ssh/authorized_keys
</span></code></pre></div>
<p>Now we have to set the correct permissions, the <code>.ssh</code> directory needs <em>0700</em>, the <code>authorized_keys</code> file needs <em>0600</em>.</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#ansible-core-ansible-core-supplemental-__codelineno-7-1"></a><span class="gp">[ansible@node1 ~]$ </span>chmod<span class="w"> </span><span class="m">0700</span><span class="w"> </span>.ssh
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#ansible-core-ansible-core-supplemental-__codelineno-7-2"></a><span class="gp">[ansible@node1 ~]$ </span>chmod<span class="w"> </span><span class="m">0600</span><span class="w"> </span>.ssh/authorized_keys
</span></code></pre></div>
<p>Good! We now have established a service user for our automation. The user must be able to do <em>root-like</em> tasks e.g. installing and starting services, therefore he needs sudo permissions. Switch back to the <em>root</em> user by entering <code>exit</code>, you are still on <em>node1</em>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Clobbering the sudoers file is one of the fastest ways to make your host unusable. Whenever you deal with suoders files, use <code>visudo</code>!</p>
</div>
<p>As the <em>root</em> user, create a new file under <code>/etc/sudoers.d</code>:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#ansible-core-ansible-core-supplemental-__codelineno-8-1"></a><span class="gp">[root@node1 ~]$ </span>visudo<span class="w"> </span>-f<span class="w"> </span>/etc/sudoers.d/automation
</span></code></pre></div>
<p>Copy the following line which enables the <code>ansible</code> user to use password-less sudo (use the copy button of the code block again):</p>
<div class="language-unixconfig highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#ansible-core-ansible-core-supplemental-__codelineno-9-1"></a>ansible ALL<span class="s">=(ALL) NOPASSWD</span><span class="p">:</span>ALL
</span></code></pre></div>
<p>We can check if the <code>ansible</code> user has the required permissions:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#ansible-core-ansible-core-supplemental-__codelineno-10-1"></a><span class="gp">[root@node1 ~]# </span>sudo<span class="w"> </span>-l<span class="w"> </span>-U<span class="w"> </span>ansible
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#ansible-core-ansible-core-supplemental-__codelineno-10-2"></a><span class="go">Matching Defaults entries for ansible on node1:</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#ansible-core-ansible-core-supplemental-__codelineno-10-3"></a><span class="go">    !visiblepw, always_set_home, match_group_by_gid, always_query_group_plugin, env_reset, env_keep=&quot;COLORS DISPLAY HOSTNAME HISTSIZE KDEDIR LS_COLORS&quot;, env_keep+=&quot;MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE&quot;, env_keep+=&quot;LC_COLLATE LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES&quot;,</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#ansible-core-ansible-core-supplemental-__codelineno-10-4"></a><span class="go">    env_keep+=&quot;LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE&quot;, env_keep+=&quot;LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY&quot;, secure_path=/sbin\:/bin\:/usr/sbin\:/usr/bin, !requiretty</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#ansible-core-ansible-core-supplemental-__codelineno-10-5"></a>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#ansible-core-ansible-core-supplemental-__codelineno-10-6"></a><span class="go">User ansible may run the following commands on node1:</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#ansible-core-ansible-core-supplemental-__codelineno-10-7"></a><span class="go">    (ALL) NOPASSWD: ALL</span>
</span></code></pre></div>
<p>Log out of <em>node1</em> (ensure that you are back on your ansible master node <em>ansible-1</em>, run <code>exit</code> twice) and try to log in to <em>node1</em> with the <em>ansible</em> user:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#ansible-core-ansible-core-supplemental-__codelineno-11-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ssh<span class="w"> </span>ansible@node1
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#ansible-core-ansible-core-supplemental-__codelineno-11-2"></a><span class="gp">[ansible@node1 ~]$</span>
</span></code></pre></div>
<div class="admonition failure">
<p class="admonition-title">Failure</p>
<p>If password-less <abbr title="Secure Shell">SSH</abbr> is not working, check the permissions of the <code>.ssh</code> folder and the <code>authorized_keys</code> file on the target host!</p>
</div>
<div class="admonition success">
<p class="admonition-title">Success</p>
<p>Repeat the steps above for <em>node2</em> and <em>node3</em>!</p>
</div>
<p>Once you can reach all managed nodes password-less (and sudo-permissions are set, you will need this later), we can start to do some Ansible stuff like executing this Ad-hoc command:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#ansible-core-ansible-core-supplemental-__codelineno-12-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible<span class="w"> </span>web<span class="w"> </span>-m<span class="w"> </span>ping
</span></code></pre></div>
<p>We got an error, all three nodes aren't reachable?! But manually, we can reach all nodes via <abbr title="Secure Shell">SSH</abbr>!<br />
Observing the error message we can see what the problem is, Ansible tries to us reach all hosts as the <em>student</em> user. We established the service user <em>ansible</em> for that, we must instruct Ansible to use that user. By default, Ansible will use the user that is executing the <em>ansible</em> commands.</p>
<p>Open the Ansible inventory file, either by clicking the <em>lab_inventory</em> folder and the <em>hosts</em> file in the VScode explorer or on the terminal.<br />
Create a new variable section (with <em>:vars</em>) for the <em>web</em> group and set the <em>ansible_user=ansible</em> variable:</p>
<div class="language-ini no-copy highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#ansible-core-ansible-core-supplemental-__codelineno-13-1"></a><span class="k">[web]</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#ansible-core-ansible-core-supplemental-__codelineno-13-2"></a><span class="na">node1 ansible_host</span><span class="o">=</span><span class="s">&lt;X.X.X.X&gt;</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#ansible-core-ansible-core-supplemental-__codelineno-13-3"></a><span class="na">node2 ansible_host</span><span class="o">=</span><span class="s">&lt;Y.Y.Y.Y&gt;</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#ansible-core-ansible-core-supplemental-__codelineno-13-4"></a><span class="na">node3 ansible_host</span><span class="o">=</span><span class="s">&lt;Z.Z.Z.Z&gt;</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#ansible-core-ansible-core-supplemental-__codelineno-13-5"></a>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#ansible-core-ansible-core-supplemental-__codelineno-13-6"></a><span class="k">[web:vars]</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#ansible-core-ansible-core-supplemental-__codelineno-13-7"></a><span class="na">ansible_user</span><span class="o">=</span><span class="s">ansible</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#ansible-core-ansible-core-supplemental-__codelineno-13-8"></a>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#ansible-core-ansible-core-supplemental-__codelineno-13-9"></a><span class="k">[control]</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#ansible-core-ansible-core-supplemental-__codelineno-13-10"></a><span class="na">ansible-1 ansible_host</span><span class="o">=</span><span class="s">44.55.66.77</span>
</span></code></pre></div>
<p>All hosts in the <em>web</em> group will now use the <em>ansible</em> user for the <abbr title="Secure Shell">SSH</abbr> connection. Try with the ad hoc command again:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#ansible-core-ansible-core-supplemental-__codelineno-14-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible<span class="w"> </span>web<span class="w"> </span>-m<span class="w"> </span>ping
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#ansible-core-ansible-core-supplemental-__codelineno-14-2"></a><span class="go">node2 | SUCCESS =&gt; {</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#ansible-core-ansible-core-supplemental-__codelineno-14-3"></a><span class="go">    &quot;ansible_facts&quot;: {</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#ansible-core-ansible-core-supplemental-__codelineno-14-4"></a><span class="go">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#ansible-core-ansible-core-supplemental-__codelineno-14-5"></a><span class="go">    },</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#ansible-core-ansible-core-supplemental-__codelineno-14-6"></a><span class="go">    &quot;changed&quot;: false,</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#ansible-core-ansible-core-supplemental-__codelineno-14-7"></a><span class="go">    &quot;ping&quot;: &quot;pong&quot;</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#ansible-core-ansible-core-supplemental-__codelineno-14-8"></a><span class="go">}</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#ansible-core-ansible-core-supplemental-__codelineno-14-9"></a><span class="go">node3 | SUCCESS =&gt; {</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#ansible-core-ansible-core-supplemental-__codelineno-14-10"></a><span class="go">    &quot;ansible_facts&quot;: {</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#ansible-core-ansible-core-supplemental-__codelineno-14-11"></a><span class="go">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#ansible-core-ansible-core-supplemental-__codelineno-14-12"></a><span class="go">    },</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#ansible-core-ansible-core-supplemental-__codelineno-14-13"></a><span class="go">    &quot;changed&quot;: false,</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#ansible-core-ansible-core-supplemental-__codelineno-14-14"></a><span class="go">    &quot;ping&quot;: &quot;pong&quot;</span>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#ansible-core-ansible-core-supplemental-__codelineno-14-15"></a><span class="go">}</span>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#ansible-core-ansible-core-supplemental-__codelineno-14-16"></a><span class="go">node1 | SUCCESS =&gt; {</span>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#ansible-core-ansible-core-supplemental-__codelineno-14-17"></a><span class="go">    &quot;ansible_facts&quot;: {</span>
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#ansible-core-ansible-core-supplemental-__codelineno-14-18"></a><span class="go">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span>
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19" href="#ansible-core-ansible-core-supplemental-__codelineno-14-19"></a><span class="go">    },</span>
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20" href="#ansible-core-ansible-core-supplemental-__codelineno-14-20"></a><span class="go">    &quot;changed&quot;: false,</span>
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21" href="#ansible-core-ansible-core-supplemental-__codelineno-14-21"></a><span class="go">    &quot;ping&quot;: &quot;pong&quot;</span>
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22" href="#ansible-core-ansible-core-supplemental-__codelineno-14-22"></a><span class="go">}</span>
</span></code></pre></div>
<p>Success! All three nodes are reachable, we get a <em>pong</em> back, we proved that we can establish a <abbr title="Secure Shell">SSH</abbr> connection and that the node(s) have a usable Python interpreter.</p>
<p>Try to run the same ad hoc command against the <em>control</em> group.  </p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#ansible-core-ansible-core-supplemental-__codelineno-15-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible<span class="w"> </span>control<span class="w"> </span>-m<span class="w"> </span>ping
</span></code></pre></div>
<p>An error again?? Although being on the same host, Ansible tries to open an <abbr title="Secure Shell">SSH</abbr> connection. Adjust the inventory file again and set the <code>ansible_connection</code> variable for the <em>ansible-1</em> host:</p>
<div class="language-ini no-copy highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#ansible-core-ansible-core-supplemental-__codelineno-16-1"></a><span class="k">[web]</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#ansible-core-ansible-core-supplemental-__codelineno-16-2"></a><span class="na">node1 ansible_host</span><span class="o">=</span><span class="s">&lt;X.X.X.X&gt;</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#ansible-core-ansible-core-supplemental-__codelineno-16-3"></a><span class="na">node2 ansible_host</span><span class="o">=</span><span class="s">&lt;Y.Y.Y.Y&gt;</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#ansible-core-ansible-core-supplemental-__codelineno-16-4"></a><span class="na">node3 ansible_host</span><span class="o">=</span><span class="s">&lt;Z.Z.Z.Z&gt;</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#ansible-core-ansible-core-supplemental-__codelineno-16-5"></a>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#ansible-core-ansible-core-supplemental-__codelineno-16-6"></a><span class="k">[web:vars]</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#ansible-core-ansible-core-supplemental-__codelineno-16-7"></a><span class="na">ansible_user</span><span class="o">=</span><span class="s">ansible</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#ansible-core-ansible-core-supplemental-__codelineno-16-8"></a>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#ansible-core-ansible-core-supplemental-__codelineno-16-9"></a><span class="k">[control]</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#ansible-core-ansible-core-supplemental-__codelineno-16-10"></a><span class="na">ansible-1 ansible_host</span><span class="o">=</span><span class="s">44.55.66.77 ansible_connection=local</span>
</span></code></pre></div>
<p>With <code>ansible_connection=local</code> (on host-level) Ansible uses the <strong>local</strong> Python interpreter, which is fine for our Ansible master node. Now the ad hoc command succeeds:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#ansible-core-ansible-core-supplemental-__codelineno-17-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible<span class="w"> </span>control<span class="w"> </span>-m<span class="w"> </span>ping
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#ansible-core-ansible-core-supplemental-__codelineno-17-2"></a><span class="go">ansible-1 | SUCCESS =&gt; {</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#ansible-core-ansible-core-supplemental-__codelineno-17-3"></a><span class="go">    &quot;ansible_facts&quot;: {</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#ansible-core-ansible-core-supplemental-__codelineno-17-4"></a><span class="go">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#ansible-core-ansible-core-supplemental-__codelineno-17-5"></a><span class="go">    },</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#ansible-core-ansible-core-supplemental-__codelineno-17-6"></a><span class="go">    &quot;changed&quot;: false,</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#ansible-core-ansible-core-supplemental-__codelineno-17-7"></a><span class="go">    &quot;ping&quot;: &quot;pong&quot;</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#ansible-core-ansible-core-supplemental-__codelineno-17-8"></a><span class="go">}</span>
</span></code></pre></div>
<h2 id="ansible-core-ansible-core-supplemental-bonus-lab-2-ad-hoc-commands">Bonus Lab 2: Ad Hoc Commands</h2>
<p>Create a new user "testuser" on <code>node1</code> and <code>node3</code> with a comment using an ad hoc command, make sure that it is not created on <code>node2</code>!</p>
<ul>
<li>
<p>Find the parameters for the appropriate module using <code>ansible-doc user</code> (leave with <code>q</code>)</p>
</li>
<li>
<p>Use an Ansible ad hoc command to create the user with the comment "Test D User"</p>
</li>
<li>
<p>Use the "command" module with the proper invocation to find the <em>userid</em></p>
</li>
<li>
<p>Delete the user and its directories, then check that the user has been deleted</p>
</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Remember privilege escalation…​</p>
</div>
<details class="success">
<summary>Solution</summary>
<p>Your commands could look like these:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#ansible-core-ansible-core-supplemental-__codelineno-18-1"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>ansible-doc<span class="w"> </span>-l<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>user
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#ansible-core-ansible-core-supplemental-__codelineno-18-2"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>ansible-doc<span class="w"> </span>user
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#ansible-core-ansible-core-supplemental-__codelineno-18-3"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>ansible<span class="w"> </span>node1,node3<span class="w"> </span>-m<span class="w"> </span>user<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;name=testuser comment=&#39;Test D User&#39;&quot;</span><span class="w"> </span>-b
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#ansible-core-ansible-core-supplemental-__codelineno-18-4"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>ansible<span class="w"> </span>node1,node3<span class="w"> </span>-m<span class="w"> </span><span class="nb">command</span><span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot; id testuser&quot;</span><span class="w"> </span>-b
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#ansible-core-ansible-core-supplemental-__codelineno-18-5"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>ansible<span class="w"> </span>node2<span class="w"> </span>-m<span class="w"> </span><span class="nb">command</span><span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot; id testuser&quot;</span><span class="w"> </span>-b
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#ansible-core-ansible-core-supplemental-__codelineno-18-6"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>ansible<span class="w"> </span>node1,node3<span class="w"> </span>-m<span class="w"> </span>user<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;name=testuser state=absent remove=yes&quot;</span><span class="w"> </span>-b
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#ansible-core-ansible-core-supplemental-__codelineno-18-7"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>ansible<span class="w"> </span>web<span class="w"> </span>-m<span class="w"> </span><span class="nb">command</span><span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot; id testuser&quot;</span><span class="w"> </span>-b
</span></code></pre></div>
</details>
<h2 id="ansible-core-ansible-core-supplemental-bonus-lab-3-templates-and-variables">Bonus Lab 3: Templates and Variables</h2>
<p>You have learned the basics about Ansible templates, variables and handlers. Let’s combine all of these.</p>
<p>Instead of editing and copying <code>httpd.conf</code> why don’t you just define a variable for the listen port and use it in a template? Here is your job:</p>
<ul>
<li>
<p>Define a variable <code>listen_port</code> for the <code>web</code> group with the value <code>8080</code> and another for <code>node2</code> with the value <code>80</code> using the proper files.</p>
</li>
<li>
<p>Copy the <code>httpd.conf</code> file into the template <code>httpd.conf.j2</code> that uses the <code>listen_port</code> variable instead of the hard-coded port number.</p>
</li>
<li>
<p>Write a Playbook that deploys the template and restarts Apache on changes using a handler.</p>
</li>
<li>
<p>Run the Playbook and test the result using <code>curl</code>.</p>
</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Remember the <code>group_vars</code> and <code>host_vars</code> directories? If not, refer to the chapter <a href="#ansible-core-ansible-core-variables">Using variables</a>.</p>
</div>
<details class="success">
<summary>Solution</summary>
<p>Define the variable.  Add this line to <code>group_vars/web</code>:</p>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#ansible-core-ansible-core-supplemental-__codelineno-19-1"></a><span class="na">listen_port</span><span class="o">:</span><span class="w"> </span><span class="s">8080</span>
</span></code></pre></div>
<p>Add this line to <code>host_vars/node2</code>:</p>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#ansible-core-ansible-core-supplemental-__codelineno-20-1"></a><span class="na">listen_port</span><span class="o">:</span><span class="w"> </span><span class="s">80</span>
</span></code></pre></div>
<p>Prepare the template:</p>
<ul>
<li>
<p>Copy <code>httpd.conf</code> to <code>httpd.conf.j2</code></p>
</li>
<li>
<p>Edit the "Listen" directive in <code>httpd.conf.j2</code> to make it look like this:</p>
</li>
</ul>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#ansible-core-ansible-core-supplemental-__codelineno-21-1"></a><span class="na">Listen {{ listen_port }}</span>
</span></code></pre></div>
<p>Create a playbook called <code>apache_config_tpl.yml</code>:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#ansible-core-ansible-core-supplemental-__codelineno-22-1"></a><span class="nn">---</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#ansible-core-ansible-core-supplemental-__codelineno-22-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Apache httpd.conf deployment</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#ansible-core-ansible-core-supplemental-__codelineno-22-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#ansible-core-ansible-core-supplemental-__codelineno-22-4"></a><span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#ansible-core-ansible-core-supplemental-__codelineno-22-5"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#ansible-core-ansible-core-supplemental-__codelineno-22-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create Apache configuration file from template</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#ansible-core-ansible-core-supplemental-__codelineno-22-7"></a><span class="w">      </span><span class="nt">ansible.builtin.template</span><span class="p">:</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#ansible-core-ansible-core-supplemental-__codelineno-22-8"></a><span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd.conf.j2</span>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#ansible-core-ansible-core-supplemental-__codelineno-22-9"></a><span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/httpd/conf/httpd.conf</span>
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#ansible-core-ansible-core-supplemental-__codelineno-22-10"></a><span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0644&quot;</span>
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#ansible-core-ansible-core-supplemental-__codelineno-22-11"></a><span class="w">      </span><span class="nt">notify</span><span class="p">:</span>
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#ansible-core-ansible-core-supplemental-__codelineno-22-12"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restart_apache</span>
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13" href="#ansible-core-ansible-core-supplemental-__codelineno-22-13"></a><span class="w">  </span><span class="nt">handlers</span><span class="p">:</span>
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14" href="#ansible-core-ansible-core-supplemental-__codelineno-22-14"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restart_apache</span>
</span><span id="__span-22-15"><a id="__codelineno-22-15" name="__codelineno-22-15" href="#ansible-core-ansible-core-supplemental-__codelineno-22-15"></a><span class="w">        </span><span class="nt">ansible.builtin.service</span><span class="p">:</span>
</span><span id="__span-22-16"><a id="__codelineno-22-16" name="__codelineno-22-16" href="#ansible-core-ansible-core-supplemental-__codelineno-22-16"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd</span>
</span><span id="__span-22-17"><a id="__codelineno-22-17" name="__codelineno-22-17" href="#ansible-core-ansible-core-supplemental-__codelineno-22-17"></a><span class="w">          </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restarted</span>
</span></code></pre></div>
<p>First run the playbook itself, then run curl against <code>node1</code> with port <code>8080</code> and <code>node2</code> with port <code>80</code>.</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#ansible-core-ansible-core-supplemental-__codelineno-23-1"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>ansible-playbook<span class="w"> </span>apache_config_tpl.yml
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#ansible-core-ansible-core-supplemental-__codelineno-23-2"></a><span class="go">[...]</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#ansible-core-ansible-core-supplemental-__codelineno-23-3"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>curl<span class="w"> </span>http://18.195.235.231:8080
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#ansible-core-ansible-core-supplemental-__codelineno-23-4"></a><span class="go">&lt;body&gt;</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#ansible-core-ansible-core-supplemental-__codelineno-23-5"></a><span class="go">&lt;h1&gt;This is a development webserver, have fun!&lt;/h1&gt;</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#ansible-core-ansible-core-supplemental-__codelineno-23-6"></a><span class="go">&lt;/body&gt;</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#ansible-core-ansible-core-supplemental-__codelineno-23-7"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>curl<span class="w"> </span>http://35.156.28.209:80
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#ansible-core-ansible-core-supplemental-__codelineno-23-8"></a><span class="go">&lt;body&gt;</span>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#ansible-core-ansible-core-supplemental-__codelineno-23-9"></a><span class="go">&lt;h1&gt;This is a production webserver, take care!&lt;/h1&gt;</span>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#ansible-core-ansible-core-supplemental-__codelineno-23-10"></a><span class="go">&lt;/body&gt;</span>
</span></code></pre></div>
</details>
<!-- markdownlint-disable --></section><h1 class='nav-section-title-end'>Ended: Ansible Basics</h1>
                        <h1 class='nav-section-title' id='section-automation-platform'>
                            Automation Platform <a class='headerlink' href='#section-automation-platform' title='Permanent link'>↵</a>
                        </h1>
                        <section class="print-page" id="automation-platform-overview"><h1 id="automation-platform-overview-overview">Overview</h1>
<p>Day 2 of the Ansible Workshop is all about the Ansible Automation Platform and usage of the Ansible Automation Controller.</p>
<figure>
<p><a href="http://github.com/ansible/logos"><img alt="Ansible Automation Platform Logo"  src="../assets/images/rh-ansible-automation-platform.png" /></a>
  </p>
<figcaption></figcaption>
</figure>
<p>You will complete the following exercises today:</p>
<ul>
<li><a href="#automation-platform-automation-platform-intro">Exercise 1 - Introduction</a></li>
<li><a href="#automation-platform-automation-platform-inventory">Exercise 2 - Inventories, credentials and ad hoc commands</a></li>
<li><a href="#automation-platform-automation-platform-projects">Exercise 3 - Projects &amp; Job Templates</a></li>
<li><a href="#automation-platform-automation-platform-surveys">Exercise 4 - Surveys</a></li>
<li><a href="#automation-platform-automation-platform-rbac">Exercise 5 - Role-based access control</a></li>
<li><a href="#automation-platform-automation-platform-workflows">Exercise 6 - Workflows</a></li>
<li><a href="#automation-platform-automation-platform-wrapup">Exercise 7 - <abbr title="Ansible Automation Platform">AAP</abbr> Wrap up</a></li>
</ul>
<p>Here are some additional information of the the Ansible Automation Platform:</p>
<h2 id="automation-platform-overview-whats-new-in-ansible-automation-controller-40">What's New in Ansible automation controller 4.0</h2>
<p>Ansible Automation Platform 2 is the next evolution in automation from Red Hat’s trusted enterprise technology experts. The Ansible Automation Platform 2 release includes automation controller 4.0, the improved and renamed Ansible Tower.</p>
<p>Controller continues to provide a standardized way to define, operate, and delegate automation across the enterprise. It introduces new technologies and an enhanced architecture that enables automation teams to scale and deliver automation rapidly.</p>
<h3 id="automation-platform-overview-why-was-ansible-tower-renamed-to-automation-controller">Why was Ansible Tower renamed to automation controller?</h3>
<p>As Ansible Automation Platform 2 continues to evolve, certain functionality has been decoupled (and will continue to be decoupled in future releases) from what was formerly known as Ansible Tower. It made sense to introduce the naming change that better reflects these enhancements and the overall position within the Ansible Automation Platform suite.</p>
<h3 id="automation-platform-overview-who-is-automation-controller-for">Who is automation controller for?</h3>
<p>All automation team members interact with or rely on automation controller, either directly or indirectly.</p>
<ul>
<li>Automation creators develop Ansible playbooks, roles, and modules.</li>
<li>Automation architects elevate automation across teams to align with IT processes and streamline adoption.</li>
<li>Automation operators ensure the automation platform and framework are operational.</li>
</ul>
<p>These roles are not necessarily dedicated to a person or team. Many organizations assign multiple roles to people or outsource specific automation tasks based on their needs.</p>
<p>Automation operators are typically the primary individuals who interact directly with the automation controller, based on their responsibilities.</p>
<h3 id="automation-platform-overview-automation-mesh">Automation mesh</h3>
<figure>
<p><img alt="Automation mesh"  src="../automation-platform/images/mesh_logical.png" />
  </p>
<figcaption></figcaption>
</figure>
<p>Automation mesh is an overlay network intended to ease the distribution of work across a large and dispersed collection of workers. Mesh nodes establish peer-to-peer connections with each other across your existing networks bringing automation closer to the endpoints that need it.</p>
<!-- markdownlint-disable --></section><section class="print-page" id="automation-platform-automation-platform-intro"><h1 id="automation-platform-automation-platform-intro-1-aap-introduction">1 - <abbr title="Ansible Automation Platform">AAP</abbr> Introduction</h1>
<h2 id="automation-platform-automation-platform-intro-objective">Objective</h2>
<p>The following exercise will provide an Ansible automation controller overview including going through features that are provided by the Red Hat Ansible Automation Platform.  This will cover automation controller fundamentals such as:</p>
<ul>
<li>Job Templates</li>
<li>Projects</li>
<li>Inventories</li>
<li>Credentials</li>
<li>Workflows</li>
</ul>
<h2 id="automation-platform-automation-platform-intro-guide">Guide</h2>
<h3 id="automation-platform-automation-platform-intro-why-ansible-automation-controller">Why Ansible automation controller?</h3>
<p>Automation controller is a web-based <abbr title="User Interface">UI</abbr> that provides an enterprise solution for IT automation. It</p>
<ul>
<li>has a user-friendly dashboard.</li>
<li>complements Ansible, adding automation, visual management, and monitoring capabilities.</li>
<li>provides user access control to administrators.</li>
<li>provides distinct <em>view</em> and <em>edit</em> perspectives for automation controller objects and components.</li>
<li>graphically manages or synchronizes inventories with a wide variety of sources.</li>
<li>has a RESTful <abbr title="Application Programming Interface">API</abbr>.</li>
<li>And much more...</li>
</ul>
<h3 id="automation-platform-automation-platform-intro-your-ansible-automation-controller-lab-environment">Your Ansible automation controller lab environment</h3>
<p>In this lab you work in a pre-configured lab environment. You will have access to the following hosts:</p>
<table>
<thead>
<tr>
<th>Role</th>
<th>Inventory name</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ansible control host &amp; automation controller</td>
<td>ansible-1</td>
</tr>
<tr>
<td>Managed Host 1</td>
<td>node1</td>
</tr>
<tr>
<td>Managed Host 2</td>
<td>node2</td>
</tr>
<tr>
<td>Managed Host 2</td>
<td>node3</td>
</tr>
</tbody>
</table>
<p>The Ansible automation controller provided in this lab is individually setup for you. Make sure to access the right machine whenever you work with it. Automation controller has already been installed and licensed for you, the web <abbr title="User Interface">UI</abbr> will be reachable over <abbr title="Hyper Text Transfer Protocol">HTTP</abbr>/<abbr title="Hypertext Transfer Protocol Secure">HTTPS</abbr>.</p>
<h3 id="automation-platform-automation-platform-intro-dashboard">Dashboard</h3>
<p>Let's have a first look at the automation controller: Point your browser to the <abbr title="Uniform Resource Locator">URL</abbr> you were given, similar to <code>https://demo.redhat.com/workshop/pm6xgd</code> (the  current workshop ID will be different) and log in as <code>admin</code>. The password will be provided by the instructor.</p>
<p>The web <abbr title="User Interface">UI</abbr> of automation controller greets you with a dashboard with a graph showing:</p>
<ul>
<li>recent job activity</li>
<li>the number of managed hosts</li>
<li>quick pointers to lists of hosts with problems.</li>
</ul>
<p>The dashboard also displays real time data about the execution of tasks completed in playbooks.</p>
<p><img alt="Ansible automation controller dashboard" src="../automation-platform/images/controller_dashboard.jpg" /></p>
<h3 id="automation-platform-automation-platform-intro-concepts">Concepts</h3>
<p>Before we dive further into using Ansible automation controller, you should get familiar with some concepts and naming conventions.</p>
<h4 id="automation-platform-automation-platform-intro-projects">Projects</h4>
<p>Projects are logical collections of Ansible playbooks in Ansible automation controller. These playbooks either reside on the Ansible automation controller instance, or in a source code version control system supported by automation controller.</p>
<h4 id="automation-platform-automation-platform-intro-inventories">Inventories</h4>
<p>An Inventory is a collection of hosts against which jobs may be launched, the same as an Ansible inventory file. Inventories are divided into groups and these groups contain the actual hosts. Groups may be populated manually, by entering host names into automation controller, from one of Ansible Automation controller’s supported cloud providers or through dynamic inventory scripts.</p>
<h4 id="automation-platform-automation-platform-intro-credentials">Credentials</h4>
<p>Credentials are utilized by automation controller for authentication when launching Jobs against machines, synchronizing with inventory sources, and importing project content from a version control system. Credential configuration can be found in the Settings.</p>
<p>automation controller credentials are imported and stored encrypted in automation controller, and are not retrievable in plain text on the command line by any user. You can grant users and teams the ability to use these credentials, without actually exposing the credential to the user.</p>
<h4 id="automation-platform-automation-platform-intro-templates">Templates</h4>
<p>A job template is a definition and set of parameters for running an Ansible job. Job templates are useful to execute the same job many times. Job templates also encourage the reuse of Ansible playbook content and collaboration between teams. To execute a job, automation Controller requires that you first create a job template.</p>
<h4 id="automation-platform-automation-platform-intro-jobs">Jobs</h4>
<p>A job is basically an instance of automation controller launching an Ansible playbook against an inventory of hosts.</p>
<!-- markdownlint-disable --></section><section class="print-page" id="automation-platform-automation-platform-inventory"><h1 id="automation-platform-automation-platform-inventory-2-inventory-ad-hoc-commands">2 - Inventory &amp; Ad-hoc commands</h1>
<h2 id="automation-platform-automation-platform-inventory-objective">Objective</h2>
<p>Explore and understand the lab environment.  This exercise will cover</p>
<ul>
<li>
<p>Locating and understanding:</p>
<ul>
<li>Ansible Automation Controller <a href="https://docs.ansible.com/automation-controller/latest/html/userguide/inventories.html" target="_blank"><strong>Inventory</strong></a></li>
<li>Ansible Automation Controller <a href="https://docs.ansible.com/automation-controller/latest/html/userguide/credentials.html" target="_blank"><strong>Credentials</strong></a></li>
</ul>
</li>
<li>
<p>Running ad hoc commands via the Ansible Automation Controller web <abbr title="User Interface">UI</abbr></p>
</li>
</ul>
<h2 id="automation-platform-automation-platform-inventory-guide">Guide</h2>
<h3 id="automation-platform-automation-platform-inventory-examine-an-inventory">Examine an Inventory</h3>
<p>The first thing we need is an inventory of your managed hosts. This is the equivalent of an inventory file in Ansible Engine. There is a lot more to it (like dynamic inventories) but let’s start with the basics.</p>
<ul>
<li>You should already have the web <abbr title="User Interface">UI</abbr> open, if not: Point your browser to the <abbr title="Uniform Resource Locator">URL</abbr> you were given, similar to <code>https://demo.redhat.com/workshop/pm6xgd</code> (the <em>workshop ID</em> will be different) and log in as <code>admin</code>. The password will be provided by the instructor.</li>
</ul>
<p>There will be one inventory, the <strong>Workshop Inventory</strong>. Click the <strong>Workshop Inventory</strong> then click the <strong>Hosts</strong> button</p>
<p>The inventory information at <code>~/lab_inventory/hosts</code> was pre-loaded into the Ansible Automation controller Inventory as part of the provisioning process.</p>
<div class="language-ini no-copy highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#automation-platform-automation-platform-inventory-__codelineno-0-1"></a><span class="k">[web]</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#automation-platform-automation-platform-inventory-__codelineno-0-2"></a><span class="na">node1 ansible_host</span><span class="o">=</span><span class="s">node1.example.com</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#automation-platform-automation-platform-inventory-__codelineno-0-3"></a><span class="na">node2 ansible_host</span><span class="o">=</span><span class="s">node2.example.com</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#automation-platform-automation-platform-inventory-__codelineno-0-4"></a><span class="na">node3 ansible_host</span><span class="o">=</span><span class="s">node3.example.com</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#automation-platform-automation-platform-inventory-__codelineno-0-5"></a>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#automation-platform-automation-platform-inventory-__codelineno-0-6"></a><span class="k">[control]</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#automation-platform-automation-platform-inventory-__codelineno-0-7"></a><span class="na">ansible-1 ansible_host</span><span class="o">=</span><span class="s">ansible-1.example.com</span>
</span></code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>In your inventory the IP addresses will be different, do not copy the values above!</p>
</div>
<h3 id="automation-platform-automation-platform-inventory-examine-machine-credentials">Examine Machine Credentials</h3>
<p>Now we will examine the credentials to access our managed hosts from Automation controller.  As part of the provisioning process for this Ansible Workshop the <strong>Workshop Credential</strong> has already been setup.</p>
<p>In the <strong>Resources</strong> menu choose <strong>Credentials</strong>. Now click on the <strong>Workshop Credential</strong>.</p>
<p>Note the following information:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><nobr>Credential Type</nobr></td>
<td><code>Machine</code></td>
<td>Machine credentials define ssh and user-level privilege escalation access for playbooks. They are used when submitting jobs to run playbooks on a remote host.</td>
</tr>
<tr>
<td><nobr>Username</nobr></td>
<td><code>ec2-user</code></td>
<td>The user which matches our command-line Ansible inventory username for the other Linux nodes</td>
</tr>
<tr>
<td><nobr><abbr title="Secure Shell">SSH</abbr> Private Key</nobr></td>
<td><code>Encrypted</code></td>
<td>Note that you can't actually examine the <abbr title="Secure Shell">SSH</abbr> private key once someone hands it over to Ansible Automation controller</td>
</tr>
</tbody>
</table>
<h3 id="automation-platform-automation-platform-inventory-run-ad-hoc-commands">Run Ad Hoc commands</h3>
<p>It is possible to run run ad hoc commands from Ansible Automation controller as well.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><strong>Ensure</strong> that all hosts are available and can be included in automation jobs.<br />
Got to <strong>Resources → Hosts</strong> and move the slider on the right to <strong>On</strong> for all hosts.</p>
</div>
<ul>
<li>
<p>In the web <abbr title="User Interface">UI</abbr> go to <strong>Resources → Inventories → Workshop Inventory</strong></p>
</li>
<li>
<p>Click the <strong>Hosts</strong> tab to change into the hosts view and select the three hosts <em>node1</em> to <em>node3</em> by ticking the boxes to the left of the host entries.</p>
</li>
<li>
<p>Click <strong>Run Command</strong> button. In the next screen you have to specify the ad hoc command.</p>
</li>
</ul>
<p>Within the <strong>Details</strong> window, select <strong>Module</strong> <code>ping</code> and click <strong>Next</strong>.</p>
<p>Within the <strong>Execution Environment</strong> window, select <strong>Default execution environment</strong> and click <strong>Next</strong>.</p>
<p>Within the <strong>Machine Credential</strong> window, select <strong>Workshop Credentials</strong> and click <strong>Launch</strong>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The output of the results is displayed once the command has completed.</p>
</div>
<p>The simple <strong>ping</strong> module doesn’t need options. For other modules you need to supply the command to run as an argument. Try the <strong>command</strong> module to find the userid of the executing user using an ad hoc command.</p>
<ul>
<li>
<p>In the web <abbr title="User Interface">UI</abbr> go to <strong>Resources → Inventories → Workshop Inventory</strong></p>
</li>
<li>
<p>Click the <strong>Hosts</strong> tab to change into the hosts view and select the three hosts by ticking the boxes to the left of the host entries.</p>
</li>
<li>
<p>Click <strong>Run Command</strong> button. In the next screen you have to specify the ad hoc command.</p>
</li>
</ul>
<p>Within the <strong>Details</strong> window, select <strong>Module</strong> <code>command</code>, in <strong>Arguments</strong> type <code>id</code> and click <strong>Next</strong>.</p>
<p>Within the <strong>Execution Environment</strong> window, select <strong>Default execution environment</strong> and click <strong>Next</strong>.</p>
<p>Within the <strong>Machine Credential</strong> window, select <strong>Workshop Credentials</strong> and click <strong>Launch</strong>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>After choosing the module to run, Ansible Automation Controller will provide a link to the docs page for the module when clicking the question mark next to "Arguments". This is handy, give it a try.</p>
</div>
<p>How about trying to get some secret information from the system? Try to print out <code>/etc/shadow</code>.</p>
<ul>
<li>
<p>In the web <abbr title="User Interface">UI</abbr> go to <strong>Resources → Inventories → Workshop Inventory</strong></p>
</li>
<li>
<p>Click the <strong>Hosts</strong> tab to change into the hosts view and select the three hosts by ticking the boxes to the left of the host entries.</p>
</li>
<li>
<p>Click <strong>Run Command</strong> button. In the next screen you have to specify the ad hoc command.</p>
</li>
</ul>
<p>Within the <strong>Details</strong> window, select <strong>Module</strong> <code>command</code>, in <strong>Arguments</strong> type <code>cat /etc/shadow</code> and click <strong>Next</strong>.</p>
<p>Within the <strong>Execution Environment</strong> window, select <strong>Default execution environment</strong> and click <strong>Next</strong>.</p>
<p>Within the <strong>Machine Credential</strong> window, select <strong>Workshop Credentials</strong> and click <strong>Launch</strong>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><strong>Expect an error!</strong></p>
</div>
<p>Oops, the last one didn’t went well, all red.</p>
<p>Re-run the last ad hoc command but this time check the checkbox labeled <strong>Enable privilege escalation</strong>.</p>
<p>As you see, this time it worked. For tasks that have to run as <code>root</code> you need to escalate the privileges. This is the same as the <strong>become: yes</strong> used in your Ansible Playbooks.</p>
<h3 id="automation-platform-automation-platform-inventory-challenge-lab-ad-hoc-commands">Challenge Lab: Ad Hoc Commands</h3>
<p>Okay, a small challenge: Run an ad hoc to make sure the package "tmux" is installed on all hosts. If unsure, consult the documentation either via the web <abbr title="User Interface">UI</abbr> as shown above or by running <code>ansible-doc yum</code> on your Automation controller control host.</p>
<details class="success">
<summary>Solution</summary>
<ul>
<li>In the Web <abbr title="User Interface">UI</abbr> go to <strong>Resources → Inventories → Workshop Inventory</strong>.  </li>
<li>Click the <strong>Hosts</strong> tab to change into the hosts view and select the three hosts by ticking the boxes to the left of the host entries.</li>
<li>Click <strong>Run Command</strong> button. In the next screen you have to specify the ad hoc command.</li>
<li>Within the <strong>Details</strong> window, select <strong>Module</strong> <code>yum</code>, in <strong>Arguments</strong> type <code>name=tmux</code>, check <strong>Enable privilege escalation</strong> and click <strong>Next</strong>.</li>
<li>Within the <strong>Execution Environment</strong> window, select <strong>Default execution environment</strong> and click <strong>Next</strong>.</li>
<li>Within the <strong>Machine Credential</strong> window, select <strong>Workshop Credentials</strong> and click <strong>Launch</strong>.</li>
</ul>
</details>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Notice how the package was installed via the "CHANGED" output. If you run the ad hoc command a second time, the output will mention "SUCCESS" and inform you via the message parameter that there is nothing to do.</p>
</div>
<!-- markdownlint-disable --></section><section class="print-page" id="automation-platform-automation-platform-projects"><h1 id="automation-platform-automation-platform-projects-3-projects-job-templates">3 - Projects &amp; Job Templates</h1>
<h2 id="automation-platform-automation-platform-projects-objective">Objective</h2>
<p>An Ansible automation controller <strong>Project</strong> is a logical collection of Ansible playbooks. You can manage your playbooks by placing them into a source code management (SCM) system supported by automation controller such as Git or Subversion.</p>
<p>This exercise covers:</p>
<ul>
<li>Understanding and using an Ansible automation controller Project</li>
<li>Using Ansible playbooks kept in a Git repository.</li>
<li>Creating and using an Ansible Job Template</li>
</ul>
<h2 id="automation-platform-automation-platform-projects-guide">Guide</h2>
<h3 id="automation-platform-automation-platform-projects-setup-git-repository">Setup Git Repository</h3>
<p>For this demonstration we will use playbooks stored in a Git repository:</p>
<p><a href="https://github.com/ansible/workshop-examples" target="_blank">https://github.com/ansible/workshop-examples</a></p>
<p>A playbook to install the Apache web server has already been committed to the directory <strong>rhel/apache</strong>, <code>apache_install.yml</code>:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#automation-platform-automation-platform-projects-__codelineno-0-1"></a><span class="nn">---</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#automation-platform-automation-platform-projects-__codelineno-0-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Apache server installed</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#automation-platform-automation-platform-projects-__codelineno-0-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#automation-platform-automation-platform-projects-__codelineno-0-4"></a>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#automation-platform-automation-platform-projects-__codelineno-0-5"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#automation-platform-automation-platform-projects-__codelineno-0-6"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">latest Apache version installed</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#automation-platform-automation-platform-projects-__codelineno-0-7"></a><span class="w">    </span><span class="nt">yum</span><span class="p">:</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#automation-platform-automation-platform-projects-__codelineno-0-8"></a><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#automation-platform-automation-platform-projects-__codelineno-0-9"></a><span class="w">      </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">latest</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#automation-platform-automation-platform-projects-__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#automation-platform-automation-platform-projects-__codelineno-0-11"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">latest firewalld version installed</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#automation-platform-automation-platform-projects-__codelineno-0-12"></a><span class="w">    </span><span class="nt">yum</span><span class="p">:</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#automation-platform-automation-platform-projects-__codelineno-0-13"></a><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firewalld</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#automation-platform-automation-platform-projects-__codelineno-0-14"></a><span class="w">      </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">latest</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#automation-platform-automation-platform-projects-__codelineno-0-15"></a>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#automation-platform-automation-platform-projects-__codelineno-0-16"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firewalld enabled and running</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#automation-platform-automation-platform-projects-__codelineno-0-17"></a><span class="w">    </span><span class="nt">service</span><span class="p">:</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#automation-platform-automation-platform-projects-__codelineno-0-18"></a><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firewalld</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#automation-platform-automation-platform-projects-__codelineno-0-19"></a><span class="w">      </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#automation-platform-automation-platform-projects-__codelineno-0-20"></a><span class="w">      </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#automation-platform-automation-platform-projects-__codelineno-0-21"></a>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#automation-platform-automation-platform-projects-__codelineno-0-22"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firewalld permits http service</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#automation-platform-automation-platform-projects-__codelineno-0-23"></a><span class="w">    </span><span class="nt">firewalld</span><span class="p">:</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#automation-platform-automation-platform-projects-__codelineno-0-24"></a><span class="w">      </span><span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#automation-platform-automation-platform-projects-__codelineno-0-25"></a><span class="w">      </span><span class="nt">permanent</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#automation-platform-automation-platform-projects-__codelineno-0-26"></a><span class="w">      </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">enabled</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27" href="#automation-platform-automation-platform-projects-__codelineno-0-27"></a><span class="w">      </span><span class="nt">immediate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28" href="#automation-platform-automation-platform-projects-__codelineno-0-28"></a>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29" href="#automation-platform-automation-platform-projects-__codelineno-0-29"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Apache enabled and running</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30" href="#automation-platform-automation-platform-projects-__codelineno-0-30"></a><span class="w">    </span><span class="nt">service</span><span class="p">:</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31" href="#automation-platform-automation-platform-projects-__codelineno-0-31"></a><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32" href="#automation-platform-automation-platform-projects-__codelineno-0-32"></a><span class="w">      </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33" href="#automation-platform-automation-platform-projects-__codelineno-0-33"></a><span class="w">      </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
</span></code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Note the difference to other playbooks you might have written! Most importantly there is no <code>become</code> and <code>hosts</code> is set to <code>all</code>.</p>
</div>
<p>To configure and use this repository as a <strong>Source Control Management (SCM)</strong> system in automation controller you have to create a <strong>Project</strong> that uses the repository</p>
<h3 id="automation-platform-automation-platform-projects-create-the-project">Create the Project</h3>
<ul>
<li>Go to <strong>Resources → Projects</strong> click the <strong>Add</strong> button. Fill in the form:</li>
</ul>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name</td>
<td><code>Workshop Project</code></td>
</tr>
<tr>
<td>Organization</td>
<td><code>Default</code></td>
</tr>
<tr>
<td>Default Execution Environment</td>
<td><code>Default Execution Environment</code></td>
</tr>
<tr>
<td>Source Control Type</td>
<td><code>Git</code></td>
</tr>
</tbody>
</table>
<p>Enter the <abbr title="Uniform Resource Locator">URL</abbr> into the Project configuration:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Source Control <abbr title="Uniform Resource Locator">URL</abbr></td>
<td><code>https://github.com/ansible/workshop-examples.git</code></td>
</tr>
<tr>
<td>Options</td>
<td>Select <strong>Clean</strong>, <strong>Delete</strong> and <strong>Update Revision on Launch</strong> to request a fresh copy of the repository and to update the repository when launching a job.</td>
</tr>
</tbody>
</table>
<ul>
<li>Click <strong>SAVE</strong></li>
</ul>
<p>The new project will be synced automatically after creation. But you can also do this manually: Sync the Project again with the Git repository by going to the <strong>Projects</strong> view and clicking the circular arrow <strong>Sync Project</strong> icon to the right of the Project.</p>
<p>After starting the sync job, go to the <strong>Jobs</strong> view: there is a new job for the update of the Git repository.</p>
<h3 id="automation-platform-automation-platform-projects-create-a-job-template-and-run-a-job">Create a Job Template and Run a Job</h3>
<p>A job template is a definition and set of parameters for running an Ansible job. Job templates are useful to execute the same job many times. So before running an Ansible <strong>Job</strong> from automation controller you must create a <strong>Job Template</strong> that pulls together:</p>
<ul>
<li>
<p><strong>Inventory</strong>: On what hosts should the job run?</p>
</li>
<li>
<p><strong>Credentials</strong> What credentials are needed to log into the hosts?</p>
</li>
<li>
<p><strong>Project</strong>: Where is the playbook?</p>
</li>
<li>
<p><strong>What</strong> playbook to use?</p>
</li>
</ul>
<p>Okay, let’s just do that: Go to the <strong>Resources -&gt; Templates</strong> view, click the <strong>Add</strong> button and choose <strong>Add job template</strong>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Remember that you can often click on magnifying glasses to get an overview of options to pick to fill in fields.</p>
</div>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name</td>
<td><code>Install Apache</code></td>
</tr>
<tr>
<td>Job Type</td>
<td><code>Run</code></td>
</tr>
<tr>
<td>Inventory</td>
<td><code>Workshop Inventory</code></td>
</tr>
<tr>
<td>Project</td>
<td><code>Workshop Project</code></td>
</tr>
<tr>
<td>Execution Environment</td>
<td><code>Default execution environment</code></td>
</tr>
<tr>
<td>Playbook</td>
<td><code>rhel/apache/apache_install.yml</code></td>
</tr>
<tr>
<td>Credentials</td>
<td><code>Workshop Credential</code></td>
</tr>
<tr>
<td>Limit</td>
<td><code>web</code></td>
</tr>
<tr>
<td>Options</td>
<td><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2m0 2v14H5V5h14m-9 12-4-4 1.41-1.42L10 14.17l6.59-6.59L18 9"/></svg></span> Privilege Escalation</td>
</tr>
</tbody>
</table>
<ul>
<li>Click <strong>Save</strong></li>
</ul>
<p>You can start the job by directly clicking the blue <strong>Launch</strong> button, or by clicking on the rocket in the Job Templates overview. After launching the Job Template, you are automatically brought to the job overview where you can follow the playbook execution in real time:</p>
<p>Job Details
<img alt="job details" src="../automation-platform/images/job_details.png" /></p>
<p>Job Run
<img alt="job_run" src="../automation-platform/images/job_run.png" /></p>
<p>Since this might take some time, have a closer look at all the details provided:</p>
<ul>
<li>
<p>All details of the job template like inventory, project, credentials and playbook are shown.</p>
</li>
<li>
<p>Additionally, the actual revision of the playbook is recorded here - this makes it easier to analyse job runs later on.</p>
</li>
<li>
<p>Also the time of execution with start and end time is recorded, giving you an idea of how long a job execution actually was.</p>
</li>
<li>
<p>Selecting <strong>Output</strong> shows the output of the running playbook. Click on a node underneath a task and see that detailed information are provided for each task of each node.</p>
</li>
</ul>
<p>After the Job has finished go to the main <strong>Jobs</strong> view: All jobs are listed here, you should see directly before the Playbook run an Source Control Update was started. This is the Git update we configured for the <strong>Project</strong> on launch!</p>
<h3 id="automation-platform-automation-platform-projects-challenge-lab-check-the-result">Challenge Lab: Check the Result</h3>
<p>Time for a little challenge:</p>
<ul>
<li>Use an ad hoc command on all hosts to make sure Apache has been installed and is running.</li>
</ul>
<p>You have already been through all the steps needed, so try this for yourself.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>What about <code>systemctl status httpd</code>?</p>
</div>
<details class="success">
<summary>Solution</summary>
<ul>
<li>Go to <strong>Resources →  Inventories</strong> → <strong>Workshop Inventory</strong></li>
<li>In the <strong>Hosts</strong> view select <code>node1</code>, <code>node2</code>, <code>node3</code> and click <strong>Run Command</strong></li>
<li>Within the <strong>Details</strong> window, select <strong>Module</strong> <code>command</code>, in <strong>Arguments</strong> type <code>systemctl status httpd</code> and click <strong>Next</strong>.</li>
<li>Within the <strong>Execution Environment</strong> window, select <strong>Default execution environment</strong> and click <strong>Next</strong>.</li>
<li>Within the <strong>Machine Credential</strong> window, select <strong>Workshop Credential</strong> and click <strong>Launch</strong>.</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>The output of the results is displayed once the command has completed.</p>
</div>
</details>
<!-- markdownlint-disable --></section><section class="print-page" id="automation-platform-automation-platform-surveys"><h1 id="automation-platform-automation-platform-surveys-4-surveys">4 - Surveys</h1>
<h2 id="automation-platform-automation-platform-surveys-objective">Objective</h2>
<p>Demonstrate the use of Ansible Automation controller <a href="https://docs.ansible.com/automation-controller/latest/html/userguide/job_templates.html#surveys">survey feature</a>. Surveys set extra variables for the playbook similar to ‘Prompt for Extra Variables’ does, but in a user-friendly question and answer way. Surveys also allow for validation of user input.</p>
<h2 id="automation-platform-automation-platform-surveys-guide">Guide</h2>
<p>You have installed Apache on all hosts in the job you just ran. Now we’re going to extend on this:</p>
<ul>
<li>
<p>Use a proper role that has a Jinja2 template to deploy an <code>index.html</code> file.</p>
</li>
<li>
<p>Create a job <strong>Template</strong> with a survey to collect the values for the <code>index.html</code> template.</p>
</li>
<li>
<p>Launch the job <strong>Template</strong></p>
</li>
</ul>
<p>Additionally, the role will make sure that the Apache configuration is properly set up for this exercise.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The survey feature only provides a simple query for data - it does not support four-eye principles, queries based on dynamic data or nested menus.</p>
</div>
<h3 id="automation-platform-automation-platform-surveys-the-apache-configuration-role">The Apache-configuration Role</h3>
<p>The playbook and the role with the Jinja2 template already exist in the Github repository <a href="https://github.com/ansible/workshop-examples" target="_blank">https://github.com/ansible/workshop-examples</a> in the directory <code>rhel/apache</code>.</p>
<p>Head over to the Github <abbr title="User Interface">UI</abbr> and have a look at the content: the playbook <code>apache_role_install.yml</code> merely references the role. The role can be found in the <code>roles/role_apache</code> subdirectory.</p>
<ul>
<li>Inside the role, note the two variables in the <code>templates/index.html.j2</code> template file marked by <code>{{…​}}</code>.</li>
<li>Notice the tasks in <code>tasks/main.yml</code> that deploy the file from the template.</li>
</ul>
<p>What is this playbook doing? It creates a file (<strong>dest</strong>) on the managed hosts from the template (<strong>src</strong>).</p>
<p>The role deploys a static configuration for Apache. This is to make sure that all changes done in the previous chapters are overwritten and your examples work properly.</p>
<p>Because the playbook and role is located in the same Github repo as the <code>apache_install.yml</code> playbook you don't have to configure a new project for this exercise.</p>
<h3 id="automation-platform-automation-platform-surveys-create-a-template-with-a-survey">Create a Template with a Survey</h3>
<p>Now you create a new Template that includes a survey.</p>
<h4 id="automation-platform-automation-platform-surveys-create-template">Create Template</h4>
<ul>
<li>
<p>Go to <strong>Resources → Templates</strong>, click the <strong>Add</strong> button and choose <strong>Add job template</strong></p>
</li>
<li>
<p>Fill out the following information:</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name</td>
<td><code>Create index.html</code></td>
</tr>
<tr>
<td>Job Type</td>
<td><code>Run</code></td>
</tr>
<tr>
<td>Inventory</td>
<td><code>Workshop Inventory</code></td>
</tr>
<tr>
<td>Project</td>
<td><code>Workshop Project</code></td>
</tr>
<tr>
<td>Execution Environment</td>
<td><code>Default execution environment</code></td>
</tr>
<tr>
<td>Playbook</td>
<td><code>rhel/apache/apache_role_install.yml</code></td>
</tr>
<tr>
<td>Credentials</td>
<td><code>Workshop Credential</code></td>
</tr>
<tr>
<td>Limit</td>
<td><code>web</code></td>
</tr>
<tr>
<td>Options</td>
<td><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2m0 2v14H5V5h14m-9 12-4-4 1.41-1.42L10 14.17l6.59-6.59L18 9"/></svg></span> Privilege Escalation</td>
</tr>
</tbody>
</table>
<ul>
<li>Click <strong>Save</strong></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><strong>Do not run the template yet!</strong></p>
</div>
<h4 id="automation-platform-automation-platform-surveys-add-the-survey">Add the Survey</h4>
<ul>
<li>
<p>In the Template, click the <strong>Survey</strong> tab and click the <strong>Add</strong> button.</p>
</li>
<li>
<p>Fill out the following information:</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Question</td>
<td><code>First Line</code></td>
</tr>
<tr>
<td>Answer Variable Name</td>
<td><code>first_line</code></td>
</tr>
<tr>
<td>Answer Type</td>
<td><code>Text</code></td>
</tr>
</tbody>
</table>
<ul>
<li>Click <strong>Save</strong></li>
<li>Click the <strong>Add</strong> button</li>
</ul>
<p>In the same fashion add a second <strong>Survey Question</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Question</td>
<td><code>Second Line</code></td>
</tr>
<tr>
<td>Answer Variable Name</td>
<td><code>second_line</code></td>
</tr>
<tr>
<td>Answer Type</td>
<td><code>Text</code></td>
</tr>
</tbody>
</table>
<ul>
<li>Click <strong>Save</strong></li>
<li>Click the toggle to turn the Survey questions to <strong>On</strong></li>
</ul>
<h3 id="automation-platform-automation-platform-surveys-launch-the-template">Launch the Template</h3>
<p>Now launch <strong>Create index.html</strong> job template by selecting the <strong>Details</strong> tab and clicking the <strong>Launch</strong> button.</p>
<p>Before the actual launch the survey will ask for <strong>First Line</strong> and <strong>Second Line</strong>. Fill in some text and click <strong>Next</strong>. The <strong>Preview</strong> window shows the values, if all is good run the Job by clicking <strong>Launch</strong>.</p>
<p>After the job has completed, check the Apache homepage. In the <abbr title="Secure Shell">SSH</abbr> console on the control host, execute <code>curl</code> against <code>node1</code>:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#automation-platform-automation-platform-surveys-__codelineno-0-1"></a><span class="gp">[student1@ansible-1 ~]$ </span>curl<span class="w"> </span>http://node1
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#automation-platform-automation-platform-surveys-__codelineno-0-2"></a><span class="go">&lt;body&gt;</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#automation-platform-automation-platform-surveys-__codelineno-0-3"></a><span class="go">&lt;h1&gt;Apache is running fine&lt;/h1&gt;</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#automation-platform-automation-platform-surveys-__codelineno-0-4"></a><span class="go">&lt;h1&gt;This is survey field &quot;First Line&quot;: line one&lt;/h1&gt;</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#automation-platform-automation-platform-surveys-__codelineno-0-5"></a><span class="go">&lt;h1&gt;This is survey field &quot;Second Line&quot;: line two&lt;/h1&gt;</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#automation-platform-automation-platform-surveys-__codelineno-0-6"></a><span class="go">&lt;/body&gt;</span>
</span></code></pre></div>
<p>Note how the two variables where used by the playbook to create the content of the <code>index.html</code> file.</p>
<!-- markdownlint-disable --></section><section class="print-page" id="automation-platform-automation-platform-rbac"><h1 id="automation-platform-automation-platform-rbac-5-role-based-access-control">5 - Role-based access control</h1>
<h2 id="automation-platform-automation-platform-rbac-objective">Objective</h2>
<p>You have already learned how Ansible automation controller separates credentials from users. Another advantage of Ansible automation controller is the user and group rights management.  This exercise demonstrates Role Based Access Control (RBAC)</p>
<h2 id="automation-platform-automation-platform-rbac-guide">Guide</h2>
<h3 id="automation-platform-automation-platform-rbac-ansible-automation-controller-users">Ansible automation controller users</h3>
<p>There are three types of automation controller users:</p>
<ul>
<li>
<p><strong>Normal User</strong>: Have read and write access limited to the inventory and projects for which that user has been granted the appropriate roles and privileges.</p>
</li>
<li>
<p><strong>System Auditor</strong>: Auditors implicitly inherit the read-only capability for all objects within the automation controller environment.</p>
</li>
<li>
<p><strong>System Administrator</strong>: Has admin, read, and write privileges over the entire automation controller installation.</p>
</li>
</ul>
<p>Let’s create a user:</p>
<ul>
<li>
<p>In the automation controller menu under <strong>Access</strong> click <strong>Users</strong></p>
</li>
<li>
<p>Click the <strong>Add</strong> button</p>
</li>
<li>
<p>Fill in the values for the new user:</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Username</td>
<td><code>wweb</code></td>
</tr>
<tr>
<td>Email</td>
<td><code>wweb@example.com</code></td>
</tr>
<tr>
<td>Password</td>
<td><code>ansible</code></td>
</tr>
<tr>
<td>Confirm Password</td>
<td><code>ansible</code></td>
</tr>
<tr>
<td>First Name</td>
<td><code>Werner</code></td>
</tr>
<tr>
<td>Last Name</td>
<td><code>Web</code></td>
</tr>
<tr>
<td>Organization</td>
<td><code>Default</code></td>
</tr>
<tr>
<td>User Type</td>
<td><code>Normal User</code></td>
</tr>
</tbody>
</table>
<ul>
<li>Click <strong>Save</strong></li>
</ul>
<h3 id="automation-platform-automation-platform-rbac-ansible-automation-controller-teams">Ansible automation controller teams</h3>
<p>A Team is a subdivision of an organization with associated users, projects, credentials, and permissions. Teams provide a means to implement role-based access control schemes and delegate responsibilities across organizations. For instance, permissions may be granted to a whole Team rather than each user on the Team.</p>
<p>Create a Team:</p>
<ul>
<li>
<p>In the menu go to <strong>Access → Teams</strong></p>
</li>
<li>
<p>Click the <strong>Add</strong> button and create a team named <code>Web Content</code> within the <code>Default</code> Organization.</p>
</li>
<li>
<p>Click <strong>Save</strong></p>
</li>
</ul>
<p>Add a user to the team:</p>
<ul>
<li>
<p>Click on the team <code>Web Content</code> and click the <strong>Access</strong> tab and click <strong>Add</strong>.</p>
</li>
<li>
<p>Within the <strong>Select a Resource Type</strong> window, click on the <strong>Users</strong> resource type and click <strong>Next</strong>.</p>
</li>
<li>
<p>Within the <strong>Select Items from List</strong>, select the checkbox next to the <code>wweb</code> user and click <strong>Next</strong>.</p>
</li>
<li>
<p>Within the <strong>Select Roles to Apply</strong>, select <strong>Member</strong> as the role to apply to the <code>wweb</code> user.</p>
</li>
</ul>
<p>Click <strong>Save</strong>.</p>
<p>Permissions allow to read, modify, and administer projects, inventories, and other automation controller elements. Permissions can be set for different resources.</p>
<h3 id="automation-platform-automation-platform-rbac-granting-permissions">Granting permissions</h3>
<p>To allow users or teams to actually do something, you have to set permissions. The user <strong>wweb</strong> should only be allowed to modify content of the assigned webserver.</p>
<p>Add the permission to use the <code>Create index.html</code> template:</p>
<ul>
<li>
<p>Within <strong>Resources</strong> -&gt; <strong>Templates</strong>, select <code>Create index.html</code>.</p>
</li>
<li>
<p>Select <strong>Access</strong> tab from the menu and click <strong>Add</strong>.</p>
</li>
<li>
<p>Within the <strong>Select a Resource Type</strong> window, click on the <strong>Users</strong> resource type and click <strong>Next</strong>.</p>
</li>
<li>
<p>Within the <strong>Select Items from List</strong>, select the checkbox next to the <code>wweb</code> user and click <strong>Next</strong>.</p>
</li>
<li>
<p>Within the <strong>Select Roles to Apply</strong>, select <strong>Read</strong> and <strong>Execute</strong> as the roles to apply to the <code>wweb</code> user.</p>
</li>
<li>
<p>Click <strong>Save</strong></p>
</li>
</ul>
<h3 id="automation-platform-automation-platform-rbac-test-permissions">Test permissions</h3>
<p>Now log out of automation controller’s web <abbr title="User Interface">UI</abbr> and in again as the <strong>wweb</strong> user.</p>
<ul>
<li>
<p>Go to the <strong>Templates</strong> view, you should notice for wweb only the <code>Create
  index.html</code> template is listed. He is allowed to view and launch, but not to edit the Template (no Edit button available).</p>
</li>
<li>
<p>Run the Job Template by clicking the rocket icon. Enter the values for the survey questions and launch the job.</p>
</li>
<li>
<p>In the following <strong>Jobs</strong> view have a good look around, note that there where changes to the host (as expected).</p>
</li>
</ul>
<p>Check the result: execute <code>curl</code> again on the control host to pull the content of the webserver on <code>node1</code> (you could of course check <code>node2</code> and <code>node3</code>, too):</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#automation-platform-automation-platform-rbac-__codelineno-0-1"></a><span class="gp">[student@ansible-1 ~]$ </span>curl<span class="w"> </span>http://node1
</span></code></pre></div>
<p>Just recall what you have just done: You enabled a restricted user to run an Ansible playbook</p>
<ul>
<li>
<p>Without having access to the credentials</p>
</li>
<li>
<p>Without being able to change the playbook itself</p>
</li>
<li>
<p>But with the ability to change variables you predefined!</p>
</li>
</ul>
<p>Effectively you provided the power to execute automation to another user without handing out your credentials or giving the user the ability to change the automation code. And yet, at the same time the user can still modify things based on the surveys you created.</p>
<p>This capability is one of the main strengths of Ansible automation controller!</p>
<!-- markdownlint-disable --></section><section class="print-page" id="automation-platform-automation-platform-workflows"><h1 id="automation-platform-automation-platform-workflows-6-workflows">6 - Workflows</h1>
<h2 id="automation-platform-automation-platform-workflows-objective">Objective</h2>
<p>The basic idea of a workflow is to link multiple Job Templates together. They may or may not share inventory, playbooks or even permissions. The links can be conditional:</p>
<ul>
<li>if job template A succeeds, job template B is automatically executed afterwards</li>
<li>but in case of failure, job template C will be run.</li>
</ul>
<p>And the workflows are not even limited to Job Templates, but can also include project or inventory updates.</p>
<p>This enables new applications for Ansible automation controller: different Job Templates can build upon each other. E.g. the networking team creates playbooks with their own content, in their own Git repository and even targeting their own inventory, while the operations team also has their own repos, playbooks and inventory.</p>
<p>In this lab you’ll learn how to setup a workflow.</p>
<h2 id="automation-platform-automation-platform-workflows-guide">Guide</h2>
<h3 id="automation-platform-automation-platform-workflows-lab-scenario">Lab scenario</h3>
<p>You have two departments in your organization:</p>
<ul>
<li>The web operations team that is developing playbooks in their own Git branch named <code>webops</code></li>
<li>The web developers team that is developing playbooks in their own Git branch named <code>webdev</code>.</li>
</ul>
<p>When there is a new Node.js server to deploy, two things need to happen:</p>
<h4 id="automation-platform-automation-platform-workflows-web-operations-team">Web operations team</h4>
<ul>
<li><code>httpd</code>, <code>firewalld</code>, and <code>node.js</code> need to be installed, <code>SELinux</code> settings configured, the firewall needs to be opened, and <code>httpd</code> and <code>node.js</code> should get started.</li>
</ul>
<h4 id="automation-platform-automation-platform-workflows-web-developers-team">Web developers team</h4>
<ul>
<li>The most recent version of the web application needs to be deployed and <code>node.js</code> needs to be restarted.</li>
</ul>
<p>In other words, the Web operations team prepares a server for application deployment, and the Web developers team deploys the application on the server.</p>
<hr />
<p>To make things somewhat easier for you, everything needed already exists in a Github repository: playbooks, JSP-files etc. You just need to glue it together.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In this example we use two different branches of the same repository for the content of the separate teams. In reality, the structure of your Source Control repositories depends on a lot of factors and could be different.</p>
</div>
<h3 id="automation-platform-automation-platform-workflows-set-up-projects">Set up projects</h3>
<p>First you have to set up the Git repo as a Project like you normally would.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you are still logged in as user <strong>wweb</strong>, log out of and log in as user <strong>admin</strong>.</p>
</div>
<p>Within <strong>Resources</strong> -&gt; <strong>Projects</strong>, click the <strong>Add</strong> button to create a project for the web operations team. Fill out the form as follows:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name</td>
<td><code>Webops Git Repo</code></td>
</tr>
<tr>
<td>Organization</td>
<td><code>Default</code></td>
</tr>
<tr>
<td>Default Execution Environment</td>
<td><code>Default Execution Environment</code></td>
</tr>
<tr>
<td>Source Control Credential Type</td>
<td><code>Git</code></td>
</tr>
<tr>
<td>Source Control <abbr title="Uniform Resource Locator">URL</abbr></td>
<td><code>https://github.com/ansible/workshop-examples.git</code></td>
</tr>
<tr>
<td>Source Control Branch/Tag/Commit</td>
<td><code>webops</code></td>
</tr>
<tr>
<td>Options</td>
<td><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2m0 2v14H5V5h14m-9 12-4-4 1.41-1.42L10 14.17l6.59-6.59L18 9"/></svg></span> Clean<br><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2m0 2v14H5V5h14m-9 12-4-4 1.41-1.42L10 14.17l6.59-6.59L18 9"/></svg></span> Delete<br><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2m0 2v14H5V5h14m-9 12-4-4 1.41-1.42L10 14.17l6.59-6.59L18 9"/></svg></span> Update Revision on Launch</td>
</tr>
</tbody>
</table>
<p>Click <strong>Save</strong></p>
<p>Within <strong>Resources</strong> -&gt; <strong>Projects</strong>, click the <strong>Add</strong> button to create a project for the web developers team. Fill out the form as follows:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name</td>
<td><code>Webdev Git Repo</code></td>
</tr>
<tr>
<td>Organization</td>
<td><code>Default</code></td>
</tr>
<tr>
<td>Default Execution Environment</td>
<td><code>Default Execution Environment</code></td>
</tr>
<tr>
<td>Source Control Credential Type</td>
<td><code>Git</code></td>
</tr>
<tr>
<td>Source Control <abbr title="Uniform Resource Locator">URL</abbr></td>
<td><code>https://github.com/ansible/workshop-examples.git</code></td>
</tr>
<tr>
<td>Source Control Branch/Tag/Commit</td>
<td><code>webdev</code></td>
</tr>
<tr>
<td>Options</td>
<td><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2m0 2v14H5V5h14m-9 12-4-4 1.41-1.42L10 14.17l6.59-6.59L18 9"/></svg></span> Clean<br><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2m0 2v14H5V5h14m-9 12-4-4 1.41-1.42L10 14.17l6.59-6.59L18 9"/></svg></span> Delete<br><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2m0 2v14H5V5h14m-9 12-4-4 1.41-1.42L10 14.17l6.59-6.59L18 9"/></svg></span> Update Revision on Launch</td>
</tr>
</tbody>
</table>
<p>Click <strong>Save</strong></p>
<h3 id="automation-platform-automation-platform-workflows-set-up-job-templates">Set up job templates</h3>
<p>Now you have to create two Job Templates like you would for "normal" Jobs.</p>
<p>Within <strong>Resources</strong> -&gt; <strong>Templates</strong>, click the <strong>Add</strong> button and choose <strong>Add job template</strong>:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name</td>
<td><code>Web App Deploy</code></td>
</tr>
<tr>
<td>Job Type</td>
<td><code>Run</code></td>
</tr>
<tr>
<td>Inventory</td>
<td><code>Workshop Inventory</code></td>
</tr>
<tr>
<td>Project</td>
<td><code>Webops Git Repo</code></td>
</tr>
<tr>
<td>Execution Environment</td>
<td><code>Default execution environment</code></td>
</tr>
<tr>
<td>Playbook</td>
<td><code>rhel/webops/web_infrastructure.yml</code></td>
</tr>
<tr>
<td>Credentials</td>
<td><code>Workshop Credential</code></td>
</tr>
<tr>
<td>Limit</td>
<td><code>web</code></td>
</tr>
<tr>
<td>Options</td>
<td><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2m0 2v14H5V5h14m-9 12-4-4 1.41-1.42L10 14.17l6.59-6.59L18 9"/></svg></span> Privilege Escalation</td>
</tr>
</tbody>
</table>
<p>Click <strong>Save</strong></p>
<hr />
<p>Within <strong>Resources</strong> -&gt; <strong>Templates</strong>, click the <strong>Add</strong> button and choose <strong>Add job template</strong>:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name</td>
<td><code>Node.js Deploy</code></td>
</tr>
<tr>
<td>Job Type</td>
<td><code>Run</code></td>
</tr>
<tr>
<td>Inventory</td>
<td><code>Workshop Inventory</code></td>
</tr>
<tr>
<td>Project</td>
<td><code>Webdev Git Repo</code></td>
</tr>
<tr>
<td>Execution Environment</td>
<td><code>Default execution environment</code></td>
</tr>
<tr>
<td>Playbook</td>
<td><code>rhel/webdev/install_node_app.yml</code></td>
</tr>
<tr>
<td>Credentials</td>
<td><code>Workshop Credential</code></td>
</tr>
<tr>
<td>Limit</td>
<td><code>web</code></td>
</tr>
<tr>
<td>Options</td>
<td><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2m0 2v14H5V5h14m-9 12-4-4 1.41-1.42L10 14.17l6.59-6.59L18 9"/></svg></span> Privilege Escalation</td>
</tr>
</tbody>
</table>
<p>Click <strong>Save</strong></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you want to know what the Ansible Playbooks look like, check out the Github <abbr title="Uniform Resource Locator">URL</abbr> and switch to the appropriate branches.</p>
</div>
<h3 id="automation-platform-automation-platform-workflows-set-up-the-workflow">Set up the workflow</h3>
<p>Workflows are configured in the <strong>Templates</strong> view, you might have noticed you can choose between <strong>Add job template</strong> and <strong>Add workflow template</strong> when adding a template.</p>
<p>Within <strong>Resources</strong> -&gt; <strong>Templates</strong>, click the <strong>Add</strong> button and choose <strong>Add workflow template</strong>:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name</td>
<td><code>Deploy Webapp Server</code></td>
</tr>
<tr>
<td>Organization</td>
<td><code>Default</code></td>
</tr>
</tbody>
</table>
<p>Click <strong>Save</strong></p>
<p>After saving the template the <strong>Workflow Visualizer</strong> opens to allow you to build a workflow. You can later open the <strong>Workflow Visualizer</strong> again by using the button on the template details page and selecting <strong>Visualizer</strong> from the menu.</p>
<p><img alt="start" src="../automation-platform/images/start.png" /></p>
<p>Click on the <strong>Start</strong> button, an <strong>Add Node</strong> window opens. Assign an action to the node, via node     type by selecting <strong>Job Template</strong>.</p>
<p>Select the <strong>Web App Deploy</strong> job template and click <strong>Save</strong>.</p>
<p><img alt="Add Node" src="../automation-platform/images/add_node.png" /></p>
<p>A new node is shown, connected to the <strong>START</strong> button with the name of the job template. Hover the mouse pointer over the node, you’ll see options to add a node (+), view node details (i), edit the node (pencil), link to an available node (chain), and delete the node (trash bin).</p>
<p><img alt="workflow node" src="../automation-platform/images/workflow_node.png" /></p>
<p>Hover over the node and click the (+) sign to add a new node.</p>
<ul>
<li>For the <strong>Run Type</strong> select <strong>On Success</strong> (default) and click <strong>Next</strong>.</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The run type allows for more complex workflows. You could lay out different execution paths for successful and for failed playbook runs.</p>
</div>
<ul>
<li>For <strong>Node Type</strong> select <strong>Job Template</strong> (default) and choose the <strong>Node.js Deploy</strong> job template.
Click <strong>Save</strong>.</li>
</ul>
<p><img alt="Add Nodejs" src="../automation-platform/images/add_node_nodejs.png" /></p>
<p>Click <strong>Save</strong> in the top right corner of the <strong>Visualizier</strong> view.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The <strong>Visualizer</strong> has options for setting up more advanced workflows, please refer to the documentation.</p>
</div>
<h3 id="automation-platform-automation-platform-workflows-launch-workflow">Launch workflow</h3>
<p>From within the <strong>Deploy Webapp Server</strong> Details page, <strong>Launch</strong> the workflow.</p>
<p><img alt="launch" src="../automation-platform/images/launch.png" /></p>
<p>Note how the workflow run is shown in the Jobs &gt; Deploy Webapp Server Output. In contrast to a normal job template job execution, there is no playbook output when the job completes but the time to complete the job is displayed. If you want to look at the actual playbook run, hover over the node you wish to see the details on and click it. Within the Details view of the job, select the <strong>Output</strong> menu to see the playbook output. If you want to get back the <strong>Output</strong> view of the <strong>Deploy WebappServer</strong> workflow, under Views -&gt; Jobs -&gt; <strong>XX - Deploy Webapp Server</strong> will take you back to the Output overview.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>XX</code> is the number of the job run.</p>
</div>
<p><img alt="jobs view of workflow" src="../automation-platform/images/job_workflow.png" /></p>
<p>After the job was finished, check if everything worked fine: from your control host run the following curl command against <code>node1</code>, <code>node2</code> and <code>node3</code>. The output of each curl command should be <code>Hello World</code>.</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#automation-platform-automation-platform-workflows-__codelineno-0-1"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>curl<span class="w"> </span>http://nodeX/nodejs
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#automation-platform-automation-platform-workflows-__codelineno-0-2"></a><span class="go">Hello World</span>
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>X</code> should be replaced with the appropriate number of the node you are checking.</p>
</div>
<!-- markdownlint-disable --></section><section class="print-page" id="automation-platform-automation-platform-wrapup"><h1 id="automation-platform-automation-platform-wrapup-7-aap-wrap-up">7 - <abbr title="Ansible Automation Platform">AAP</abbr> Wrap up</h1>
<h2 id="automation-platform-automation-platform-wrapup-objective">Objective</h2>
<p>This is the final challenge where we try to put most of what you have learned together.</p>
<h2 id="automation-platform-automation-platform-wrapup-guide">Guide</h2>
<h3 id="automation-platform-automation-platform-wrapup-lets-set-the-stage">Let’s set the stage</h3>
<p>Your operations team and your application development team likes what they see in Ansible automation controller. To really use it in their environment they put together these requirements:</p>
<ul>
<li>
<p>All webserver hosts (<code>node1</code>, <code>node2</code> and <code>node3</code>) should go in one group</p>
</li>
<li>
<p>As the webserver hosts can be used for development purposes or in production, there has to be a way to flag them accordingly as "stage dev" or "stage prod".</p>
<ul>
<li>Currently <code>node1</code> and <code>node3</code> are used as a development system and <code>node2</code> is in production.</li>
</ul>
</li>
<li>
<p>Of course the content of the world famous application "index.html" will be different between dev and prod stages.</p>
<ul>
<li>There should be a title on the page stating the environment</li>
<li>There should be a content field</li>
</ul>
</li>
<li>
<p>The content writer <code>wweb</code> should have access to a survey to change the content for dev and prod servers.</p>
</li>
</ul>
<h3 id="automation-platform-automation-platform-wrapup-the-git-repository">The Git Repository</h3>
<p>All code is already in place - this is a automation controller lab after all. Check out the <strong>Workshop Project</strong> git repository at <a href="https://github.com/ansible/workshop-examples" target="_blank">https://github.com/ansible/workshop-examples</a>. There you will find the playbook <code>webcontent.yml</code>, which calls the role <code>role_webcontent</code>.</p>
<p>Compared to the previous Apache installation role there is a major difference: there are now multiple versions of an <code>index.html</code> template, and a task deploying the template file, which has a variable as part of the source file name.</p>
<p>For the development servers the file is named <code>dev_index.html.j2</code> with the following content:</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#automation-platform-automation-platform-wrapup-__codelineno-0-1"></a><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#automation-platform-automation-platform-wrapup-__codelineno-0-2"></a><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>This is a development webserver, have fun!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#automation-platform-automation-platform-wrapup-__codelineno-0-3"></a>{{ dev_content }}
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#automation-platform-automation-platform-wrapup-__codelineno-0-4"></a><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></code></pre></div>
<p>For the production servers the file is named <code>prod_index.html.j2</code> with the following content:</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#automation-platform-automation-platform-wrapup-__codelineno-1-1"></a><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#automation-platform-automation-platform-wrapup-__codelineno-1-2"></a><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>This is a production webserver, take care!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#automation-platform-automation-platform-wrapup-__codelineno-1-3"></a>{{ prod_content }}
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#automation-platform-automation-platform-wrapup-__codelineno-1-4"></a><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></code></pre></div>
<p>The playbook <code>main.yml</code> deploys the template:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#automation-platform-automation-platform-wrapup-__codelineno-2-1"></a><span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#automation-platform-automation-platform-wrapup-__codelineno-2-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy index.html from template</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#automation-platform-automation-platform-wrapup-__codelineno-2-3"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#automation-platform-automation-platform-wrapup-__codelineno-2-4"></a><span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">stage</span><span class="nv"> </span><span class="s">}}_index.html.j2&quot;</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#automation-platform-automation-platform-wrapup-__codelineno-2-5"></a><span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/www/html/index.html</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#automation-platform-automation-platform-wrapup-__codelineno-2-6"></a><span class="w">  </span><span class="nt">notify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apache-restart</span>
</span></code></pre></div>
<h3 id="automation-platform-automation-platform-wrapup-prepare-inventory">Prepare Inventory</h3>
<p>There is of course more then one way to accomplish this, but for the purposes of this lab, we will use Ansible automation controller.</p>
<p>Within <strong>Resources</strong> -&gt; <strong>Inventories</strong> and select 'Workshop Inventory'.</p>
<p>Within the <strong>Groups</strong> tab, click the <strong>Add</strong> button and create a new inventory group labeled <code>Webserver</code> and click <strong>Save</strong>.</p>
<p>Within the <strong>Details</strong> tab of the <code>Webserver</code> group, click on <strong>Edit</strong>. Within the <strong>Variables</strong> textbox define a variable labeled <code>stage</code> with the value <code>dev</code> and click <strong>Save</strong>.</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#automation-platform-automation-platform-wrapup-__codelineno-3-1"></a><span class="nn">---</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#automation-platform-automation-platform-wrapup-__codelineno-3-2"></a><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dev</span>
</span></code></pre></div>
<p>Within the <strong>Details</strong> tab of the <code>Webserver</code> inventory, click the <strong>Hosts</strong> tab, click the <strong>Add</strong> button and <strong>Add existing host</strong>. Select <code>node1</code>, <code>node2</code>, <code>node3</code> as the hosts to be part of the <code>Webserver</code> inventory.</p>
<p>Within <strong>Resources</strong> -&gt; <strong>Inventories</strong>, select the <code>Workshop</code> Inventory. Click on the <code>Hosts</code> tab and click on <code>node2</code>.  Click on <code>Edit</code> and add the <code>stage: prod</code> variable in the <strong>Variables</strong> window. This overrides the inventory variable due to order of operations of how the variables are accessed during playbook execution.</p>
<p>Within the <strong>Variables</strong> textbox define a variable labeled <code>stage</code> with the value of <code>prod</code> and click <strong>Save</strong>.</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#automation-platform-automation-platform-wrapup-__codelineno-4-1"></a><span class="nn">---</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#automation-platform-automation-platform-wrapup-__codelineno-4-2"></a><span class="nt">ansible_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;IP_of_node2&gt;</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#automation-platform-automation-platform-wrapup-__codelineno-4-3"></a><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prod</span>
</span></code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Make sure to keep the three dashes that mark the <abbr title="YAML Ain't Markup Language">YAML</abbr> start and the <code>ansible_host</code> line in place!</p>
</div>
<h3 id="automation-platform-automation-platform-wrapup-create-the-template">Create the Template</h3>
<p>Within <strong>Resources</strong> -&gt; <strong>Templates</strong>, select the <strong>Add</strong> button and <strong>Add job template</strong> as follows:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name</td>
<td><code>Create Web Content</code></td>
</tr>
<tr>
<td>Job Type</td>
<td><code>Run</code></td>
</tr>
<tr>
<td>Inventory</td>
<td><code>Workshop Inventory</code></td>
</tr>
<tr>
<td>Project</td>
<td><code>Workshop Project</code></td>
</tr>
<tr>
<td>Execution Environment</td>
<td><code>Default execution environment</code></td>
</tr>
<tr>
<td>Playbook</td>
<td><code>rhel/apache/webcontent.yml</code></td>
</tr>
<tr>
<td>Credentials</td>
<td><code>Workshop Credential</code></td>
</tr>
<tr>
<td>Limit</td>
<td><code>web</code></td>
</tr>
<tr>
<td>Variables</td>
<td><code>dev_content: "default dev content", prod_content: "default prod content"</code></td>
</tr>
<tr>
<td>Options</td>
<td><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2m0 2v14H5V5h14m-9 12-4-4 1.41-1.42L10 14.17l6.59-6.59L18 9"/></svg></span> Privilege Escalation</td>
</tr>
</tbody>
</table>
<p>Click <strong>Save</strong>.</p>
<p>Run the template by clicking the <strong>Launch</strong> button.</p>
<h3 id="automation-platform-automation-platform-wrapup-check-the-results">Check the Results</h3>
<p>This time we use the power of Ansible to check the results: execute uri to get the web content from each node, orchestrated by an Ansible playbook labeled <code>check_url.yml</code></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>We are using the <code>ansible_host</code> variable in the <abbr title="Uniform Resource Locator">URL</abbr> to access every node in the inventory group.</p>
</div>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#automation-platform-automation-platform-wrapup-__codelineno-5-1"></a><span class="nn">---</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#automation-platform-automation-platform-wrapup-__codelineno-5-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Check URL results</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#automation-platform-automation-platform-wrapup-__codelineno-5-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#automation-platform-automation-platform-wrapup-__codelineno-5-4"></a>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#automation-platform-automation-platform-wrapup-__codelineno-5-5"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#automation-platform-automation-platform-wrapup-__codelineno-5-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Check that you can connect (GET) to a page and it returns a status 200</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#automation-platform-automation-platform-wrapup-__codelineno-5-7"></a><span class="w">      </span><span class="nt">uri</span><span class="p">:</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#automation-platform-automation-platform-wrapup-__codelineno-5-8"></a><span class="w">        </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://{{</span><span class="nv"> </span><span class="s">ansible_host</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#automation-platform-automation-platform-wrapup-__codelineno-5-9"></a><span class="w">        </span><span class="nt">return_content</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#automation-platform-automation-platform-wrapup-__codelineno-5-10"></a><span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">uri_output</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#automation-platform-automation-platform-wrapup-__codelineno-5-11"></a>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#automation-platform-automation-platform-wrapup-__codelineno-5-12"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#automation-platform-automation-platform-wrapup-__codelineno-5-13"></a><span class="w">       </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">uri_output.content</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></div>
<p>Execute the playbook:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#automation-platform-automation-platform-wrapup-__codelineno-6-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible-playbook<span class="w"> </span>check_url.yml
</span></code></pre></div>
<p>Snippet of output:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#automation-platform-automation-platform-wrapup-__codelineno-7-1"></a><span class="go">TASK [debug] *******************************************************************</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#automation-platform-automation-platform-wrapup-__codelineno-7-2"></a><span class="go">ok: [node1] =&gt; {</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#automation-platform-automation-platform-wrapup-__codelineno-7-3"></a><span class="go">    &quot;uri_output.content&quot;: &quot;&lt;body&gt;\n&lt;h1&gt;This is a development webserver, have fun!&lt;/h1&gt;\ndev wweb&lt;/body&gt;\n&quot;</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#automation-platform-automation-platform-wrapup-__codelineno-7-4"></a><span class="go">}</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#automation-platform-automation-platform-wrapup-__codelineno-7-5"></a><span class="go">ok: [node2] =&gt; {</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#automation-platform-automation-platform-wrapup-__codelineno-7-6"></a><span class="go">    &quot;uri_output.content&quot;: &quot;&lt;body&gt;\n&lt;h1&gt;This is a production webserver, take care!&lt;/h1&gt;\nprod wweb&lt;/body&gt;\n&quot;</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#automation-platform-automation-platform-wrapup-__codelineno-7-7"></a><span class="go">}</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#automation-platform-automation-platform-wrapup-__codelineno-7-8"></a><span class="go">ok: [node3] =&gt; {</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#automation-platform-automation-platform-wrapup-__codelineno-7-9"></a><span class="go">    &quot;uri_output.content&quot;: &quot;&lt;body&gt;\n&lt;h1&gt;This is a development webserver, have fun!&lt;/h1&gt;\ndev wweb&lt;/body&gt;\n&quot;</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#automation-platform-automation-platform-wrapup-__codelineno-7-10"></a><span class="go">}</span>
</span></code></pre></div>
<h3 id="automation-platform-automation-platform-wrapup-add-survey">Add Survey</h3>
<ul>
<li>Add a Survey to the template to allow changing the variables <code>dev_content</code> and <code>prod_content</code>.</li>
<li>In the Template, click the <strong>Survey</strong> tab and click the <strong>Add</strong> button.</li>
<li>Fill out the following information:</li>
</ul>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Question</td>
<td><code>What should the value of dev_content be?</code></td>
</tr>
<tr>
<td>Answer Variable Name</td>
<td><code>dev_content</code></td>
</tr>
<tr>
<td>Answer Type</td>
<td><code>Text</code></td>
</tr>
</tbody>
</table>
<ul>
<li>Click <strong>Save</strong></li>
<li>Click the <strong>Add</strong> button</li>
</ul>
<p>In the same fashion add a second <strong>Survey Question</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Question</td>
<td><code>What should the value of prod_content be?</code></td>
</tr>
<tr>
<td>Answer Variable Name</td>
<td><code>prod_content</code></td>
</tr>
<tr>
<td>Answer Type</td>
<td><code>Text</code></td>
</tr>
</tbody>
</table>
<ul>
<li>Click <strong>Save</strong></li>
<li>
<p>Click the toggle to turn the Survey questions to <strong>On</strong></p>
</li>
<li>
<p>Click <strong>Preview</strong> for the Survey</p>
</li>
<li>
<p>Add permissions to the team <code>Web Content</code> so the template <strong>Create Web Content</strong> can be executed by <code>wweb</code>.</p>
</li>
<li>
<p>Within the <strong>Resources</strong> -&gt; <strong>Templates</strong>, click <strong>Create Web Content</strong> and add <strong>Access</strong> to the user <code>wweb</code> the ability to execute the template.</p>
<ul>
<li><strong>Select a Resource Type</strong> -&gt; click <strong>Users</strong>, click <strong>Next</strong>.</li>
<li><strong>Select Items from List</strong> -&gt; select the checkbox <code>wweb</code>, click <strong>Next</strong>.</li>
<li><strong>Select Roles to Apply</strong> -&gt; select the checkbox <strong>Execute</strong> and click <strong>Save</strong>.</li>
</ul>
</li>
<li>
<p>Run the survey as user <code>wweb</code></p>
<ul>
<li>Logout of the user <code>admin</code> of your Ansible automation controller.</li>
<li>Login as <code>wweb</code> and go to <strong>Resources</strong> -&gt; <strong>Templates</strong> and run the <strong>Create Web Content</strong> template.</li>
</ul>
</li>
</ul>
<p>Check the results again from your automation controller host. We will use the dedicated <code>uri</code> module within an Ansible playbook. As arguments it needs the actual <abbr title="Uniform Resource Locator">URL</abbr> and a flag to output the body in the results.</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#automation-platform-automation-platform-wrapup-__codelineno-8-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible-playbook<span class="w"> </span>check_url.yml
</span></code></pre></div>
<h3 id="automation-platform-automation-platform-wrapup-solution">Solution</h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><strong>No solution this time <img alt="😅" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f605.svg" title=":sweat_smile:" /></strong></p>
</div>
<p>You have done all the required configuration steps in the lab already. If unsure, just refer back to the respective chapters.</p>
<!-- markdownlint-disable --></section><h1 class='nav-section-title-end'>Ended: Automation Platform</h1>
                        <h1 class='nav-section-title' id='section-projects'>
                            Projects <a class='headerlink' href='#section-projects' title='Permanent link'>↵</a>
                        </h1>
                        <section class="print-page" id="projects-projects-overview"><h1 id="projects-projects-overview-overview">Overview</h1>
<p>This section includes a couple of small projects which will further enhance your Ansible automation skills.<br />
Depending on the length or the focus of the workshop, you will do one or more of these projects.</p>
<ul>
<li><a href="#projects-linux-automation-grafana-project">Linux Automation - Grafana Deployment</a></li>
<li><a href="#projects-network-automation-apic-project">Network Automation - CISCO <abbr title="Application Centric Infrastructure">ACI</abbr> Automation</a></li>
<li><a href="#projects-cloud-automation-aws-project">Cloud Automation - <abbr title="Amazon Web Services">AWS</abbr></a></li>
<li><a href="#projects-dcim-ipam-automation-netbox-project">DCIM Automation - Netbox</a></li>
</ul>
<p>All of the projects are done in or with the Lab environment.</p>
<!-- markdownlint-disable --></section><section class="print-page" id="projects-linux-automation-grafana-project"><h1 id="projects-linux-automation-grafana-project-project-linux-automation">Project - Linux automation</h1>
<p>To further enhance your Ansible skills, let's deploy the monitoring tool <em>Grafana</em> to one of the nodes in the demo environment.</p>
<figure>
<p><img alt="Grafana Logo" src="../projects/linux-automation/images/grafana-logo.png" />
  </p>
<figcaption></figcaption>
</figure>
<h2 id="projects-linux-automation-grafana-project-objective">Objective</h2>
<p>Create an Ansible project <em>from scratch</em> and automate some basic linux configurations.</p>
<h2 id="projects-linux-automation-grafana-project-guide">Guide</h2>
<h3 id="projects-linux-automation-grafana-project-step-1-prepare-project">Step 1 - Prepare project</h3>
<p>Create a new project folder in your home directory:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#projects-linux-automation-grafana-project-__codelineno-0-1"></a><span class="gp">[student@ansible-1 ~]$ </span>mkdir<span class="w"> </span>grafana-deployment
</span></code></pre></div>
<p>Create an inventory file with a <em>grafana</em> group definition. You will deploy Grafana to one of the nodes in the lab environment. Copy the <em>node2</em> configuration from the default inventory file to your <em>grafana</em> group.</p>
<h3 id="projects-linux-automation-grafana-project-step-2-install-grafana">Step 2 - Install Grafana</h3>
<p>The Grafana package comes from a dedicated repository, you'll need to enable it for the <em>yum</em> package manager on <em>node2</em>.
Use the following file and copy it to <code>/etc/yum.repos.d/grafana.repo</code> with an Ansible task:</p>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#projects-linux-automation-grafana-project-__codelineno-1-1"></a><span class="k">[grafana]</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#projects-linux-automation-grafana-project-__codelineno-1-2"></a><span class="na">name</span><span class="o">=</span><span class="s">grafana</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#projects-linux-automation-grafana-project-__codelineno-1-3"></a><span class="na">baseurl</span><span class="o">=</span><span class="s">https://packages.grafana.com/oss/rpm</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#projects-linux-automation-grafana-project-__codelineno-1-4"></a><span class="na">repo_gpgcheck</span><span class="o">=</span><span class="s">1</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#projects-linux-automation-grafana-project-__codelineno-1-5"></a><span class="na">enabled</span><span class="o">=</span><span class="s">1</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#projects-linux-automation-grafana-project-__codelineno-1-6"></a><span class="na">gpgcheck</span><span class="o">=</span><span class="s">1</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#projects-linux-automation-grafana-project-__codelineno-1-7"></a><span class="na">gpgkey</span><span class="o">=</span><span class="s">https://packages.grafana.com/gpg.key</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#projects-linux-automation-grafana-project-__codelineno-1-8"></a><span class="na">sslverify</span><span class="o">=</span><span class="s">1</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#projects-linux-automation-grafana-project-__codelineno-1-9"></a><span class="na">sslcacert</span><span class="o">=</span><span class="s">/etc/pki/tls/certs/ca-bundle.crt</span>
</span></code></pre></div>
<p>The next task should install the <code>grafana</code> package. Another task is needed to start (and enable) the <code>grafana-server</code> service.</p>
<p>Achieve the following tasks:</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Running Grafana instance on node2</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Grafana service running and enabled at startup</li>
</ul>
<p>Ensure that Grafana is running with an ad hoc command:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#projects-linux-automation-grafana-project-__codelineno-2-1"></a><span class="gp">[student@ansible-1 grafana-deployment]$ </span>ansible<span class="w"> </span>grafana<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;systemctl status grafana-server&quot;</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#projects-linux-automation-grafana-project-__codelineno-2-2"></a><span class="go">node2 | CHANGED | rc=0 &gt;&gt;</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#projects-linux-automation-grafana-project-__codelineno-2-3"></a><span class="go">● grafana-server.service - Grafana instance</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#projects-linux-automation-grafana-project-__codelineno-2-4"></a><span class="go">   Loaded: loaded (/usr/lib/systemd/system/grafana-server.service; enabled; vendor preset: disabled)</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#projects-linux-automation-grafana-project-__codelineno-2-5"></a><span class="go">   Active: active (running) since Sun 2022-04-17 10:00:35 UTC; 2min 44s ago</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#projects-linux-automation-grafana-project-__codelineno-2-6"></a><span class="go">     Docs: http://docs.grafana.org</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#projects-linux-automation-grafana-project-__codelineno-2-7"></a><span class="go"> Main PID: 20887 (grafana-server)</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#projects-linux-automation-grafana-project-__codelineno-2-8"></a><span class="go">    Tasks: 7 (limit: 4579)</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#projects-linux-automation-grafana-project-__codelineno-2-9"></a><span class="go">   Memory: 97.7M</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#projects-linux-automation-grafana-project-__codelineno-2-10"></a><span class="go">   CGroup: /system.slice/grafana-server.service</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#projects-linux-automation-grafana-project-__codelineno-2-11"></a><span class="go">           └─20887 /usr/sbin/grafana-server --config=/etc/grafana/grafana.ini --pidfile=/var/run/grafana/grafana-server.pid --packaging=rpm cfg:default.paths.logs=/var/log/grafana cfg:default.paths.data=/var/lib/grafana cfg:default.paths.plugins=/var/lib/grafana/plugins cfg:default.paths.provisioning=/etc/grafana/provisioning</span>
</span></code></pre></div>
<p>Accessing the Grafana <abbr title="User Interface">UI</abbr> from the browser currently fails with a timeout, use the <strong>public</strong> IP address of your <em>node2</em> (the one from your inventory) and port 3000 (this is the default port for Grafana). We will fix this in the next step.</p>
<h3 id="projects-linux-automation-grafana-project-step-3-configure-grafana">Step 3 - Configure Grafana</h3>
<p>Currently, you are not able to access the Grafana <abbr title="User Interface">UI</abbr>, using the <strong>public</strong> IP address of your <em>node2</em> and the Grafana default port of 3000, you will get a timeout.<br />
The lab environment only allows access to Port 80 and 8080, yesterday you started an Apache webserver on these ports with Ansible. You'll have to configure Grafana to start on Port 8080 to able to access the <abbr title="User Interface">UI</abbr>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>There should be no running Apache webserver on <em>node2</em>, if otherwise, you'll need to stop <em>httpd</em> on <em>node2</em>! If the port is occupied, Grafana can not be started!<br />
You could (and should!) ensure a stopped Apache easily with an Ansible task...</p>
</div>
<p>By default, Grafana uses a black background. You will adjust the Grafana configuration with Ansible to show the Grafana <abbr title="User Interface">UI</abbr> with white background. You will change the look from this...</p>
<p><img alt="Grafana with black background" src="../projects/linux-automation/images/grafana-dark-background.png" /></p>
<p>...to this...</p>
<p><img alt="Grafana with white background" src="../projects/linux-automation/images/grafana-light-background.png" /></p>
<p>The configuration for Grafana is stored in <code>/etc/grafana/grafana.ini</code>. You need to adjust the theme configuration in the <em>users</em> section, as well as the <em>http_port</em> in the <em>server</em> section. Take a look at the <a href="https://grafana.com/docs/grafana/latest/administration/configuration/" target="_blank">Grafana documentation</a> on how to change the parameters.<br />
Naturally, you should achieve this with Ansible! Find an appropriate module (there is more than one way to achieve the solution...) and adjust the Grafana configuration file.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Configuration changes require a service restart!</p>
</div>
<p>Now that we adjusted the configuration, try to access the Grafana <abbr title="User Interface">UI</abbr> again. Use the public IP address of your <em>node2</em> and use Port 8080 this time.  </p>
<div class="admonition success">
<p class="admonition-title">Success</p>
<p>It works! The default login credentials are <em>admin:admin</em>, you can skip the password change request.</p>
</div>
<p>Achieve the following tasks:</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Accessible Grafana <abbr title="User Interface">UI</abbr> on port 8080</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Grafana <abbr title="User Interface">UI</abbr> in <code>light</code> theme</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Bonus: Can you manage to control the look of Grafana by just switching a variable?</li>
</ul>
<h3 id="projects-linux-automation-grafana-project-step-4-re-format-project-to-role-structure">Step 4 - Re-format project to role structure</h3>
<p>All Ansible projects should use the role structure, if your project does not already uses it, now is the time to rearrange your content. Create a <code>roles</code> folder and an appropriately named sub-folder for the grafana deployment with all necessary folder and files.<br />
Change your playbook to use your role, e.g.:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#projects-linux-automation-grafana-project-__codelineno-3-1"></a><span class="nn">---</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#projects-linux-automation-grafana-project-__codelineno-3-2"></a><span class="c1"># This is the main Playbook for the &#39;Grafana Deployment&#39; Project</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#projects-linux-automation-grafana-project-__codelineno-3-3"></a>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#projects-linux-automation-grafana-project-__codelineno-3-4"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy Grafana instance</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#projects-linux-automation-grafana-project-__codelineno-3-5"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#projects-linux-automation-grafana-project-__codelineno-3-6"></a><span class="w">  </span><span class="nt">roles</span><span class="p">:</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#projects-linux-automation-grafana-project-__codelineno-3-7"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana</span>
</span></code></pre></div>
<p>Make sure everything works by executing your playbook again, you should not see any changes, all tasks should return a green "Ok" status.</p>
<p>Achieve the following tasks:</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Project uses Ansible role structure</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Playbook references role</li>
</ul>
<h3 id="projects-linux-automation-grafana-project-step-5-bonus-upload-project-to-github">Step 5 - Bonus: Upload project to Github</h3>
<p>Create a new project in your personal Github account and commit your Ansible project.</p>
<h3 id="projects-linux-automation-grafana-project-step-6-bonus-run-your-project-within-aap">Step 6 - Bonus: Run your project within <abbr title="Ansible Automation Platform">AAP</abbr></h3>
<p>Create a new project in <abbr title="Ansible Automation Platform">AAP</abbr>, reference your Grafana project from Github as the code source. Create a template and run your playbook.</p>
<!-- markdownlint-disable --></section><section class="print-page" id="projects-network-automation-apic-project"><h1 id="projects-network-automation-apic-project-project-network-automation">Project - Network automation</h1>
<p>Although the (historical) focus of Ansible was Linux automation, it is very strong with automating network as well.<br />
Ansible collections support a wide range of vendors, device types, and actions, so you can manage your entire network with a single automation tool. With Ansible, you can:</p>
<ul>
<li>Automate repetitive tasks to speed routine network changes and free up your time for more strategic work</li>
<li>Leverage the same simple, powerful, and agent-less automation tool for network tasks that operations and development use</li>
<li>Separate the data model (in a playbook or role) from the execution layer (via Ansible modules) to manage heterogeneous network devices</li>
<li>Benefit from community and vendor-generated sample playbooks and roles to help accelerate network automation projects</li>
<li>Communicate securely with network hardware over <abbr title="Secure Shell">SSH</abbr> or <abbr title="Hypertext Transfer Protocol Secure">HTTPS</abbr></li>
</ul>
<h2 id="projects-network-automation-apic-project-objective">Objective</h2>
<p>Get to know network automation with Ansible.<br />
Network automation uses the basic Ansible concepts, but there are some differences in how the network modules work.<br />
Unlike most Ansible modules, network modules do not run on the managed nodes. From a user’s point of view, network modules work like any other modules. They work with ad hoc commands, playbooks, and roles. Behind the scenes, however, network modules use a different methodology than the other (Linux/Unix and Windows) modules use. Ansible is written and executed in Python. Because the majority of network devices can not run Python, the Ansible network modules are executed on the Ansible control node.</p>
<h2 id="projects-network-automation-apic-project-guide">Guide</h2>
<p>You will execute some automation tasks against Cisco <abbr title="Application Centric Infrastructure">ACI</abbr>. The Cisco Application Centric Infrastructure allows application requirements to define the network. This architecture simplifies, optimizes, and accelerates the entire application deployment life cycle.<br />
The Application Policy Infrastructure Controller manages the scalable <abbr title="Application Centric Infrastructure">ACI</abbr> multi-tenant fabric. The <abbr title="Application Policy Infrastructure Controller">APIC</abbr> provides a unified point of automation and management, policy programming, application deployment, and health monitoring for the fabric. The <abbr title="Application Policy Infrastructure Controller">APIC</abbr>, which is implemented as a replicated synchronized clustered controller, optimizes performance, supports any application anywhere, and provides unified operation of the physical and virtual infrastructure.</p>
<p>The <abbr title="Application Policy Infrastructure Controller">APIC</abbr> enables network administrators to easily define the optimal network for applications. Data center operators can clearly see how applications consume network resources, easily isolate and troubleshoot application and infrastructure problems, and monitor and profile resource usage patterns.</p>
<p>The Cisco Application Policy Infrastructure Controller <abbr title="Application Programming Interface">API</abbr> enables applications to directly connect with a secure, shared, high-performance resource pool that includes network, compute, and storage capabilities.</p>
<h3 id="projects-network-automation-apic-project-step-1-prepare-project">Step 1 - Prepare project</h3>
<p>Create a new project folder in your home directory:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#projects-network-automation-apic-project-__codelineno-0-1"></a><span class="gp">[student@ansible-1 ~]$ </span>mkdir<span class="w"> </span>aci-automation
</span></code></pre></div>
<p>We will be using a Cisco <abbr title="Application Centric Infrastructure">ACI</abbr> Sandbox available online.</p>
<p><img alt="Cisco APIC overview" src="../projects/network-automation/images/apic-quickstart.png" /></p>
<p>Open a new browser tab and go to <a href="https://sandboxapicdc.cisco.com/#" target="_blank">https://sandboxapicdc.cisco.com/#</a></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The credentials for accessing the <a href="https://sandboxapicdc.cisco.com/#" target="_blank">Cisco Sandbox</a> are shown below, you can copy the content by using the symbol on the right of the code block.</p>
</div>
<p>Username:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#projects-network-automation-apic-project-__codelineno-1-1"></a>admin
</span></code></pre></div>
<p>Password:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#projects-network-automation-apic-project-__codelineno-2-1"></a>!v3G@!4@Y
</span></code></pre></div>
<p>Today, you might need additional Ansible modules. In the first part of the workshop, we only used a handful of modules which are all included in the <code>ansible-core</code> binary. With <em>ansible-core</em> only 69 of the most used modules are included:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#projects-network-automation-apic-project-__codelineno-3-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible-doc<span class="w"> </span>-l
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#projects-network-automation-apic-project-__codelineno-3-2"></a><span class="go">add_host               Add a host (and alternatively a group) to the ansible-playbook in-memory inventory  </span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#projects-network-automation-apic-project-__codelineno-3-3"></a><span class="go">apt                    Manages apt-packages  </span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#projects-network-automation-apic-project-__codelineno-3-4"></a><span class="go">apt_key                Add or remove an apt key  </span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#projects-network-automation-apic-project-__codelineno-3-5"></a><span class="go">apt_repository         Add and remove APT repositories  </span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#projects-network-automation-apic-project-__codelineno-3-6"></a><span class="go">assemble               Assemble configuration files from fragments  </span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#projects-network-automation-apic-project-__codelineno-3-7"></a><span class="go">assert                 Asserts given expressions are true  </span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#projects-network-automation-apic-project-__codelineno-3-8"></a><span class="go">async_status           Obtain status of asynchronous task  </span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#projects-network-automation-apic-project-__codelineno-3-9"></a><span class="go">blockinfile            Insert/update/remove a text block surrounded by marker lines  </span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#projects-network-automation-apic-project-__codelineno-3-10"></a><span class="go">command                Execute commands on targets  </span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#projects-network-automation-apic-project-__codelineno-3-11"></a><span class="go">copy                   Copy files to remote locations</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#projects-network-automation-apic-project-__codelineno-3-12"></a><span class="go">...</span>
</span></code></pre></div>
<p>Additional modules are installed through <em>collections</em>, search the <a href="https://docs.ansible.com/ansible/latest/collections/index.html" target="_blank">Collection Index</a> in the Ansible documentation for a module or use the search field.</p>
<p><img alt="Ansible documentation" src="../projects/network-automation/images/ansible-docs.png" /></p>
<p>If, for example, you want to create an <abbr title="Eleastic Compute Cloud">EC2</abbr> instance in <abbr title="Amazon Web Services">AWS</abbr>, you will need the module <code>amazon.aws.ec2_instance</code>. To get the module, you'll need the collection <code>aws</code> of the provider <code>amazon</code>. Download the collection with the <code>ansible-galaxy</code> utility:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#projects-network-automation-apic-project-__codelineno-4-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible-galaxy<span class="w"> </span>collection<span class="w"> </span>install<span class="w"> </span>amazon.aws
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#projects-network-automation-apic-project-__codelineno-4-2"></a><span class="go">Starting galaxy collection install process</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#projects-network-automation-apic-project-__codelineno-4-3"></a><span class="go">Process install dependency map</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#projects-network-automation-apic-project-__codelineno-4-4"></a><span class="go">Starting collection install process</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#projects-network-automation-apic-project-__codelineno-4-5"></a><span class="go">Downloading https://galaxy.ansible.com/download/amazon-aws-3.2.0.tar.gz to /home/student/.ansible/tmp/ansible-local-55382m3kkt4we/tmp7b2kxag4/amazon-aws-3.2.0-3itpmahr</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#projects-network-automation-apic-project-__codelineno-4-6"></a><span class="go">Installing &#39;amazon.aws:3.2.0&#39; to &#39;/home/student/.ansible/collections/ansible_collections/amazon/aws&#39;</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#projects-network-automation-apic-project-__codelineno-4-7"></a><span class="go">amazon.aws:3.2.0 was installed successfully</span>
</span></code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Well, you won't need the <abbr title="Amazon Web Services">AWS</abbr> collection, but automating the <abbr title="Application Centric Infrastructure">ACI</abbr> with Ansible also requires additional modules, these are not included in the <code>ansible-core</code> binary and need to be installed with Ansible Galaxy.</p>
</div>
<p>Achieve the following tasks:</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Find appropriate collection for Cisco <abbr title="Application Centric Infrastructure">ACI</abbr> automation in the documentation</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Collection installed</li>
</ul>
<p>You can view the installed collections with this command:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#projects-network-automation-apic-project-__codelineno-5-1"></a><span class="gp">[student@ansible-1 aci-automation]$ </span>ansible-galaxy<span class="w"> </span>collection<span class="w"> </span>list
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#projects-network-automation-apic-project-__codelineno-5-2"></a><span class="gp"># </span>/home/student/.ansible/collections/ansible_collections
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#projects-network-automation-apic-project-__codelineno-5-3"></a><span class="go">Collection        Version</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#projects-network-automation-apic-project-__codelineno-5-4"></a><span class="go">----------------- -------</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#projects-network-automation-apic-project-__codelineno-5-5"></a><span class="go">ansible.posix     1.4.0  </span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#projects-network-automation-apic-project-__codelineno-5-6"></a><span class="go">community.docker  2.7.0  </span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#projects-network-automation-apic-project-__codelineno-5-7"></a><span class="go">community.general 5.3.0</span>
</span></code></pre></div>
<details class="note">
<summary>Note</summary>
<p>If you use the Ansible navigator (which utilizes an execution environment), the collection is available. The method for playbook execution is up to you, why not try it with both ways?!</p>
</details>
<h3 id="projects-network-automation-apic-project-step-2-inventory-and-playbook">Step 2 - Inventory and playbook</h3>
<p>Within your newly created project folder, create an inventory file and a playbook file.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You have to instruct Ansible to communicate with the <abbr title="Application Policy Infrastructure Controller">APIC</abbr> <abbr title="Application Programming Interface">API</abbr>, per default Ansible would try to communicate via <abbr title="Secure Shell">SSH</abbr>. This will not work.<br />
Use the same credentials for <abbr title="Application Programming Interface">API</abbr> communication as for the login to the <abbr title="Application Policy Infrastructure Controller">APIC</abbr> <abbr title="User Interface">UI</abbr>.</p>
</div>
<p>The <abbr title="Application Programming Interface">API</abbr> endpoint (<em>host</em>) for the <abbr title="Application Centric Infrastructure">ACI</abbr> modules can use the <abbr title="Uniform Resource Locator">URL</abbr> of the sandbox, you won't need the prefix <code>https://</code>. An overview of all available <abbr title="Application Centric Infrastructure">ACI</abbr> modules can be found in the <a href="https://docs.ansible.com/ansible/latest/collections/cisco/aci/index.html#plugins-in-cisco-aci" target="_blank">Ansible documentation</a>. The documentation also provides an <a href="https://docs.ansible.com/ansible/latest/scenario_guides/guide_aci.html" target="_blank">extensive Guide</a> for <abbr title="Application Centric Infrastructure">ACI</abbr> automation.</p>
<p>Testing the successful communication with the <abbr title="Application Programming Interface">API</abbr> could be done by querying <abbr title="Application Centric Infrastructure">ACI</abbr> system information with the <code>aci_system</code> module. Create your playbook and add a task, utilizing this module. Fill all necessary parameter.<br />
Run your playbook, if it returns a green <em>ok</em> status, communication is established.</p>
<p>For now, the gathered system information about the <abbr title="Application Centric Infrastructure">ACI</abbr> system is not relevant for us, still, you could store the output in a variable and output it with an appropriate module, if you are curious.</p>
<p>Achieve the following tasks:</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Inventory and playbook created</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Use variables where possible (and useful)</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Successful communication with <abbr title="Application Policy Infrastructure Controller">APIC</abbr> established</li>
</ul>
<p>You may encounter the following error messages:</p>
<div class="admonition failure">
<p class="admonition-title">Failure</p>
<p>Expect an error message complaining about certification verification:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#projects-network-automation-apic-project-__codelineno-6-1"></a><span class="go">Connection failed for https://sandboxapicdc.cisco.com/api/aaaLogin.json. Request failed: &lt;urlopen error [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1131)&gt;</span>
</span></code></pre></div>
</div>
<p>If you see an error message like above, you can disable certificate validation for your task:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#projects-network-automation-apic-project-__codelineno-7-1"></a><span class="nt">validate_certs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span></code></pre></div>
<p>For a production environment this is obviously <strong>not recommended</strong>!</p>
<div class="admonition failure">
<p class="admonition-title">Failure</p>
<p>If you see one of the following error messages, ensure that the Sandbox is available:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#projects-network-automation-apic-project-__codelineno-8-1"></a><span class="go">Connection failed for https://sandboxapicdc.cisco.com/api/aaaLogin.json. Connection failure: The read operation timed out</span>
</span></code></pre></div>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#projects-network-automation-apic-project-__codelineno-9-1"></a><span class="go">Authentication failed: -1 Unable to parse output as JSON, see &#39;raw&#39; output. Expecting value: line 1 column 1 (char 0)&quot;, &quot;raw&quot;: &quot;&lt;html&gt;\r\n&lt;head&gt;&lt;title&gt;502 Bad Gateway&lt;/title&gt;&lt;/head&gt;\r\n&lt;body bgcolor=\&quot;white\&quot;&gt;\r\n&lt;center&gt;&lt;h1&gt;502 Bad Gateway&lt;/h1&gt;&lt;/center&gt;\r\n&lt;hr&gt;&lt;center&gt;nginx/1.13.12&lt;/center&gt;\r\n&lt;/body&gt;\r\n&lt;/html&gt;\r\n</span>
</span></code></pre></div>
<p>Try to reload the <abbr title="Application Policy Infrastructure Controller">APIC</abbr> browser tab.</p>
</div>
<p>In case of an unavailable <abbr title="Application Policy Infrastructure Controller">APIC</abbr> sandbox, re-run your playbook when it comes back online.  </p>
<h3 id="projects-network-automation-apic-project-step-3-create-a-new-tenant">Step 3 - Create a new tenant</h3>
<p>The <abbr title="Application Policy Infrastructure Controller">APIC</abbr> manages the scalable <abbr title="Application Centric Infrastructure">ACI</abbr> multi-tenant fabric. A <em>multi-tenant</em> environment or <em>multi-tenancy</em> data centres handle segregation of traffic between multiple tenants and ensure privacy and security between tenant data.</p>
<p>The goal is to create a new tenant within the <abbr title="Application Policy Infrastructure Controller">APIC</abbr> controller with Ansible. The tenant should have a recognizable name e.g. <code>demo-tenant-&lt;initials&gt;</code>. Add the tenant description <code>Workshop tenant</code>.</p>
<p><img alt="Demo Tenant in APIC UI" src="../projects/network-automation/images/apic-demo-tenant.png" /></p>
<p>Observe the tenant and it's annotation in the <abbr title="Application Policy Infrastructure Controller">APIC</abbr> <abbr title="User Interface">UI</abbr>.</p>
<p>Achieve the following tasks:</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Tenant created</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Inspected tenant in the <abbr title="User Interface">UI</abbr></li>
</ul>
<h3 id="projects-network-automation-apic-project-step-4-ap-creation-and-epgs">Step 4 - <abbr title="Application Profile">AP</abbr> creation and <abbr title="End Point Groups">EPGs</abbr></h3>
<p>Now, that we have our own custom tenant, lets fill it with content. Create an Application profile and add multiple end point groups.
Application profiles are <em>container</em> for the grouping of endpoint groups. For example, an <abbr title="Application Profile">AP</abbr> could group a web server with the backend database, with storage, and so on.</p>
<p>Create an <em>Application profile</em> with the following attributes:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><em><abbr title="Application Profile">AP</abbr> name</em></td>
<td><code>workshop</code></td>
</tr>
<tr>
<td><em><abbr title="Application Profile">AP</abbr> description</em></td>
<td><code>Workshop AP</code></td>
</tr>
<tr>
<td><em>Monitoring Policy</em></td>
<td><code>default</code></td>
</tr>
</tbody>
</table>
<p>Ensure that your <abbr title="Application Profile">AP</abbr> is created for your own tenant!</p>
<p>Let's create three <abbr title="End Point Groups">EPGs</abbr> for our Application profile, use a single task by creating them in a loop.
The <em><abbr title="End Point Groups">EPGs</abbr></em> should have the following attributes:</p>
<table>
<thead>
<tr>
<th style="text-align: center;">Loop item</th>
<th style="text-align: left;"><em><abbr title="End Point Group">EPG</abbr> name</em></th>
<th style="text-align: left;"><em><abbr title="End Point Group">EPG</abbr> description</em></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">1</td>
<td style="text-align: left;"><code>web</code></td>
<td style="text-align: left;"><code>Web EPG</code></td>
</tr>
<tr>
<td style="text-align: center;">2</td>
<td style="text-align: left;"><code>app</code></td>
<td style="text-align: left;"><code>APP EPG</code></td>
</tr>
<tr>
<td style="text-align: center;">3</td>
<td style="text-align: left;"><code>db</code></td>
<td style="text-align: left;"><code>DB EPG</code></td>
</tr>
</tbody>
</table>
<p>Setting the required attributes requires looping over a <a href="https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_loops.html#iterating-over-a-list-of-hashes" target="_blank">list of hashes</a>. All <abbr title="End Point Groups">EPGs</abbr> should have the <code>default</code> monitoring policy attached.</p>
<p>Observe the tenant in the <abbr title="Application Policy Infrastructure Controller">APIC</abbr> <abbr title="User Interface">UI</abbr>.</p>
<p>Achieve the following tasks:</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Application profile created</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> <abbr title="End Point Groups">EPGs</abbr> created</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>No communication between the different <abbr title="End Point Groups">EPGs</abbr> is established yet, this would be achieved with <em>contracts</em>. By now, you are experienced enough with creating objects in <abbr title="Application Centric Infrastructure">ACI</abbr> with Ansible, let's skip the contracts creation.</p>
</div>
<h3 id="projects-network-automation-apic-project-step-5-roles-and-encryption">Step 5 - Roles and encryption</h3>
<p>Now that you can execute automated tasks against the <abbr title="Application Centric Infrastructure">ACI</abbr>, let's re-format the project and use some Ansible best-practices.<br />
All Ansible projects should use the role structure, if your project does not already uses it, now is the time to rearrange your content. Create a <code>roles</code> folder and an appropriately named sub-folder for the tenant creation with all necessary folder and files.  </p>
<p>Your tasks using the Ansible <abbr title="Application Centric Infrastructure">ACI</abbr> module(s) require username and password, at least the password should be encrypted. Ansible Vault encrypts variables and files so you can protect sensitive content rather than leaving it visible as plaintext in playbooks or roles, take a look at the <a href="https://docs.ansible.com/ansible/latest/user_guide/vault.html#vault" target="_blank">Ansible Vault documentation</a> for further information.
Encrypt the <abbr title="Application Policy Infrastructure Controller">APIC</abbr> credentials and re-run your playbook.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Remember the necessary additional cli parameter when executing a playbook which references encrypted content.</p>
</div>
<p>Achieve the following tasks:</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Project uses Ansible role structure</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> <abbr title="Application Policy Infrastructure Controller">APIC</abbr> credentials are vault-encrypted</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Playbook references role, tasks are executed</li>
</ul>
<h3 id="projects-network-automation-apic-project-step-6-use-filters-to-manipulate-data">Step 6 - Use filters to manipulate data</h3>
<p>Filters let you transform <abbr title="JavaScript Object Notation">JSON</abbr> data into <abbr title="YAML Ain't Markup Language">YAML</abbr> data, split a <abbr title="Uniform Resource Locator">URL</abbr> to extract the hostname, get the SHA1 hash of a string, add or multiply integers, and much more. You can use the Ansible-specific filters documented <a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_filters.html" target="_blank">here</a> to manipulate your data, or use any of the standard filters shipped with <a href="https://jinja.palletsprojects.com/en/3.0.x/templates/#builtin-filters" target="_blank">Jinja2</a>.</p>
<p>Create a new role which utilizes an <a href="https://docs.ansible.com/ansible/latest/collections/cisco/aci/index.html" target="_blank">Ansible <abbr title="Application Centric Infrastructure">ACI</abbr> module</a> that can manage contract resources (<em>vz:BrCP</em>). Get all contracts of the <strong>common</strong> tenant and output a list with only the contract names.</p>
<p><img alt="Contracts of common tenant" src="../projects/network-automation/images/apic-common-contracts.png" /></p>
<p>The <em>common</em> tenant has at least one contract (<em>default</em>).</p>
<p>Dealing with network devices often means dealing with large <abbr title="JavaScript Object Notation">JSON</abbr> objects and you have to <em>filter</em> the output to your needs. Browse the <a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_filters.html" target="_blank">Ansible filter documentation</a> for a suitable filter.</p>
<p>The Ansible module you will be using returns a <abbr title="JavaScript Object Notation">JSON</abbr> output like the following:</p>
<div class="language-json highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-1">  1</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-2">  2</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-3">  3</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-4">  4</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-5">  5</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-6">  6</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-7">  7</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-8">  8</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-9">  9</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-10"> 10</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-11"> 11</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-12"> 12</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-13"> 13</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-14"> 14</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-15"> 15</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-16"> 16</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-17"> 17</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-18"> 18</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-19"> 19</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-20"> 20</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-21"> 21</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-22"> 22</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-23"> 23</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-24"> 24</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-25"> 25</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-26"> 26</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-27"> 27</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-28"> 28</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-29"> 29</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-30"> 30</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-31"> 31</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-32"> 32</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-33"> 33</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-34"> 34</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-35"> 35</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-36"> 36</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-37"> 37</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-38"> 38</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-39"> 39</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-40"> 40</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-41"> 41</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-42"> 42</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-43"> 43</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-44"> 44</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-45"> 45</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-46"> 46</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-47"> 47</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-48"> 48</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-49"> 49</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-50"> 50</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-51"> 51</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-52"> 52</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-53"> 53</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-54"> 54</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-55"> 55</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-56"> 56</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-57"> 57</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-58"> 58</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-59"> 59</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-60"> 60</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-61"> 61</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-62"> 62</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-63"> 63</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-64"> 64</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-65"> 65</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-66"> 66</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-67"> 67</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-68"> 68</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-69"> 69</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-70"> 70</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-71"> 71</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-72"> 72</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-73"> 73</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-74"> 74</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-75"> 75</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-76"> 76</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-77"> 77</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-78"> 78</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-79"> 79</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-80"> 80</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-81"> 81</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-82"> 82</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-83"> 83</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-84"> 84</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-85"> 85</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-86"> 86</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-87"> 87</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-88"> 88</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-89"> 89</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-90"> 90</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-91"> 91</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-92"> 92</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-93"> 93</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-94"> 94</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-95"> 95</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-96"> 96</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-97"> 97</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-98"> 98</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-99"> 99</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-100">100</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-101">101</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-102">102</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-103">103</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-104">104</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-105">105</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-106">106</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-107">107</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-108">108</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-109">109</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-110">110</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-111">111</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-112">112</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-113">113</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-114">114</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-115">115</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-116">116</a></span>
<span class="normal"><a href="#projects-network-automation-apic-project-__codelineno-10-117">117</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="w">  </span><span class="nt">&quot;changed&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="w">  </span><span class="nt">&quot;current&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="w">      </span><span class="nt">&quot;fvTenant&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="w">        </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="w">          </span><span class="nt">&quot;annotation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="w">          </span><span class="nt">&quot;childAction&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="w">          </span><span class="nt">&quot;descr&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9"></a><span class="w">          </span><span class="nt">&quot;dn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uni/tn-common&quot;</span><span class="p">,</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10"></a><span class="w">          </span><span class="nt">&quot;extMngdBy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11"></a><span class="w">          </span><span class="nt">&quot;lcOwn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;local&quot;</span><span class="p">,</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12"></a><span class="w">          </span><span class="nt">&quot;modTs&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2022-04-16T13:54:30.664+00:00&quot;</span><span class="p">,</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13"></a><span class="w">          </span><span class="nt">&quot;monPolDn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uni/tn-common/monepg-default&quot;</span><span class="p">,</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14"></a><span class="w">          </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;common&quot;</span><span class="p">,</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15"></a><span class="w">          </span><span class="nt">&quot;nameAlias&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16"></a><span class="w">          </span><span class="nt">&quot;ownerKey&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17"></a><span class="w">          </span><span class="nt">&quot;ownerTag&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18"></a><span class="w">          </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19"></a><span class="w">          </span><span class="nt">&quot;uid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20"></a><span class="w">          </span><span class="nt">&quot;userdom&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;all&quot;</span>
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-10-22"><a id="__codelineno-10-22" name="__codelineno-10-22"></a><span class="hll"><span class="w">        </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span></span><span id="__span-10-23"><a id="__codelineno-10-23" name="__codelineno-10-23"></a><span class="w">            </span><span class="p">{</span>
</span><span id="__span-10-24"><a id="__codelineno-10-24" name="__codelineno-10-24"></a><span class="w">              </span><span class="nt">&quot;vzBrCP&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-25"><a id="__codelineno-10-25" name="__codelineno-10-25"></a><span class="w">                </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-26"><a id="__codelineno-10-26" name="__codelineno-10-26"></a><span class="w">                  </span><span class="nt">&quot;accessPrivilege&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;USER&quot;</span><span class="p">,</span>
</span><span id="__span-10-27"><a id="__codelineno-10-27" name="__codelineno-10-27"></a><span class="w">                  </span><span class="nt">&quot;annotation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-10-28"><a id="__codelineno-10-28" name="__codelineno-10-28"></a><span class="w">                  </span><span class="nt">&quot;childAction&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-10-29"><a id="__codelineno-10-29" name="__codelineno-10-29"></a><span class="w">                  </span><span class="nt">&quot;configIssues&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-10-30"><a id="__codelineno-10-30" name="__codelineno-10-30"></a><span class="w">                  </span><span class="nt">&quot;descr&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-10-31"><a id="__codelineno-10-31" name="__codelineno-10-31"></a><span class="w">                  </span><span class="nt">&quot;extMngdBy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-10-32"><a id="__codelineno-10-32" name="__codelineno-10-32"></a><span class="w">                  </span><span class="nt">&quot;intent&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;install&quot;</span><span class="p">,</span>
</span><span id="__span-10-33"><a id="__codelineno-10-33" name="__codelineno-10-33"></a><span class="w">                  </span><span class="nt">&quot;lcOwn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;local&quot;</span><span class="p">,</span>
</span><span id="__span-10-34"><a id="__codelineno-10-34" name="__codelineno-10-34"></a><span class="w">                  </span><span class="nt">&quot;modTs&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2022-04-16T13:54:30.664+00:00&quot;</span><span class="p">,</span>
</span><span id="__span-10-35"><a id="__codelineno-10-35" name="__codelineno-10-35"></a><span class="w">                  </span><span class="nt">&quot;monPolDn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uni/tn-common/monepg-default&quot;</span><span class="p">,</span>
</span><span id="__span-10-36"><a id="__codelineno-10-36" name="__codelineno-10-36"></a><span class="hll"><span class="w">                  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span><span class="p">,</span>
</span></span><span id="__span-10-37"><a id="__codelineno-10-37" name="__codelineno-10-37"></a><span class="w">                  </span><span class="nt">&quot;nameAlias&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-10-38"><a id="__codelineno-10-38" name="__codelineno-10-38"></a><span class="w">                  </span><span class="nt">&quot;ownerKey&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-10-39"><a id="__codelineno-10-39" name="__codelineno-10-39"></a><span class="w">                  </span><span class="nt">&quot;ownerTag&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-10-40"><a id="__codelineno-10-40" name="__codelineno-10-40"></a><span class="w">                  </span><span class="nt">&quot;prio&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;unspecified&quot;</span><span class="p">,</span>
</span><span id="__span-10-41"><a id="__codelineno-10-41" name="__codelineno-10-41"></a><span class="w">                  </span><span class="nt">&quot;reevaluateAll&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;no&quot;</span><span class="p">,</span>
</span><span id="__span-10-42"><a id="__codelineno-10-42" name="__codelineno-10-42"></a><span class="w">                  </span><span class="nt">&quot;rn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;brc-default&quot;</span><span class="p">,</span>
</span><span id="__span-10-43"><a id="__codelineno-10-43" name="__codelineno-10-43"></a><span class="w">                  </span><span class="nt">&quot;scope&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;context&quot;</span><span class="p">,</span>
</span><span id="__span-10-44"><a id="__codelineno-10-44" name="__codelineno-10-44"></a><span class="w">                  </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-10-45"><a id="__codelineno-10-45" name="__codelineno-10-45"></a><span class="w">                  </span><span class="nt">&quot;targetDscp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;unspecified&quot;</span><span class="p">,</span>
</span><span id="__span-10-46"><a id="__codelineno-10-46" name="__codelineno-10-46"></a><span class="w">                  </span><span class="nt">&quot;uid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
</span><span id="__span-10-47"><a id="__codelineno-10-47" name="__codelineno-10-47"></a><span class="w">                  </span><span class="nt">&quot;userdom&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;all&quot;</span>
</span><span id="__span-10-48"><a id="__codelineno-10-48" name="__codelineno-10-48"></a><span class="w">                </span><span class="p">},</span>
</span><span id="__span-10-49"><a id="__codelineno-10-49" name="__codelineno-10-49"></a><span class="w">                </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-10-50"><a id="__codelineno-10-50" name="__codelineno-10-50"></a><span class="w">                  </span><span class="p">{</span>
</span><span id="__span-10-51"><a id="__codelineno-10-51" name="__codelineno-10-51"></a><span class="w">                    </span><span class="nt">&quot;vzSubj&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-52"><a id="__codelineno-10-52" name="__codelineno-10-52"></a><span class="w">                      </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-53"><a id="__codelineno-10-53" name="__codelineno-10-53"></a><span class="w">                        </span><span class="nt">&quot;accessPrivilege&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;USER&quot;</span><span class="p">,</span>
</span><span id="__span-10-54"><a id="__codelineno-10-54" name="__codelineno-10-54"></a><span class="w">                        </span><span class="nt">&quot;annotation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-10-55"><a id="__codelineno-10-55" name="__codelineno-10-55"></a><span class="w">                        </span><span class="nt">&quot;childAction&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-10-56"><a id="__codelineno-10-56" name="__codelineno-10-56"></a><span class="w">                        </span><span class="nt">&quot;configIssues&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-10-57"><a id="__codelineno-10-57" name="__codelineno-10-57"></a><span class="w">                        </span><span class="nt">&quot;consMatchT&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AtleastOne&quot;</span><span class="p">,</span>
</span><span id="__span-10-58"><a id="__codelineno-10-58" name="__codelineno-10-58"></a><span class="w">                        </span><span class="nt">&quot;descr&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-10-59"><a id="__codelineno-10-59" name="__codelineno-10-59"></a><span class="w">                        </span><span class="nt">&quot;extMngdBy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-10-60"><a id="__codelineno-10-60" name="__codelineno-10-60"></a><span class="w">                        </span><span class="nt">&quot;lcOwn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;local&quot;</span><span class="p">,</span>
</span><span id="__span-10-61"><a id="__codelineno-10-61" name="__codelineno-10-61"></a><span class="w">                        </span><span class="nt">&quot;modTs&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2022-04-16T13:54:30.664+00:00&quot;</span><span class="p">,</span>
</span><span id="__span-10-62"><a id="__codelineno-10-62" name="__codelineno-10-62"></a><span class="w">                        </span><span class="nt">&quot;monPolDn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uni/tn-common/monepg-default&quot;</span><span class="p">,</span>
</span><span id="__span-10-63"><a id="__codelineno-10-63" name="__codelineno-10-63"></a><span class="w">                        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span><span class="p">,</span>
</span><span id="__span-10-64"><a id="__codelineno-10-64" name="__codelineno-10-64"></a><span class="w">                        </span><span class="nt">&quot;nameAlias&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-10-65"><a id="__codelineno-10-65" name="__codelineno-10-65"></a><span class="w">                        </span><span class="nt">&quot;prio&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;unspecified&quot;</span><span class="p">,</span>
</span><span id="__span-10-66"><a id="__codelineno-10-66" name="__codelineno-10-66"></a><span class="w">                        </span><span class="nt">&quot;provMatchT&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AtleastOne&quot;</span><span class="p">,</span>
</span><span id="__span-10-67"><a id="__codelineno-10-67" name="__codelineno-10-67"></a><span class="w">                        </span><span class="nt">&quot;revFltPorts&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;yes&quot;</span><span class="p">,</span>
</span><span id="__span-10-68"><a id="__codelineno-10-68" name="__codelineno-10-68"></a><span class="w">                        </span><span class="nt">&quot;rn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;subj-default&quot;</span><span class="p">,</span>
</span><span id="__span-10-69"><a id="__codelineno-10-69" name="__codelineno-10-69"></a><span class="w">                        </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-10-70"><a id="__codelineno-10-70" name="__codelineno-10-70"></a><span class="w">                        </span><span class="nt">&quot;targetDscp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;unspecified&quot;</span><span class="p">,</span>
</span><span id="__span-10-71"><a id="__codelineno-10-71" name="__codelineno-10-71"></a><span class="w">                        </span><span class="nt">&quot;uid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
</span><span id="__span-10-72"><a id="__codelineno-10-72" name="__codelineno-10-72"></a><span class="w">                        </span><span class="nt">&quot;userdom&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;all&quot;</span>
</span><span id="__span-10-73"><a id="__codelineno-10-73" name="__codelineno-10-73"></a><span class="w">                      </span><span class="p">},</span>
</span><span id="__span-10-74"><a id="__codelineno-10-74" name="__codelineno-10-74"></a><span class="w">                      </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-10-75"><a id="__codelineno-10-75" name="__codelineno-10-75"></a><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-10-76"><a id="__codelineno-10-76" name="__codelineno-10-76"></a><span class="w">                          </span><span class="nt">&quot;vzRsSubjFiltAtt&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-77"><a id="__codelineno-10-77" name="__codelineno-10-77"></a><span class="w">                            </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-78"><a id="__codelineno-10-78" name="__codelineno-10-78"></a><span class="w">                              </span><span class="nt">&quot;accessPrivilege&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;USER&quot;</span><span class="p">,</span>
</span><span id="__span-10-79"><a id="__codelineno-10-79" name="__codelineno-10-79"></a><span class="w">                              </span><span class="nt">&quot;action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;permit&quot;</span><span class="p">,</span>
</span><span id="__span-10-80"><a id="__codelineno-10-80" name="__codelineno-10-80"></a><span class="w">                              </span><span class="nt">&quot;annotation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-10-81"><a id="__codelineno-10-81" name="__codelineno-10-81"></a><span class="w">                              </span><span class="nt">&quot;childAction&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-10-82"><a id="__codelineno-10-82" name="__codelineno-10-82"></a><span class="w">                              </span><span class="nt">&quot;directives&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-10-83"><a id="__codelineno-10-83" name="__codelineno-10-83"></a><span class="w">                              </span><span class="nt">&quot;extMngdBy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-10-84"><a id="__codelineno-10-84" name="__codelineno-10-84"></a><span class="w">                              </span><span class="nt">&quot;forceResolve&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;yes&quot;</span><span class="p">,</span>
</span><span id="__span-10-85"><a id="__codelineno-10-85" name="__codelineno-10-85"></a><span class="w">                              </span><span class="nt">&quot;lcOwn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;local&quot;</span><span class="p">,</span>
</span><span id="__span-10-86"><a id="__codelineno-10-86" name="__codelineno-10-86"></a><span class="w">                              </span><span class="nt">&quot;modTs&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2022-04-16T13:54:30.664+00:00&quot;</span><span class="p">,</span>
</span><span id="__span-10-87"><a id="__codelineno-10-87" name="__codelineno-10-87"></a><span class="w">                              </span><span class="nt">&quot;monPolDn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uni/tn-common/monepg-default&quot;</span><span class="p">,</span>
</span><span id="__span-10-88"><a id="__codelineno-10-88" name="__codelineno-10-88"></a><span class="w">                              </span><span class="nt">&quot;priorityOverride&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span><span class="p">,</span>
</span><span id="__span-10-89"><a id="__codelineno-10-89" name="__codelineno-10-89"></a><span class="w">                              </span><span class="nt">&quot;rType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;mo&quot;</span><span class="p">,</span>
</span><span id="__span-10-90"><a id="__codelineno-10-90" name="__codelineno-10-90"></a><span class="w">                              </span><span class="nt">&quot;rn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;rssubjFiltAtt-default&quot;</span><span class="p">,</span>
</span><span id="__span-10-91"><a id="__codelineno-10-91" name="__codelineno-10-91"></a><span class="w">                              </span><span class="nt">&quot;state&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;formed&quot;</span><span class="p">,</span>
</span><span id="__span-10-92"><a id="__codelineno-10-92" name="__codelineno-10-92"></a><span class="w">                              </span><span class="nt">&quot;stateQual&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
</span><span id="__span-10-93"><a id="__codelineno-10-93" name="__codelineno-10-93"></a><span class="w">                              </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-10-94"><a id="__codelineno-10-94" name="__codelineno-10-94"></a><span class="w">                              </span><span class="nt">&quot;tCl&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;vzFilter&quot;</span><span class="p">,</span>
</span><span id="__span-10-95"><a id="__codelineno-10-95" name="__codelineno-10-95"></a><span class="w">                              </span><span class="nt">&quot;tContextDn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-10-96"><a id="__codelineno-10-96" name="__codelineno-10-96"></a><span class="w">                              </span><span class="nt">&quot;tDn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uni/tn-common/flt-default&quot;</span><span class="p">,</span>
</span><span id="__span-10-97"><a id="__codelineno-10-97" name="__codelineno-10-97"></a><span class="w">                              </span><span class="nt">&quot;tRn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;flt-default&quot;</span><span class="p">,</span>
</span><span id="__span-10-98"><a id="__codelineno-10-98" name="__codelineno-10-98"></a><span class="w">                              </span><span class="nt">&quot;tType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
</span><span id="__span-10-99"><a id="__codelineno-10-99" name="__codelineno-10-99"></a><span class="w">                              </span><span class="nt">&quot;tnVzFilterName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span><span class="p">,</span>
</span><span id="__span-10-100"><a id="__codelineno-10-100" name="__codelineno-10-100"></a><span class="w">                              </span><span class="nt">&quot;uid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
</span><span id="__span-10-101"><a id="__codelineno-10-101" name="__codelineno-10-101"></a><span class="w">                              </span><span class="nt">&quot;userdom&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;all&quot;</span>
</span><span id="__span-10-102"><a id="__codelineno-10-102" name="__codelineno-10-102"></a><span class="w">                            </span><span class="p">}</span>
</span><span id="__span-10-103"><a id="__codelineno-10-103" name="__codelineno-10-103"></a><span class="w">                          </span><span class="p">}</span>
</span><span id="__span-10-104"><a id="__codelineno-10-104" name="__codelineno-10-104"></a><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-10-105"><a id="__codelineno-10-105" name="__codelineno-10-105"></a><span class="w">                      </span><span class="p">]</span>
</span><span id="__span-10-106"><a id="__codelineno-10-106" name="__codelineno-10-106"></a><span class="w">                    </span><span class="p">}</span>
</span><span id="__span-10-107"><a id="__codelineno-10-107" name="__codelineno-10-107"></a><span class="w">                  </span><span class="p">}</span>
</span><span id="__span-10-108"><a id="__codelineno-10-108" name="__codelineno-10-108"></a><span class="w">                </span><span class="p">]</span>
</span><span id="__span-10-109"><a id="__codelineno-10-109" name="__codelineno-10-109"></a><span class="w">              </span><span class="p">}</span>
</span><span id="__span-10-110"><a id="__codelineno-10-110" name="__codelineno-10-110"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-10-111"><a id="__codelineno-10-111" name="__codelineno-10-111"></a><span class="w">          </span><span class="p">]</span>
</span><span id="__span-10-112"><a id="__codelineno-10-112" name="__codelineno-10-112"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-10-113"><a id="__codelineno-10-113" name="__codelineno-10-113"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-10-114"><a id="__codelineno-10-114" name="__codelineno-10-114"></a><span class="w">    </span><span class="p">],</span>
</span><span id="__span-10-115"><a id="__codelineno-10-115" name="__codelineno-10-115"></a><span class="w">    </span><span class="nt">&quot;failed&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-10-116"><a id="__codelineno-10-116" name="__codelineno-10-116"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-117"><a id="__codelineno-10-117" name="__codelineno-10-117"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<p>The highlighted lines show the <strong>list</strong> of contracts and the name of the contract-<strong>element</strong>. You need to traverse the <abbr title="JavaScript Object Notation">JSON</abbr> object until you reach the key you want to get. In <abbr title="JavaScript Object Notation">JSON</abbr>, <em>list</em>-objects are encapsulated with square brackets (start with <em>[</em> and end with <em>]</em>), dictionary objects with curly brackets (start with <em>{</em> and end with <em>}</em>).  </p>
<p>Observing the above output, you can see that multiple list objects are within the complete <abbr title="JavaScript Object Notation">JSON</abbr> object. The value of the <em>key</em> <code>current</code> is a list, every list item of this key is a tenant (with multiple <em>key-value</em> pairs which can also be dictionaries or lists).</p>
<p>If you filter for a single tenant (by providing the tenant name) when using the module, the list <code>current</code> only has one element. Lists (in Python, which Ansible is based on) start at element <em>0</em>, the second list element is <em>1</em> and so on.</p>
<p>The resulting output in your playbook-run should look something like this (considering that the <em>common</em> tenant only has one contract):</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#projects-network-automation-apic-project-__codelineno-11-1"></a><span class="go">TASK [aci-contract : Output list of contract names of Tenant &#39;common&#39;] ********</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#projects-network-automation-apic-project-__codelineno-11-2"></a><span class="go">ok: [demo-aci-host] =&gt; {</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#projects-network-automation-apic-project-__codelineno-11-3"></a><span class="go">    &quot;msg&quot;: [</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#projects-network-automation-apic-project-__codelineno-11-4"></a><span class="go">        &quot;default&quot;</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#projects-network-automation-apic-project-__codelineno-11-5"></a><span class="go">    ]</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#projects-network-automation-apic-project-__codelineno-11-6"></a><span class="go">}</span>
</span></code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>There are multiple ways to achieve the desired solution, try around!<br />
Dealing with large <abbr title="JavaScript Object Notation">JSON</abbr> objects and outputting it to stdout may result in not being able to scroll back far enough to see the start of your task or playbook.<br />
You can adjust the <a href="#demo-environment-demo-environment-terminal-scrollback">VScode configuration</a> yourself.</p>
</div>
<p>Achieve the following tasks:</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> New role for contract handling created</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Playbook runs both roles</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Playbook outputs list of all contracts for <em>common</em> tenant</li>
</ul>
<details class="tip">
<summary>If you struggle to find a solution, here are some hints. (Try without them first!)</summary>
<p>The following tips may help you to develop a solution:</p>
<ul>
<li>Use the <code>cisco.aci.aci_contract</code> module.</li>
<li>Define the tenant <code>common</code> in the module, otherwise you will get <strong>all</strong> contracts of <strong>all</strong> users, which is harder to parse.  </li>
<li>Use <code>state: query</code> for listing all contract objects.  </li>
<li>Store the module output in a variable (register).  </li>
<li>Use the <code>json_query</code> filter. The filter is part of the <code>community.general</code> collection.  </li>
<li>You need to install a Python package for the filter, run <code>pip3.9 install jmespath</code> (if your Ansible uses Python3.9, run <code>ansible --version</code> to find out)</li>
<li>Traversing the <abbr title="JavaScript Object Notation">JSON</abbr> object can be achieved by <code>current[0].fvTenant.children...</code>  </li>
<li>Output to stdout can be achieved with the debug module.</li>
</ul>
</details>
<!-- markdownlint-disable --></section><section class="print-page" id="projects-cloud-automation-aws-project"><h1 id="projects-cloud-automation-aws-project-project-aws-automation">Project - <abbr title="Amazon Web Services">AWS</abbr> Automation</h1>
<p>Automating Cloud infrastructure is getting more and more important. Tools like <em>Terraform</em> are well suited for provisioning infrastructure in public cloud environments.<br />
When dealing with immutable infrastructure, Terraform works well and is great at provisioning cloud resources and applications for <abbr title="Amazon Web Services">AWS</abbr>, Azure, Docker, <abbr title="Google Cloud Platform">GCP</abbr>, and others.  However, there is more to IT operations than automated infrastructure provisioning and this is why Ansible is extremely popular as well.</p>
<p>Terraform is an excellent cloud provisioning and de-provisioning tool for infrastructure as code.  Ansible is a great all-purpose, cross-domain automation solution.<br />
Together, they perform in harmony to create a better experience for developers and operations teams. Still, this workshops focus is Ansible, let us do provisioning <strong>and</strong> configuration in the cloud with the tool we learned.</p>
<h2 id="projects-cloud-automation-aws-project-objective">Objective</h2>
<p>Get to know cloud automation with Ansible.<br />
Cloud automation uses the basic Ansible concepts, but there are some differences in how the modules work.<br />
From a user’s point of view, cloud modules work like any other modules. They work with ad hoc commands, playbooks, and roles.
Behind the scenes, however, cloud modules use a different methodology than the other (Linux/Unix and Windows) modules use. As we are communicating with an <abbr title="Application Programming Interface">API</abbr> endpoint, but Ansible and most of its modules are written and executed in Python, you need to use the Python interpreter on the Ansible control node.</p>
<h2 id="projects-cloud-automation-aws-project-requirements">Requirements</h2>
<p>For doing the following exercises, you will need an <abbr title="Amazon Web Services">AWS</abbr> Account and an <abbr title="Amazon Web Services">AWS</abbr> Access key (consists of an <em>Access Key ID</em> and a <em>Secret Access Key</em>).<br />
<img align="left" alt="AWS Security credentials" src="../projects/cloud-automation/images/AWS-Security-Credentials.png" width="300" />
After creating your <abbr title="Amazon Web Services">AWS</abbr> Account, go to the navigation bar on the upper right, choose your user name, and then choose <em>Security credentials</em>.<br />
In the Access keys section, choose Create access key.  On the Access key best practices &amp; alternatives page, choose your use case to learn about additional options which can help you avoid creating a long-term access key. Mark the checkbox and click <em>Create Access Key</em>. On the <em>Retrieve access keys</em> page, choose either Show to reveal the value of your user's secret access key, or Download .csv file. This is your only opportunity to save your secret access key. After you've saved your secret access key in a secure location, choose Done.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Most modules need the region set, use the region <code>eu-central-1</code> throughout your playbook.</p>
</div>
<h2 id="projects-cloud-automation-aws-project-guide">Guide</h2>
<p>The following steps explain and train you how to use the modules and inventory scripts to automate your <abbr title="Amazon Web Services">AWS</abbr> resources with Ansible.</p>
<h3 id="projects-cloud-automation-aws-project-step-1-prepare-controller">Step 1 - Prepare controller</h3>
<p>Today, you will need additional Ansible modules. In the first part of the workshop, we only used a handful of modules which are all included in the <code>ansible-core</code> binary. With <em>ansible-core</em> only 69 of the most used modules are included:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#projects-cloud-automation-aws-project-__codelineno-0-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible-doc<span class="w"> </span>-l
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#projects-cloud-automation-aws-project-__codelineno-0-2"></a><span class="go">add_host               Add a host (and alternatively a group) to the ansible-playbook in-memory inventory  </span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#projects-cloud-automation-aws-project-__codelineno-0-3"></a><span class="go">apt                    Manages apt-packages  </span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#projects-cloud-automation-aws-project-__codelineno-0-4"></a><span class="go">apt_key                Add or remove an apt key  </span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#projects-cloud-automation-aws-project-__codelineno-0-5"></a><span class="go">apt_repository         Add and remove APT repositories  </span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#projects-cloud-automation-aws-project-__codelineno-0-6"></a><span class="go">assemble               Assemble configuration files from fragments  </span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#projects-cloud-automation-aws-project-__codelineno-0-7"></a><span class="go">assert                 Asserts given expressions are true  </span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#projects-cloud-automation-aws-project-__codelineno-0-8"></a><span class="go">async_status           Obtain status of asynchronous task  </span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#projects-cloud-automation-aws-project-__codelineno-0-9"></a><span class="go">blockinfile            Insert/update/remove a text block surrounded by marker lines  </span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#projects-cloud-automation-aws-project-__codelineno-0-10"></a><span class="go">command                Execute commands on targets  </span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#projects-cloud-automation-aws-project-__codelineno-0-11"></a><span class="go">copy                   Copy files to remote locations</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#projects-cloud-automation-aws-project-__codelineno-0-12"></a><span class="go">...</span>
</span></code></pre></div>
<p>Additional modules are installed through <em>collections</em>, search the <a href="https://docs.ansible.com/ansible/latest/collections/index.html" target="_blank">Collection Index</a> in the Ansible documentation for a suitable collection or use the search field.</p>
<p><img alt="Ansible documentation" src="../projects/network-automation/images/ansible-docs.png" /></p>
<p>Once you found the appropriate collection, install it with the <code>ansible-galaxy</code> <abbr title="Command-Line Interface">CLI</abbr> command:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#projects-cloud-automation-aws-project-__codelineno-1-1"></a><span class="go">ansible-galaxy collection install provider.collection</span>
</span></code></pre></div>
<p>Requirements for the <abbr title="Amazon Web Services">AWS</abbr> modules are minimal, you will need an additional Python package. Install the package with this command:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#projects-cloud-automation-aws-project-__codelineno-2-1"></a><span class="go">pip3.9 install boto3 --user</span>
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Note the version of the Python package manager utility (<code>pip3.9</code>)!</strong><br />
Your Ansible control node might have multiple Python versions installed, install necessary dependencies for the Python version that Ansible uses.<br />
You can check for the Python interpreter of Ansible with the <code>ansible --version</code> command:</p>
<p><div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#projects-cloud-automation-aws-project-__codelineno-3-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible<span class="w"> </span>--version
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#projects-cloud-automation-aws-project-__codelineno-3-2"></a><span class="go">ansible [core 2.14.0]</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#projects-cloud-automation-aws-project-__codelineno-3-3"></a><span class="go">config file = /etc/ansible/ansible.cfg</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#projects-cloud-automation-aws-project-__codelineno-3-4"></a><span class="go">configured module search path = [&#39;/home/student/.ansible/plugins/modules&#39;, &#39;/usr/share/ansible/plugins/modules&#39;]</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#projects-cloud-automation-aws-project-__codelineno-3-5"></a><span class="go">ansible python module location = /usr/lib/python3.9/site-packages/ansible</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#projects-cloud-automation-aws-project-__codelineno-3-6"></a><span class="go">ansible collection location = /home/student/.ansible/collections:/usr/share/ansible/collections</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#projects-cloud-automation-aws-project-__codelineno-3-7"></a><span class="go">executable location = /usr/bin/ansible*</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#projects-cloud-automation-aws-project-__codelineno-3-8"></a><span class="go">python version = 3.9.13 (main, Nov  9 2022, 13:16:24) [GCC 8.5.0 20210514 (Red Hat 8.5.0-15)] (/usr/bin/python3.9)</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#projects-cloud-automation-aws-project-__codelineno-3-9"></a><span class="go">jinja version = 3.1.2</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#projects-cloud-automation-aws-project-__codelineno-3-10"></a><span class="go">libyaml = True</span>
</span></code></pre></div>
<strong>Do not use <em>sudo</em> when installing Python packages. If you get a <em>Permission denied</em>, add <code>--user</code>, this installs the dependencies to <code>~/.local/lib</code>.</strong></p>
</div>
<p>Achieve the following tasks:</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Find appropriate collection for <abbr title="Amazon Web Services">AWS</abbr> automation in the documentation</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Collection installed</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Python requirements installed</li>
</ul>
<p>You can view the installed collections with this command:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#projects-cloud-automation-aws-project-__codelineno-4-1"></a><span class="gp">[student@ansible-1 aci-automation]$ </span>ansible-galaxy<span class="w"> </span>collection<span class="w"> </span>list
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#projects-cloud-automation-aws-project-__codelineno-4-2"></a><span class="gp"># </span>/home/student/.ansible/collections/ansible_collections
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#projects-cloud-automation-aws-project-__codelineno-4-3"></a><span class="go">Collection        Version</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#projects-cloud-automation-aws-project-__codelineno-4-4"></a><span class="go">----------------- -------</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#projects-cloud-automation-aws-project-__codelineno-4-5"></a><span class="go">ansible.posix     1.4.0  </span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#projects-cloud-automation-aws-project-__codelineno-4-6"></a><span class="go">community.docker  2.7.0  </span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#projects-cloud-automation-aws-project-__codelineno-4-7"></a><span class="go">community.general 5.3.0</span>
</span></code></pre></div>
<h3 id="projects-cloud-automation-aws-project-step-2-prepare-project">Step 2 - Prepare project</h3>
<p>Create a new project folder in your home directory:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#projects-cloud-automation-aws-project-__codelineno-5-1"></a><span class="gp">[student@ansible-1 ~]$ </span>mkdir<span class="w"> </span>aws-automation
</span></code></pre></div>
<p>Within your newly created project folder, create a playbook file.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You have to instruct Ansible to communicate with the <abbr title="Amazon Web Services">AWS</abbr> <abbr title="Application Programming Interface">API</abbr>, per default Ansible would try to communicate via <abbr title="Secure Shell">SSH</abbr>. This will not work. Set the target of your playbook to your <em>local machine</em>.  </p>
</div>
<p>The documentation provides an <a href="https://docs.ansible.com/ansible/latest/scenario_guides/guide_aci.html" target="_blank">extensive Guide</a> for <abbr title="Amazon Web Services">AWS</abbr> automation which can help you setting up everything.
For successful communication with the <abbr title="Amazon Web Services">AWS</abbr> <abbr title="Application Programming Interface">API</abbr>, you need to authenticate yourself, this is where your previously created Access key is needed.  </p>
<p>You can either specify your credentials as module arguments (you'll need to repeat them with <strong>every</strong> module) or as <em>environment variables</em>. The first variant would require you to set the credentials in variables (which need to be encrypted, this can be achieved with <em>ansible-vault</em>). Let's use the method with environment variables, this eases the first steps and is also applicable if you would run your playbook in the <a href="https://docs.ansible.com/automation-controller/latest/html/userguide/credentials.html#amazon-web-services" target="_blank">Ansible Automation Platform</a>.</p>
<p>Set the environment variables on the <abbr title="Command-Line Interface">CLI</abbr>:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#projects-cloud-automation-aws-project-__codelineno-6-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span><span class="s1">&#39;AK123&#39;</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#projects-cloud-automation-aws-project-__codelineno-6-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span><span class="s1">&#39;abc123&#39;</span>
</span></code></pre></div>
<p>Environment variables are only set in the current session, if you close your terminal, you'll need to set them again. To remember this, you could include this optional task as the first in your playbook which asserts that the variables are set. If the variables are missing, it will fail the playbook with a hint on what to do:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#projects-cloud-automation-aws-project-__codelineno-7-1"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ensure AWS credentials are set</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#projects-cloud-automation-aws-project-__codelineno-7-2"></a><span class="w">  </span><span class="nt">ansible.builtin.assert</span><span class="p">:</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#projects-cloud-automation-aws-project-__codelineno-7-3"></a><span class="w">  </span><span class="nt">that</span><span class="p">:</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#projects-cloud-automation-aws-project-__codelineno-7-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_env.AWS_ACCESS_KEY_ID is defined</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#projects-cloud-automation-aws-project-__codelineno-7-5"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_env.AWS_SECRET_ACCESS_KEY is defined</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#projects-cloud-automation-aws-project-__codelineno-7-6"></a><span class="w">  </span><span class="nt">quiet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#projects-cloud-automation-aws-project-__codelineno-7-7"></a><span class="w">  </span><span class="nt">fail_msg</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#projects-cloud-automation-aws-project-__codelineno-7-8"></a><span class="w">    </span><span class="no">No environment variables with AWS credentials found!</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#projects-cloud-automation-aws-project-__codelineno-7-9"></a><span class="w">    </span><span class="no">Set the variables with:</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#projects-cloud-automation-aws-project-__codelineno-7-10"></a><span class="w">      </span><span class="no">export AWS_ACCESS_KEY_ID=&#39;AK123&#39;</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#projects-cloud-automation-aws-project-__codelineno-7-11"></a><span class="w">      </span><span class="no">export AWS_SECRET_ACCESS_KEY=&#39;abc123&#39;</span>
</span></code></pre></div>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p><strong>Your bash history reveals the <abbr title="Command-Line Interface">CLI</abbr> input and your credentials!</strong><br />
You can delete the respective entry with <code>history -d &lt;position&gt;</code>.</p>
</div>
<details class="tip">
<summary>Alternative solution</summary>
<p>You can set your credentials in a hidden file <code>~/.aws/credentials</code> in your home directory in an <em>ini</em> file:</p>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#projects-cloud-automation-aws-project-__codelineno-8-1"></a><span class="k">[workshop]</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#projects-cloud-automation-aws-project-__codelineno-8-2"></a><span class="na">aws_access_key_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">YOUR_AWS_ACCESS_KEY_ID</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#projects-cloud-automation-aws-project-__codelineno-8-3"></a><span class="na">aws_secret_access_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">YOUR_AWS_SECRET_ACCESS_KEY</span>
</span></code></pre></div>
<p>The <em>section</em> represents a credential profile which needs to be added to every module with the key-value-pair <code>aws_profile: profile_name</code>, in our example with <code>aws_profile: workshop</code>.</p>
<p>Note, this solution also does not store the credentials in an encrypted way! Everybody with access to your home directory would be able to read your credentials!<br />
In production, its best to use an external credential provider. In the Ansible Automation platform you can store your variables in an encrypted database or use multiple credential provider plugins.</p>
</details>
<p>Testing the successful communication with the <abbr title="Application Programming Interface">API</abbr> could be done by querying information about an <abbr title="Eleastic Compute Cloud">EC2</abbr> <abbr title="Amazon Machine Image">AMI</abbr> Image. Find an appropriate module, create your playbook and add a task. Try to gather information about the following <abbr title="Amazon Machine Image">AMI</abbr>, you can copy the content with a button:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#projects-cloud-automation-aws-project-__codelineno-9-1"></a>ami-06c39ed6b42908a36
</span></code></pre></div>
<p>The <abbr title="Amazon Machine Image">AMI</abbr> is available in the <em>eu-central-1</em> region, you may to define this in the module you've chosen.  </p>
<p>Run your playbook, if it returns a green <em>ok</em> status, communication is established. For now, the gathered information about the <abbr title="Amazon Machine Image">AMI</abbr> is not relevant for us, still, you could store the output in a variable and output it with an appropriate module, if you are curious.</p>
<p>Achieve the following tasks:</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Playbook created</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Successful communication with <abbr title="Amazon Web Services">AWS</abbr> established</li>
</ul>
<h3 id="projects-cloud-automation-aws-project-step-3-create-ssh-key-pair">Step 3 - Create <abbr title="Secure Shell">SSH</abbr> key-pair</h3>
<p>In a later step, we will create <abbr title="Eleastic Compute Cloud">EC2</abbr> instances. To be able to login to these hosts, we need a <abbr title="Secure Shell">SSH</abbr> key-pair. Let's create a dedicated key, this can be achieved with the module <code>openssh_keypair</code>.
The module is not part of the <em>ansible.builtin</em> collection, try to find the collection where the module is stored (Tip: Use the search field in the documentation). When you found the correct collection, install it with the <code>ansible-galaxy collection install</code> command.</p>
<p>Add a task to your playbook which creates a key-pair in the default folder in your home directory (<code>~/.ssh</code>). The key should be called <code>workshop</code>, the module will create a private key with this name and a public key with the name <code>workshop.pub</code>. The home directory of the user running the playbook is stored in the fact <code>ansible_env.HOME</code>, use this as a variable and append <code>/.ssh/workshop</code>.  </p>
<div class="admonition success">
<p class="admonition-title">Success</p>
<p>Use a key size of <strong>2048 bits</strong>!</p>
</div>
<p>Now, lets create the <abbr title="Eleastic Compute Cloud">EC2</abbr> key-pair named <code>workshop</code> in <abbr title="Amazon Web Services">AWS</abbr> with our playbook.<br />
Find the correct module and provide the <strong>public</strong> key created by the previous task.<br />
You can access the content of the public key with a <em>lookup</em> plugin:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#projects-cloud-automation-aws-project-__codelineno-10-1"></a><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;file&#39;,</span><span class="nv"> </span><span class="s">ansible_env.HOME</span><span class="nv"> </span><span class="s">+</span><span class="nv"> </span><span class="s">&#39;/.ssh/workshop.pub&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></div>
<p>Achieve the following tasks:</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Collection with module <code>openssh_keypair</code> found and installed</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Added task to create key pair with 2048 bits</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Added task to create new <abbr title="Amazon Web Services">AWS</abbr> <abbr title="Eleastic Compute Cloud">EC2</abbr> keypair using public key of previously created local keypair</li>
</ul>
<h3 id="projects-cloud-automation-aws-project-step-4-get-default-vpc">Step 4 - Get default <abbr title="Amazon Virtual Private Cloud">VPC</abbr></h3>
<p>A <abbr title="Amazon Web Services">AWS</abbr> Virtual Private Cloud should already be configured for you, lets use this for our workshop. We need to get the ID of the default <abbr title="Amazon Virtual Private Cloud">VPC</abbr> net, this can be achieved with Ansible as well.<br />
Find the correct module to gather information about <abbr title="Eleastic Compute Cloud">EC2</abbr> VPCs and add it to your playbook. Add the following parameters:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#projects-cloud-automation-aws-project-__codelineno-11-1"></a><span class="nt">region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eu-central-1</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#projects-cloud-automation-aws-project-__codelineno-11-2"></a><span class="nt">filters</span><span class="p">:</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#projects-cloud-automation-aws-project-__codelineno-11-3"></a><span class="w">  </span><span class="s">&quot;is-default&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span></code></pre></div>
<p>Store the output of the module in a variable, e.g. <code>vpc_info</code>. Afterwards, add the following task which sets a fact/variable with the ID of your default <abbr title="Amazon Virtual Private Cloud">VPC</abbr>:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#projects-cloud-automation-aws-project-__codelineno-12-1"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set variable with ID of default VPC</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#projects-cloud-automation-aws-project-__codelineno-12-2"></a><span class="w">  </span><span class="nt">set_fact</span><span class="p">:</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#projects-cloud-automation-aws-project-__codelineno-12-3"></a><span class="w">    </span><span class="nt">default_vpc_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">vpc_info.vpcs.0.vpc_id</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></div>
<p>The variable <code>vpc_info</code> contains a list <code>vpcs</code>. As we filtered for the default <abbr title="Amazon Virtual Private Cloud">VPC</abbr>, the list only contains one element, therefore we can access the list item with <code>0</code>. The list item contains a key <code>vpc_id</code>, the value is what we are looking for.</p>
<p>Achieve the following tasks:</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Module for gathering <abbr title="Amazon Virtual Private Cloud">VPC</abbr> info identified and used</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> <em>set_fact</em> Task returns green "ok" status</li>
</ul>
<p>If you are curious, add another task which debugs the variable to <em>stdout</em>.</p>
<h3 id="projects-cloud-automation-aws-project-step-5-create-security-group">Step 5 - Create Security group</h3>
<p>We need to create a security group and add a rule for incoming <abbr title="Secure Shell">SSH</abbr> access to be able to login to our <abbr title="Eleastic Compute Cloud">EC2</abbr> instance later.
Find the correct module and add a task, provide the following parameter:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td><em>workshop-sg</em></td>
<td>The name of the Security group</td>
</tr>
<tr>
<td>description</td>
<td><em>Security group created by Ansible</em></td>
<td>Short description</td>
</tr>
<tr>
<td>vpc_id</td>
<td><em>"{{ default_vpc_id }}"</em></td>
<td>The value of your variable <code>default_vpc_id</code></td>
</tr>
<tr>
<td>region</td>
<td><em>eu-central-1</em></td>
<td>The region we used in all other tasks</td>
</tr>
</tbody>
</table>
<p>The <code>rules</code> parameter must hold a list, in our case a single rule is enough. Find the correct rule parameters and use the following values:</p>
<ul>
<li>Protocol: <em>TCP</em></li>
<li>From: <em>22</em></li>
<li>To: <em>22</em></li>
<li>CIDR: <em>0.0.0.0/0</em></li>
</ul>
<p>Run your playbook.</p>
<p>Achieve the following tasks:</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Module for maintaining security groups identified and used</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Security group successfully created</li>
</ul>
<h3 id="projects-cloud-automation-aws-project-step-6-create-ec2-instance">Step 6 - Create <abbr title="Eleastic Compute Cloud">EC2</abbr> instance</h3>
<p>Now it's finally time to create a virtual machine in <abbr title="Amazon Web Services">AWS</abbr>.<br />
Find the appropriate module and add a task to your playbook, your instance should have the following configuration (this time it is up to you to find the correct key-value-pairs):</p>
<ul>
<li>Must be called <code>workshop-instance1</code></li>
<li>Must be created in <code>eu-central-1</code></li>
<li>Must have a public IP address</li>
<li>Must have the <code>workshop</code> key assigned</li>
<li>Must have the size <code>t2.micro</code></li>
<li>Must be in the security group <code>workshop-sg</code></li>
<li>Must use the <abbr title="Amazon Machine Image">AMI</abbr> <code>ami-06c39ed6b42908a36</code></li>
<li>Should have the tag <code>Environment: Testing</code> attached</li>
</ul>
<p>Choose the right value for the <code>state</code> parameter, your playbook should wait for a <em>running</em> instance!</p>
<p>Achieve the following task:</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Running <abbr title="Eleastic Compute Cloud">EC2</abbr> instance</li>
</ul>
<h3 id="projects-cloud-automation-aws-project-step-7-get-dns-name-and-login">Step 7 - Get <abbr title="Domain Name System">DNS</abbr> name and login</h3>
<p>Find a module to gather information about your <abbr title="Eleastic Compute Cloud">EC2</abbr> instances in your region, use the filter <code>"tag:Name": workshop-instance1</code> to only get this single instance.<br />
Store the output of the module into a variable and use the variable in another task which <em>debugs</em> only the <em>public <abbr title="Domain Name System">DNS</abbr> name</em> of your previously created <abbr title="Eleastic Compute Cloud">EC2</abbr> instance.</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#projects-cloud-automation-aws-project-__codelineno-13-1"></a><span class="go">TASK [Output public DNS name of workshop-instance1] ****************************************************************************************************************</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#projects-cloud-automation-aws-project-__codelineno-13-2"></a><span class="go">ok: [localhost] =&gt;</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#projects-cloud-automation-aws-project-__codelineno-13-3"></a><span class="go">  msg: ec2-3-70-238-39.eu-central-1.compute.amazonaws.com</span>
</span></code></pre></div>
<p>Copy the output of your task and login to your <abbr title="Eleastic Compute Cloud">EC2</abbr> instance with <abbr title="Secure Shell">SSH</abbr>. Provide the <em>private</em> key and use the user <code>ec2-user</code>, for example:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#projects-cloud-automation-aws-project-__codelineno-14-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ssh<span class="w"> </span>-i<span class="w"> </span>~/.ssh/workshop<span class="w"> </span>ec2-user@ec2-3-70-238-39.eu-central-1.compute.amazonaws.com
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#projects-cloud-automation-aws-project-__codelineno-14-2"></a><span class="go">Last login: Sat Feb 11 13:27:56 2023 from ec2-3-71-15-149.eu-central-1.compute.amazonaws.com</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#projects-cloud-automation-aws-project-__codelineno-14-3"></a>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#projects-cloud-automation-aws-project-__codelineno-14-4"></a><span class="go">       __|  __|_  )</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#projects-cloud-automation-aws-project-__codelineno-14-5"></a><span class="go">       _|  (     /   Amazon Linux 2 AMI</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#projects-cloud-automation-aws-project-__codelineno-14-6"></a><span class="go">      ___|\___|___|</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#projects-cloud-automation-aws-project-__codelineno-14-7"></a>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#projects-cloud-automation-aws-project-__codelineno-14-8"></a><span class="go">https://aws.amazon.com/amazon-linux-2/</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#projects-cloud-automation-aws-project-__codelineno-14-9"></a><span class="go">16 package(s) needed for security, out of 16 available</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#projects-cloud-automation-aws-project-__codelineno-14-10"></a><span class="go">Run &quot;sudo yum update&quot; to apply all updates.</span>
</span></code></pre></div>
<p>Achieve the following tasks:</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Added task to gather information about <abbr title="Eleastic Compute Cloud">EC2</abbr> instances</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Added task to output public <abbr title="Domain Name System">DNS</abbr> name of instance</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Successful <abbr title="Secure Shell">SSH</abbr> login to <abbr title="Eleastic Compute Cloud">EC2</abbr> instance</li>
</ul>
<div class="admonition success">
<p class="admonition-title">Success</p>
<p>Awesome, you created a virtual machine in the Cloud and are able to login!</p>
</div>
<h2 id="projects-cloud-automation-aws-project-optional">Optional</h2>
<h3 id="projects-cloud-automation-aws-project-step-1-create-multiple-ec2-instances">Step 1 - Create multiple <abbr title="Eleastic Compute Cloud">EC2</abbr> instances</h3>
<p>In <em>Step 5</em> you created a single <abbr title="Eleastic Compute Cloud">EC2</abbr> instance, adjust your task to create multiple instances in a loop. The <em>name</em> of every instance must differ, as well as the <code>Environment</code> tag.<br />
Create three instances with the single task, with the instance being in the given <em>Environment</em> :</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Environment (Tag)</th>
</tr>
</thead>
<tbody>
<tr>
<td>workshop-instance1</td>
<td><em>Testing</em></td>
</tr>
<tr>
<td>workshop-instance2</td>
<td><em>Testing</em></td>
</tr>
<tr>
<td>workshop-instance3</td>
<td><em>Production</em></td>
</tr>
</tbody>
</table>
<p>Run your playbook, you should see two more instances being created.</p>
<p>Achieve the following task:</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Adjusted task to create three <abbr title="Eleastic Compute Cloud">EC2</abbr> instances <code>workshop-instance[1-3]</code></li>
</ul>
<h3 id="projects-cloud-automation-aws-project-step-2-create-dynamic-inventory">Step 2 - Create dynamic inventory</h3>
<p>When using Ansible with <abbr title="Amazon Web Services">AWS</abbr>, inventory file maintenance will be a hectic task as <abbr title="Amazon Web Services">AWS</abbr> frequently changes IPs, autoscaling instances, and more. Once your <abbr title="Amazon Web Services">AWS</abbr> <abbr title="Eleastic Compute Cloud">EC2</abbr> hosts are spun up, you’ll probably want to talk to them again. With a cloud setup, it’s best not to maintain a static list of cloud hostnames in text files. Rather, the best way to handle this is to use the <code>aws_ec2</code> dynamic inventory plugin.  </p>
<p>Create a file <code>workshop.aws_ec2.yml</code></p>
<p>The inventory should have two additional groups <code>test_stage</code> and <code>prod_stage</code>. The hosts have a tag <code>Environment</code> with either <code>Testing</code> or <code>Production</code>, ensure that they are part of the correct group.<br />
You can test your inventory with the <code>ansible-inventory</code> <abbr title="Command-Line Interface">CLI</abbr> utility, it outputs a <abbr title="JavaScript Object Notation">JSON</abbr> representation of how Ansible sees your provided inventory.</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#projects-cloud-automation-aws-project-__codelineno-15-1"></a><span class="gp">[student@ansible-1 aws-automation]$ </span>ansible-inventory<span class="w"> </span>-i<span class="w"> </span>demo.aws_ec2.yml<span class="w"> </span>--list
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#projects-cloud-automation-aws-project-__codelineno-15-2"></a><span class="go">{</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#projects-cloud-automation-aws-project-__codelineno-15-3"></a><span class="go">    &quot;_meta&quot;: {</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#projects-cloud-automation-aws-project-__codelineno-15-4"></a><span class="go">        [..Cut for better readability..]</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#projects-cloud-automation-aws-project-__codelineno-15-5"></a><span class="go">    }</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#projects-cloud-automation-aws-project-__codelineno-15-6"></a><span class="go">    &quot;all&quot;: {</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#projects-cloud-automation-aws-project-__codelineno-15-7"></a><span class="go">        &quot;children&quot;: [</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#projects-cloud-automation-aws-project-__codelineno-15-8"></a><span class="go">            &quot;aws_ec2&quot;,</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#projects-cloud-automation-aws-project-__codelineno-15-9"></a><span class="go">            &quot;prod_stage&quot;,</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#projects-cloud-automation-aws-project-__codelineno-15-10"></a><span class="go">            &quot;test_stage&quot;,</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#projects-cloud-automation-aws-project-__codelineno-15-11"></a><span class="go">            &quot;ungrouped&quot;</span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#projects-cloud-automation-aws-project-__codelineno-15-12"></a><span class="go">        ]</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#projects-cloud-automation-aws-project-__codelineno-15-13"></a><span class="go">    },</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#projects-cloud-automation-aws-project-__codelineno-15-14"></a><span class="go">    &quot;aws_ec2&quot;: {</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#projects-cloud-automation-aws-project-__codelineno-15-15"></a><span class="go">        &quot;hosts&quot;: [</span>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#projects-cloud-automation-aws-project-__codelineno-15-16"></a><span class="go">            &quot;ec2-18-185-94-35.eu-central-1.compute.amazonaws.com&quot;,</span>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#projects-cloud-automation-aws-project-__codelineno-15-17"></a><span class="go">            &quot;ec2-3-126-92-75.eu-central-1.compute.amazonaws.com&quot;,</span>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#projects-cloud-automation-aws-project-__codelineno-15-18"></a><span class="go">            &quot;ec2-3-70-238-39.eu-central-1.compute.amazonaws.com&quot;</span>
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#projects-cloud-automation-aws-project-__codelineno-15-19"></a><span class="go">        ]</span>
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20" href="#projects-cloud-automation-aws-project-__codelineno-15-20"></a><span class="go">    },</span>
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21" href="#projects-cloud-automation-aws-project-__codelineno-15-21"></a><span class="go">    &quot;prod_stage&quot;: {</span>
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22" href="#projects-cloud-automation-aws-project-__codelineno-15-22"></a><span class="go">        &quot;hosts&quot;: [</span>
</span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23" href="#projects-cloud-automation-aws-project-__codelineno-15-23"></a><span class="go">            &quot;ec2-18-185-94-35.eu-central-1.compute.amazonaws.com&quot;</span>
</span><span id="__span-15-24"><a id="__codelineno-15-24" name="__codelineno-15-24" href="#projects-cloud-automation-aws-project-__codelineno-15-24"></a><span class="go">        ]</span>
</span><span id="__span-15-25"><a id="__codelineno-15-25" name="__codelineno-15-25" href="#projects-cloud-automation-aws-project-__codelineno-15-25"></a><span class="go">    },</span>
</span><span id="__span-15-26"><a id="__codelineno-15-26" name="__codelineno-15-26" href="#projects-cloud-automation-aws-project-__codelineno-15-26"></a><span class="go">    &quot;test_stage&quot;: {</span>
</span><span id="__span-15-27"><a id="__codelineno-15-27" name="__codelineno-15-27" href="#projects-cloud-automation-aws-project-__codelineno-15-27"></a><span class="go">        &quot;hosts&quot;: [</span>
</span><span id="__span-15-28"><a id="__codelineno-15-28" name="__codelineno-15-28" href="#projects-cloud-automation-aws-project-__codelineno-15-28"></a><span class="go">            &quot;ec2-3-126-92-75.eu-central-1.compute.amazonaws.com&quot;,</span>
</span><span id="__span-15-29"><a id="__codelineno-15-29" name="__codelineno-15-29" href="#projects-cloud-automation-aws-project-__codelineno-15-29"></a><span class="go">            &quot;ec2-3-70-238-39.eu-central-1.compute.amazonaws.com&quot;</span>
</span><span id="__span-15-30"><a id="__codelineno-15-30" name="__codelineno-15-30" href="#projects-cloud-automation-aws-project-__codelineno-15-30"></a><span class="go">        ]</span>
</span><span id="__span-15-31"><a id="__codelineno-15-31" name="__codelineno-15-31" href="#projects-cloud-automation-aws-project-__codelineno-15-31"></a><span class="go">    }</span>
</span><span id="__span-15-32"><a id="__codelineno-15-32" name="__codelineno-15-32" href="#projects-cloud-automation-aws-project-__codelineno-15-32"></a><span class="go">}</span>
</span></code></pre></div>
<p>You need to set some <a href="https://docs.ansible.com/ansible/latest/collections/amazon/aws/docsite/aws_ec2_guide.html#compose" target="_blank">Ansible connection variables</a>, remember, direct <abbr title="Secure Shell">SSH</abbr> connection also only worked when providing the <abbr title="Secure Shell">SSH</abbr> private key and the target user.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The documentation has a typo, the variable for the <abbr title="Secure Shell">SSH</abbr> private key file is <strong>not</strong> <code>ansible_private_ssh_key_file</code> but <code>ansible_ssh_private_key_file</code>!</p>
</div>
<p>When you finished your inventory, use this playbook to test the connection:</p>
<div class="language-yaml highlight"><span class="filename">test.yml</span><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#projects-cloud-automation-aws-project-__codelineno-16-1"></a><span class="nn">---</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#projects-cloud-automation-aws-project-__codelineno-16-2"></a>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#projects-cloud-automation-aws-project-__codelineno-16-3"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Playbook targeting hosts from dynamic inventory</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#projects-cloud-automation-aws-project-__codelineno-16-4"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test_stage</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#projects-cloud-automation-aws-project-__codelineno-16-5"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#projects-cloud-automation-aws-project-__codelineno-16-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Try to reach hosts</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#projects-cloud-automation-aws-project-__codelineno-16-7"></a><span class="w">      </span><span class="nt">ansible.builtin.ping</span><span class="p">:</span>
</span></code></pre></div>
<p>Running the playbook (and providing the inventory!) results in the following output:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#projects-cloud-automation-aws-project-__codelineno-17-1"></a><span class="gp">[student@ansible-1 aws-automation]$ </span>ansible-playbook<span class="w"> </span>-i<span class="w"> </span>workshop.aws_ec2.yml<span class="w"> </span>test.yml
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#projects-cloud-automation-aws-project-__codelineno-17-2"></a>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#projects-cloud-automation-aws-project-__codelineno-17-3"></a><span class="go">PLAY [Playbook targeting hosts from dynamic inventory] ***************************************************************************************************************</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#projects-cloud-automation-aws-project-__codelineno-17-4"></a>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#projects-cloud-automation-aws-project-__codelineno-17-5"></a><span class="go">TASK [Gathering Facts] ***********************************************************************************************************************************************</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#projects-cloud-automation-aws-project-__codelineno-17-6"></a><span class="go">ok: [ec2-3-70-238-39.eu-central-1.compute.amazonaws.com]</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#projects-cloud-automation-aws-project-__codelineno-17-7"></a><span class="go">ok: [ec2-3-126-92-75.eu-central-1.compute.amazonaws.com]</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#projects-cloud-automation-aws-project-__codelineno-17-8"></a>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#projects-cloud-automation-aws-project-__codelineno-17-9"></a><span class="go">TASK [Try to reach hosts] ********************************************************************************************************************************************</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#projects-cloud-automation-aws-project-__codelineno-17-10"></a><span class="go">ok: [ec2-3-126-92-75.eu-central-1.compute.amazonaws.com]</span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#projects-cloud-automation-aws-project-__codelineno-17-11"></a><span class="go">ok: [ec2-3-70-238-39.eu-central-1.compute.amazonaws.com]</span>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#projects-cloud-automation-aws-project-__codelineno-17-12"></a>
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#projects-cloud-automation-aws-project-__codelineno-17-13"></a><span class="go">PLAY RECAP ***********************************************************************************************************************************************************</span>
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#projects-cloud-automation-aws-project-__codelineno-17-14"></a><span class="go">ec2-3-126-92-75.eu-central-1.compute.amazonaws.com : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0  </span>
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#projects-cloud-automation-aws-project-__codelineno-17-15"></a><span class="go">ec2-3-70-238-39.eu-central-1.compute.amazonaws.com : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0  </span>
</span></code></pre></div>
<details class="question">
<summary>Help wanted?</summary>
<p>Authentication is done here with the credentials stored in <code>~/.aws/credentials</code></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#projects-cloud-automation-aws-project-__codelineno-18-1"></a><span class="c1"># demo.aws_ec2.yml</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#projects-cloud-automation-aws-project-__codelineno-18-2"></a><span class="nt">plugin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">amazon.aws.aws_ec2</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#projects-cloud-automation-aws-project-__codelineno-18-3"></a>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#projects-cloud-automation-aws-project-__codelineno-18-4"></a><span class="nt">aws_profile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">workshop</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#projects-cloud-automation-aws-project-__codelineno-18-5"></a>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#projects-cloud-automation-aws-project-__codelineno-18-6"></a><span class="nt">regions</span><span class="p">:</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#projects-cloud-automation-aws-project-__codelineno-18-7"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eu-central-1</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#projects-cloud-automation-aws-project-__codelineno-18-8"></a>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#projects-cloud-automation-aws-project-__codelineno-18-9"></a><span class="nt">groups</span><span class="p">:</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#projects-cloud-automation-aws-project-__codelineno-18-10"></a><span class="w">  </span><span class="nt">test_stage</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&#39;Testing&#39;</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">tags.Environment&quot;</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#projects-cloud-automation-aws-project-__codelineno-18-11"></a><span class="w">  </span><span class="nt">prod_stage</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&#39;Production&#39;</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">tags.Environment&quot;</span>
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#projects-cloud-automation-aws-project-__codelineno-18-12"></a>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#projects-cloud-automation-aws-project-__codelineno-18-13"></a><span class="nt">filters</span><span class="p">:</span>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#projects-cloud-automation-aws-project-__codelineno-18-14"></a><span class="w">  </span><span class="nt">instance-state-name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">running</span>
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#projects-cloud-automation-aws-project-__codelineno-18-15"></a>
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16" href="#projects-cloud-automation-aws-project-__codelineno-18-16"></a><span class="nt">compose</span><span class="p">:</span>
</span><span id="__span-18-17"><a id="__codelineno-18-17" name="__codelineno-18-17" href="#projects-cloud-automation-aws-project-__codelineno-18-17"></a><span class="w">  </span><span class="nt">ansible_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">public_dns_name</span>
</span><span id="__span-18-18"><a id="__codelineno-18-18" name="__codelineno-18-18" href="#projects-cloud-automation-aws-project-__codelineno-18-18"></a><span class="w">  </span><span class="nt">ansible_ssh_private_key_file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">~/.ssh/workshop</span>
</span><span id="__span-18-19"><a id="__codelineno-18-19" name="__codelineno-18-19" href="#projects-cloud-automation-aws-project-__codelineno-18-19"></a><span class="w">  </span><span class="nt">ansible_user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ec2-user</span>
</span></code></pre></div>
</details>
<h2 id="projects-cloud-automation-aws-project-cleanup">Cleanup</h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When you are done, remember to <strong>clean up all created resources</strong> in <abbr title="Amazon Web Services">AWS</abbr> to prevent incurring costs!</p>
</div>
<p>You created the following resources in <abbr title="Amazon Web Services">AWS</abbr>:</p>
<ul>
<li><a href="https://eu-central-1.console.aws.amazon.com/ec2/home?region=eu-central-1#Instances:" target="_blank"><abbr title="Eleastic Compute Cloud">EC2</abbr> Instance(s)</a></li>
<li><a href="https://eu-central-1.console.aws.amazon.com/ec2/home?region=eu-central-1#SecurityGroups:" target="_blank">Security Group</a></li>
<li><a href="https://eu-central-1.console.aws.amazon.com/ec2/home?region=eu-central-1#KeyPairs:" target="_blank"><abbr title="Secure Shell">SSH</abbr> Keypair</a></li>
</ul>
<!-- markdownlint-disable --></section><section class="print-page" id="projects-dcim-ipam-automation-netbox-project"><h1 id="projects-dcim-ipam-automation-netbox-project-project-dcim-automation">Project - DCIM Automation</h1>
<p><strong>D</strong>ata<strong>c</strong>enter <strong>I</strong>nventory <strong>M</strong>anagement and IP Address Management are indispensable in today's large data centers. NetBox offers both functions including a versatile <abbr title="Application Programming Interface">API</abbr>.</p>
<figure>
<p><img alt="Netbox logo" src="../projects/dcim-ipam-automation/images/netbox-logo.png" />
  </p>
<figcaption></figcaption>
</figure>
<p>NetBox has curated a data model which caters specifically to the needs of network engineers and operators. It delivers a wide assortment of object types to best serve the needs of infrastructure design and documentation. These cover all facets of network technology, from IP address managements to cabling to overlays and more.</p>
<figure>
<p><img alt="Netbox UI overview" src="../projects/dcim-ipam-automation/images/netbox-ui.png" width="500" />
  </p>
<figcaption></figcaption>
</figure>
<h2 id="projects-dcim-ipam-automation-netbox-project-objective">Objective</h2>
<p>Create an Ansible project <em>from scratch</em>, automate against an <abbr title="Application Programming Interface">API</abbr> and make use of an Ansible <em>dynamic inventory</em>.</p>
<h2 id="projects-dcim-ipam-automation-netbox-project-guide">Guide</h2>
<h3 id="projects-dcim-ipam-automation-netbox-project-step-1-prepare-project">Step 1 - Prepare project</h3>
<p>Create a new project folder in your home directory:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#projects-dcim-ipam-automation-netbox-project-__codelineno-0-1"></a><span class="gp">[student@ansible-1 ~]$ </span>mkdir<span class="w"> </span>netbox-automation
</span></code></pre></div>
<p>We will be using a Netbox Demo available online.</p>
<p>Open a new browser tab and go to <a href="https://demo.netbox.dev/" target="_blank">https://demo.netbox.dev/</a>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can create <a href="https://demo.netbox.dev/plugins/demo/login/" target="_blank">personal login credentials</a> yourself. Once logged in, you can create an <a href="https://demo.netbox.dev/user/api-tokens/add/" target="_blank"><abbr title="Application Programming Interface">API</abbr> token</a> which you will need for your automation tasks. Either use the link or click on your username in the upper right corner of the Netbox <abbr title="User Interface">UI</abbr> and select <em><abbr title="Application Programming Interface">API</abbr> Tokens</em> from the dropdown menu.</p>
</div>
<p>Today, you'll need additional Ansible modules. In the first part of the workshop, we only used a handful of modules which are all included in the <code>ansible-core</code> binary. With <em>ansible-core</em> only 69 of the most used modules are included:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#projects-dcim-ipam-automation-netbox-project-__codelineno-1-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible-doc<span class="w"> </span>-l
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#projects-dcim-ipam-automation-netbox-project-__codelineno-1-2"></a><span class="go">add_host               Add a host (and alternatively a group) to the ansible-playbook in-memory inventory  </span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#projects-dcim-ipam-automation-netbox-project-__codelineno-1-3"></a><span class="go">apt                    Manages apt-packages  </span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#projects-dcim-ipam-automation-netbox-project-__codelineno-1-4"></a><span class="go">apt_key                Add or remove an apt key  </span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#projects-dcim-ipam-automation-netbox-project-__codelineno-1-5"></a><span class="go">apt_repository         Add and remove APT repositories  </span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#projects-dcim-ipam-automation-netbox-project-__codelineno-1-6"></a><span class="go">assemble               Assemble configuration files from fragments  </span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#projects-dcim-ipam-automation-netbox-project-__codelineno-1-7"></a><span class="go">assert                 Asserts given expressions are true  </span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#projects-dcim-ipam-automation-netbox-project-__codelineno-1-8"></a><span class="go">async_status           Obtain status of asynchronous task  </span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#projects-dcim-ipam-automation-netbox-project-__codelineno-1-9"></a><span class="go">blockinfile            Insert/update/remove a text block surrounded by marker lines  </span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#projects-dcim-ipam-automation-netbox-project-__codelineno-1-10"></a><span class="go">command                Execute commands on targets  </span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#projects-dcim-ipam-automation-netbox-project-__codelineno-1-11"></a><span class="go">copy                   Copy files to remote locations</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#projects-dcim-ipam-automation-netbox-project-__codelineno-1-12"></a><span class="go">...</span>
</span></code></pre></div>
<p>Additional modules are installed through <em>collections</em>, search the <a href="https://docs.ansible.com/ansible/latest/collections/index.html" target="_blank">Collection Index</a> in the Ansible documentation for a module or use the search field.</p>
<p><img alt="Ansible documentation" src="../projects/network-automation/images/ansible-docs.png" /></p>
<p>If, for example, you want to create an <abbr title="Eleastic Compute Cloud">EC2</abbr> instance in <abbr title="Amazon Web Services">AWS</abbr>, you will need the module <code>amazon.aws.ec2_instance</code>. To get the module, you'll need the collection <code>aws</code> of the provider <code>amazon</code>. Download the collection with the <code>ansible-galaxy</code> utility:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#projects-dcim-ipam-automation-netbox-project-__codelineno-2-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible-galaxy<span class="w"> </span>collection<span class="w"> </span>install<span class="w"> </span>amazon.aws
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#projects-dcim-ipam-automation-netbox-project-__codelineno-2-2"></a><span class="go">Starting galaxy collection install process</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#projects-dcim-ipam-automation-netbox-project-__codelineno-2-3"></a><span class="go">Process install dependency map</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#projects-dcim-ipam-automation-netbox-project-__codelineno-2-4"></a><span class="go">Starting collection install process</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#projects-dcim-ipam-automation-netbox-project-__codelineno-2-5"></a><span class="go">Downloading https://galaxy.ansible.com/download/amazon-aws-3.2.0.tar.gz to /home/student/.ansible/tmp/ansible-local-55382m3kkt4we/tmp7b2kxag4/amazon-aws-3.2.0-3itpmahr</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#projects-dcim-ipam-automation-netbox-project-__codelineno-2-6"></a><span class="go">Installing &#39;amazon.aws:3.2.0&#39; to &#39;/home/student/.ansible/collections/ansible_collections/amazon/aws&#39;</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#projects-dcim-ipam-automation-netbox-project-__codelineno-2-7"></a><span class="go">amazon.aws:3.2.0 was installed successfully</span>
</span></code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Well, you won't need the <abbr title="Amazon Web Services">AWS</abbr> collection, but automating the Netbox with Ansible also requires additional modules, these are not included in the <code>ansible-core</code> binary and need to be installed with Ansible Galaxy.</p>
</div>
<p>Achieve the following tasks:</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Find appropriate collection for Netbox automation in the documentation</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Collection installed</li>
</ul>
<p>You can view the installed collections with this command:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#projects-dcim-ipam-automation-netbox-project-__codelineno-3-1"></a><span class="gp">[student@ansible-1 netbox-automation]$ </span>ansible-galaxy<span class="w"> </span>collection<span class="w"> </span>list
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#projects-dcim-ipam-automation-netbox-project-__codelineno-3-2"></a><span class="gp"># </span>/home/student/.ansible/collections/ansible_collections
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#projects-dcim-ipam-automation-netbox-project-__codelineno-3-3"></a><span class="go">Collection        Version</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#projects-dcim-ipam-automation-netbox-project-__codelineno-3-4"></a><span class="go">----------------- -------</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#projects-dcim-ipam-automation-netbox-project-__codelineno-3-5"></a><span class="go">ansible.posix     1.4.0  </span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#projects-dcim-ipam-automation-netbox-project-__codelineno-3-6"></a><span class="go">community.docker  2.7.0  </span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#projects-dcim-ipam-automation-netbox-project-__codelineno-3-7"></a><span class="go">community.general 5.3.0</span>
</span></code></pre></div>
<h3 id="projects-dcim-ipam-automation-netbox-project-step-2-inventory-and-playbook">Step 2 - Inventory and playbook</h3>
<p>Within your newly created project folder, create an inventory file and a playbook file.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You have to instruct Ansible to communicate with the Netbox <abbr title="Application Programming Interface">API</abbr>, by default Ansible would try to communicate via <abbr title="Secure Shell">SSH</abbr>. This will not work.<br />
Use the <abbr title="Application Programming Interface">API</abbr> token you created in the Netbox <abbr title="User Interface">UI</abbr>.</p>
</div>
<p>Testing the successful communication with the <abbr title="Application Programming Interface">API</abbr> could be done by querying all available tenants with the <code>nb_lookup</code> plugin. Take a look at the <a href="https://docs.ansible.com/ansible/latest/index.html" target="_blank">documentation</a> for how to use it, use the <em>search</em> to find it.<br />
Create your playbook and add a task with the <em>debug</em> module, utilizing the <em>lookup plugin</em>.<br />
In the documented example the loop uses the <a href="https://docs.ansible.com/ansible/latest/plugins/lookup.html#forcing-lookups-to-return-lists-query-and-wantlist-true" target="_blank">query</a> function, instead of <code>devices</code> search for <code>tenant</code>, the variable to output can be <code class="language-jinja highlight"><span class="cp">{{</span> <span class="nv">item.value.display</span> <span class="cp">}}</span></code> for the name of the respective tenant.<br />
Run your playbook, if it returns a green <em>ok</em> status, communication is established.</p>
<details class="question">
<summary>Help wanted?</summary>
<p>Use the following task to get a list of all already configured tenants.</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#projects-dcim-ipam-automation-netbox-project-__codelineno-4-1"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Obtain list of tenants from NetBox</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#projects-dcim-ipam-automation-netbox-project-__codelineno-4-2"></a><span class="w">  </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#projects-dcim-ipam-automation-netbox-project-__codelineno-4-3"></a><span class="w">    </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.value.display</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#projects-dcim-ipam-automation-netbox-project-__codelineno-4-4"></a><span class="w">  </span><span class="nt">loop</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">query(&#39;netbox.netbox.nb_lookup&#39;,</span><span class="nv"> </span><span class="s">&#39;tenants&#39;,</span><span class="nv"> </span><span class="s">api_endpoint=https://demo.netbox.dev/,</span><span class="nv"> </span><span class="s">token=YOUR_NETBOX_TOKEN)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#projects-dcim-ipam-automation-netbox-project-__codelineno-4-5"></a><span class="w">  </span><span class="nt">loop_control</span><span class="p">:</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#projects-dcim-ipam-automation-netbox-project-__codelineno-4-6"></a><span class="w">    </span><span class="nt">label</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ID:</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">item.key</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></div>
<p>The <em>loop_control</em> is not really necessary, but improves readability.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You need to input your personal <abbr title="Application Programming Interface">API</abbr> token.</p>
</div>
</details>
<p>Achieve the following tasks:</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Inventory and playbook created</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Use variables where possible (and useful)</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Successful communication with <abbr title="Application Programming Interface">API</abbr> established</li>
</ul>
<h3 id="projects-dcim-ipam-automation-netbox-project-step-3-create-a-new-tenant">Step 3 - Create a new Tenant</h3>
<p>Most core objects within NetBox's data model support tenancy. This is the association of an object with a particular tenant to convey ownership or dependency.</p>
<p>The goal is to create a new Netbox tenant with Ansible. The tenant should have the following properties, which can be set with the parameters of the appropriate module:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td><code>Demo Tenant &lt;Initials&gt;</code></td>
</tr>
<tr>
<td>slug</td>
<td><code>demo_tenant_&lt;initials&gt;</code></td>
</tr>
<tr>
<td>description</td>
<td><code>Workshop tenant</code></td>
</tr>
<tr>
<td>tenant_group</td>
<td><code>cc_workshop</code></td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Replace <code>&lt;Initials&gt;</code> with your personal initials to identify the objects later on.</p>
</div>
<p>Achieve the following tasks:</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Tenant created</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Tenant is part of <code>cc_workshop</code> tenant group</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Inspect tenant in the <abbr title="User Interface">UI</abbr></li>
</ul>
<h3 id="projects-dcim-ipam-automation-netbox-project-step-4-create-group-for-vms">Step 4 - Create group for VMs</h3>
<p>Let's add your three <em>managed nodes</em> to a logical group within Netbox. In the Netbox <abbr title="User Interface">UI</abbr>, click on <em>Virtualization</em>, here you can find <em>Clusters</em>.<br />
Find an appropriate module to create a cluster and set the following module parameters:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td><code>Demo Tenant &lt;Initials&gt; VMs</code></td>
</tr>
<tr>
<td>site</td>
<td><code>rh_demo_environment</code></td>
</tr>
<tr>
<td>cluster_type</td>
<td><code>Amazon Web Services</code></td>
</tr>
<tr>
<td>group</td>
<td><code>EMEA</code></td>
</tr>
</tbody>
</table>
<p>Achieve the following tasks:</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Cluster created</li>
</ul>
<h3 id="projects-dcim-ipam-automation-netbox-project-step-5-create-vms">Step 5 - Create VMs</h3>
<p>A virtual machine (VM) represents a virtual compute instance hosted within a cluster. Each VM must be assigned to a site and/or cluster.<br />
Let's create multiple virtual machine objects, one for every host in your inventory group <code>web</code>.<br />
As we need additional information about our VMs (number of vCPU cores, memory, disk space), add a task which <a href="https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_vars_facts.html#ansible-facts" target="_blank"><em>gathers facts</em></a> about your managed nodes. Find the appropriate module to do this, Ansible documentation shows you how to do this, the keyword here is <em>delegating facts</em>.</p>
<p>Once you gathered all facts about your managed nodes, add a task to create virtual machine objects in the Netbox with a loop, iterating over the <code>web</code> group of your inventory.<br />
Find the correct module, every VM object should use the following parameters:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
<th>Example (rendered to)</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td><code class="language-jinja highlight"><span class="x">&quot;</span><span class="cp">{{</span> <span class="nv">hostvars</span><span class="o">[</span><span class="nv">item</span><span class="o">][</span><span class="s1">&#39;ansible_fqdn&#39;</span><span class="o">]</span> <span class="cp">}}</span><span class="x">&quot;</span></code></td>
<td><em>node2.example.com</em></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>site</td>
<td><code>rh_demo_environment</code></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>cluster</td>
<td><code>Demo Tenant &lt;Initials&gt; VMs</code></td>
<td><em>Demo Tenant TG VMs</em></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>tenant</td>
<td><code>demo_tenant_&lt;initials&gt;</code></td>
<td><em>student2</em></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>platform</td>
<td><code class="language-jinja highlight"><span class="x">&quot;</span><span class="cp">{{</span> <span class="nv">hostvars</span><span class="o">[</span><span class="nv">item</span><span class="o">][</span><span class="s1">&#39;ansible_distribution&#39;</span><span class="o">]</span>               <span class="o">|</span> <span class="nf">lower</span> <span class="cp">}}</span><span class="x">_</span><span class="cp">{{</span> <span class="nv">hostvars</span><span class="o">[</span><span class="nv">item</span><span class="o">][</span><span class="s1">&#39;ansible_distribution_major_version&#39;</span><span class="o">]</span> <span class="cp">}}</span><span class="x">&quot;</span></code></td>
<td><em>Redhat 8</em></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>vcpus</td>
<td><code class="language-jinja highlight"><span class="x">&quot;</span><span class="cp">{{</span> <span class="nv">hostvars</span><span class="o">[</span><span class="nv">item</span><span class="o">][</span><span class="s1">&#39;ansible_processor_vcpus&#39;</span><span class="o">]</span> <span class="cp">}}</span><span class="x">&quot;</span></code></td>
<td><em>2</em></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>memory</td>
<td><code class="language-jinja highlight"><span class="x">&quot;</span><span class="cp">{{</span> <span class="nv">hostvars</span><span class="o">[</span><span class="nv">item</span><span class="o">][</span><span class="s1">&#39;ansible_memtotal_mb&#39;</span><span class="o">]</span> <span class="cp">}}</span><span class="x">&quot;</span></code></td>
<td><em>1024</em></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>disk</td>
<td><code class="language-jinja highlight"><span class="x">&quot;</span><span class="cp">{{</span> <span class="nv">hostvars</span><span class="o">[</span><span class="nv">item</span><span class="o">][</span><span class="s1">&#39;ansible_devices&#39;</span><span class="o">][</span><span class="s1">&#39;nvme0n1&#39;</span><span class="o">][</span><span class="s1">&#39;size&#39;</span><span class="o">]</span> <span class="o">|</span> <span class="nf">split</span><span class="o">(</span><span class="s1">&#39; &#39;</span><span class="o">)</span>                                                            <span class="o">|</span> <span class="nf">first</span>      <span class="o">|</span> <span class="nf">int</span> <span class="cp">}}</span><span class="x">&quot;</span></code></td>
<td><em>10</em></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>virtual_machine_role</td>
<td><code>application-server</code></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>status</td>
<td><code>Active</code></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Again, replace <code>&lt;initials&gt;</code> with your own Initials.</p>
</div>
<p>Achieve the following tasks:</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> VM objects for all managed nodes created</li>
</ul>
<!-- markdownlint-disable --></section><h1 class='nav-section-title-end'>Ended: Projects</h1>
                        <h1 class='nav-section-title' id='section-ansible-future'>
                            Ansible Future <a class='headerlink' href='#section-ansible-future' title='Permanent link'>↵</a>
                        </h1>
                        <section class="print-page" id="ansible-future-overview"><h1 id="ansible-future-overview-overview">Overview</h1>
<p>This section shows tools in the Ansible world which will become more and more relevant in the upcoming future. This includes:</p>
<ul>
<li>Ansible Navigator</li>
<li>Execution Environments</li>
<li>Ansible Builder</li>
</ul>
<figure>
<p><a href="http://github.com/ansible/logos"><img _="," alt="Ansible Logo"  src="../assets/images/ansible-birthday-bull.png" width="300" /></a>
  </p>
<figcaption></figcaption>
</figure>
<h2 id="ansible-future-overview-who-will-use-the-ansible-navigator">Who will use the Ansible navigator?</h2>
<p>The automation content navigator (or "Ansible Navigator") is mainly geared towards developers of automation. This can mean people creating automated tasks with available modules, those migrating roles into Collections or those who are developing modules from the ground up. Content navigator runs as a textual user interface and looks great within a terminal session, even while running inside popular code editors with included terminal panes.</p>
<h2 id="ansible-future-overview-who-will-use-execution-environments">Who will use Execution Environments?</h2>
<p>Everybody will use Execution environments, not only will they become more relevant for users of Ansible Core, but they are integral to users of the Ansible Automation platform (even if they don't know that they are using <abbr title="Execution Environments">EEs</abbr>). In short, Execution Environments are Container images which run the automation tasks, think about them as an Ansible Control node in a Container.<br />
They are a defined, consistent and portable environment for Ansible Automation consisting of a <abbr title="Red Hat Enterprise Linux">RHEL</abbr> Universal Base Image, Ansible Core, Python 3, Ansible Content Collections and all dependencies.</p>
<h2 id="ansible-future-overview-who-will-use-the-ansible-builder">Who will use the Ansible Builder?</h2>
<p>Ansible Builder is a tool that aids in the creation of Ansible Execution Environments, no container know-how is necessary, a simple <abbr title="YAML Ain't Markup Language">YAML</abbr> configuration file is used to create the Podman or Docker image. The Ansible builder will be used by Automation developers and Automation platform administrators.</p>
<!-- markdownlint-disable --></section><section class="print-page" id="ansible-navigator-ansible-navigator"><h1 id="ansible-navigator-ansible-navigator-ansible-navigator">Ansible Navigator</h1>
<h2 id="ansible-navigator-ansible-navigator-objective">Objective</h2>
<p>In this exercise, we are going to explore the latest Ansible command line utility <code>ansible-navigator</code> to learn how to work with inventory files and the listing of modules when needing assistance. The goal is to familiarize yourself with how <code>ansible-navigator</code> works and how it can be used to enrich your Ansible experience.</p>
<p>This exercise will cover</p>
<ul>
<li>Working with inventory files</li>
<li>Locating and understanding an <code>ini</code> formatted inventory file</li>
<li>Listing modules and getting help when trying to use them</li>
</ul>
<h2 id="ansible-navigator-ansible-navigator-guide">Guide</h2>
<p>With the introduction of Ansible Automation Platform 2, several new key components are being introduced as a part of the overall developer experience. Execution environments have been introduced to provide predictable environments to be used during automation runtime. All collection dependencies are contained within the execution environment to ensure that automation created in development environments runs the same as in production environments.</p>
<p>What do you find within an execution environment?</p>
<ul>
<li><abbr title="Red Hat Enterprise Linux">RHEL</abbr> UBI 8</li>
<li>Ansible 2.9 or Ansible Core 2.11</li>
<li>Python 3.8</li>
<li>Any content Collections</li>
<li>Collection python or binary dependencies.</li>
</ul>
<p>Why use execution environments?</p>
<p>They provide a standardized way to define, build and distribute the environments that the automation runs in. In a nutshell, Automation execution environments are container images that allow for easier administration of Ansible by the platform administrator.</p>
<p>Considering the shift towards containerized execution of automation, automation development workflow and tooling that existed before Ansible Automation Platform 2 have had to be re-imagined. In short, <code>ansible-navigator</code> replaces <code>ansible-playbook</code> and other <code>ansible-*</code> command line utilities.</p>
<p>With this change, Ansible playbooks are executed using the <code>ansible-navigator</code> command on the control node.</p>
<p>The prerequisites and best practices for using <code>ansible-navigator</code> have been done for you within this lab.</p>
<p>These include:</p>
<ul>
<li>Installing the <code>ansible-navigator</code> package</li>
<li>Creating a default settings <code>/home/student/.ansible-navigator.yml</code> for all your projects (optional)</li>
<li>All execution environment (<abbr title="Execution Environment">EE</abbr>) logs are stored within <code>/home/student/.ansible-navigator/logs/ansible-navigator.log</code></li>
<li>Playbook artifacts are saved under <code>/tmp/artifact.json</code></li>
</ul>
<p>Follow the next link for more information on the <a href="https://ansible.readthedocs.io/projects/navigator/settings/#the-ansible-navigator-settings-file" target="_blank">Ansible navigator settings</a>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The parameters for ansible-navigator maybe modified for your specific environment. The current settings use a default <code>ansible-navigator.yml</code> for all projects, but a specific <code>ansible-navigator.yml</code> can be created for each project and is the recommended practice.</p>
</div>
<p>A useful <em>ansible-navigator</em>-configuration for the workshop environment is the following, create a new file in your project directory <code>/home/student/ansible-files/ansible-navigator.yml</code> and paste in this configuration:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#ansible-navigator-ansible-navigator-__codelineno-0-1"></a><span class="nn">---</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#ansible-navigator-ansible-navigator-__codelineno-0-2"></a><span class="nt">ansible-navigator</span><span class="p">:</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#ansible-navigator-ansible-navigator-__codelineno-0-3"></a><span class="w">  </span><span class="nt">ansible</span><span class="p">:</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#ansible-navigator-ansible-navigator-__codelineno-0-4"></a><span class="c1"># Specify an inventory file path or comma separated host list</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#ansible-navigator-ansible-navigator-__codelineno-0-5"></a><span class="w">    </span><span class="nt">inventories</span><span class="p">:</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#ansible-navigator-ansible-navigator-__codelineno-0-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/student/lab_inventory/hosts</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#ansible-navigator-ansible-navigator-__codelineno-0-7"></a><span class="c1"># Sets configuration for  the creation of artifacts for completed playbooks.</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#ansible-navigator-ansible-navigator-__codelineno-0-8"></a><span class="c1"># Can be enabled or disabled and specify filename and location</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#ansible-navigator-ansible-navigator-__codelineno-0-9"></a><span class="w">  </span><span class="nt">playbook-artifact</span><span class="p">:</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#ansible-navigator-ansible-navigator-__codelineno-0-10"></a><span class="w">    </span><span class="nt">enable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#ansible-navigator-ansible-navigator-__codelineno-0-11"></a><span class="w">    </span><span class="nt">save-as</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">~/ansible-files/artifacts/{playbook_name}-artifact-{ts_utc}.json</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#ansible-navigator-ansible-navigator-__codelineno-0-12"></a><span class="c1"># Set user interface mode, either &#39;stdout&#39; or &#39;interactive&#39;</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#ansible-navigator-ansible-navigator-__codelineno-0-13"></a><span class="c1"># Mode &#39;stdout&#39; ensures same output method as with ansible-playbook command</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#ansible-navigator-ansible-navigator-__codelineno-0-14"></a><span class="w">  </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">interactive</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#ansible-navigator-ansible-navigator-__codelineno-0-15"></a>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#ansible-navigator-ansible-navigator-__codelineno-0-16"></a><span class="c1"># Enable or disable the use of an execution environment and specify different options</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#ansible-navigator-ansible-navigator-__codelineno-0-17"></a><span class="w">  </span><span class="nt">execution-environment</span><span class="p">:</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#ansible-navigator-ansible-navigator-__codelineno-0-18"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">registry.redhat.io/ansible-automation-platform-20-early-access/ee-supported-rhel8:2.0.0</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#ansible-navigator-ansible-navigator-__codelineno-0-19"></a><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#ansible-navigator-ansible-navigator-__codelineno-0-20"></a><span class="w">    </span><span class="nt">container-engine</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">podman</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#ansible-navigator-ansible-navigator-__codelineno-0-21"></a><span class="w">    </span><span class="nt">pull-policy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">missing</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#ansible-navigator-ansible-navigator-__codelineno-0-22"></a><span class="w">    </span><span class="nt">volume-mounts</span><span class="p">:</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#ansible-navigator-ansible-navigator-__codelineno-0-23"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/etc/ansible/&quot;</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#ansible-navigator-ansible-navigator-__codelineno-0-24"></a><span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/etc/ansible/&quot;</span>
</span></code></pre></div>
<p>Adjust the path to your inventory file, as well as the used container image if a newer image is used in the default <em>ansible-navigator</em>-configuration.</p>
<h3 id="ansible-navigator-ansible-navigator-step-1-work-with-your-inventory">Step 1 - Work with your Inventory</h3>
<p>An inventory file is a text file that specifies the nodes that will be managed by the control machine. The nodes to be managed may include a list of hostnames or IP addresses of those nodes. The inventory file allows for nodes to be organized into groups by declaring a host group name within square brackets ([]).</p>
<p>To use the <code>ansible-navigator</code> command for host management, you need to provide an inventory file which defines a list of hosts to be managed from the control node. In this lab, the inventory is provided by your instructor. The inventory file is an <code>ini</code> formatted file listing your hosts, sorted in groups, additionally providing some variables. It looks like:</p>
<div class="language-ini no-copy highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#ansible-navigator-ansible-navigator-__codelineno-1-1"></a><span class="k">[web]</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#ansible-navigator-ansible-navigator-__codelineno-1-2"></a><span class="na">node1 ansible_host</span><span class="o">=</span><span class="s">&lt;X.X.X.X&gt;</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#ansible-navigator-ansible-navigator-__codelineno-1-3"></a><span class="na">node2 ansible_host</span><span class="o">=</span><span class="s">&lt;Y.Y.Y.Y&gt;</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#ansible-navigator-ansible-navigator-__codelineno-1-4"></a><span class="na">node3 ansible_host</span><span class="o">=</span><span class="s">&lt;Z.Z.Z.Z&gt;</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#ansible-navigator-ansible-navigator-__codelineno-1-5"></a>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#ansible-navigator-ansible-navigator-__codelineno-1-6"></a><span class="k">[control]</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#ansible-navigator-ansible-navigator-__codelineno-1-7"></a><span class="na">ansible-1 ansible_host</span><span class="o">=</span><span class="s">44.55.66.77</span>
</span></code></pre></div>
<p>Ansible is already configured to use the inventory specific to your environment. We will show you in the next step how that is done. For now, we will execute some simple commands to work with the inventory.</p>
<p>To reference all the inventory hosts, you supply a pattern to the <code>ansible-navigator</code> command. <code>ansible-navigator inventory</code> has a <code>--list</code> option which can be useful for displaying all the hosts that are part of an inventory file including what groups they are associated with.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="ansible-navigator-ansible-navigator-__tabbed_1_1" name="ansible-navigator-ansible-navigator-__tabbed_1" type="radio" /><input id="ansible-navigator-ansible-navigator-__tabbed_1_2" name="ansible-navigator-ansible-navigator-__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="ansible-navigator-ansible-navigator-__tabbed_1_1">Navigator</label><label for="ansible-navigator-ansible-navigator-__tabbed_1_2">Ansible</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#ansible-navigator-ansible-navigator-__codelineno-2-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible-navigator<span class="w"> </span>inventory<span class="w"> </span>--list<span class="w"> </span>-m<span class="w"> </span>stdout
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#ansible-navigator-ansible-navigator-__codelineno-2-2"></a><span class="go">{</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#ansible-navigator-ansible-navigator-__codelineno-2-3"></a><span class="go">    &quot;_meta&quot;: {</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#ansible-navigator-ansible-navigator-__codelineno-2-4"></a><span class="go">        &quot;hostvars&quot;: {</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#ansible-navigator-ansible-navigator-__codelineno-2-5"></a><span class="go">            &quot;ansible-1&quot;: {</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#ansible-navigator-ansible-navigator-__codelineno-2-6"></a><span class="go">                &quot;ansible_host&quot;: &quot;3.236.186.92&quot;},</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#ansible-navigator-ansible-navigator-__codelineno-2-7"></a><span class="go">            &quot;node1&quot;: {</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#ansible-navigator-ansible-navigator-__codelineno-2-8"></a><span class="go">                &quot;ansible_host&quot;: &quot;3.239.234.187&quot;</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#ansible-navigator-ansible-navigator-__codelineno-2-9"></a><span class="go">            },</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#ansible-navigator-ansible-navigator-__codelineno-2-10"></a><span class="go">            &quot;node2&quot;: {</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#ansible-navigator-ansible-navigator-__codelineno-2-11"></a><span class="go">                &quot;ansible_host&quot;: &quot;75.101.228.151&quot;</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#ansible-navigator-ansible-navigator-__codelineno-2-12"></a><span class="go">            },</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#ansible-navigator-ansible-navigator-__codelineno-2-13"></a><span class="go">            &quot;node3&quot;: {</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#ansible-navigator-ansible-navigator-__codelineno-2-14"></a><span class="go">                &quot;ansible_host&quot;: &quot;100.27.38.142&quot;</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#ansible-navigator-ansible-navigator-__codelineno-2-15"></a><span class="go">            }</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#ansible-navigator-ansible-navigator-__codelineno-2-16"></a><span class="go">        }</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#ansible-navigator-ansible-navigator-__codelineno-2-17"></a><span class="go">    },</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#ansible-navigator-ansible-navigator-__codelineno-2-18"></a><span class="go">    &quot;all&quot;: {</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#ansible-navigator-ansible-navigator-__codelineno-2-19"></a><span class="go">        &quot;children&quot;: [</span>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#ansible-navigator-ansible-navigator-__codelineno-2-20"></a><span class="go">            &quot;control&quot;,</span>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#ansible-navigator-ansible-navigator-__codelineno-2-21"></a><span class="go">            &quot;ungrouped&quot;,</span>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22" href="#ansible-navigator-ansible-navigator-__codelineno-2-22"></a><span class="go">            &quot;web&quot;</span>
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23" href="#ansible-navigator-ansible-navigator-__codelineno-2-23"></a><span class="go">        ]</span>
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24" href="#ansible-navigator-ansible-navigator-__codelineno-2-24"></a><span class="go">    },</span>
</span><span id="__span-2-25"><a id="__codelineno-2-25" name="__codelineno-2-25" href="#ansible-navigator-ansible-navigator-__codelineno-2-25"></a><span class="go">    &quot;control&quot;: {</span>
</span><span id="__span-2-26"><a id="__codelineno-2-26" name="__codelineno-2-26" href="#ansible-navigator-ansible-navigator-__codelineno-2-26"></a><span class="go">        &quot;hosts&quot;: [</span>
</span><span id="__span-2-27"><a id="__codelineno-2-27" name="__codelineno-2-27" href="#ansible-navigator-ansible-navigator-__codelineno-2-27"></a><span class="go">            &quot;ansible-1&quot;</span>
</span><span id="__span-2-28"><a id="__codelineno-2-28" name="__codelineno-2-28" href="#ansible-navigator-ansible-navigator-__codelineno-2-28"></a><span class="go">        ]</span>
</span><span id="__span-2-29"><a id="__codelineno-2-29" name="__codelineno-2-29" href="#ansible-navigator-ansible-navigator-__codelineno-2-29"></a><span class="go">    },</span>
</span><span id="__span-2-30"><a id="__codelineno-2-30" name="__codelineno-2-30" href="#ansible-navigator-ansible-navigator-__codelineno-2-30"></a><span class="go">    &quot;web&quot;: {</span>
</span><span id="__span-2-31"><a id="__codelineno-2-31" name="__codelineno-2-31" href="#ansible-navigator-ansible-navigator-__codelineno-2-31"></a><span class="go">        &quot;hosts&quot;: [</span>
</span><span id="__span-2-32"><a id="__codelineno-2-32" name="__codelineno-2-32" href="#ansible-navigator-ansible-navigator-__codelineno-2-32"></a><span class="go">            &quot;node1&quot;,</span>
</span><span id="__span-2-33"><a id="__codelineno-2-33" name="__codelineno-2-33" href="#ansible-navigator-ansible-navigator-__codelineno-2-33"></a><span class="go">            &quot;node2&quot;,</span>
</span><span id="__span-2-34"><a id="__codelineno-2-34" name="__codelineno-2-34" href="#ansible-navigator-ansible-navigator-__codelineno-2-34"></a><span class="go">            &quot;node3&quot;</span>
</span><span id="__span-2-35"><a id="__codelineno-2-35" name="__codelineno-2-35" href="#ansible-navigator-ansible-navigator-__codelineno-2-35"></a><span class="go">        ]</span>
</span><span id="__span-2-36"><a id="__codelineno-2-36" name="__codelineno-2-36" href="#ansible-navigator-ansible-navigator-__codelineno-2-36"></a><span class="go">    }</span>
</span><span id="__span-2-37"><a id="__codelineno-2-37" name="__codelineno-2-37" href="#ansible-navigator-ansible-navigator-__codelineno-2-37"></a><span class="go">}</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#ansible-navigator-ansible-navigator-__codelineno-3-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible-inventory<span class="w"> </span>--list
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#ansible-navigator-ansible-navigator-__codelineno-3-2"></a><span class="go">{</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#ansible-navigator-ansible-navigator-__codelineno-3-3"></a><span class="go">    &quot;_meta&quot;: {</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#ansible-navigator-ansible-navigator-__codelineno-3-4"></a><span class="go">        &quot;hostvars&quot;: {</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#ansible-navigator-ansible-navigator-__codelineno-3-5"></a><span class="go">            &quot;ansible-1&quot;: {</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#ansible-navigator-ansible-navigator-__codelineno-3-6"></a><span class="go">                &quot;ansible_host&quot;: &quot;3.236.186.92&quot;},</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#ansible-navigator-ansible-navigator-__codelineno-3-7"></a><span class="go">            &quot;node1&quot;: {</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#ansible-navigator-ansible-navigator-__codelineno-3-8"></a><span class="go">                &quot;ansible_host&quot;: &quot;3.239.234.187&quot;</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#ansible-navigator-ansible-navigator-__codelineno-3-9"></a><span class="go">            },</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#ansible-navigator-ansible-navigator-__codelineno-3-10"></a><span class="go">            &quot;node2&quot;: {</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#ansible-navigator-ansible-navigator-__codelineno-3-11"></a><span class="go">                &quot;ansible_host&quot;: &quot;75.101.228.151&quot;</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#ansible-navigator-ansible-navigator-__codelineno-3-12"></a><span class="go">            },</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#ansible-navigator-ansible-navigator-__codelineno-3-13"></a><span class="go">            &quot;node3&quot;: {</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#ansible-navigator-ansible-navigator-__codelineno-3-14"></a><span class="go">                &quot;ansible_host&quot;: &quot;100.27.38.142&quot;</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#ansible-navigator-ansible-navigator-__codelineno-3-15"></a><span class="go">            }</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#ansible-navigator-ansible-navigator-__codelineno-3-16"></a><span class="go">        }</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#ansible-navigator-ansible-navigator-__codelineno-3-17"></a><span class="go">    },</span>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#ansible-navigator-ansible-navigator-__codelineno-3-18"></a><span class="go">    &quot;all&quot;: {</span>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19" href="#ansible-navigator-ansible-navigator-__codelineno-3-19"></a><span class="go">        &quot;children&quot;: [</span>
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20" href="#ansible-navigator-ansible-navigator-__codelineno-3-20"></a><span class="go">            &quot;control&quot;,</span>
</span><span id="__span-3-21"><a id="__codelineno-3-21" name="__codelineno-3-21" href="#ansible-navigator-ansible-navigator-__codelineno-3-21"></a><span class="go">            &quot;ungrouped&quot;,</span>
</span><span id="__span-3-22"><a id="__codelineno-3-22" name="__codelineno-3-22" href="#ansible-navigator-ansible-navigator-__codelineno-3-22"></a><span class="go">            &quot;web&quot;</span>
</span><span id="__span-3-23"><a id="__codelineno-3-23" name="__codelineno-3-23" href="#ansible-navigator-ansible-navigator-__codelineno-3-23"></a><span class="go">        ]</span>
</span><span id="__span-3-24"><a id="__codelineno-3-24" name="__codelineno-3-24" href="#ansible-navigator-ansible-navigator-__codelineno-3-24"></a><span class="go">    },</span>
</span><span id="__span-3-25"><a id="__codelineno-3-25" name="__codelineno-3-25" href="#ansible-navigator-ansible-navigator-__codelineno-3-25"></a><span class="go">    &quot;control&quot;: {</span>
</span><span id="__span-3-26"><a id="__codelineno-3-26" name="__codelineno-3-26" href="#ansible-navigator-ansible-navigator-__codelineno-3-26"></a><span class="go">        &quot;hosts&quot;: [</span>
</span><span id="__span-3-27"><a id="__codelineno-3-27" name="__codelineno-3-27" href="#ansible-navigator-ansible-navigator-__codelineno-3-27"></a><span class="go">            &quot;ansible-1&quot;</span>
</span><span id="__span-3-28"><a id="__codelineno-3-28" name="__codelineno-3-28" href="#ansible-navigator-ansible-navigator-__codelineno-3-28"></a><span class="go">        ]</span>
</span><span id="__span-3-29"><a id="__codelineno-3-29" name="__codelineno-3-29" href="#ansible-navigator-ansible-navigator-__codelineno-3-29"></a><span class="go">    },</span>
</span><span id="__span-3-30"><a id="__codelineno-3-30" name="__codelineno-3-30" href="#ansible-navigator-ansible-navigator-__codelineno-3-30"></a><span class="go">    &quot;web&quot;: {</span>
</span><span id="__span-3-31"><a id="__codelineno-3-31" name="__codelineno-3-31" href="#ansible-navigator-ansible-navigator-__codelineno-3-31"></a><span class="go">        &quot;hosts&quot;: [</span>
</span><span id="__span-3-32"><a id="__codelineno-3-32" name="__codelineno-3-32" href="#ansible-navigator-ansible-navigator-__codelineno-3-32"></a><span class="go">            &quot;node1&quot;,</span>
</span><span id="__span-3-33"><a id="__codelineno-3-33" name="__codelineno-3-33" href="#ansible-navigator-ansible-navigator-__codelineno-3-33"></a><span class="go">            &quot;node2&quot;,</span>
</span><span id="__span-3-34"><a id="__codelineno-3-34" name="__codelineno-3-34" href="#ansible-navigator-ansible-navigator-__codelineno-3-34"></a><span class="go">            &quot;node3&quot;</span>
</span><span id="__span-3-35"><a id="__codelineno-3-35" name="__codelineno-3-35" href="#ansible-navigator-ansible-navigator-__codelineno-3-35"></a><span class="go">        ]</span>
</span><span id="__span-3-36"><a id="__codelineno-3-36" name="__codelineno-3-36" href="#ansible-navigator-ansible-navigator-__codelineno-3-36"></a><span class="go">    }</span>
</span><span id="__span-3-37"><a id="__codelineno-3-37" name="__codelineno-3-37" href="#ansible-navigator-ansible-navigator-__codelineno-3-37"></a><span class="go">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>-m</code> is short for <code>--mode</code> which allows for the mode to be switched to standard output instead of using the text-based user interface (TUI).</p>
</div>
<p>If the <code>--list</code> is too verbose, the option of <code>--graph</code> can be used to provide a more condensed version of <code>--list</code>.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="ansible-navigator-ansible-navigator-__tabbed_2_1" name="ansible-navigator-ansible-navigator-__tabbed_2" type="radio" /><input id="ansible-navigator-ansible-navigator-__tabbed_2_2" name="ansible-navigator-ansible-navigator-__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="ansible-navigator-ansible-navigator-__tabbed_2_1">Navigator</label><label for="ansible-navigator-ansible-navigator-__tabbed_2_2">Ansible</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#ansible-navigator-ansible-navigator-__codelineno-4-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible-navigator<span class="w"> </span>inventory<span class="w"> </span>--graph<span class="w"> </span>-m<span class="w"> </span>stdout
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#ansible-navigator-ansible-navigator-__codelineno-4-2"></a><span class="go">@all:</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#ansible-navigator-ansible-navigator-__codelineno-4-3"></a><span class="go">|--@control:</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#ansible-navigator-ansible-navigator-__codelineno-4-4"></a><span class="go">|  |--ansible-1</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#ansible-navigator-ansible-navigator-__codelineno-4-5"></a><span class="go">|--@ungrouped:</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#ansible-navigator-ansible-navigator-__codelineno-4-6"></a><span class="go">|--@web:</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#ansible-navigator-ansible-navigator-__codelineno-4-7"></a><span class="go">|  |--node1</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#ansible-navigator-ansible-navigator-__codelineno-4-8"></a><span class="go">|  |--node2</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#ansible-navigator-ansible-navigator-__codelineno-4-9"></a><span class="go">|  |--node3</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#ansible-navigator-ansible-navigator-__codelineno-5-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible-inventory<span class="w"> </span>--graph
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#ansible-navigator-ansible-navigator-__codelineno-5-2"></a><span class="go">@all:</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#ansible-navigator-ansible-navigator-__codelineno-5-3"></a><span class="go">|--@control:</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#ansible-navigator-ansible-navigator-__codelineno-5-4"></a><span class="go">|  |--ansible-1</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#ansible-navigator-ansible-navigator-__codelineno-5-5"></a><span class="go">|--@ungrouped:</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#ansible-navigator-ansible-navigator-__codelineno-5-6"></a><span class="go">|--@web:</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#ansible-navigator-ansible-navigator-__codelineno-5-7"></a><span class="go">|  |--node1</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#ansible-navigator-ansible-navigator-__codelineno-5-8"></a><span class="go">|  |--node2</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#ansible-navigator-ansible-navigator-__codelineno-5-9"></a><span class="go">|  |--node3</span>
</span></code></pre></div>
</div>
</div>
</div>
<p>We can clearly see that nodes: <code>node1</code>, <code>node2</code>, <code>node3</code> are part of the <code>web</code> group, while <code>ansible-1</code> is part of the <code>control</code> group.</p>
<p>An inventory file can contain a lot more information, it can organize your hosts in groups or define variables. In our example, the current inventory has the groups <code>web</code> and <code>control</code>. Run Ansible with these host patterns and observe the output:</p>
<p>Using the <code>ansible-navigator inventory</code> command, we can also run commands that provide information only for one host or group. For example, give the following commands a try to see their output.</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#ansible-navigator-ansible-navigator-__codelineno-6-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible-navigator<span class="w"> </span>inventory<span class="w"> </span>--graph<span class="w"> </span>web<span class="w"> </span>-m<span class="w"> </span>stdout
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#ansible-navigator-ansible-navigator-__codelineno-6-2"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible-navigator<span class="w"> </span>inventory<span class="w"> </span>--graph<span class="w"> </span>control<span class="w"> </span>-m<span class="w"> </span>stdout
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#ansible-navigator-ansible-navigator-__codelineno-6-3"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible-navigator<span class="w"> </span>inventory<span class="w"> </span>--host<span class="w"> </span>node1<span class="w"> </span>-m<span class="w"> </span>stdout
</span></code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The inventory can contain more data. E.g. if you have hosts that run on non-standard <abbr title="Secure Shell">SSH</abbr> ports you can put the port number after the hostname with a colon. Or you could define names specific to Ansible and have them point to the "real" IP or hostname.</p>
</div>
<h3 id="ansible-navigator-ansible-navigator-step-2-listing-modules-and-getting-help">Step 2 - Listing Modules and Getting Help</h3>
<p>Ansible Automation Platform comes with multiple supported Execution Environments (<abbr title="Execution Environments">EEs</abbr>).  These <abbr title="Execution Environments">EEs</abbr> come with bundled supported collections that contain supported content, including modules.  To browse your available modules first enter interactive mode:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#ansible-navigator-ansible-navigator-__codelineno-7-1"></a>ansible-navigator
</span></code></pre></div>
<p><img alt="picture of ansible-navigator" src="../ansible-navigator/images/interactive-mode.png" /></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>In <code>ansible-navigator</code> exit by pressing the button <code>ESC</code>.</p>
</div>
<p>First browse a collection by typing <code>:collections</code></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#ansible-navigator-ansible-navigator-__codelineno-8-1"></a>:collections
</span></code></pre></div>
<p><img alt="picture of ansible-navigator" src="../ansible-navigator/images/interactive-collections.png" /></p>
<p>To browse the content for a specific collections, type the corresponding number.  For example in the example screenshot above the number <code>0</code> corresponds to <code>amazon.aws</code> collection.  To zoom into collection type the number <code>0</code>.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#ansible-navigator-ansible-navigator-__codelineno-9-1"></a><span class="m">0</span>
</span></code></pre></div>
<p><img alt="picture of ansible-navigator" src="../ansible-navigator/images/interactive-aws.png" /></p>
<p>Get help for a specific module including usage by zooming in further.  For example the module <code>ec2_tag</code> corresponds to <code>24</code>.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#ansible-navigator-ansible-navigator-__codelineno-10-1"></a>:24
</span></code></pre></div>
<p>Scrolling down using the arrow keys or page-up and page-down can show us documentation and examples.</p>
<p><img alt="picture of ansible-navigator" src="../ansible-navigator/images/interactive-ec2-tag.png" /></p>
<p>You can also skip directly to a particular module by simply typing <code>:doc namespace.collection.module-name</code>.  For example typing <code>:doc amazon.aws.ec2_tag</code> would skip directly to the final page shown above.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Different execution environments can have access to different collections, and different versions of those collections.  By using the built-in documentation you know that it will be accurate for that particular version of the collection.</p>
</div>
<h3 id="ansible-navigator-ansible-navigator-step-3-examining-execution-environments">Step 3 - Examining Execution Environments</h3>
<p>Run the <code>ansible-navigator</code> command with the <code>images</code> argument to look at execution environments configured on the control node:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#ansible-navigator-ansible-navigator-__codelineno-11-1"></a>ansible-navigator<span class="w"> </span>images
</span></code></pre></div>
<p><img alt="ansible-navigator images" src="../ansible-navigator/images/navigator-images.png" /></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The output  you see might differ from the above output</p>
</div>
<p>This command gives you information about all currently installed Execution Environments or <abbr title="Execution Environments">EEs</abbr> for short.  Investigate an <abbr title="Execution Environment">EE</abbr> by pressing the corresponding number.  For example pressing <strong>2</strong> with the above example will open the <code>ee-supported-rhel8</code> execution environment:</p>
<p><img alt="ee main menu" src="../ansible-navigator/images/navigator-ee-menu.png" /></p>
<p>Selecting <code>2</code> for <code>Ansible version and collections</code> will show us all Ansible Collections installed on that particular <abbr title="Execution Environment">EE</abbr>, and the version of <code>ansible-core</code>:</p>
<p><img alt="ee info" src="../ansible-navigator/images/navigator-ee-collections.png" /></p>
<h3 id="ansible-navigator-ansible-navigator-step-4-examining-the-ansible-navigator-configuration">Step 4 - Examining the ansible-navigator configuration</h3>
<p>Either use Visual Studio Code to open or use the <code>cat</code> command to view the contents of the <code>ansible-navigator.yml</code> file.  The file is located in the home directory:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#ansible-navigator-ansible-navigator-__codelineno-12-1"></a><span class="gp">$ </span>cat<span class="w"> </span>~/.ansible-navigator.yml
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#ansible-navigator-ansible-navigator-__codelineno-12-2"></a><span class="go">---</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#ansible-navigator-ansible-navigator-__codelineno-12-3"></a><span class="go">ansible-navigator:</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#ansible-navigator-ansible-navigator-__codelineno-12-4"></a><span class="go">  ansible:</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#ansible-navigator-ansible-navigator-__codelineno-12-5"></a><span class="go">    inventories:</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#ansible-navigator-ansible-navigator-__codelineno-12-6"></a><span class="go">    - /home/student/lab_inventory/hosts</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#ansible-navigator-ansible-navigator-__codelineno-12-7"></a>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#ansible-navigator-ansible-navigator-__codelineno-12-8"></a><span class="go">  execution-environment:</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#ansible-navigator-ansible-navigator-__codelineno-12-9"></a><span class="go">    image: registry.redhat.io/ansible-automation-platform-20-early-access/ee-supported-rhel8:2.0.0</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#ansible-navigator-ansible-navigator-__codelineno-12-10"></a><span class="go">    enabled: true</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#ansible-navigator-ansible-navigator-__codelineno-12-11"></a><span class="go">    container-engine: podman</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#ansible-navigator-ansible-navigator-__codelineno-12-12"></a><span class="go">    pull-policy: missing</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#ansible-navigator-ansible-navigator-__codelineno-12-13"></a><span class="go">    volume-mounts:</span>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#ansible-navigator-ansible-navigator-__codelineno-12-14"></a><span class="go">    - src: &quot;/etc/ansible/&quot;</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#ansible-navigator-ansible-navigator-__codelineno-12-15"></a><span class="go">      dest: &quot;/etc/ansible/&quot;</span>
</span></code></pre></div>
<p>Note the following parameters within the <code>ansible-navigator.yml</code> file:</p>
<ul>
<li><code>inventories</code>: shows the location of the ansible inventory being used</li>
<li><code>execution-environment</code>: where the default execution environment is set</li>
</ul>
<p>For a full listing of every configurable knob checkout the <a href="https://ansible-navigator.readthedocs.io/en/latest/settings/" target="_blank">documentation</a>.</p>
<h3 id="ansible-navigator-ansible-navigator-step-3-running-the-playbook">Step 3 - Running the Playbook</h3>
<p>Create a simple playbook:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#ansible-navigator-ansible-navigator-__codelineno-13-1"></a><span class="nn">---</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#ansible-navigator-ansible-navigator-__codelineno-13-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Apache server installation</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#ansible-navigator-ansible-navigator-__codelineno-13-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node1</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#ansible-navigator-ansible-navigator-__codelineno-13-4"></a><span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#ansible-navigator-ansible-navigator-__codelineno-13-5"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#ansible-navigator-ansible-navigator-__codelineno-13-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ensure Apache package is installed</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#ansible-navigator-ansible-navigator-__codelineno-13-7"></a><span class="w">      </span><span class="nt">ansible.builtin.yum</span><span class="p">:</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#ansible-navigator-ansible-navigator-__codelineno-13-8"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#ansible-navigator-ansible-navigator-__codelineno-13-9"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span></code></pre></div>
<p>To run your playbook, use the <code>ansible-navigator run &lt;playbook&gt;</code> command as follows:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#ansible-navigator-ansible-navigator-__codelineno-14-1"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>ansible-navigator<span class="w"> </span>run<span class="w"> </span>apache.yml
</span></code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The existing <code>ansible-navigator.yml</code> file provides the location of your inventory file. If this was not set within your <code>ansible-navigator.yml</code> file, the command to run the playbook would be: <code>ansible-navigator run apache.yml -i /home/student/lab_inventory/hosts</code></p>
</div>
<p>When running the playbook, you'll be displayed a text user interface (TUI) that displays the play name among other information about the playbook that is currently run.</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#ansible-navigator-ansible-navigator-__codelineno-15-1"></a><span class="go">  PLAY NAME                        OK  CHANGED    UNREACHABLE      FAILED    SKIPPED    IGNORED    IN PROGRESS     TASK COUNT          PROGRESS</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#ansible-navigator-ansible-navigator-__codelineno-15-2"></a><span class="go">0│Apache server installed           2        1              0           0          0          0              0              2          COMPLETE</span>
</span></code></pre></div>
<p>If you notice, prior to the play name <code>Apache server installed</code>, you'll see a <code>0</code>. By pressing the <code>0</code> key on your keyboard, you will be provided a new window view displaying the different tasks that ran for the playbook completion. In this example, those tasks included the "Gathering Facts" and "latest Apache version installed". The "Gathering Facts" is a built-in task that runs automatically at the beginning of each play. It collects information about the managed nodes. Exercises later on will cover this in more detail. The "latest Apache version installed" was the task created within the <code>apache.yml</code> file that installed <code>httpd</code>.</p>
<p>The display should look something like this:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#ansible-navigator-ansible-navigator-__codelineno-16-1"></a><span class="go">  RESULT   HOST    NUMBER   CHANGED   TASK                              TASK ACTION    DURATION</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#ansible-navigator-ansible-navigator-__codelineno-16-2"></a><span class="go">0│OK       node1   0        False     Gathering Facts                   gather_facts   1s</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#ansible-navigator-ansible-navigator-__codelineno-16-3"></a><span class="go">1│OK       node1   1        False     latest Apache version installed   yum            4s</span>
</span></code></pre></div>
<p>Taking a closer look, you'll notice that each task is associated with a number. Task 1, "latest Apache version installed", does not show a change state, you already installed Apache yesterday, otherwise it would show a change.</p>
<p>By pressing <code>0</code> or <code>1</code> on your keyboard, you can see further details of the task being run. If a more traditional output view is desired, type <code>:st</code> within the text user interface.</p>
<p>Once you've completed, reviewing your Ansible playbook, you can exit out of the TUI via the Esc key on your keyboard.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The <em>Esc</em> key only takes you back to the previous screen. Once at the main overview screen an additional <em>Esc</em> key will take you back to the terminal window.</p>
</div>
<p>Once the playbook has completed, connect to <code>node1</code> via <abbr title="Secure Shell">SSH</abbr> to make sure Apache has been installed. You may also skip this, as you did this yesterday.</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#ansible-navigator-ansible-navigator-__codelineno-17-1"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>ssh<span class="w"> </span>node1
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#ansible-navigator-ansible-navigator-__codelineno-17-2"></a><span class="go">Last login: Wed May 15 14:03:45 2019 from 44.55.66.77</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#ansible-navigator-ansible-navigator-__codelineno-17-3"></a><span class="go">Managed by Ansible</span>
</span></code></pre></div>
<p>Use the command <code>rpm -qi httpd</code> to verify httpd is installed:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#ansible-navigator-ansible-navigator-__codelineno-18-1"></a><span class="gp">[ec2-user@node1 ~]$ </span>rpm<span class="w"> </span>-qi<span class="w"> </span>httpd
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#ansible-navigator-ansible-navigator-__codelineno-18-2"></a><span class="go">Name        : httpd</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#ansible-navigator-ansible-navigator-__codelineno-18-3"></a><span class="go">Version     : 2.4.37</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#ansible-navigator-ansible-navigator-__codelineno-18-4"></a><span class="go">[...]</span>
</span></code></pre></div>
<p>Log out of <code>node1</code> with the command <code>exit</code> so that you are back on the control host and verify the installed package with an Ansible playbook labeled <code>package.yml</code></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#ansible-navigator-ansible-navigator-__codelineno-19-1"></a><span class="nn">---</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#ansible-navigator-ansible-navigator-__codelineno-19-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Check packages</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#ansible-navigator-ansible-navigator-__codelineno-19-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node1</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#ansible-navigator-ansible-navigator-__codelineno-19-4"></a><span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#ansible-navigator-ansible-navigator-__codelineno-19-5"></a><span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#ansible-navigator-ansible-navigator-__codelineno-19-6"></a><span class="w">    </span><span class="nt">package</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;httpd&quot;</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#ansible-navigator-ansible-navigator-__codelineno-19-7"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#ansible-navigator-ansible-navigator-__codelineno-19-8"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Gather the package facts</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#ansible-navigator-ansible-navigator-__codelineno-19-9"></a><span class="w">      </span><span class="nt">ansible.builtin.package_facts</span><span class="p">:</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#ansible-navigator-ansible-navigator-__codelineno-19-10"></a><span class="w">        </span><span class="nt">manager</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">auto</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#ansible-navigator-ansible-navigator-__codelineno-19-11"></a>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#ansible-navigator-ansible-navigator-__codelineno-19-12"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Output message if package is installed</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#ansible-navigator-ansible-navigator-__codelineno-19-13"></a><span class="w">      </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#ansible-navigator-ansible-navigator-__codelineno-19-14"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">package</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">Version</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">ansible_facts.packages[package][0].version</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">installed!&quot;</span>
</span></code></pre></div>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#ansible-navigator-ansible-navigator-__codelineno-20-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible-navigator<span class="w"> </span>run<span class="w"> </span>package.yml<span class="w"> </span>-m<span class="w"> </span>stdout
</span></code></pre></div>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#ansible-navigator-ansible-navigator-__codelineno-21-1"></a><span class="go">PLAY [Check packages] **********************************************************</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#ansible-navigator-ansible-navigator-__codelineno-21-2"></a><span class="go">TASK [Gathering Facts] *********************************************************</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#ansible-navigator-ansible-navigator-__codelineno-21-3"></a><span class="go">ok: [ansible]</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#ansible-navigator-ansible-navigator-__codelineno-21-4"></a><span class="go">TASK [Gather the package facts] ************************************************</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#ansible-navigator-ansible-navigator-__codelineno-21-5"></a><span class="go">ok: [ansible]</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#ansible-navigator-ansible-navigator-__codelineno-21-6"></a><span class="go">TASK [Check whether a httpd  is installed] *************************************</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#ansible-navigator-ansible-navigator-__codelineno-21-7"></a><span class="go">ok: [ansible] =&gt; {</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#ansible-navigator-ansible-navigator-__codelineno-21-8"></a><span class="go">    &quot;msg&quot;: &quot;httpd 2.4.37 is installed!&quot;</span>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#ansible-navigator-ansible-navigator-__codelineno-21-9"></a><span class="go">}</span>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#ansible-navigator-ansible-navigator-__codelineno-21-10"></a><span class="go">PLAY RECAP *********************************************************************</span>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#ansible-navigator-ansible-navigator-__codelineno-21-11"></a><span class="go">ansible                    : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0  </span>
</span></code></pre></div>
<h3 id="ansible-navigator-ansible-navigator-step-5-extend-your-playbook-create-an-webhtml">Step 5 - Extend your Playbook: Create an web.html</h3>
<p>Check that the tasks were executed correctly and Apache is accepting connections: Make an <abbr title="Hyper Text Transfer Protocol">HTTP</abbr> request using Ansible’s <code>uri</code> module in a playbook named check_httpd.yml from the control node to <code>node1</code>.</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#ansible-navigator-ansible-navigator-__codelineno-22-1"></a><span class="nn">---</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#ansible-navigator-ansible-navigator-__codelineno-22-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Check URL</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#ansible-navigator-ansible-navigator-__codelineno-22-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">control</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#ansible-navigator-ansible-navigator-__codelineno-22-4"></a><span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#ansible-navigator-ansible-navigator-__codelineno-22-5"></a><span class="w">    </span><span class="nt">node</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;node1&quot;</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#ansible-navigator-ansible-navigator-__codelineno-22-6"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#ansible-navigator-ansible-navigator-__codelineno-22-7"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Check that you can connect (GET) to a page and it returns a status 200</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#ansible-navigator-ansible-navigator-__codelineno-22-8"></a><span class="w">      </span><span class="nt">ansible.builtin.uri</span><span class="p">:</span>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#ansible-navigator-ansible-navigator-__codelineno-22-9"></a><span class="w">        </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://{{</span><span class="nv"> </span><span class="s">node</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><strong>Expect a lot of red lines and a 403 status!</strong></p>
</div>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#ansible-navigator-ansible-navigator-__codelineno-23-1"></a><span class="gp">[student@ansible-1 ~]$ </span>ansible-navigator<span class="w"> </span>run<span class="w"> </span>check_httpd.yml<span class="w"> </span>-m<span class="w"> </span>stdout
</span></code></pre></div>
<p>There are a lot of red lines and an error: As long as there is not at least an <code>web.html</code> file to be served by Apache, it will throw an ugly "<abbr title="Hyper Text Transfer Protocol">HTTP</abbr> Error 403: Forbidden" status and Ansible will report an error.</p>
<p>So why not use Ansible to deploy a simple <code>web.html</code> file? On the ansible control host, as the <code>student</code> user, create the directory <code>files</code> to hold file resources in <code>~/ansible-files/</code>:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#ansible-navigator-ansible-navigator-__codelineno-24-1"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>mkdir<span class="w"> </span>files
</span></code></pre></div>
<p>Then create the file <code>~/ansible-files/files/web.html</code> on the control node:</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#ansible-navigator-ansible-navigator-__codelineno-25-1"></a><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#ansible-navigator-ansible-navigator-__codelineno-25-2"></a><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Apache is running fine<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#ansible-navigator-ansible-navigator-__codelineno-25-3"></a><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></code></pre></div>
<p>In a previous example, you used Ansible’s <code>copy</code> module to write text supplied on the command line into a file. Now you’ll use the module in your playbook to copy a file.</p>
<p>On the control node as your student user edit the file <code>~/ansible-files/apache.yml</code> and add a new task utilizing the <code>copy</code> module. It should now look like this:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#ansible-navigator-ansible-navigator-__codelineno-26-1"></a><span class="nn">---</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#ansible-navigator-ansible-navigator-__codelineno-26-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Apache server installation</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#ansible-navigator-ansible-navigator-__codelineno-26-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node1</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#ansible-navigator-ansible-navigator-__codelineno-26-4"></a><span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#ansible-navigator-ansible-navigator-__codelineno-26-5"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#ansible-navigator-ansible-navigator-__codelineno-26-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install Apache package</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#ansible-navigator-ansible-navigator-__codelineno-26-7"></a><span class="w">      </span><span class="nt">ansible.builtin.yum</span><span class="p">:</span>
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#ansible-navigator-ansible-navigator-__codelineno-26-8"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd</span>
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9" href="#ansible-navigator-ansible-navigator-__codelineno-26-9"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10" href="#ansible-navigator-ansible-navigator-__codelineno-26-10"></a>
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11" href="#ansible-navigator-ansible-navigator-__codelineno-26-11"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ensure Apache is enabled and running</span>
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12" href="#ansible-navigator-ansible-navigator-__codelineno-26-12"></a><span class="w">      </span><span class="nt">ansible.builtin.service</span><span class="p">:</span>
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13" href="#ansible-navigator-ansible-navigator-__codelineno-26-13"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd.service</span>
</span><span id="__span-26-14"><a id="__codelineno-26-14" name="__codelineno-26-14" href="#ansible-navigator-ansible-navigator-__codelineno-26-14"></a><span class="w">        </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-26-15"><a id="__codelineno-26-15" name="__codelineno-26-15" href="#ansible-navigator-ansible-navigator-__codelineno-26-15"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
</span><span id="__span-26-16"><a id="__codelineno-26-16" name="__codelineno-26-16" href="#ansible-navigator-ansible-navigator-__codelineno-26-16"></a>
</span><span id="__span-26-17"><a id="__codelineno-26-17" name="__codelineno-26-17" href="#ansible-navigator-ansible-navigator-__codelineno-26-17"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Copy file for webserver index</span>
</span><span id="__span-26-18"><a id="__codelineno-26-18" name="__codelineno-26-18" href="#ansible-navigator-ansible-navigator-__codelineno-26-18"></a><span class="w">      </span><span class="nt">ansible.builtin.copy</span><span class="p">:</span>
</span><span id="__span-26-19"><a id="__codelineno-26-19" name="__codelineno-26-19" href="#ansible-navigator-ansible-navigator-__codelineno-26-19"></a><span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web.html</span>
</span><span id="__span-26-20"><a id="__codelineno-26-20" name="__codelineno-26-20" href="#ansible-navigator-ansible-navigator-__codelineno-26-20"></a><span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/www/html/index.html</span>
</span><span id="__span-26-21"><a id="__codelineno-26-21" name="__codelineno-26-21" href="#ansible-navigator-ansible-navigator-__codelineno-26-21"></a><span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0644&quot;</span>
</span></code></pre></div>
<p>What does this new copy task do? The new task uses the <code>copy</code> module and defines the source and destination options for the copy operation as parameters.</p>
<p>Run your extended Playbook:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#ansible-navigator-ansible-navigator-__codelineno-27-1"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>ansible-navigator<span class="w"> </span>run<span class="w"> </span>apache.yml<span class="w"> </span>-m<span class="w"> </span>stdout
</span></code></pre></div>
<ul>
<li>
<p>Have a good look at the output, notice the changes of "CHANGED" and the tasks associated with that change.</p>
</li>
<li>
<p>Run the Ansible playbook check_httpd.yml using the "uri" module from above again to test Apache. The command should now return a friendly green "status: 200" line, amongst other information.</p>
</li>
</ul>
<h3 id="ansible-navigator-ansible-navigator-step-6-practice-apply-to-multiple-host">Step 6 - Practice: Apply to Multiple Host</h3>
<p>While the above, shows the simplicity of applying changes to a particular host. What about if you want to set changes to many hosts? This is where you'll notice the real power of Ansible as it applies the same set of tasks reliably to many hosts.</p>
<ul>
<li>So what about changing the apache.yml Playbook to run on <code>node1</code> <strong>and</strong> <code>node2</code> <strong>and</strong> <code>node3</code>?</li>
</ul>
<p>As you might remember, the inventory lists all nodes as members of the group <code>web</code>:</p>
<div class="language-ini no-copy highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#ansible-navigator-ansible-navigator-__codelineno-28-1"></a><span class="k">[web]</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#ansible-navigator-ansible-navigator-__codelineno-28-2"></a><span class="na">node1 ansible_host</span><span class="o">=</span><span class="s">node1.example.com</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#ansible-navigator-ansible-navigator-__codelineno-28-3"></a><span class="na">node2 ansible_host</span><span class="o">=</span><span class="s">node2.example.com</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#ansible-navigator-ansible-navigator-__codelineno-28-4"></a><span class="na">node3 ansible_host</span><span class="o">=</span><span class="s">node3.example.com</span>
</span></code></pre></div>
<p>Change the playbook <code>hosts</code> parameter to point to <code>web</code> instead of <code>node1</code>:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#ansible-navigator-ansible-navigator-__codelineno-29-1"></a><span class="nn">---</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#ansible-navigator-ansible-navigator-__codelineno-29-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Apache server installation</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#ansible-navigator-ansible-navigator-__codelineno-29-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#ansible-navigator-ansible-navigator-__codelineno-29-4"></a><span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#ansible-navigator-ansible-navigator-__codelineno-29-5"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#ansible-navigator-ansible-navigator-__codelineno-29-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install Apache package</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#ansible-navigator-ansible-navigator-__codelineno-29-7"></a><span class="w">      </span><span class="nt">ansible.builtin.yum</span><span class="p">:</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#ansible-navigator-ansible-navigator-__codelineno-29-8"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#ansible-navigator-ansible-navigator-__codelineno-29-9"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#ansible-navigator-ansible-navigator-__codelineno-29-10"></a>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#ansible-navigator-ansible-navigator-__codelineno-29-11"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ensure Apache is enabled and running</span>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#ansible-navigator-ansible-navigator-__codelineno-29-12"></a><span class="w">      </span><span class="nt">ansible.builtin.service</span><span class="p">:</span>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13" href="#ansible-navigator-ansible-navigator-__codelineno-29-13"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd.service</span>
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14" href="#ansible-navigator-ansible-navigator-__codelineno-29-14"></a><span class="w">        </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-29-15"><a id="__codelineno-29-15" name="__codelineno-29-15" href="#ansible-navigator-ansible-navigator-__codelineno-29-15"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
</span><span id="__span-29-16"><a id="__codelineno-29-16" name="__codelineno-29-16" href="#ansible-navigator-ansible-navigator-__codelineno-29-16"></a>
</span><span id="__span-29-17"><a id="__codelineno-29-17" name="__codelineno-29-17" href="#ansible-navigator-ansible-navigator-__codelineno-29-17"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Copy file for webserver index</span>
</span><span id="__span-29-18"><a id="__codelineno-29-18" name="__codelineno-29-18" href="#ansible-navigator-ansible-navigator-__codelineno-29-18"></a><span class="w">      </span><span class="nt">ansible.builtin.copy</span><span class="p">:</span>
</span><span id="__span-29-19"><a id="__codelineno-29-19" name="__codelineno-29-19" href="#ansible-navigator-ansible-navigator-__codelineno-29-19"></a><span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web.html</span>
</span><span id="__span-29-20"><a id="__codelineno-29-20" name="__codelineno-29-20" href="#ansible-navigator-ansible-navigator-__codelineno-29-20"></a><span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/www/html/index.html</span>
</span><span id="__span-29-21"><a id="__codelineno-29-21" name="__codelineno-29-21" href="#ansible-navigator-ansible-navigator-__codelineno-29-21"></a><span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0644&quot;</span>
</span></code></pre></div>
<p>Now run the playbook:</p>
<div class="language-console no-copy highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#ansible-navigator-ansible-navigator-__codelineno-30-1"></a><span class="gp">[student@ansible-1 ansible-files]$ </span>ansible-navigator<span class="w"> </span>run<span class="w"> </span>apache.yml<span class="w"> </span>-m<span class="w"> </span>stdout
</span></code></pre></div>
<p>Verify if Apache is now running on all web servers (node1, node2, node3). All output should be green.</p>
<!-- markdownlint-disable --></section><h1 class='nav-section-title-end'>Ended: Ansible Future</h1></div>












                

              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; Computacenter 2023
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://gitlab.ccloud.ninja/tgruetzmacher/ansible-workshop-exercises" target="_blank" rel="noopener" title="Project in Gitlab" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="m503.5 204.6-.7-1.8-69.7-181.78c-1.4-3.57-3.9-6.59-7.2-8.64-2.4-1.55-5.1-2.515-8-2.81-2.9-.295-5.7.083-8.4 1.11-2.7 1.02-5.1 2.66-7.1 4.78-1.9 2.12-3.3 4.67-4.1 7.44l-47 144H160.8l-47.1-144c-.8-2.77-2.2-5.31-4.1-7.43-2-2.12-4.4-3.75-7.1-4.77a18.1 18.1 0 0 0-8.38-1.113 18.4 18.4 0 0 0-8.04 2.793 18.09 18.09 0 0 0-7.16 8.64L9.267 202.8l-.724 1.8a129.57 129.57 0 0 0-3.52 82c7.747 26.9 24.047 50.7 46.447 67.6l.27.2.59.4 105.97 79.5 52.6 39.7 32 24.2c3.7 1.9 8.3 4.3 13 4.3 4.7 0 9.3-2.4 13-4.3l32-24.2 52.6-39.7 106.7-79.9.3-.3c22.4-16.9 38.7-40.6 45.6-67.5 8.6-27 7.4-55.8-2.6-82z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://github.com/TimGrt/Ansible-Workshop-Exercises/blob/main/Dockerfile" target="_blank" rel="noopener" title="Container Definition" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "/", "features": ["content.code.annotate", "content.code.copy", "navigation.indexes", "navigation.instant", "navigation.sections", "navigation.tabs", "navigation.top", "search.highlight", "search.suggest"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c8d2eff1.min.js"></script>
      
        <script src="../js/print-site.js"></script>
      
        <script src="../assets/javascripts/extra/refresh-on-toggle-dark-light.js"></script>
      
        <script src="../assets/javascripts/extra/tablesort.min.js"></script>
      
        <script src="../assets/javascripts/extra/tablesort.js"></script>
      
    
  </body>
</html>